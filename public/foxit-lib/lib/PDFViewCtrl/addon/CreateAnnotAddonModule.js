!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):"function"==typeof define&&define.amd?define(["PDFViewCtrl","jquery",["PDFViewCtrl","PDFViewer"],["PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.PDFViewCtrl_CreateAnnotAddonModule=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):e.PDFViewCtrl_CreateAnnotAddonModule=t(e.PDFViewCtrl,e.jQuery,e.PDFViewCtrl.PDFViewer,e.PDFViewCtrl.commons)}(self,((e,t,n,i)=>(()=>{var a={425:(e,t,n)=>{var i=n(118),a=n(435);function r(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},548:(e,t,n)=>{var i=n(118),a=n(435);function r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},118:(e,t,n)=>{var i=n(218),a=Object.create,r=function(){function e(){}return function(t){if(!i(t))return{};if(a)return a(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=r},435:e=>{e.exports=function(){}},278:e=>{e.exports=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}},913:(e,t,n)=>{var i=n(425),a=n(548),r=n(278);e.exports=function(e){if(e instanceof i)return e.clone();var t=new a(e.__wrapped__,e.__chain__);return t.__actions__=r(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},263:(e,t,n)=>{var i=n(111);e.exports=function(e){var t=i(e);return t.__chain__=!0,t}},469:e=>{var t=Array.isArray;e.exports=t},218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},5:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},111:(e,t,n)=>{var i=n(425),a=n(548),r=n(435),o=n(469),s=n(5),c=n(913),l=Object.prototype.hasOwnProperty;function u(e){if(s(e)&&!o(e)&&!(e instanceof i)){if(e instanceof a)return e;if(l.call(e,"__wrapped__"))return c(e)}return new a(e)}u.prototype=r.prototype,u.prototype.constructor=u,e.exports=u},778:t=>{"use strict";t.exports=e},47:e=>{"use strict";e.exports=t},602:e=>{"use strict";e.exports=n},457:e=>{"use strict";e.exports=i}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function r(e,t,n){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}},r(e,t,n||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function h(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function f(e){return function(e){if(Array.isArray(e))return u(e)}(e)||d(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(p=function(){return!!e})()}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?v(e):t;var n}function m(e){var t=p();return function(){var n,i=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function y(e){if(Array.isArray(e))return e}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return r}}(e,t)||h(e,t)||S()}o.r(s),o.d(s,{CreateAnnotAddon:()=>Cs,CreateStampService:()=>ho});var w=o(778),E=w.stateHandler,b=E.IStateHandler,k=E.HandStateHandler,R=w.vendors.Hammer,T=E.StateHandlerConsts.STATE_HANDLER_CREATE_TEXT,x=w.ViewerEvents,C=w.shared,P=C.getClientX,_=C.getClientY,I=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-note",i}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o=i[0],s=this.hammer=new R.Manager(o,{recognizers:[[R.Tap]]}),c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan,u=c.otelService;s.on("tap",(function(t){var i=o.getBoundingClientRect(),s=t.srcEvent,c=P(s),d=_(s),h=[c-i.left,d-i.top],f=h[0],p=h[1];return l&&l(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;a=t,r=n})),e.getPDFPage().then((function(t){var i=A(t.reverseDevicePoint([f,p],e.scale,e.getRotation()),2),a=i[0],r=i[1],o=n.pdfViewer.getDefaultAnnotConfig()("text"),s=Object.assign({flags:28,type:"text",rect:{left:a,right:a+20,top:r,bottom:r-20},subject:n.pdfViewer.i18n.t("viewer_:annotSubjects.Note")},o);return t.addAnnot(s).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;e.pdfViewer.eventEmitter.emit(x.addAnnotSuccess,i.annot),e.pdfViewer.getStateHandlerManager().switchTo(k.getStateName()),setTimeout((function(){e.annotsRender.doubleTapAnnot(n.getId())}),500)}))})).catch((function(e){throw null==u||u.setSpanException(r,e),e})).finally((function(){null==a||a()}))}))}},{key:"getNoteRightPanelData",value:function(){var e=localStorage.getItem("NOTE-STORAGE-KEY");return e?JSON.parse(e):e||{}}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle)}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return T}}]),a}(b),D=w.stateHandler,M=D.IStateHandler,N=(D.HandStateHandler,w.vendors.Hammer),L=w.shared.DebouncePromiseQueue,V=D.StateHandlerUtils,O=V.getDevicePagePoint,H=V.deltaDeviceRect,F=V.appendSelectMark,U=V.removeSelectMark,j=V.removeTextSelectedRangeMark,B=V.showTextSelectedRangeMark,X=w.ViewerEvents,Y=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="",i}return i(a,[{key:"getDefaultProps",value:function(e){return this.pdfViewer.getDefaultAnnotConfig()(e)}},{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o,s,c,l=i[0],u=this.hammer=new N.Manager(l,{recognizers:[[N.Pan,{direction:N.DIRECTION_ALL}],[N.Tap]]}),d=-1,h=-1,f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;u.on("tap",(function(t){n.pageRender.pdfViewer.activeElement();var i=n.pageRender.pdfViewer,a=t.srcEvent,r=A(e.getPDFPointFromClientPoint(a.clientX,a.clientY,!0),2),o=r[0],s=r[1],c=i.getEventEmitter();e.getPDFPage().then((function(t){var n=e.scale,i=e.rotate,a=t.getDeviceMatrix();return a.scale(n,n),a.rotate(i),t.getAnnotObjectNumAtDevicePoint([o,s],1,[a.a,a.b,a.c,a.d,a.e,a.f])})).then((function(n){var i=e.getAnnotRender(n);if(i){var a=i.component;c.emit(X.tapAnnotation,i,t),a.tapAnnot(t)}}))})),u.on("panstart",(function(t){if(!1!==n.panStart(t,n)){d=-1,h=-1;var i=O(l,t);a=[i.x,i.y],n.hideSelectMark(),r=new L,n.shouldDrawRange=!1,e.getTextContinueRectAtDevicePoints([i.x,i.y],[i.x+5,i.y+5],-1,-1).then((function(e){n.shouldDrawRange=!(e||[])[0]})),p&&p(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;o=t,n}))}})),u.on("panmove",(function(e){!1!==n.panMove(e,n)&&r&&r.push((function(){var t,i=n.pageRender,r=[a[0]+e.deltaX,a[1]+e.deltaY];if(n.shouldDrawRange){B(i,a,r);var o=H(a,e.deltaX,e.deltaY);t=i.getTextRectsAtRect(o)}else t=n.getTextRect(a,r,d,h);t.then((function(e){var t;return(t=e[0])&&"string"==typeof t.text&&(d=t.start,h=t.end),Promise.all([i.getPDFPage(),e])})).then((function(e){var t=A(e,2),a=t[0],r=t[1];n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"textMarkup",rects:r,page:a.getIndex()});var o=i.transformRectArray(a,r);n.showSelectMark(o)}))}))})),u.on("panend",(function(t){if(!1!==n.panEnd(t,n)&&r){r.end(),r=null;var i,l=[a[0]+t.deltaX,a[1]+t.deltaY];if(n.shouldDrawRange){n.shouldDrawRange=!1,j(e,e.$handler);var u=H(a,t.deltaX,t.deltaY);i=e.getTextRectsAtRect(u)}else i=n.getTextRect(a,l,d,h);if(v){var f=v.startChildSpan(n.constructor.getStateName()+"End"),p=f.end,g=f.span;s=p,c=g}i.then((function(t){var i;return(i=t[0])&&"string"==typeof i.text&&(d=i.start,h=i.end),n.hideSelectMark(),Promise.all([e.getPDFPage(),t])})).then((function(e){var t=A(e,2),i=t[0],a=t[1];return a.length<1?Promise.resolve():n.addAnnot(i,a).then((function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(i),n.pageRender.annotsRender.activeAnnot(t.getId()),e})).then((function(e){if(n.pdfViewer.config.showCommentList){var t=e[e.length-2];n.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}})).then((function(){0}))})).catch((function(e){throw null==v||v.setSpanException(c,e),e})).finally((function(){null==s||s(),null==o||o()}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark(),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"showSelectMark",value:function(e){F(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){U(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}},{key:"addAnnot",value:function(e,t){}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit(X.addAnnotSuccess,e.annot)}}]),a}(M),G=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_HIGHLIGHT,W=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-highlight",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"highlight",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("highlight")))}}],[{key:"getStateName",value:function(){return G}}]),a}(Y),$=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_STRIKE_OUT,z=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-strikeout",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"strikeout",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Strikeout"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("strikeout")))}}],[{key:"getStateName",value:function(){return $}}]),a}(Y),q=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_UNDERLINE,K=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-underline",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"underline",rect:{left:0,right:0,top:0,bottom:0},coords:t,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Underline")},this.getDefaultProps("underline")))}}],[{key:"getStateName",value:function(){return q}}]),a}(Y),Z=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUIGGLY,J=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-s-underline",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"squiggly",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Squiggly"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("squiggly")))}}],[{key:"getStateName",value:function(){return Z}}]),a}(Y),Q=w.stateHandler,ee=Q.StateHandlerConsts.STATE_HANDLER_CREATE_REPLACE,te=Q.StateHandlerUtils.getCaretRectAndRotate,ne=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-replace-text",i}return i(a,[{key:"addAnnot",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("replace"),i=te(t),a=i.rect,r=i.rotate;return e.addAnnotGroup([{flags:4,type:"strikeout",rect:{left:0,right:0,top:0,bottom:0},coords:t,noPopup:!0,typeAlias:"Replace",intent:"StrikeOutTextEdit",color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")},{type:"caret",flags:4,rect:a,typeAlias:"Replace",intent:"Replace",rotation:r,color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")}],1)}}],[{key:"getStateName",value:function(){return ee}}]),a}(Y),ie=w.stateHandler,ae=w.Matrix,re=ie.IStateHandler,oe=(ie.HandStateHandler,w.vendors.Hammer),se=w.shared,ce=se.DebouncePromiseQueue,le=se.getClientX,ue=se.getClientY,de=ie.StateHandlerUtils,he=de.getDevicePagePoint,fe=(de.deltaDeviceRect,de.appendSelectMark),pe=de.removeSelectMark,ve=de.getCaretRectAndRotate,ge=w.ViewerEvents,me=ie.StateHandlerConsts.STATE_HANDLER_CREATE_CARET,ye=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-insert-text",i}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o,s,c,l=i[0],u=this.hammer=new oe.Manager(l,{recognizers:[[oe.Pan,{direction:oe.DIRECTION_ALL}],[oe.Tap]]}),d=-1,h=-1,p=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,v=p.startSDKSpan,g=p.otelService;u.on("panstart",(function(e){if(!1!==n.panStart(e,n)){d=-1,h=-1;var t=he(l,e);a=[t.x,t.y],n.hideSelectMark(),r=new ce,v&&v(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;o=t,n}))}})),u.on("panmove",(function(e){!1!==n.panMove(e,n)&&r.push((function(){var t=n.pageRender,i=[a[0]+e.deltaX,a[1]+e.deltaY];return n.getTextRect(a,i,d,h).then((function(e){var n;return(n=e[0])&&"string"==typeof n.text&&(d=n.start,h=n.end),Promise.all([t.getPDFPage(),e])})).then((function(e){var n=A(e,2),i=n[0],a=n[1];return t.transformRectArray(i,a)})).then((function(e){n.showSelectMark(e)}))}))})),u.on("panend",(function(t){if(!1!==n.panEnd(t,n)){r.end(),r=null;var i=[a[0]+t.deltaX,a[1]+t.deltaY];if(g){var l=g.startChildSpan(n.constructor.getStateName()+"End"),u=l.end,f=l.span;s=u,c=f}return n.getTextRect(a,i,d,h).then((function(t){var i;return(i=t[0])&&"string"==typeof i.text&&(d=i.start,h=i.end),n.hideSelectMark(),Promise.all([e.getPDFPage(),t])})).then((function(e){var t=A(e,2),i=t[0],a=t[1];if(a.length<1)return Promise.resolve();var r=ve(a),o=r.rect,s=r.rotate;return i.addAnnot({type:"caret",flags:4,rect:o,rotation:s,subject:n.pdfViewer.i18n.t("viewer_:annotSubjects.Insert")}).then((function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;n.pdfViewer.eventEmitter.emit(ge.addAnnotSuccess,i.annot),n.pageRender.annotsRender.activeAnnot(t.getId()),n.pdfViewer.config.showCommentList&&i.showReplyDialog()})).then((function(){0}))})).catch((function(e){throw null==g||g.setSpanException(c,e),e})).finally((function(){null==s||s(),null==o||o()}))}})),u.on("tap",(function(t){if(!1!==n.tap(t,n)){var i=l.getBoundingClientRect(),a=t.srcEvent,r=le(a),o=ue(a),s=[r-i.left,o-i.top];return e.getPDFPage().then((function(t){var i=t.reverseDevicePoint([s[0],s[1]],e.scale,e.getRotation());return t.getCharInfoAtPoint(i,0,!0).then((function(e){var i,a;if(e){var r=e.top-e.bottom,o=e.bottom+r/2,s=(e.right+e.left)/2,c=new ae;c.e=-s,c.f=-o;var l=(e.bottom+e.top)/2,u=l-r,d=e.right-3*r/8,h=e.right+3*r/8,p=c.transformRect(d,l,h,u),m=e.rotation*Math.PI/2;return c.reset(),c.rotate(-m),p=(i=c).transformRect.apply(i,f(p)),c.reset(),c.e=s,c.f=o,p=(a=c).transformRect.apply(a,f(p)),(v?v(n.constructor.getStateName()):Promise.resolve({end:null,span:null})).then((function(e){var i=e.end,a=e.span;return t.addAnnot({type:"caret",rect:{left:p[0],bottom:p[1],right:p[2],top:p[3]},rotation:m}).then((function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;n.pdfViewer.eventEmitter.emit(ge.addAnnotSuccess,i.annot),n.pageRender.annotsRender.activeAnnot(t.getId()),n.pdfViewer.config.showCommentList&&i.showReplyDialog()})).then((function(){0})).catch((function(e){throw null==g||g.setSpanException(a,e),e})).finally((function(){null==i||i()}))}))}}))}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"tap",value:function(){var e=Date.now(),t=!0;return this.timer&&(t=e-this.timer>=1e3),this.timer=e,t}},{key:"showSelectMark",value:function(e){fe(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){pe(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}}],[{key:"getStateName",value:function(){return me}}]),a}(re);function Se(e,t,n,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function Ae(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){Se(r,i,a,o,s,"next",e)}function s(e){Se(r,i,a,o,s,"throw",e)}o(void 0)}))}}function we(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var Ee,be,ke=w.stateHandler.IStateHandler,Re=w.vendors,Te=(Re.Hammer,Re.jQuery,function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"pageHandler",value:function(e){}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler")}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"textboxWidth",value:function(){return 100}},{key:"textboxHeight",value:function(){return 20}},{key:"calloutKneeLength",value:function(){return 20}},{key:"getStateName",value:function(){return"createFreetext"}},{key:"edit",value:function(e,t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;n.active(!0),setTimeout((function(){n.showReplyDialog("comment")}),0)}}]),a}(ke)),xe=o(457);!function(e){e.ZoomFitBBox="ZoomFitBBox",e.ZoomFitBHorz="ZoomFitBHorz",e.ZoomFitBVert="ZoomFitBVert",e.ZoomFitHorz="ZoomFitHorz",e.ZoomFitVert="ZoomFitVert",e.ZoomFitPage="ZoomFitPage",e.ZoomFitRect="ZoomFitRect",e.ZoomXYZ="ZoomXYZ"}(Ee||(Ee={})),function(e){e[e.NONE=-1]="NONE",e[e.PAGE_OPENED=0]="PAGE_OPENED",e[e.PAGE_CLOSED=1]="PAGE_CLOSED",e[e.DOC_WILL_CLOSE=2]="DOC_WILL_CLOSE",e[e.DOC_WILL_SAVE=3]="DOC_WILL_SAVE",e[e.DOC_SAVED=4]="DOC_SAVED",e[e.DOC_WILL_PRINT=5]="DOC_WILL_PRINT",e[e.DOC_PRINTED=6]="DOC_PRINTED",e[e.FIELD_KEY_STROKE=7]="FIELD_KEY_STROKE",e[e.FIELD_WILL_FORMAT=8]="FIELD_WILL_FORMAT",e[e.FIELD_VALUE_CHANGED=9]="FIELD_VALUE_CHANGED",e[e.FIELD_RECALCULATE_VALUE=10]="FIELD_RECALCULATE_VALUE",e[e.ANNOT_CURSOR_ENTER=11]="ANNOT_CURSOR_ENTER",e[e.ANNOT_CURSOR_EXIT=12]="ANNOT_CURSOR_EXIT",e[e.ANNOT_MOUSE_BUTTON_PRESSED=13]="ANNOT_MOUSE_BUTTON_PRESSED",e[e.ANNOT_MOUSE_BUTTON_RELEASED=14]="ANNOT_MOUSE_BUTTON_RELEASED",e[e.ANNOT_RECEIVE_INPUT_FOCUS=15]="ANNOT_RECEIVE_INPUT_FOCUS",e[e.ANNOT_LOSE_INPUT_FOCUS=16]="ANNOT_LOSE_INPUT_FOCUS",e[e.ANNOT_PAGE_OPENED=17]="ANNOT_PAGE_OPENED",e[e.ANNOT_PAGE_CLOSED=18]="ANNOT_PAGE_CLOSED",e[e.ANNOT_PAGE_VISIBLE=19]="ANNOT_PAGE_VISIBLE",e[e.ANNOT_PAGE_INVISIBLE=20]="ANNOT_PAGE_INVISIBLE"}(be||(be={}));var Ce,Pe,_e,Ie,De,Me,Ne,Le,Ve,Oe,He,Fe=Object.values({ANNOT_CURSOR_ENTER:11,ANNOT_CURSOR_EXIT:12,ANNOT_MOUSE_BUTTON_PRESSED:13,ANNOT_MOUSE_BUTTON_RELEASED:14,ANNOT_RECEIVE_INPUT_FOCUS:15,ANNOT_LOSE_INPUT_FOCUS:16,ANNOT_PAGE_OPENED:17,ANNOT_PAGE_CLOSED:18,ANNOT_PAGE_VISIBLE:19,ANNOT_PAGE_INVISIBLE:20}),Ue=Object.values({FIELD_KEY_STROKE:7,FIELD_WILL_FORMAT:8,FIELD_VALUE_CHANGED:9,FIELD_RECALCULATE_VALUE:10}),je=Object.values({PAGE_OPENED:0,PAGE_CLOSED:1}),Be=Object.values({DOC_WILL_CLOSE:2,DOC_WILL_SAVE:3,DOC_SAVED:4,DOC_WILL_PRINT:5,DOC_PRINTED:6});!function(e){e.goto="TypeGoto",e.launch="TypeLaunch",e.uri="TypeURI",e.named="TypeNamed",e.thread="TypeThread",e.submitForm="TypeSubmitForm",e.resetForm="TypeResetForm",e.javaScript="TypeJavaScript",e.importData="TypeImportData",e.hide="TypeHide",e.gotoE="TypeGoToE",e.gotoR="TypeGoToR",e.setOCGState="TypeSetOCGState",e.rendition="TypeRendition"}(Ce||(Ce={})),function(e){e[e.NewWindowFlagFalse=0]="NewWindowFlagFalse",e[e.NewWindowFlagTrue=1]="NewWindowFlagTrue",e[e.NewWindowFlagNone=2]="NewWindowFlagNone"}(Pe||(Pe={})),function(e){e[e.FlagExclude=1]="FlagExclude",e[e.FlagIncludeNoValueFields=2]="FlagIncludeNoValueFields",e[e.FlagExportFormat=4]="FlagExportFormat",e[e.FlagGetMethod=8]="FlagGetMethod",e[e.FlagWithCoordinates=16]="FlagWithCoordinates",e[e.FlagAsXFDF=32]="FlagAsXFDF",e[e.FlagIncludeAppendSaves=64]="FlagIncludeAppendSaves",e[e.FlagIncludeAnnotations=128]="FlagIncludeAnnotations",e[e.FlagSubmitAsPDF=256]="FlagSubmitAsPDF",e[e.FlagCanonicalFormat=512]="FlagCanonicalFormat",e[e.FlagExclNonUserAnnots=1024]="FlagExclNonUserAnnots",e[e.FlagExclFKey=2048]="FlagExclFKey",e[e.FlagEmbedForm=8192]="FlagEmbedForm"}(_e||(_e={})),function(e){e.fdf="fdf",e.html="html",e.xfdf="xfdf",e.pdf="pdf",e.txt="txt",e.xml="xml"}(Ie||(Ie={})),function(e){e.Parent="P",e.Child="C"}(De||(De={})),function(e){e.Associate="Associate",e.None="None",e.Pause="Pause",e.Play="Play",e.Resume="Resume",e.Stop="Stop"}(Me||(Me={})),function(e){e.unKnownType="unknowntype",e.text="text",e.link="link",e.freeText="freetext",e.line="line",e.square="square",e.circle="circle",e.polygon="polygon",e.polyLine="polyline",e.polyline="polyline",e.highlight="highlight",e.underline="underline",e.squiggly="squiggly",e.strikeOut="strikeout",e.stamp="stamp",e.caret="caret",e.ink="ink",e.psInk="psink",e.fileAttachment="fileattachment",e.sound="sound",e.movie="movie",e.widget="widget",e.screen="screen",e.printerMark="printermark",e.trapNet="trapnet",e.watermark="watermark",e.threeD="3d",e.popup="popup",e.redact="redact"}(Ne||(Ne={})),function(e){e[e.NONE=0]="NONE",e[e.INVERT=1]="INVERT",e[e.OUTLINE=2]="OUTLINE",e[e.PUSH=3]="PUSH",e[e.TOGGLE=4]="TOGGLE"}(Le||(Le={})),function(e){e.BUTTON="button",e.CHECK_BOX="checkbox",e.RADIO="radio",e.LIST_BOX="listbox",e.HIER_LIST_BOX="hier_listbox",e.STATIC_TEXT="static_text",e.EDIT_TEXT="edit_text",e.OK="ok",e.OK_CANCEL="ok_cancel",e.OK_CANCEL_OTHER="ok_cancel_other",e.CLUSTER="cluster",e.IMAGE="image",e.PROGRESS_BAR="progress_bar",e.LINK_TEXT="link_text",e.LINK_GROUP="link_group",e.POPUP="popup",e.GAP="gap",e.VIEW="view"}(Ve||(Ve={})),function(e){e.LEFT="align_left",e.CENTER="align_center",e.RIGHT="align_right",e.TOP="align_top",e.FILL="align_fill",e.DISTRIBUTE="align_distribute",e.ROW="align_row",e.OFFSCREEN="align_offscreen"}(Oe||(Oe={})),function(e){e.DEFAULT="default",e.DIALOG="dialog",e.palette="palette"}(He||(He={}));var Xe;!function(e){e[e.ERROR=0]="ERROR",e[e.WARNING=1]="WARNING",e[e.QUESTION=2]="QUESTION",e[e.STATUS=3]="STATUS",e[e.DEFAULT=4]="DEFAULT"}(Xe||(Xe={}));var Ye,Ge;!function(e){e[e.Doc=0]="Doc",e[e.DocAndAnnot=1]="DocAndAnnot",e[e.DocAntStamps=2]="DocAntStamps",e[e.FieldsOnly=3]="FieldsOnly"}(Ye||(Ye={})),function(e){e[e.All=0]="All",e[e.CurrentView=1]="CurrentView",e[e.CurrentPage=2]="CurrentPage",e[e.Pages=3]="Pages",e[e.PortfolioSelected=4]="PortfolioSelected",e[e.PortfolioAll=5]="PortfolioAll"}(Ge||(Ge={}));var We,$e,ze,qe;function Ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.OK=0]="OK",e[e.OKCancel=1]="OKCancel",e[e.YesNO=2]="YesNO",e[e.YesNoCancel=3]="YesNoCancel"}(We||(We={})),function(e){e[e.OK=1]="OK",e[e.Cancel=2]="Cancel",e[e.NO=3]="NO",e[e.Yes=4]="Yes"}($e||($e={})),function(e){e[e.OK=1]="OK",e[e.Cancel=2]="Cancel",e[e.Block=3]="Block"}(ze||(ze={})),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Question=2]="Question",e[e.Prompt=3]="Prompt"}(qe||(qe={}));var Ze={annot:Fe,doc:Be,page:je,field:Ue,bookmark:[]};!function(){function e(n,i,a){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return Ze[r.query.type]};t(this,e),Ke(this,"query",void 0),Ke(this,"additionalActionAPI",void 0),Ke(this,"emitAAActionChangeEvent",void 0),Ke(this,"getDefaultTriggerEvents",void 0),this.query=n,this.additionalActionAPI=i,this.emitAAActionChangeEvent=a,this.getDefaultTriggerEvents=o}i(e,[{key:"setAction",value:function(e,t){var n=this;return Ae((function(){return we(this,(function(i){switch(i.label){case 0:return[4,n.additionalActionAPI.overwriteAction(n.query,e,t)];case 1:return i.sent(),n.emitAAActionChangeEvent("set",e,t),[2]}}))}))()}},{key:"updateActionData",value:function(e,t,n){var i=this;return Ae((function(){return we(this,(function(a){switch(a.label){case 0:return[4,i.additionalActionAPI.updateAction(i.query,e,t,n)];case 1:return a.sent(),i.emitAAActionChangeEvent("update",e,t,n),[2]}}))}))()}},{key:"getActions",value:function(e){return Array.isArray(e)||(e=this.getDefaultTriggerEvents()),(null==e?void 0:e.length)?this.additionalActionAPI.getActions(this.query,e):Promise.resolve([])}},{key:"moveAction",value:function(e){var t=this;return Ae((function(){return we(this,(function(n){switch(n.label){case 0:return[4,t.additionalActionAPI.moveAction(t.query,e)];case 1:return n.sent(),t.emitAAActionChangeEvent("move"),[2]}}))}))()}},{key:"removeAction",value:function(e,t){var n=this;return Ae((function(){var i;return we(this,(function(a){switch(a.label){case 0:return[4,n.additionalActionAPI.removeAction(n.query,e,t)];case 1:return(i=a.sent())&&n.emitAAActionChangeEvent("remove",e,t),[2,i]}}))}))()}},{key:"addAction",value:function(e,t){var n=this;return Ae((function(){return we(this,(function(i){switch(i.label){case 0:return[4,n.additionalActionAPI.appendAction(n.query,e,t)];case 1:return i.sent(),n.emitAAActionChangeEvent("add",e,t),[2]}}))}))()}},{key:"triggerAction",value:function(e){var t=this;return Ae((function(){return we(this,(function(n){switch(n.label){case 0:return[4,t.additionalActionAPI.triggerAction(t.query,e)];case 1:return n.sent(),[2]}}))}))()}}])}();var Je=5,Qe=0,et={left:0,center:1,right:2},tt=1,nt=2,it=3,at="editDiv",rt=function(){function e(){t(this,e)}return i(e,null,[{key:"formatHtmlStr",value:function(e){var t=e,n={split:"split",remove:"remove",removeSelf:"removeTag"};[{startStr:"\x3c!--StartFragment--\x3e",endStr:"\x3c!--EndFragment--\x3e",operate:n.split},{startStr:"\x3c!--[if",endStr:"<![endif]--\x3e",operate:n.remove},{startStr:"<![if",endStr:"<![endif]>",operate:n.remove},{startStr:"<o:p>",endStr:"</o:p>",operate:n.remove},{startStr:"<w:Sdt",endStr:"</w:Sdt>",operate:n.removeTag},{startStr:"<w:sdtPr>",endStr:"</w:sdtPr>",operate:n.remove}].forEach((function(e){for(var i=t.indexOf(e.startStr);i>-1;){switch(e.operate){case n.split:var a=t.indexOf(e.endStr);t=t.slice(i+e.startStr.length,a>-1?a:t.length);break;case n.remove:var r=t.indexOf(e.endStr),o=t.substring(0,i),s=t.substring(r+e.endStr.length);t=o+s;break;case n.removeTag:var c=t.substring(i),l=c.indexOf(">");t=(t=t.substring(0,i)+c.substring(l+1)).split(e.endStr).join("")}i=t.indexOf(e.startStr)}}));var i=document.createElement("div");return i.contentEditable=!0,i.id=at,i.style.display="none",document.body.appendChild(i),i.innerHTML=t.replaceAll("\n","").replaceAll("\r",""),this.addTagClassName(i)}},{key:"getFont",value:function(e){var t=e[0],n=new RegExp("^\\s*".concat(t,"\\b")),i=["-apple-system","system-ui"," BlinkMacSystemFont"," Segoe UI"," Roboto"," Oxygen"," Ubuntu"," Fira Sans"," Droid Sans"," Helvetica Neue"," sans-serif"].some((function(e){return n.test(e)}));return i?(xe.DeviceInfo.isWindows?t="DengXian Light":xe.DeviceInfo.isMacOS||xe.DeviceInfo.isIOS?t="PingFangSC":xe.DeviceInfo.isAndroid?t="Roboto":xe.DeviceInfo.isLinux&&(t="Noto Sans"),t):t}},{key:"formatRichText",value:function(e){var t=this,n=this.formatHtmlStr(e),i=document.getElementById("".concat(at)),a=n.map((function(e){var n,a,r,o,s=i.getElementsByClassName("".concat(e))[0],c=getComputedStyle(s),l=c.fontFamily.replaceAll('"',"").split(","),u=t.getFont(l);return{content:s.textContent,richTextStyle:{font:{name:u},textSize:parseInt(c.fontSize),textAlignment:et[c.textAlign],textColor:(0,xe.colorConvertor)(c.color,"int"),isBold:(r=c.fontWeight,o=parseFloat(r),isNaN(o)?r.includes("bold"):o>400),isItalic:(a=c.fontStyle,a.includes("italic")||a.includes("oblique")),isUnderline:c.textDecoration.includes("underline"),isStrikethrough:c.textDecoration.includes("line-through"),cornerMarkStyle:(n=c.verticalAlign,{sub:it,super:nt}[n]||tt)}}}));return i.remove(),a}},{key:"addTagClassName",value:function(e){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=e.childNodes.length;(["block","flex"].includes(getComputedStyle(e).display)&&e.nextElementSibling&&(e.innerHTML+="\n"),a>0)&&Array.from(e.childNodes).forEach((function(a){if("#text"===a.nodeName){var r=document.createElement("span");r.innerText="".concat(a.textContent),r.style.textDecoration="".concat(n.underline?"underline":""," ").concat(n.lineThrough?"line-through":""),r.style.verticalAlign=n.verticalAlign;var o="foxitwebsdk-".concat(Date.now(),"-").concat(parseInt(1e3*Math.random()));i.push(o),r.classList.add(o),e.replaceChild(r,a)}else{var s=getComputedStyle(a).textDecoration,c={};s.includes("underline")&&(c.underline=!0),s.includes("line-through")&&(c.lineThrough=!0);var l=getComputedStyle(a).verticalAlign;["sub","super"].includes(l)&&(c.verticalAlign=l),t.addTagClassName(a,i,Object.assign({},n,c))}}));return i}}]),e}(),ot=w.stateHandler,st=w.ViewerEvents,ct=ot.StateHandlerUtils.getDevicePagePoint,lt=w.vendors.Hammer,ut=w.shared,dt=ut.extendOptions,ht=ut.convertFromNumberToHex,ft=ot.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER,pt=w.BrowserInfo.isFirefox,vt=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(o,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e,this.jqEventNamespace=(Date.now()*Math.random()).toString(34);var i=e.$handler;i.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var a,r,o=i[0],s=this.hammer=new lt.Manager(o,{recognizers:[[lt.Tap]]}),c=function(e){var t=n.input=document.createElement("div");t.contentEditable=!0,o.appendChild(t),t.focus({preventScroll:!0})};i.on("touchstart",c),this.removeTouchStartListener=function(){i.off("touchstart",c)};var l=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,d=l.otelService,h=new xe.QueuedAsyncTaskExecutor,p=this;s.on("tap",function(){var t=Ae((function(t){var n,i,s,c;return we(this,(function(l){switch(l.label){case 0:return n=new xe.Defer,i=h.waitForCurrentRunningTasks(),h.exec((function(){return n.promise})),[4,i];case 1:return l.sent(),s=ct(o,t),c=function(t){var n=new xe.Defer,i=100*e.scale*4/3,c=20*e.scale*2/3,l={left:s.x,right:s.x+i,top:s.y,bottom:s.y+2*c},h=p.input=p.input||document.createElement("div");pt?"plaintext-only"!==h.contentEditable&&(h.contentEditable=!0,h.addEventListener("keyup",(function(e){e.ctrlKey&&/^v$/i.test(e.key)&&(h.innerHTML=h.innerText)}))):h.contentEditable=!0;var v=p.pdfViewer.getDefaultAnnotConfig(),g=dt({defaultAppearance:{textColor:255,textSize:12,font:"Arial"}},"function"==typeof v?v("freetext","FreeTextTypewriter"):{}),m=g.defaultAppearance.textSize*e.scale*4/3,y=function(e){var t=o.getBoundingClientRect();return{maxWidth:t.right-e.left,maxHeight:t.height-e.top}}(l),S=y.maxHeight,A=y.maxWidth;h.style.cssText="\n                    position: absolute;\n                    left: ".concat(l.left,"px;\n                    top: ").concat(l.top,"px;\n                    min-width: ").concat(m+5,"px;\n                    min-height: ").concat(m,"px;\n                    font-size: ").concat(m,"px;\n                    line-height: 1;\n                    color: ").concat(ht(16777215&g.defaultAppearance.textColor),";\n                    outline:1px solid #5aa;\n                    outline-offset:1px;\n                    max-width: ").concat(A,"px;\n                    max-height: ").concat(S,"px;\n                    overflow: hidden;\n                    white-space: pre-line;\n                    word-break: break-word;\n                "),h.innerText=g.contents||"",o.appendChild(h),(0,xe.moveCursorToEnd)(h),h.onmousedown=h.ontouchstart=h.onpointerdown=function(e){e.stopPropagation()};h.onkeydown=function(e){39!==e.keyCode&&37!==e.keyCode||e.stopPropagation()},h.onkeyup=function(e){0};var w=!1,E="";return h.onpaste=function(e){w=!0},h.oninput=function(e){if(w){var t,n=Array.from(h.childNodes).map((function(e){if(e.nodeType!==Node.TEXT_NODE){var t=e.style.fontFamily.replaceAll('"',"").split(",");return E=rt.getFont(t),new Text(e.innerText)}return e}));h.innerHTML="",(t=h).append.apply(t,f(n))}w=!1},h.onblur=Ae((function(){var i,s,c,f,v,m,y,S;return we(this,(function(A){switch(A.label){case 0:return p.isCreating=1,0!==h.innerText.trim().length?[3,1]:(o.removeChild(h),p.input=null,p.isCreating=0,p.pdfViewer.customs.isAnnotToolKept&&!p.pdfViewer.customs.isAnnotToolKept(ft)&&e.pdfViewer.getStateHandlerManager().switchTo(),n.resolve(),[3,4]);case 1:return u?[4,u(p.constructor.getStateName())]:[3,3];case 2:i=A.sent(),s=i.end,c=i.span,a=s,r=c,A.label=3;case 3:f=h.getBoundingClientRect(),l.right=l.left+f.width,l.bottom=l.top+f.height,v=t.reverseDeviceRect(l,e.scale,e.getRotation()),m={type:"freetext",intent:"FreeTextTypewriter",rect:v,contents:h.innerText.trim(),rotation:((360-90*t.getRotation()-e.getRotation())%360+360)%360,flags:4,borderInfo:{width:0},subject:p.pdfViewer.i18n.t("viewer_:annotSubjects.Typewriter")},E.length>0&&(y=g.defaultAppearance.textColor,S=g.defaultAppearance.textSize,m.defaultAppearance={font:{name:E},textColor:y||255,textSize:S||12}),t.addAnnot(m).then((function(t){var n,i;o.removeChild(h);var a=t[0],r=null===(i=e.annotsRender)||void 0===i||null===(n=i.getAnnotRender(a.getId()))||void 0===n?void 0:n.component;r&&r.$textInput.get(0).blur(),e.pdfViewer.eventEmitter.emit(st.addAnnotSuccess,a),p.isCreating=0})).catch((function(e){throw null==d||d.setSpanException(r,e),e})).finally((function(){n.resolve(),null==a||a()})),A.label=4;case 4:return[2]}}))})),n.promise},e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var n=e.scale,i=e.rotate,a=t.getDeviceMatrix(i);return a.scale(n,n),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([s.x,s.y],1,[a.a,a.b,a.c,a.d,a.e,a.f])])})).then(function(){var t=Ae((function(t){var n,i,a;return we(this,(function(r){switch(r.label){case 0:return n=A(t,2),i=n[0],-1===(a=n[1])?[3,3]:i.annotIdMap[a]?[3,2]:[4,i.getUnloadedAnnots()];case 1:r.sent(),r.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(a).getAnnot().getType())return[2,e.annotsRender.activeAnnot(a,0,1)];r.label=3;case 3:return p.pdfViewer.killFocus(),e.page?[2,c(e.page)]:[2,e.getPDFPage().then(c)]}}))}));return function(e){return t.apply(this,arguments)}}()).finally((function(){n.resolve()})),[2]}}))}));return function(e){return t.apply(this,arguments)}}())}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.removeTouchStartListener(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.input&&this.input.blur()}},{key:"out",value:function(){r(a(o.prototype),"out",this).call(this)}}],[{key:"getStateName",value:function(){return ft}}]),o}(Te),gt=w.creation.CreateFreeTextCalloutService,mt=w.stateHandler,yt=w.ViewerEvents,St=(w.CalloutShape,mt.IStateHandler,mt.StateHandlerUtils.getDevicePagePoint),At=w.vendors,wt=At.Hammer,Et=(At.jQuery,w.shared),bt=Et.getClientX,kt=Et.getClientY,Rt=(Et.CalloutPointsReviser,mt.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_CALLOUT),Tt=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass("fv__create-callout-state-handler "+this.cursorStyle),i.on("mousemove",(function(e){if(n.startAdding){var t=o.getBoundingClientRect(),i=bt(e)-t.left,a=kt(e)-t.top;n.service.update({x:i,y:a})}}));var a,r,o=i[0],s=this.hammer=new wt.Manager(o,{recognizers:[[wt.Pan,{direction:wt.DIRECTION_ALL}],[wt.Tap]]}),c=function(t){n.service.complete().then((function(t){return n.startAdding=0,Te.edit(e,t)})).then((function(e){n.pdfViewer.eventEmitter.once("editingFreeText",(function(){!function(e){document.body.removeChild(e)}(t)}))})).catch((function(e){null==h||h.setSpanException(r,e)})).finally((function(){null==a||a()}))},l=function(t){var n=St(o,t);return e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])])})).then(function(){var t=Ae((function(t){var n,i,a;return we(this,(function(r){switch(r.label){case 0:return n=A(t,2),i=n[0],-1===(a=n[1])?[3,3]:i.annotIdMap[a]?[3,2]:[4,i.getUnloadedAnnots()];case 1:r.sent(),r.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(a).getAnnot().getType())return[2,e.annotsRender.activeAnnot(a,0,1)];r.label=3;case 3:return[2,a]}}))}));return function(e){return t.apply(this,arguments)}}())},u=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,d=u.startSDKSpan,h=u.otelService,f=this;s.on("tap",function(){var t=Ae((function(t){var n,i;return we(this,(function(s){switch(s.label){case 0:return f.startAdding?[3,2]:[4,l(t)];case 1:return-1!==s.sent()?[2]:(f.service||(f.service=new gt,f.service.prepare(e)),n=St(o,t),f.service.start(n),f.service.update(n),f.startAdding=1,d&&d(f.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;a=t,r=n})),[3,3]);case 2:f.pdfViewer.killFocus(),i=xt(),setTimeout((function(){c(i)}),100),s.label=3;case 3:return[2]}}))}));return function(e){return t.apply(this,arguments)}}()).on("panstart",(function(t){n.service||(n.service=new gt,n.service.prepare(e));var i=St(o,t);n.service.start(i),d&&d(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;a=t,r=n}))})).on("panend",(function(e){c(xt())})).on("panmove",(function(t){var i=o.getBoundingClientRect(),a=t.srcEvent,r=bt(a)-i.left,s=kt(a)-i.top;n.service.update({x:r,y:s}),n.service.annotInfo&&n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"freetext",page:e.index,points:n.service.annotInfo.calloutLinePoints,innerRect:n.service.annotInfo.innerRect,rect:n.service.annotInfo.rect})}))}},{key:"destroyPageHandler",value:function(){var e,t;null===(t=this.service)||void 0===t||null===(e=t.calloutShape)||void 0===e||e.hide(),this.startAdding=0,this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-callout-state-handler "+this.cursorStyle),this.service&&(this.service.calloutShape.hide(),this.startAdding=0,this.service.destroy()),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addAnnot",value:function(e){var t=this,n=this.pageRender,i=n.pdfViewer;return n.getPDFPage().then((function(i){var a=t.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),r=Object.assign({},Ke({type:"freetext",intent:"FreeTextCallout",subject:"FreeTextCallout","interior-color":16777215,rotation:((360-90*i.getRotation()-n.getRotation())%360+360)%360,flags:4},"subject",t.pdfViewer.i18n.t("viewer_:annotSubjects.Callout")),e,a);return i.addAnnot(r)})).then((function(e){var t=e[0],a=n.annotsRender.getAnnotRender(t.getId()).component;return i.eventEmitter.emit(yt.addAnnotSuccess,a.annot),Te.edit(n,e)}))}}],[{key:"getStateName",value:function(){return Rt}}]),a}(Te);function xt(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}var Ct=w.stateHandler,Pt=w.ViewerEvents,_t=(Ct.IStateHandler,Ct.StateHandlerUtils.getDevicePagePoint),It=w.vendors.Hammer,Dt=Ct.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_BOX,Mt=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(a,[{key:"pageHandler",value:function(e){var t;this.pageRender=e;var n=e.$handler;n.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var i,a,r=n[0],o=this.hammer=new It.Manager(r,{recognizers:[[It.Tap]]}),s=function(t){var n=_t(r,t);return e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])])})).then(function(){var t=Ae((function(t){var n,i,a;return we(this,(function(r){switch(r.label){case 0:return n=A(t,2),i=n[0],-1===(a=n[1])?[3,3]:i.annotIdMap[a]?[3,2]:[4,i.getUnloadedAnnots()];case 1:r.sent(),r.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(a).getAnnot().getType())return[2,e.annotsRender.activeAnnot(a,0,1)];r.label=3;case 3:return[2,-1]}}))}));return function(e){return t.apply(this,arguments)}}())},c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan,u=c.otelService,d=this;o.on("tap",function(){var t=Ae((function(t){var n,o,c;return we(this,(function(h){switch(h.label){case 0:return n=function(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}(),o=_t(r,t),c=e.pdfViewer,[4,s(t)];case 1:return-1!==h.sent()?[2]:(l&&l(d.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;i=t,a=n})),[2,e.getPDFPage().then((function(t){var n=e.getScale(),i=e.getRotation(),a=100*n*4/3,r=20*n*2/3,s={left:o.x,right:o.x+a,top:o.y-r,bottom:o.y+r},c=d.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),l=16777215;void 0!==c.fillColor&&(l=c.fillColor);var u=t.reverseDeviceRect(s,n,i),h=c.borderInfo;if(h&&h.style===Je){var f=2===h.cloudIntensity?14.25:6;u={left:u.left-f,right:u.right+f,top:u.top+f,bottom:u.bottom-f}}var p=Object.assign({type:"freetext",rect:u,"interior-color":l,rotation:((360-90*t.getRotation()-i)%360+360)%360,flags:4,subject:d.pdfViewer.i18n.t("viewer_:annotSubjects.Textbox")},c);return t.addAnnot(p)})).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;return c.eventEmitter.emit(Pt.addAnnotSuccess,i.annot),Te.edit(e,t)})).then((function(e){d.pdfViewer.eventEmitter.once("editingFreeText",(function(){!function(e){document.body.removeChild(e)}(n)})),c.getStateHandlerManager().switchTo()})).catch((function(e){throw null==u||u.setSpanException(a,e),e})).finally((function(){null==i||i()}))])}}))}));return function(e){return t.apply(this,arguments)}}())}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.__removeHandlerMouseEvent__&&this.__removeHandlerMouseEvent__()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return Dt}}]),a}(Te);var Nt=function(){function e(n){t(this,e),this.component=n,this.prepared=!1}return i(e,[{key:"prepare",value:function(){this.prepared||(this.prepared=!0,this.doPrepare())}},{key:"doPrepare",value:function(){}},{key:"show",value:function(){this.prepared&&this.doShow()}},{key:"doShow",value:function(){}},{key:"hide",value:function(){this.prepared&&this.doHide()}},{key:"doHide",value:function(){}},{key:"destroy",value:function(){this.component=null,this.prepared=!1}},{key:"willRender",value:function(){}},{key:"afterRender",value:function(){}},{key:"render",value:function(e,t,n){return this.prepared||this.prepare(),this.doRender(e,t,n)}},{key:"doRender",value:function(e,t){return Promise.resolve()}},{key:"numberToRGBAString",value:function(e){var t=(0,xe.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"invisibleRender",value:function(){}}]),e}(),Lt="vertical",Vt="horizontal",Ot=function(){function e(n,i){t(this,e),this.fromInchRate=n,this.name=i,Object.defineProperties(this,{fromInchRate:{value:n,enumerable:!0,writable:!1,configurable:!0},name:{value:i,enumerable:!0,writable:!1,configurable:!0}})}return i(e,[{key:"isPixel",get:function(){return!1}},{key:"convertTo",value:function(e,t){return e/this.fromInchRate*t.fromInchRate}},{key:"convertAreaTo",value:function(e,t){return e/Math.pow(this.fromInchRate,2)*Math.pow(t.fromInchRate,2)}}]),e}(),Ht=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,0,"px")).orientation=e,Object.defineProperty(v(i),"fromInchRate",{get:function(){var t=(0,xe.getDPI)();switch(e){case Vt:return t.x;case Lt:return t.y;default:return t.x}}}),i}return i(a,[{key:"isPixel",get:function(){return!0}}]),a}(Ot);const Ft={inch:"inch",custom:"custom",mi:"mi",pt:"pt",ft:"ft",yd:"yd",km:"km",m:"m",cm:"cm",mm:"mm",pica:"pica"};var Ut,jt=new Ot(1,Ft.inch),Bt=new Ot(1,Ft.custom),Xt=new Ot(1/63360,Ft.mi),Yt=new Ot(72,Ft.pt),Gt=new Ot(1/12,Ft.ft),Wt=new Ot(1/36,Ft.yd),$t=new Ot(.0254/1e3,Ft.km),zt=new Ot(.0254,Ft.m),qt=new Ot(2.54,Ft.cm),Kt=new Ot(25.4,Ft.mm),Zt=new Ot(6,Ft.pica),Jt=new Ht(Vt),Qt=(new Ht(Lt),Ke(Ut={},jt.name,jt),Ke(Ut,Bt.name,Bt),Ke(Ut,Xt.name,Xt),Ke(Ut,Yt.name,Yt),Ke(Ut,Gt.name,Gt),Ke(Ut,Wt.name,Wt),Ke(Ut,$t.name,$t),Ke(Ut,zt.name,zt),Ke(Ut,qt.name,qt),Ke(Ut,Kt.name,Kt),Ke(Ut,Zt.name,Zt),Ke(Ut,Jt.name,Jt),Ut);function en(e){switch(e=(e=e.toLowerCase()).replace(/[^a-z]/g,"")){case"in":e="inch";break;case"p":e="pica"}return Qt[e]}var tn=function(e){l(o,e);var n=m(o);function o(e){return t(this,o),n.call(this,e)}return i(o,[{key:"prepare",value:function(){this.prepared||(this.canvas=document.createElement("canvas"),this.container=this.component.getContainerElement(),this.container.appendChild(this.canvas),r(a(o.prototype),"prepare",this).call(this))}},{key:"destroy",value:function(){r(a(o.prototype),"destroy",this).call(this),this.prepared&&this.canvas.remove()}},{key:"doShow",value:function(){this.canvas.classList.remove("fv__ui-hide")}},{key:"doHide",value:function(){this.canvas.classList.add("fv__ui-hide")}},{key:"convertPointToPixel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Yt.convertTo(e,Jt)*t}},{key:"willRender",value:function(){this.canvas.style.willChange="left, top, width, height",this.container.style.willChange="left; top"}},{key:"afterRender",value:function(){this.canvas.style.willChange="auto",this.container.style.willChange="auto"}},{key:"render",value:function(e,t){this.prepared||this.prepare();var n=this.component.getRenderingData(e,t);if(!n)return Promise.resolve();var i=n.annotInfo,a=i.borderInfo||{},r=this.convertPointToPixel(a.width,e),o=n.smartScale;!n.annotFlag.checkNoZoom()||(e=1);var s=n.rect,c=n.outerDeviceRect,l=n.innerDeviceRect;Object.assign(l,{width:l.right-l.left,height:l.bottom-l.top}),Object.assign(c,{width:c.right-c.left,height:c.bottom-c.top}),this.resetCanvasSize(c.width,c.height),this.container.style.cssText+="\n            left: ".concat(s.left,"px;\n            top: ").concat(s.top,"px;\n        ");var u=this.canvas.style;if(0===r&&0===i.borderColor&&!i.fillColor)return u.visibility="hidden",Promise.resolve();if(0===i.opacity)return u.visibility="hidden",Promise.resolve();u.visibility="unset";try{return Promise.resolve(this.doRender({outerRect:c,innerRect:l,deviceRect:s,scale:e,smartScale:o,rotate:t,renderingData:n}))}catch(e){return console.error(e),Promise.resolve()}}},{key:"doRender",value:function(e){e.outerRect,e.innerRect,e.deviceRect,e.scale,e.rotate}},{key:"resetCanvasSize",value:function(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.canvas.style.width=null,this.canvas.style.height=null}},{key:"invisibleRender",value:function(){this.canvas&&(this.canvas.width=0)}}]),o}(Nt);var nn=0,an=1,rn=2,on=3,sn=5,cn="LineArrow",ln="LineDimension",un="PolygonDimension",dn="PolyLineDimension",hn="CircleDimension",fn={0:"None",1:"Square",2:"Circle",3:"Diamond",4:"OpenArrow",5:"ClosedArrow",6:"Butt",7:"ROpenArrow",8:"RClosedArrow",9:"Slash"},pn=Object.keys(fn).reduce((function(e,t){return e[fn[t]]=Number(t),e}),{}),vn=0,gn=1,mn=(Promise.resolve(),function(){function n(e,i){t(this,n),this.x=e,this.y=i}return i(n,[{key:"add",value:function(e,t){return new n(this.x+e,this.y+t)}},{key:"addp",value:function(e){return new n(this.x+e.x,this.y+e.y)}},{key:"subtractp",value:function(e){return new n(this.x-e.x,this.y-e.y)}},{key:"subtract",value:function(e,t){return new n(this.x-e,this.y-t)}},{key:"move",value:function(e,t){var i=t.x-this.x,a=t.y-this.y,r=e/Math.sqrt(i*i+a*a);return new n(this.x+i*r,this.y+a*r)}},{key:"rotate",value:function(e,t){var i=this.x-t.x,a=this.y-t.y,r=Math.sqrt(i*i+a*a),o=Math.atan2(a,i)-e,s=r*Math.cos(o),c=r*Math.sin(o);return new n(t.x+s,t.y+c)}},{key:"distanceTo",value:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)}},{key:"slope",value:function(e){var t=this._dot(e);return Math.acos(t/(this._disp()*e._disp()))}},{key:"_dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"_disp",value:function(){return Math.sqrt(this._dot(this))}},{key:"equalTo",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i=Math.abs(i),e(t,n)&&Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i}},{key:"clone",value:function(){return new n(this.x,this.y)}}]),n}()),yn=function(){function n(){t(this,n),this.segments=[]}return i(n,[{key:"addSegment",value:function(t){e(t,Sn)&&this.segments.push(t)}},{key:"render",value:function(e){e.beginPath(),this.segments.forEach((function(t){t.render(e)})),e.closePath()}}]),n}(),Sn=function(){function e(n,i){t(this,e),this.from=n,this.to=i}return i(e,[{key:"render",value:function(e){(0,xe.notImplemented)()}},{key:"isJoinedBefore",value:function(e){return this.to.equalTo(e.from)}},{key:"isJoinedAfter",value:function(e){return e.to.equalTo(this.from)}},{key:"isJoinedWith",value:function(e){return this.isJoinedBefore(e)||this.isJoinedAfter(e)}}]),e}(),An=function(){function e(){t(this,e)}return i(e,[{key:"generate",value:function(){(0,xe.notImplemented)()}}]),e}(),wn=function(e){l(a,e);var n=m(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"render",value:function(e){try{e.save(),e.beginPath(),this.segments.filter((function(e){return e.isOn})).forEach((function(t){t.render(e)})),e.closePath()}finally{e.restore()}}}]),a}(yn),En=function(e){l(a,e);var n=m(a);function a(e,i){var r,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t(this,a),(r=n.call(this,e,i)).isOn=o,r}return i(a,[{key:"render",value:function(e){this.isOn&&(e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y))}}]),a}(Sn),bn=(function(e){l(a,e);var n=m(a);function a(e,i){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return t(this,a),(r=n.call(this)).contour=e,r.dashes=i,r.phase=o,r.continuous=s,r.dashSum=i.reduce((function(e,t){return e+t}),0),r}i(a,[{key:"generate",value:function(){var e=this,t=new wn;if(0==this.dashes.length)this.contour.reduce((function(e,n){t.addSegment(new En(e,n))}));else{var n=this.phase<this.dashSum?this.phase:this.phase%this.dashSum,i=0,a=0,r=!0;n>0&&this.dashes.reduce((function(e,t,o){var s=e+t;return s>n&&(a=s-n,i=o,r=o%2==0),s}),0);var o=function(){return(i+1)%e.dashes.length};this.contour.reduce((function(s,c){var l=s.distanceTo(c),u=s;for(a>0&&(t.addSegment(new En(u,u=u.move(a,c),r)),r=!r,l-=a,i=o());;){var d=e.dashes[i];if(!(l>=d)){t.addSegment(new En(u,c,r)),e.continuous?(a=d-l,l=0):(a=n,i=0,r=!0);break}t.addSegment(new En(u,u=u.move(d,c),r)),l-=d,i=o(),r=!r}return c}))}return t}}])}(An),function(e){l(a,e);var n=m(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,null,r)).controlPoint1=e,o.controlPoint2=i,o}return i(a,[{key:"render",value:function(e){e.bezierCurveTo(this.controlPoint1.x,this.controlPoint1.y,this.controlPoint2.x,this.controlPoint2.y,this.to.x,this.to.y)}}]),a}(Sn)),kn=function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"render",value:function(e){e.moveTo(this.from.x,this.from.y)}}]),a}(Sn),Rn=.5522847498308,Tn=3.14159265358979,xn=function(e){l(a,e);var n=m(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this)).points=e,o.innerRect=i,o.outerRect=r,o}return i(a,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,n=arguments.length>2?arguments[2]:void 0,i=new yn,a=this.points.map((function(t){var n=e.innerRect.height-t.y;return new mn(t.x,n)})),r=a.length;n||(n=r*t);var o=a.map((function(e,t){return e.distanceTo(a[(t+1)%r])})).reduce((function(e,t){return e+t})),s={left:a[0].x,right:a[0].x,top:a[0].y,bottom:a[0].y},c=o/n;if(0==c)return i;for(var l=[],u=0,d=a[0],h=a[1],p=d.distanceTo(h),v=0,g=1;v<n;v++){for(;u>p;)u-=p,g++,d=h,h=a[g%r],p=d.distanceTo(h);l.push(d.move(u,h)),u+=c}var m=l.length,y=!0,S=5*c/8;return l.forEach((function(t,n){var a=function(e,t,n){var i,a,r=e.subtractp(t),o=n.subtractp(t),s=[],c=Math.atan2(r.y,r.x),l=Math.atan2(o.y,o.x);c+=Math.acos(e.distanceTo(t)/(2*S))-Tn/9,l-=Math.acos(n.distanceTo(t)/(2*S)),l<c&&(l+=2*Tn);var u={left:t.x-S,right:t.x+S,bottom:t.y-S,top:t.y+S},d=Cn(u,c,l,y);(i=s).push.apply(i,f(d.arrAp)),y=!1;var h=t.subtractp(n);return c=Math.atan2(h.y,h.x),c+=Math.acos(n.distanceTo(t)/(2*S)),l=c-Tn/9,u={left:n.x-S,right:n.x+S,bottom:n.y-S,top:n.y+S},d=Cn(u,c,l,y),(a=s).push.apply(a,f(d.arrAp)),s}(l[0==n?m-1:n-1],t,l[(n+1)%m]);a.forEach((function(t){var n=function(t){if(t)return new mn(t.x+e.innerRect.left-e.outerRect.left,e.innerRect.height-t.y+(e.innerRect.top-e.outerRect.top))};t.from=n(t.from),t.to=n(t.to),t.controlPoint1=n(t.controlPoint1),t.controlPoint2=n(t.controlPoint2),i.addSegment(t)}))})),i.rect=s,i}}]),a}(An);function Cn(e,t,n,i){var a,r,o,s,c,l,u,d,h,f,p,v,g,m,y,S,A,w,E,b,k,R,T,x,C={};if(e.left>=e.right||e.bottom>=e.top)return{arrAp:[],pdfRect:C};if(Math.abs(n-t)<=1e-4)return{arrAp:[],pdfRect:C};var P=[];a=(e.right+e.left)/2,r=(e.top+e.bottom)/2,o=Math.abs(e.right-e.left)/2,s=Math.abs(e.top-e.bottom)/2,T=t,k=a+(p=o*Math.cos(T)),R=r+(v=s*Math.sin(T)),C.left=C.right=k,C.bottom=C.top=R,i&&P.push(new kn(new mn(k,R)));var _=1;n<t&&(_=-1);var I=Math.floor(2*t/Tn);_>0&&(I+=1),I*=Tn/2;for(var D=!1;x=I,_>0?n<=I&&(x=n,D=!0):n>=I&&(x=n,D=!0),p=o*Math.cos(T),v=s*Math.sin(T),A=o*Math.cos(x),h=f=-o*o*s*s,g=p+(k=(E=((u=o*o*v)*f-(d=o*o*(w=s*Math.sin(x)))*h)/((c=s*s*p)*d-(l=s*s*A)*u))-p)*Rn,m=v+(R=(b=(l*h-c*f)/(c*d-l*u))-v)*Rn,y=A+(k=E-A)*Rn,S=w+(R=b-w)*Rn,g=k=a+g,m=R=r+m,C.left>g&&(C.left=g),C.bottom>m&&(C.bottom=m),C.right<g&&(C.right=g),C.top<m&&(C.top=m),y=k=a+y,S=R=r+S,C.left>y&&(C.left=y),C.bottom>S&&(C.bottom=S),C.right<y&&(C.right=y),C.top<S&&(C.top=S),A=k=a+A,w=R=r+w,C.left>A&&(C.left=A),C.bottom>w&&(C.bottom=w),C.right<A&&(C.right=A),C.top<w&&(C.top=w),P.push(new bn(new mn(g,m),new mn(y,S),new mn(A,w))),!D;)T=x,I+=_*Tn/2;return{arrAp:P,pdfRect:C}}var Pn=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;t(this,e),this.top=n,this.left=i,this.bottom=a,this.right=r},_n=function(){function n(e){t(this,n),this.offsetLeft=0,this.offsetTop=0,this.offsetRight=0,this.offsetBottom=0,this.target=e}return i(n,[{key:"moveLeft",value:function(e){return this.offsetLeft+=e,this.offsetRight+=e,this}},{key:"moveTop",value:function(e){return this.offsetTop+=e,this.offsetBottom+=e,this}},{key:"move",value:function(e,t){return this.moveLeft(e).moveTop(t)}},{key:"moveTo",value:function(e,t){return this.offsetLeft=this.offsetRight=this.target.left-e,this.offsetTop=this.offsetBottom=this.target.top-t,this}},{key:"shrink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new Pn(e,t,-n,-i))}},{key:"expand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new Pn(-e,-t,n,i))}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",i=this.target.right+this.offsetRight-(this.target.left+this.offsetLeft),a=this.target.bottom+this.offsetBottom-(this.target.top+this.offsetTop),r=i*e-i,o=a*e-a,s=0,c=0,l=0,u=0;switch(t){case"right":s=-r;break;case"center":s=-r/2,c=r/2;break;default:c=r}switch(n){case"bottom":l=-o;break;case"center":l=-o/2,u=o/2;break;default:u=o}return this.add(new Pn(l,s,u,c))}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.top,n=void 0===t?0:t,i=e.left,a=void 0===i?n:i,r=e.bottom,o=void 0===r?n:r,s=e.right,c=void 0===s?a:s;return this.offsetLeft+=a,this.offsetRight+=c,this.offsetBottom+=o,this.offsetTop+=n,this}},{key:"extract",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight;return{left:e,top:this.target.top+this.offsetTop,right:t,bottom:this.target.bottom+this.offsetBottom}}},{key:"boundary",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight,n=this.target.top+this.offsetTop;return{left:e,top:n,width:t-e,height:this.target.bottom+this.offsetBottom-n}}},{key:"intersect",value:function(t){e(t,n)||(t=n.on(t));var i=this.toPlainObject(),a=t.toPlainObject(),r={left:Math.max(i.left,a.left),right:Math.min(i.right,a.right),top:Math.max(i.top,a.top),bottom:Math.min(i.bottom,a.bottom)};return n.on(r)}},{key:"toPlainObject",value:function(){return{left:this.target.left+this.offsetLeft,right:this.target.right+this.offsetRight,top:this.target.top+this.offsetTop,bottom:this.target.bottom+this.offsetBottom}}},{key:"optimize",value:function(e){var t=this.toPlainObject(),i=t.left,a=t.right,r=t.top,o=t.bottom,s=e.left,c=e.right,l=e.top,u=e.bottom,d=function(e,t,n){return Math.max(t,Math.min(e,n))},h={left:d(i,s,c),right:d(a,s,c),top:d(r,l,u),bottom:d(o,l,u)},f=h.left,p=h.right,v=h.top,g=h.bottom;return Object.assign(h,{left:Math.min(f,p),right:Math.max(f,p),top:Math.min(v,g),bottom:Math.max(v,g)}),n.on(h)}}],[{key:"isOverlap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(e.left,t.left),a=Math[n?"min":"max"](e.top,t.top),r=Math[n?"max":"min"](e.bottom,t.bottom),o=Math.min(e.right,t.right);if(i<=o)if(n){if(a>=r)return(o-i)*(a-r)}else if(a<=r)return(o-i)*(r-a);return 0}},{key:"isInRect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e>=n.left&&e<=n.right)if(i){if(t>=n.bottom&&t<=n.top)return!0}else if(t<=n.bottom&&t>=n.top)return!0;return!1}},{key:"rectInRect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(e.left>=t.left&&e.right<=t.right)&&(n?e.top<=t.top&&e.bottom>=t.bottom:e.top>=t.top&&e.bottom<=t.bottom)}},{key:"isSimilar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(e.top-t.top)<n&&Math.abs(e.bottom-t.bottom)<n&&Math.abs(e.left-t.left)<n&&Math.abs(e.right-t.right)<n}},{key:"on",value:function(e){return new n(e)}},{key:"subtract",value:function(e,t){return new Pn(e.top-t.top,e.left-t.left,e.bottom-t.bottom,e.right-t.right)}},{key:"expandOffset",value:function(e,t){return new Pn(e.top-t.top,e.left-t.left,t.bottom-e.bottom,t.right-e.right)}},{key:"copyTo",value:function(e,t){t.left=e.left,t.top=e.top,t.right=e.right,t.bottom=e.bottom}}]),n}(),In=function(e){l(o,e);var n=m(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-square-canvas")}},{key:"doRender",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.renderingData.annotInfo,i=n.borderInfo||{},a=this.convertPointToPixel(i.width||1,e.scale),r=this.canvas.getContext("2d");if(r.clearRect(0,0,this.canvas.width,this.canvas.height),r.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=a,t&&(r.globalAlpha=n.opacity),0===a||!1===n.hasBorderColor?r.strokeStyle="transparent":r.strokeStyle=this.numberToRGBAString(n.color),r.lineWidth=a;try{switch(i.style){case on:case rn:case nn:this.renderSolid(r,n,e);break;case an:this.renderDashed(r,n,e);break;case sn:this.renderCloud(r,n,e)}var o=n.fillColor;o&&(r.fillStyle=this.numberToRGBAString(o),r.fill()),r.stroke()}finally{r.restore()}}}},{key:"shrinkRect",value:function(e,t){var n=_n.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"renderCloud",value:function(e,t,n){t.fillColor;var i=t.borderInfo.cloudIntensity,a=this.shrinkRect(n.innerRect,0),r=this.shrinkRect(n.outerRect,0),o=a.width,s=a.height;new xn([new mn(0,s),new mn(o,s),new mn(o,0),new mn(0,0)],a,r).generate(32/3/i).render(e)}},{key:"renderDashed",value:function(e,t,n){var i=this,a=t.borderInfo,r=a.dashes||[],o=a.dashPhase||0,s=n.scale;e.save(),e.setLineDash&&e.setLineDash(r.map((function(e){return i.convertPointToPixel(e,s)}))),e.lineDashOffset=this.convertPointToPixel(o,s),this.renderSolid(e,t,n)}},{key:"renderSolid",value:function(e,t,n){var i=n.lineWidth,a=n.innerRect,r=n.outerRect,o=a.width,s=a.height,c=.5*i,l=a.left-r.left,u=a.top-r.top;e.beginPath(),e.rect(c+l,c+u,o-i,s-i),e.closePath()}}]),o}(tn);const Dn={invisible:1,hidden:2,print:4,noZoom:8,noRotate:16,noView:32,readOnly:64,locked:128,toggleNoView:256,lockedContents:512};const Mn=function(){function e(n){t(this,e),this.flag=n}return i(e,[{key:"getValue",value:function(){return this.flag}},{key:"checkInvisible",value:function(){return(this.flag&Dn.invisible)===Dn.invisible}},{key:"checkHidden",value:function(){return(this.flag&Dn.hidden)===Dn.hidden}},{key:"checkPrint",value:function(){return(this.flag&Dn.print)===Dn.print}},{key:"checkNoZoom",value:function(){return(this.flag&Dn.noZoom)===Dn.noZoom}},{key:"checkNoRotate",value:function(){return(this.flag&Dn.noRotate)===Dn.noRotate}},{key:"checkNoView",value:function(){return(this.flag&Dn.noView)===Dn.noView}},{key:"checkReadOnly",value:function(){return(this.flag&Dn.readOnly)===Dn.readOnly}},{key:"checkLocked",value:function(){return(this.flag&Dn.locked)===Dn.locked}},{key:"checkToggleNoView",value:function(){return(this.flag&Dn.toggleNoView)===Dn.toggleNoView}},{key:"checkLockedContents",value:function(){return(this.flag&Dn.lockedContents)===Dn.lockedContents}},{key:"check",value:function(e){return(this.flag&e)===e}},{key:"or",value:function(e){return this.flag=this.flag|e,this}}]),e}();const Nn={annotationUpdated:"annotation-updated",annotationIDUpdated:"annotation-id-updated",annotationAppearanceUpdated:"annotation-appearance-updated",annotationReplyAdd:"annotation-reply-add",annotationReplyAdded:"annotation-reply-add",annotationReviewStateAnnotAdd:"annotation-review-state-annot-add",annotationReviewStateAnnotAdded:"annotation-review-state-annot-add",annotationMarkedStateAnnotAdd:"annotation-marked-state-annot-add",annotationMarkedStateAnnotAdded:"annotation-marked-state-annot-add",annotationStatesCleared:"annotation-states-cleared",annotationRemoved:"annotation-removed",annotationMovedPosition:"annotation-moved-position",annotationPositionMoved:"annotation-moved-position",annotationOrderChanged:"annotation-order-changed",annotationAdded:"annotation-add",annotationAdd:"annotation-add",moveAnnotsToPages:"moveAnnotsToPages",annotationImported:"annotation-imported",annotationImportedEx:"annotation-imported-ex",annotationLoaded:"annotation-loaded",actionUpdated:"action-updated",actionAdd:"action-add",actionAdded:"action-add",actionRemove:"action-remove",actionRemoved:"action-remove",layerVisibleChange:"layer-visible-change",layerVisibleChanged:"layer-visible-change",layerRemoved:"layer-removed",layerMerged:"layer-merged",layerAdded:"layer-added",bookmarkAdded:"bookmark-added",structureBookmarkAdded:"structure-bookmark-added",bookmarkUpdated:"bookmark-updated",bookmarkRemoved:"bookmark-removed",stateAnnotNameUpdated:"state-annot-name-updated",pageInfoChange:"page-info-change",pageInfoChanged:"page-info-change",pageRotationChange:"page-rotation-change",beforePageRotationChanged:"before-page-rotation-changed",pageRotationChanged:"page-rotation-change",imageAdded:"image-added",watermarksAdded:"watermarks-added",watermarkAdded:"watermark-added",watermarkRemoved:"watermark-removed",graphicsUpdated:"graphics-updated",permissionChanged:"permission-changed",docPasswordChanged:"doc-password-changed",drmEncryptSuccess:"drm-encrypt-success",drmEncryptSucceeded:"drm-encrypt-success",drmEncryptFailed:"drm-encrypt-failed",removePwdAndPerm:"remove-password-and-permission",pwdAndPermRemoved:"remove-password-and-permission",securityTypeChanged:"security-type-changed",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",insertPages:"import-pages",pagesInserted:"import-pages",importPages:"import-pages",documentAttachmentAdd:"document-attachment-add",docAttachmentAdded:"document-attachment-add",documentAttachmentModify:"document-attachment-modify",docAttachmentModified:"document-attachment-modify",documentAttachmentRemove:"document-attachment-remove",docAttachmentRemoved:"document-attachment-remove",applyRedaction:"apply-redaction",redactionApplied:"apply-redaction",removeReviewState:"remove-review-state",reviewStateRemoved:"remove-review-state",removeMarkedState:"remove-marked-state",markedStateRemoved:"remove-marked-state",formValueChanged:"form-value-changed",metaDataChanged:"meta-data-changed",docModified:"doc-modified",flattened:"flattened",flattenAnnotation:"flatten-annotation",headerFooterUpdated:"headerFooterUpdated",headerFooterAdded:"headerFooterAdded",calculationOrderUpdated:"calculationOrderUpdated",COChange:"COChange",COChanged:"COChange",pagesMoved:"pages-moved",pagesReverseStart:"pagesReverseStart",pagesReversed:"pagesReversed",pagesRemoved:"pages-removed",pagesRotated:"pages-rotated",pageMeasureScaleRatioChanged:" page-measure-scale-ratio-changed",obtainsPageFromEngine:"obtains-page-from-engine",pagesBoxChange:"pages-box-changed",pagesBoxChanged:"pages-box-changed",pagesLabelChange:"pages-label-change",pagesLabelChanged:"pages-label-change",pagesLabelNeedUpdate:"pages-label-need-change",pagesLabelNeedUpdated:"pages-label-need-change",pagesReplace:"pages-replace",pagesReplaced:"pages-replace",recognitionForm:"recognition-form",removeEmbeddedPageThumbnail:"remove-embedded-page-thumbnail",embeddedPageThumbnailRemoved:"remove-embedded-page-thumbnail",objectStartEdit:"object-start-edit",objectEndEdit:"object-end-edit",objectSelectionChanged:"object-selection-changed",objectAdded:"object-added",objectPropertyChanged:"object-property-changed",objectContentChanged:"object-content-changed",paragraphContentChanged:"paragraph-text-changed",paragraphTextOnActivate:"paragraph-text-on-activate",paragraphTextOnDeactivate:"paragraph-text-on-deactivate",paragraphTextEnterEdit:"paragraph-text-enter-edit",paragraphTextExitEdit:"paragraph-text-exit-edit",paragraphTextOnChar:"paragraph-text-on-char",findSuccess:"find-success",replaceSuccess:"replace-success",replaceAllSuccess:"replace-all-success",articleThreadAdded:"article-thread-added",articleThreadUpdated:"article-thread-updated",articleThreadRemoved:"article-thread-removed",articleBeadAdded:"article-bead-added",articleBeadRemoved:"article-bead-removed",articleBeadUpdated:"article-bead-updated",articleEnterReadMode:"article-enter-read-mode",articleOutReadMode:"article-out-read-mode",invalidRect:"invalidRect",xfaContentChanged:"xfa-content-changed",formReloaded:"formReloaded",formFieldImported:"form-field-imported",pagingSealUpdated:"paging-seal-updated",xfaFormImported:"xfa-form-imported",xfaFormReset:"xfa-form-reset",xfaFormRemoved:"xfa-form-removed",textSplited:"text-splited",formFieldPropertyUpdated:"form-field-property-updated",formFieldRenamed:"form-field-renamed",formFieldRemoved:"form-field-removed",formReset:"form-reset",formImported:"form-imported",tabOrderTypeUpdated:"tab-order-type-updated",pageAdditionalActionAdded:"page-additional-action-added",pageAdditionalActionUpdated:"page-additional-action-updated",pageAdditionalActionRemoved:"page-additional-action-removed",docAdditionalActionAdded:"doc-additional-action-added",docAdditionalActionUpdated:"doc-additional-action-updated",docAdditionalActionRemoved:"doc-additional-action-removed",docOpenActionUpdated:"doc-open-action-updated",docOpenActionRemoved:"doc-open-action-removed",formWidgetCreated:"form-widget-created",pdfDocCreated:"pdf-doc-created"};const Ln=Object.assign({jrLicenseSuccess:"jr-license-success",srLicenseSuccess:"sr-license-success",beforeOpenFile:"before-open-file",openingFile:"opening-file",beforeLoadPDFDoc:"before-load-pdf-document",openFileSuccess:"open-file-success",openFileFailed:"open-file-failed",willCloseDocument:"will-close-document",documentClosed:"document-closed",renderFileSuccess:"render-file-success",renderFileFailed:"render-file-error",beforeRenderPage:"before-render-page",renderPageSuccess:"render-page-success",updateZoomMode:"update-zoom-mode",beforeZoomTo:"before-zoom-to",zoomToSuccess:"zoom-to-success",zoomToFailed:"zoom-to-failed",startChangeViewMode:"start-change-view-mode",changeViewModeSuccess:"change-view-mode-success",toggleFullScreen:"toggle-full-screen",changeViewModeFailed:"change-view-mode-failed",pagesLayoutRedrawBegin:"pages-layout-redraw-begin",pageLayoutRedraw:"page-layout-redraw",pagesLayoutRedrawEnd:"pages-layout-redraw-end",copyTextSuccess:"copy-text-success",copyTextFailed:"copy-text-failed",tapPage:"tap-page",tapAnnotation:"tap-annotation",pressPage:"press-page",pressAnnotation:"press-annotation",pressText:"press-text",rightClickPage:"right-click-page",rightClickAnnotation:"right-click-annotation",doubleTapPage:"double-tap-page",doubleTapAnnotation:"double-tap-annotation",activeAnnotationBefore:"active-annotation-before",activeAnnotation:"active-annotation",activeAnnotationAfter:"active-annotation-after",panActiveAnnotation:"pan-active-annotation",doubleTapActiveAnnotation:"double-tap-active-annotation",contextMenuActiveAnnotation:"contextmenu-action-annotation",activeMultipleAnnotations:"active-multiple-annotations",unActiveAnnotation:"unactive-annotation",updateActiveAnnotation:"update-action-annotation",updateActionAnnotation:"update-action-annotation",removeActiveAnnotationBefore:"remove-action-annotation-before",removeActionAnnotationBefore:"remove-action-annotation-before",removeActiveAnnotationSuccess:"remove-action-annotation-success",removeActionAnnotationSuccess:"remove-action-annotation-success",removeActiveAnnotationFailed:"remove-action-annotation-failed",removeActionAnnotationFailed:"remove-action-annotation-failed",beforeSwitchStateHandler:"before-switch-state-handler",switchStateHandler:"switch-state-handler",deactiveStateHandler:"deactive-state-handler",afterSwitchStateHandler:"after-switch-state-handler",redactAnnotAllApplyed:"applyed-all-redaction",redactAnnotApplyed:"applyed-redaction",pageNumberChange:"page-number-change",beforeDocumentRotation:"before-document-rotation",afterDocumentRotation:"after-document-rotation",snapModeChanged:"snap-mode-changed",createPageAreaRenderer:"create-page-area-renderer",destroyPageAreaRenderer:"destroy-page-area-renderer",startUpdatePageAreaRenderer:"start-update-page-area-renderer",createSnapshotArea:"create-snapshot-area",updateSnapshotArea:"update-snapshot-area",stabilizedSnapshotArea:"stabilized-snapshot-area",switchPageAreaRenderer:"switch-page-area-renderer",fitWidthResizeViewport:"fit-width-resize-viewport",signatureFieldMouseLButtonDown:"signature-field-Lbutton-down",signatureFieldMouseLButtonUp:"signature-field-LButton-up",signatureFieldMouseEnter:"signature-field-mouse-enter",signatureFieldMouseExit:"signature-field-mouse-exit",visiblePagesRenderCompleted:"completed-render-visible-pages",marqueeZoomIn:"marquee-zoom-in",marqueeZoomOut:"marquee-zoom-out",inkSignAdded:"inkSign-added",inkSignDeleted:"inkSign-deleted",changeReadSpeed:"changeReadSpeed",changeReadVolume:"changeReadVolume",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",customDataAdd:"custom-data-add",customDataImported:"custom-data-imported",customDataRemoved:"custom-data-removed",customDataUpdated:"custom-data-updated",distanceAnnotCreationStart:"distance-creation-start",perimeterAnnotCreationStart:"perimeter-creation-start",updateDistanceAnnot:"update-distance-annot",distanceAnnotCreationEnd:"distance-creation-end",distanceAnnotCreationCancel:"distance-creation-cancel",drawingAnnotCreationStart:"drawing-creation-start",drawingAnnotCreationEnd:"drawing-creation-end",drawingAnnotCreationCancel:"drawing-creation-cancel",addEditImage:"add-edit-image",InkImageSelected:"ink-image-selected",checkTheSearch:"check-the-search",activeElementChanged:"active-element-changed",cancelCreatingDistance:"cancel-creating-measurement",completeCreatingDistance:"complete-creating-measurement",eraserSuccess:"eraser-success",addAnnotSuccess:"add-annot-success",cancelAddAnnot:"cancel-add-annot",globalAnnotFlagChanged:"global-annot-flag-changed",toolbarTabsClicked:"toolbar-tabs-clicked",sideBarChanged:"sidebar-changed",showWhatsNew:"show-whats-new",disableScroll:"disable-scroll",enableScroll:"enable-scroll",updateScrollableStatus:"update-scrollable-status",selectText:"select-text",changeEnableJS:"change-enable-js",toggleEngineSr2JrSuccess:"toggle-engine-sr-to-jr-success",iconInited:"iconInited",iconAdded:"iconAdded",iconRemoved:"iconRemoved",annotationPermissionChanged:"annotation-premission-changed",startScrollingPage:"pdfui-start-scrolling-page",scrollingPage:"pdfui-scrolling-page",endScrollingPage:"pdfui-end-scrolling-page",designerAssistantStatusChanged:"form-designer-assistant-status-changed",mouseEnter:"mouse-enter",mouseLeave:"mouse-leave",setFromFieldHighlight:"set_form_field_highlight",AddFontMaps:"set_font_map",thumbnailClicked:"thumbnail-clicked",layerActionActived:"layer-action-actived",redeModeShowSidebar:"rede-mode-show-sidebar",gridToggle:"grid-toggle",snapGridToggle:"snap-grid-toggle",toggleCollaborationMode:"toggleCollaborationMode",findReplaceDialogVisibleChange:"find-replace-dialog-visible-change",showAllComments:"show-all-comments",hideAllComments:"hide-all-comments",focusOnControl:"focus-on-control",blurFromObject:"blur-from-object",documentWillPrint:"document-will-print",documentDidPrint:"document-did-print",documentWillSave:"document-will-save",documentDidSave:"document-did-save",verifyDocSignatureEvent:"verify-doc-signature",verifySignatureEvent:"verify-signature",clearSignatureEvent:"clear-signature",viewSignedVersionDocEvent:"view-signed-version",showFieldPropertiesEvent:"show-field-properties",showSignatureVerifyInfoEvent:"show-signature-tusted-info",compareSignedVersionEvent:"compare-signed-version",showCompareSignedVersionResultEvent:"show-compare-signed-version-result",eSignCnShowMultiPageStamp:"eSignCnShowMultiPageStamp",eSignCNAddDateStamp:"eSignCNAddDateStamp",eSignCNCloseStamp:"eSignCNCloseStamp",eSignCNChangePagingSeal:"eSignCNChangePagingSeal",eSignCNOpenProcessSeal:"eSignCNOpenProcessSeal",eSignCnApply:"eSignCnApply",eSignCNShowOfflineResult:"eSignCNShowOfflineResult",eSignCnExit:"eSignCnExit",tapField:"tap-field",tapGraphicsObject:"tap-graphics-object",spawnPageSuccess:" spawn-page-success",progressChanged:"progress-changed",togglePageContextMenu:"toggle-page-contextmenu",beforeRenderingVisiblePages:"before-rerendering-visible-pages",afterRenderingVisiblePages:"after-rerendering-visible-pages",localFontLoaded:"local-font-loaded",willToggleAutoScroll:"will-toggle-auto-scroll",showLoading:"show-loading",changeLanguageSuccess:"change-language-success"},Nn);!function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(t(this,n),"function"==typeof e.transformRect){var c=e;e=c.a,i=c.b,a=c.c,r=c.d,o=c.e,s=c.f}else if(Array.isArray(e)){var l=e;e=l[0],i=l[1],a=l[2],r=l[3],o=l[4],s=l[5]}this.a=e,this.b=i,this.c=a,this.d=r,this.e=o,this.f=s}i(n,[{key:"set",value:function(e,t,n,i,a,r){this.a=e,this.b=t,this.c=n,this.d=i,this.e=a,this.f=r}},{key:"reset",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}},{key:"reverse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=e.a*e.d-e.b*e.c;if(0==t)return e;var i=-t;return new n(e.d/t,e.b/i,e.c/i,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.a*e.f-e.b*e.e)/i)}},{key:"setReverse",value:function(e){var t=this.reverse(e);this.set(t.a,t.b,t.c,t.d,t.e,t.f)}},{key:"rotate",value:function(e,t){var i,a=Math.cos(e),r=Math.sin(e),o=new n(a,r,-r,a,0,0);i=t?n.Concat2mt(o,this):n.Concat2mt(this,o),this.set(i.a,i.b,i.c,i.d,i.e,i.f)}},{key:"rotateAt",value:function(e,t,n,i){this.translate(e,t,i),this.rotate(n,i),this.translate(-e,-t,i)}},{key:"translate",value:function(e,t,n){n?(this.e+=e*this.a+t*this.c,this.f+=t*this.d+e*this.b):(this.e+=e,this.f+=t)}},{key:"concat",value:function(t,i,a,r,o,s,c){var l,u;e(t,n)?(l=t,c=i):l=new n(t,i,a,r,o,s),u=c?n.Concat2mt(l,this):n.Concat2mt(this,l),this.set(u.a,u.b,u.c,u.d,u.e,u.f)}},{key:"is90Rotated",value:function(){var e=1e3*this.a;e<0&&(e*=-1);var t=1e3*this.d;t<0&&(t*=-1);var n=this.b;n<0&&(n*=-1);var i=this.c;return i<0&&(i*=-1),e<n&&t<i}},{key:"isScaled",value:function(){var e=1e3*this.b;e<0&&(e*=-1);var t=1e3*this.c;t<0&&(t*=-1);var n=this.a;n<0&&(n*=-1);var i=this.d;return i<0&&(i*=-1),e<n&&t<i}},{key:"getA",value:function(){return this.a}},{key:"getB",value:function(){return this.b}},{key:"getC",value:function(){return this.c}},{key:"getD",value:function(){return this.d}},{key:"getE",value:function(){return this.e}},{key:"getF",value:function(){return this.f}},{key:"scale",value:function(e,t,n){this.a*=e,this.d*=t,n?(this.b*=e,this.c*=t):(this.b*=t,this.c*=e,this.e*=e,this.f*=t)}},{key:"transformXDistance",value:function(e){var t=this.a*e,n=this.b*e;return Math.sqrt(t*t+n*n)}},{key:"transformYDistance",value:function(e){var t=this.c*e,n=this.d*e;return Math.sqrt(t*t+n*n)}},{key:"transformDistance",value:function(e,t){var n=this.a*e+this.c*t,i=this.b*e+this.d*t;return Math.sqrt(n*n+i*i)}},{key:"transformPoint",value:function(e,t){return[this.a*e+this.c*t+this.e,this.b*e+this.d*t+this.f]}},{key:"transformRect",value:function(e,t,n,i){for(var a,r=[e,e,n,n],o=[t,i,t,i],s=0;s<4;s++)a=this.transformPoint(r[s],o[s]),r[s]=a[0],o[s]=a[1];for(var c=[r[0],r[0],o[0],o[0]],l=1;l<4;l++)c[0]>r[l]&&(c[0]=r[l]),c[1]<r[l]&&(c[1]=r[l]),c[2]>o[l]&&(c[2]=o[l]),c[3]<o[l]&&(c[3]=o[l]);return[c[0],c[2],c[1],c[3]]}},{key:"getXUnit",value:function(){var e=this.a,t=this.b;return 0===t?Math.abs(e):0===e?Math.abs(t):Math.sqrt(e*e+t*t)}},{key:"getYUnit",value:function(){var e=this.c,t=this.d;return 0===e?Math.abs(t):0===t?Math.abs(e):Math.sqrt(e*e+t*t)}},{key:"getUnitRect",value:function(){return this.transformRect(0,0,1,1)}},{key:"matchRect",value:function(e,t){var n=t[0]-t[2];this.a=Math.abs(n)<.001?1:(e[0]-e[2])/n,n=t[3]-t[1],this.d=Math.abs(n)<.001?1:(e[3]-e[1])/n,this.e=e[0]-t[0]*this.a,this.f=e[3]-t[3]*this.d,this.b=0,this.c=0}},{key:"getAngle",value:function(){return Math.atan2(this.b,this.a)}},{key:"toArray",value:function(){return[this.a,this.b,this.c,this.d,this.e,this.f]}}],[{key:"Concat2mt",value:function(e,t){return new n(e.a*t.a+e.b*t.c,e.a*t.b+e.b*t.d,e.c*t.a+e.d*t.c,e.c*t.b+e.d*t.d,e.e*t.a+e.f*t.c+t.e,e.e*t.b+e.f*t.d+t.f)}}])}();var Vn,On=function(){function e(n){t(this,e),Ke(this,"values",void 0),Ke(this,"cols",void 0),(0,xe.assertThat)(Array.isArray(n),"Illegal Matrix values, it should be an array! But actual: "+n),(0,xe.assertThat)(16===n.length,"Incorrect matrix values size, it must be 16!"),this.values=n,this.cols=Math.sqrt(n.length)}return i(e,[{key:"multiVec4",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return[this.getAt(0,0)*e+this.getAt(0,1)*t+this.getAt(0,2)*n+this.getAt(0,3)*i,this.getAt(1,0)*e+this.getAt(1,1)*t+this.getAt(1,2)*n+this.getAt(1,3)*i,this.getAt(2,0)*e+this.getAt(2,1)*t+this.getAt(2,2)*n+this.getAt(2,3)*i,this.getAt(3,0)*e+this.getAt(3,1)*t+this.getAt(3,2)*n+this.getAt(3,3)*i]}},{key:"getAt",value:function(e,t){var n=e*this.cols+t;return(0,xe.assertThat)(n<this.values.length,"Cannot access value at (".concat(e,",").concat(t,"), it out bound of this matrix!")),this.values[n]}}]),e}();!function(){function e(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,e),Ke(this,"a",void 0),Ke(this,"b",void 0),Ke(this,"c",void 0),Ke(this,"d",void 0),this.a=n,this.b=i,this.c=a,this.d=r}i(e,[{key:"transform",value:function(t){var n=A(t.multiVec4(this.a,this.b,this.c,this.d),4);return new e(n[0],n[1],n[2],n[3])}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return this.transform(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return new On([e,0,0,0,0,t,0,0,0,0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,0,0,0,0,1])}(e,t,n))}},{key:"rotateZ",value:function(e){return this.transform(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/180*Math.PI,t=Math.cos(e),n=Math.sin(e);return new On([t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1])}(e))}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.transform(function(e){return new On([1,0,0,e,0,1,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,0,0,1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,0,0,0,1])}(e,t,n))}}])}();function Hn(e){return function(){if(!Vn){var e=(0,xe.getDPI)();Vn=[e.x,e.y]}return Vn}()[e]}function Fn(e){return e*Hn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/72}var Un=function(){function e(n){t(this,e),Ke(this,"pdfRect",{left:0,right:0,top:0,bottom:0}),Ke(this,"deviceRect",{left:0,right:0,top:0,bottom:0}),Ke(this,"pdfViewer",void 0),Ke(this,"page",void 0),Ke(this,"pageRender",void 0),Ke(this,"scale",void 0),Ke(this,"rotate",void 0),Ke(this,"intent",void 0),Ke(this,"annotationInfo",this.getDefaultAnnotInfo()),Ke(this,"eContainer",document.createElement("div")),Ke(this,"renderer",void 0),this.eContainer.classList.add("fv__viewer-fake-annot-container"),this.pdfViewer=n.pdfViewer,this.pageRender=n.pageRender,this.intent=n.info.intent,(0,xe.extendOptions)(this.annotationInfo,n.info,this.getDefaultAnnotConfig()),this.annotationInfo.type=this.getType(),this.page=n.pageRender.page,this.scale=n.pageRender.scale,this.rotate=n.pageRender.rotate,this.pageRender.$annotsContainer.append(this.eContainer)}return i(e,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top),i=Fn(this.annotationInfo.borderInfo.width)*this.scale*2;if(t<i){var a=.5*(i-t)*(e.right-e.left>0?1:-1);e.right+=a,e.left-=a}if(n<i){var r=.5*(i-n)*(e.bottom-e.top>0?1:-1);e.top-=r,e.bottom+=r}t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var o=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,o),(0,xe.cssText)(this.eContainer,{left:e.left+"px",top:e.left+"px",width:t+"px",height:n+"px"})}},{key:"setContent",value:function(e){this.annotationInfo.content=e,this.annotationInfo.contents=e}},{key:"zoomTo",value:function(e){this.scale=e}},{key:"draw",value:function(){this.renderer||(this.renderer=this.generateApRenderer(),this.renderer.prepare(),this.renderer.willRender()),this.renderer.component&&this.renderer.render(this.scale,this.rotate)}},{key:"getContainerElement",value:function(){return this.eContainer}},{key:"getRenderingData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.getDeviceRect(e,t),a=this.getOuterDeviceRect(e,t),r=this.getDeviceRect(n,t);return{annotInfo:this.annotationInfo,annotFlag:new Mn(this.annotationInfo.flags),smartScale:n,rect:a,outerDeviceRect:a,innerDeviceRect:i,engineRenderingRect:r,scale:e,rotate:t,page:this.page}}},{key:"getDeviceRect",value:function(e,t){return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.borderInfo;if(n&&5===n.style){var i=this.pageRender.getContainerVisibleRect(),a=i.right-i.left,r=i.bottom-i.top,o=this.page.getDeviceRect(this.pdfRect,e,t),s=(a-(o.right-o.left))/2,c=(r-(o.bottom-o.top))/2;return{left:o.left-s,right:o.right+s,top:o.top-c,bottom:o.bottom+c}}return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"apply",value:function(){var e=this;return Ae((function(){var t,n;return we(this,(function(i){switch(i.label){case 0:return null===(t=e.renderer)||void 0===t||t.afterRender(),[4,e.getCreationJSON()];case 1:return(n=i.sent()).endingStyle&&(n.endStyle=n.endingStyle,delete n.endingStyle),n.rect=e.pdfRect,[2,e.page.addAnnot(n).then((function(t){var n=e.pdfViewer.addEventListener("renderAnnotSuccess",(function(){e.destroy(),n()})),i=t[0];return e.pageRender.annotsRender.activeAnnot(i.getId()),e.pdfViewer.eventEmitter.emit(Ln.addAnnotSuccess,i),t}))]}}))}))()}},{key:"destroy",value:function(){var e;null===(e=this.renderer)||void 0===e||e.destroy(),this.getContainerElement().remove()}},{key:"getCreationJSON",value:function(){return this.annotationInfo}},{key:"getDefaultAnnotInfo",value:function(){return{borderInfo:{width:2,style:nn},color:16711680,opacity:1,flags:4,date:new Date}}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),this.getIntent()):{}}},{key:"getIntent",value:function(){return this.intent}}]),e}(),jn=function(e){l(o,e);var n=m(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"getTileConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.pdfViewer.config.tileSize,a=this.page.getDeviceRect(this.pdfRect,1,t),r=this.page.getDeviceRect(this.pdfRect,n,t),o=r.right-r.left,s=r.bottom-r.bottom;return[Math.ceil(s/i),Math.ceil(o/i),o,s,i,n,e,t,a.left,a.top]}},{key:"getRenderingData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=r(a(o.prototype),"getRenderingData",this).call(this,e,t);return Object.assign(n,{opacity:this.annotationInfo.opacity,tileConfig:this.getTileConfig(e,t)})}}]),o}(Un),Bn=function(e){l(a,e);var n=m(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"getType",value:function(){return"square"}},{key:"generateApRenderer",value:function(){return new In(this)}}]),a}(jn),Xn=function(e){l(a,e);var n=m(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"doRender",value:function(e){var t=e.renderingData.annotInfo,n=t.borderInfo||{},i=this.convertPointToPixel(n.width||1,e.scale);if(0!=i||-1!=t.borderColor||t.fillColor){var a=this.canvas.getContext("2d");if(a.clearRect(0,0,this.canvas.width,this.canvas.height),a.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=i,a.globalAlpha=t.opacity,0===i||!1===t.hasBorderColor?a.strokeStyle="transparent":a.strokeStyle=this.numberToRGBAString(t.color),a.lineWidth=i;try{switch(n.style){case nn:this.renderSolid(a,t,e);break;case on:break;case an:this.renderDashed(a,t,e);break;case sn:0==n.cloudIntensity?this.renderSolid(a,t,e):this.renderCloud(a,t,e)}var r=t.fillColor;r&&(a.fillStyle=this.numberToRGBAString(r),a.fill()),a.stroke(),this.setContents(a,t.contents,e)}finally{a.restore()}}}}},{key:"renderSolid",value:function(e,t,n){this.renderDashed(e,t,n)}},{key:"renderDashed",value:function(e,t,n){var i=t.borderInfo,a=n.lineWidth,r=n.innerRect,o=n.outerRect,s=i.dashes||[],c=i.dashPhase||0,l=.5*a,u=new mn(.5*(r.left+r.right)-o.left,.5*(r.top+r.bottom)-o.top),d=Math.abs(.5*r.height-l),h=Math.abs(.5*r.width-l);e.lineDashOffset=c,e.setLineDash&&e.setLineDash(s),e.beginPath(),function(e,t,n,i,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];e.ellipse?e.ellipse(t,n,i,a,r,o,s,c):(e.save(),e.translate(t,n),e.rotate(r),e.scale(i,a),e.arc(0,0,1,o,s,c),e.restore())}(e,u.x,u.y,h,d),e.closePath()}},{key:"renderCloud",value:function(e,t,n){var i=t.borderInfo.cloudIntensity,a=.5*n.lineWidth,r=this.shrinkRect(n.innerRect,a),o=this.shrinkRect(n.outerRect,a),s=new mn(.5*(o.right-o.left)-(r.left-o.left),.5*(o.bottom-o.top)-(r.top-o.top)),c=.5*r.height-a,l=.5*r.width-a,u=16/i,d=Math.PI/u,h=2*Math.PI,f=Array(Math.floor(h/d)-1).fill(0).map((function(e,t){return t*d%h})).map((function(e){var t=l*Math.cos(h-e),n=c*Math.sin(h-e);return s.add(t,n)}));new xn(f,r,o).generate(1,e).render(e)}},{key:"shrinkRect",value:function(e,t){var n=_n.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"setContents",value:function(e,t,n){if(void 0!==t){var i=n.innerRect,a=n.outerRect,r=.5*(i.left+i.right)-a.left,o=.5*(i.top+i.bottom)-a.top,s=e;s.beginPath(),s.font="14px Verdana",s.textAlign="left",s.textBaseline="top",s.direction="ltr";var c=s.measureText(t).width;s.fillStyle="#AF6B6B",s.fillText(t,r-c/2,o-7,c),s.closePath()}}}]),a}(tn);function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){Ke(e,t,n[t])}))}return e}var Gn,Wn=o(602),$n=o.n(Wn);function zn(){}!function(e){e.MEASUREMENT="measurement",e.COMPARISON="comparison",e.STAMP="stamp",e.SIGN_CERTIFY="sign-certify",e.SIGNATURE="signature"}(Gn||(Gn={}));var qn="measurement-info",Kn={userSpaceUnit:jt,userSpaceScaleValue:1,realUnit:jt,realScaleValue:1,caption:"",markup:!0},Zn="measurementInfo",Jn=function(e){l(a,e);var n=m(a);function a(){var e;return t(this,a),Ke(v(e=n.apply(this,arguments)),"pdfViewer",void 0),e}return i(a,[{key:"allInjected",value:function(){var e=this;this.pdfViewer.store.dispatch(Zn,Kn),this.getStorage().get(Gn.MEASUREMENT,qn).then((function(t){e.isDestroyed||t&&(e.pdfViewer.getStore().dispatch(Zn,Yn({},e.convertFromRaw(t))),e.addDestroyHook(e.pdfViewer.store.subscribe(Zn,(function(t){if(!e.isDestroyed)return e.updateMeasurementInfo(t)}))))}));var t=this;this.addDestroyHook(this.getStorage().onChange((function(t){t.context.feature===Gn.MEASUREMENT&&e.pdfViewer.store.dispatch(Zn,e.convertFromRaw(t.newValue))})),this.pdfViewer.addEventListener(Ln.pageNumberChange,Ae((function(){var e,n;return we(this,(function(i){switch(i.label){case 0:return t.isDestroyed?[2]:[4,(e=t.getStorage()).get(Gn.MEASUREMENT,qn)];case 1:return n=i.sent(),[4,e.set(Gn.MEASUREMENT,qn,n)];case 2:return i.sent(),[2]}}))}))))}},{key:"updateMeasurementInfo",value:function(e){var t=this;return Ae((function(){var n,i,a;return we(this,(function(r){switch(r.label){case 0:return[4,t.getMeasurementInfo()];case 1:return n=r.sent(),i=Yn({},n,e),a=t.convertToRaw(i),[4,t.getStorage().set(Gn.MEASUREMENT,qn,a)];case 2:return r.sent(),[2]}}))}))()}},{key:"getMeasurementInfo",value:function(){return this.pdfViewer.store.getCurrentValue(Zn)}},{key:"onMeasurementInfoChange",value:function(e){return this.pdfViewer.store.subscribe(Zn,e)||zn}},{key:"getStorage",value:function(){return this.pdfViewer.getStorage()}},{key:"convertFromRaw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"object"!=typeof e?Object.assign({},Kn):{userSpaceUnit:e.userSpaceUnit?new Ot(e.userSpaceUnit.fromInchRate,e.userSpaceUnit.name):jt,userSpaceScaleValue:null==e.userSpaceScaleValue?1:e.userSpaceScaleValue,realUnit:e.realUnit?new Ot(e.realUnit.fromInchRate,e.realUnit.name):jt,realScaleValue:null==e.realScaleValue?1:e.realScaleValue,caption:e.caption||"",markup:!1!==e.markup}}},{key:"convertToRaw",value:function(e){return{userSpaceUnit:e.userSpaceUnit?{fromInchRate:e.userSpaceUnit.fromInchRate,name:e.userSpaceUnit.name}:Kn.userSpaceUnit,userSpaceScaleValue:e.userSpaceScaleValue||Kn.userSpaceScaleValue,realUnit:e.realUnit?{fromInchRate:e.realUnit.fromInchRate,name:e.realUnit.name}:Kn.realUnit,realScaleValue:e.realScaleValue||Kn.realScaleValue,caption:e.caption||Kn.caption,markup:void 0===e.markup?Kn.markup:e.markup}}},{key:"isSame",value:function(e,t){return JSON.stringify(this.convertToRaw(e))===JSON.stringify(this.convertToRaw(t))}}],[{key:"inject",value:function(){return{pdfViewer:$n()}}}]),a}(xe.Disposable),Qn=function(e){var t=e.getIoC().getInstanceByClass(Jn).getMeasurementInfo();return t.markup&&t.caption?t.caption+"\n":""},ei=function(e){return{markup:e.getIoC().getInstanceByClass(Jn).getMeasurementInfo().markup}},ti=function(e){for(var t=e.length-1;t>=0;t--){e[t].destroy(),e.splice(t,1)}return[]},ni=function(e,t,n){var i=e.getRenderingData(t,n);!i.annotFlag.checkNoZoom()||(t=1);var a=i.outerDeviceRect,r=i.innerDeviceRect;return Object.assign(r,{width:r.right-r.left,height:r.bottom-r.top}),Object.assign(a,{width:a.right-a.left,height:a.bottom-a.top}),{renderingData:i,innerRect:r,outerRect:a,scale:t,rotate:n}},ii=function(e,t){var n=e.canvas,i=n.width,a=n.height,r=t.x,o=t.y;r-=4,o-=4,(r=Math.max(r,2))+8>i&&(r=i-8-2),(o=Math.max(o,2))+8>a&&(o=a-8-2),e.rotate(0),e.fillStyle="#ffffff",e.rect(r,o,8,8),e.stroke(),e.fill()},ai=function(e){l(o,e);var n=m(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"getType",value:function(){return"circle"}},{key:"generateApRenderer",value:function(){return new Xn(this)}},{key:"getCreationJSON",value:function(){var e=this,t=r(a(o.prototype),"getCreationJSON",this).call(this);return"CircleDimension"===this.annotationInfo.intent?this.page.getMeasureScaleRatio().then((function(n){if(n&&n.scale){var i=e.pdfViewer.getStore().getCurrentValue("measurementData"),a=Qn(e.pdfViewer),r=en(i.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(i.displayUnit.name)):i.displayUnit.name;t.contents=a+parseFloat(i.area).toFixed(2)+" sq "+r}return t})):t}}]),o}(jn),ri=w.stateHandler,oi=w.ViewerEvents,si=ri.IStateHandler,ci=ri.StateHandlerUtils.getDevicePagePoint,li=w.shared.keyboardStatus,ui=w.keyboard,di=ui.BuiltinCommand,hi=ui.BuiltinShortcutContext,fi=function(e){l(a,e);var n=m(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).type=i,r.cursorStyle="fv__cursor-crosshair",r}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=i.get(0),r=this.hammer=new Hammer.Manager(a);r.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var o,s,c,l,u=!1,d=this.pdfViewer.getKeyboard(),h=function(){};d.withContext(hi.CREATING_ANNOTATION,(function(e){e.keyup(di.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){n.cancel(),u=!0,h()}),{interceptors:[function(e,t){u||t(e)}]})}));var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;r.on("panstart",(function(e){if(h=d.activeContext(hi.CREATING_ANNOTATION),u=!1,o=a.getBoundingClientRect(),n.startPoint=ci(a,e),n.start({left:n.startPoint.x,top:n.startPoint.y}),p&&p(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;s=t,n})),v){var t=v.startChildSpan(n.constructor.getStateName()+"Start"),i=t.end,r=t.span;c=i,r}})),r.on("panmove",(function(e){if(!u){var t=a.getBoundingClientRect(),i=t.left-o.left,r=t.top-o.top,s=n.correctPosition({x:n.startPoint.x+e.deltaX-i,y:n.startPoint.y+e.deltaY-r});return n.currentPoint=s,n.adjust(n.currentFakeAnnot,n.startPoint,s)}})),r.on("panend",(function(e){if(h(),!u){var t=a.getBoundingClientRect(),i=t.left-o.left,r=t.top-o.top,d=n.correctPosition({x:n.startPoint.x+e.deltaX-i,y:n.startPoint.y+e.deltaY-r});if(n.currentPoint=d,n.end(n.currentFakeAnnot,n.startPoint,d),o=null,v){var f=v.startChildSpan(n.constructor.getStateName()+"End"),p=f.end,g=f.span;l=p,g}null==l||l(),null==c||c(),null==s||s()}})),r.on("pancancel",(function(e){if(h(),!u)return o=null,n.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:n.pageRender.index}),n.end(n.currentFakeAnnot,n.startPoint,n.currentPoint)})),this.removeZoomToSuccessEvent=this.pdfViewer.addEventListener(oi.zoomToSuccess,(function(e){!u&&n.currentFakeAnnot&&(n.currentFakeAnnot.zoomTo(e),n.currentFakeAnnot.draw())}))}},{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(n,e.y))}}},{key:"getSubject",value:function(){switch(this.type){case"circle":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Oval");case"square":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Rectangle")}return""}},{key:"start",value:function(e){var t=e.left,n=e.top,i={flags:4,subject:this.getSubject()};switch(this.type){case"circle":this.currentFakeAnnot=new ai({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square":this.currentFakeAnnot=new Bn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square-crop":this.currentFakeAnnot=new Bn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.getSubject(),borderInfo:{width:1},color:255}});break;default:throw new Error("Will never happen")}this.currentFakeAnnot.setRect({left:t,top:n,right:t+10,bottom:n-10})}},{key:"adjust",value:function(e,t,n){var i,a,r=t.x,o=t.y,s=n.x,c=n.y,l=Math.abs(r-s),u=Math.abs(o-c);li.isShift?(l=u=Math.min(l,u),i=s<r?r-l:r,a=c<o?o-u:o):(i=Math.min(r,s),a=Math.min(o,c)),l=Math.max(l,1),u=Math.max(u,1),e.setRect({left:i,top:a,right:i+l,bottom:a+u}),e.draw()}},{key:"end",value:function(e,t,n){var i=this;return this.currentFakeAnnot.apply().then((function(e){if(i.pdfViewer.config.showCommentList){var t=e[0];i.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}})).finally((function(){i.currentFakeAnnot=null}))}},{key:"cancel",value:function(){this.currentFakeAnnot&&(this.currentFakeAnnot.destroy(),this.currentFakeAnnot=null),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"currentPointDirection",value:function(){var e=this.startPoint.x,t=this.startPoint.y,n=this.currentPoint.x,i=this.currentPoint.y;return n<=e?i<t?"north-west":"south-west":i<t?"north-east":"south-east"}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.removeZoomToSuccessEvent&&this.removeZoomToSuccessEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),a}(si),pi=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUARE,vi=function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e,"square")}return i(a,null,[{key:"getStateName",value:function(){return pi}}]),a}(fi),gi=w.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_CIRCLE,mi=function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e,"circle")}return i(a,null,[{key:"getStateName",value:function(){return gi}}]),a}(fi),yi=w.vendors.EventEmitter,Si=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this)).pdfViewer=e,i.eventEmitter=new yi,i.addDestroyHook((function(){i.eventEmitter.removeAllListeners()})),i.isLocked=!1,i.isStarted=!1,i}return i(a,[{key:"init",value:function(){}},{key:"start",value:function(){this.isStarted=!0}},{key:"cancel",value:function(){this.isStarted=!1}},{key:"emit",value:function(e,t){this.isLocked||this.eventEmitter.emit(e,t)}},{key:"on",value:function(e,t){var n=this;return this.eventEmitter.on(e,t),function(){n.eventEmitter.off(e,t)}}},{key:"lock",value:function(){this.isLocked=!0}},{key:"unlock",value:function(){this.isLocked=!1}}]),a}(xe.Disposable),Ai=function(e){l(a,e);var n=m(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).target=i,o.hammer=new Hammer.Manager(i),o.hammer.add(new Hammer.Pan(r)),o.addDestroyHook((function(){o.hammer.destroy()})),o}return i(a,[{key:"init",value:function(){var e,t,n=this,i=0,a=0,r=function(r){return function(o){if("start"===r){var s=(t=o.target).getBoundingClientRect();e={left:s.left,top:s.top}}n.eventEmitter.emit(r,{deltaX:o.deltaX-i,deltaY:o.deltaY-a,srcEvent:o.srcEvent}),"end"!==r&&"cancel"!==r||(t=null,i=0,a=0)}};this.hammer.on("panstart",r("start")),this.hammer.on("panmove",r("move")),this.hammer.on("panend",r("end")),this.hammer.on("pancancel",r("cancel"));var o=function(n){if(t){var r=t.getBoundingClientRect();i=r.left-e.left,a=r.top-e.top}};window.addEventListener("scroll",o,!0),this.addDestroyHook((function(){window.removeEventListener("scroll",o,!0)}));var s=function(e){var t=n.target.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;n.eventEmitter.emit("mousemove",{x:i,y:a})};this.target.addEventListener("mousemove",s,!0),this.addDestroyHook((function(){n.target.removeEventListener("mousemove",s,!0)}))}}]),a}(Si);function wi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Ei,bi=4.396,ki=function(){function e(n){t(this,e),this.component=n}return i(e,[{key:"numberToRGBAString",value:function(e){if("string"==typeof e)return e;var t=(0,xe.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"renderLineEnd",value:function(e,t,n,i,a,r){if(0!==i){var o=n.renderingData,s=o.fillColor;"line"===o.annotInfo.type&&(s=o.annotInfo.styleFillColor);var c=n.scale,l=Math.atan2(r.y-a.y,r.x-a.x);switch(e.save(),e.lineJoin="miter",e.beginPath(),i){case pn.Square:this.renderSquareEnding(e,r,l,c,t);break;case pn.Circle:this.renderCircleEnding(e,r,l,c,t);break;case pn.Diamond:this.renderDiamondEnding(e,r,l,c,t);break;case pn.OpenArrow:r=r.move(t/2,a),this.renderOpenArrowEnding(e,r,l,c,t);break;case pn.ClosedArrow:r=r.move(t/2,a),this.renderClosedArrowEnding(e,r,l,c,t);break;case pn.Butt:this.renderButtEnding(e,r,l,c,t);break;case pn.ROpenArrow:this.renderROpenArrowEnding(e,r,l,c,t);break;case pn.RClosedArrow:this.renderRClosedArrowEnding(e,r,l,c,t);break;case pn.Slash:this.renderSlashEnding(e,r,l,c,t)}switch(i){case pn.ClosedArrow:case pn.RClosedArrow:case pn.Diamond:case pn.Square:case pn.Circle:s&&(e.fillStyle=this.numberToRGBAString(s),e.fill())}e.stroke(),e.restore()}}},{key:"renderSquareEnding",value:function(e,t,n,i,a){var r=bi*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderCircleEnding",value:function(e,t,n,i,a){var r=1.75862*i+2*a;e.translate(t.x,t.y),e.rotate(n),e.moveTo(r,0),e.arc(0,0,r,0,2*Math.PI)}},{key:"renderDiamondEnding",value:function(e,t,n,i,a){var r=bi*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n+Math.PI/4),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderOpenArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderClosedArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderButtEnding",value:function(e,t,n,i,a){var r=Math.PI/2,o=bi*i+3.1*a,s=new mn(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}},{key:"renderROpenArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderRClosedArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderArrow",value:function(e,t,n,i,a,r){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=bi*i+3.1*a,c=new mn(t.x+s,t.y),l=c.rotate(Math.PI-n+r,t),u=c.rotate(Math.PI-n-r,t);e.moveTo(l.x,l.y),e.lineTo(t.x,t.y),e.lineTo(u.x,u.y),o&&e.closePath()}},{key:"renderSlashEnding",value:function(e,t,n,i,a){var r=60/180*Math.PI,o=bi*i+3.1*a,s=new mn(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}}]),e}(),Ri=Math.log(2),Ti=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).helper=new ki(e),i}return i(a,[{key:"doRender",value:function(e){var t=this,n=e.renderingData,i=n.page,a=n.annotInfo,r=a.borderInfo||{},o=e.scale,s=e.rotate,c=this.convertPointToPixel(r.width,o);if(0!=c||-1!=a.borderColor||a.fillColor){var l=this.canvas.getContext("2d");if(l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=c,l.globalAlpha=a.opacity,l.lineWidth=c,0===c||!1===a.hasBorderColor?l.strokeStyle="transparent":l.strokeStyle=this.numberToRGBAString(a.color);var u=e.outerRect,d=this.convertToPathPoint(n.startPoint,o,u,i,s),h=this.convertToPathPoint(n.endPoint,o,u,i,s),f=n.leaderLinePoints,p=this.convertToPathPoint(f.start,o,u,i,s),v=this.convertToPathPoint(f.end,o,u,i,s);if(n.leaderLineOffset>0){var g=n.annotInfo.leaderLineLength>0?1:-1,m=this.convertPointToPixel(n.leaderLineOffset,o),y=d.move(m,h).rotate(g*Math.PI/2,d);h=h.move(m,d).rotate(g*-Math.PI/2,h),d=y,y=p.move(m,v).rotate(g*Math.PI/2,p),v=v.move(m,p).rotate(g*-Math.PI/2,v),p=y}var S=n.captionOffset,A=new mn(this.convertPointToPixel(S.x,o),-this.convertPointToPixel(S.y,o)),w=this.convertPointToPixel(n.leaderLineExtend,o);try{if(r.style===an){var E=r.dashes||[],b=r.dashPhase||0;l.setLineDash&&l.setLineDash(E.map((function(e){return t.convertPointToPixel(e,o)}))),l.lineDashOffset=this.convertPointToPixel(b,o)}l.beginPath(),this.renderLine(l,d,h,p,v,w),l.closePath(),l.stroke(),this.helper.renderLineEnd(l,c,e,n.startStyle,v,p),this.helper.renderLineEnd(l,c,e,n.endingStyle,p,v),this.renderLineCaption(l,e,c,p,v,A)}finally{l.restore()}}}}},{key:"convertToPathPoint",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=A(i.getDevicePoint([e.x,e.y],t,a),2),o=r[0],s=r[1];return new mn(o-n.left,s-n.top)}},{key:"renderLine",value:function(e,t,n,i,a,r){if(e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),r>0){var o=i.move(-r,t),s=a.move(-r,n);e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.moveTo(s.x,s.y)}}},{key:"renderLineCaption",value:function(e,t,n,i,a,r){var o=t.renderingData,s=t.scale,c=o.annotInfo,l=c.content;if("string"==typeof l&&!((l=l.trim()).length<1)){if(a.x<i.x){var u=i;i=a,a=u}var d,h,f=Math.atan2(a.y-i.y,a.x-i.x),p=i.distanceTo(a),v=i.move(.5*p,a),g=16*(d=s+1,Math.log(d)/Ri),m=16777215-(16777215&c.borderColor^10855845);e.save(),e.fillStyle=this.numberToRGBAString(m),e.font=g+"px bold Arial",e.textBaseline="middle",e.textAlign="center";var y=e.measureText(l),S=y.actualBoundingBoxAscent+y.actualBoundingBoxDescent,A=v.move(r.y,i).rotate(Math.PI/2,v),w=Math.PI/2;switch(w=r.y>0?-Math.PI/2:Math.PI/2,o.captionPos){case vn:if(0!=r.y&&0!=r.x){h=A.move(r.x,v).rotate(w,A);break}h=A;break;case gn:var E=v.move(.5*(n+S)-r.y,a).rotate(Math.PI/2,v);h=0!=r.x?E.move(r.x,v).rotate(w,A):E}if(o.hasCaption&&(e.translate(h.x,h.y),e.rotate(f),e.fillText(l,0,0),e.restore()),e.beginPath(),!(Math.abs(r.x)<p/2+y.width/2&&Math.abs(r.y)<S)){var b=r.x>0?-1:1,k=r.x+b*y.width/2;if(Math.abs(r.x)<=y.width/2){k=0;var R=S/2+4,T=r.y>0?1:-1,x=0;Math.abs(r.y)>S&&(x=r.y-T*R),A=v.move(x,i).rotate(Math.PI/2,v)}var C=A.move(k,v).rotate(w,A),P=C.move(Math.abs(k)+n/2,A);e.moveTo(v.x,v.y),e.lineTo(A.x,A.y),e.moveTo(P.x,P.y),e.lineTo(C.x,C.y),e.moveTo(C.x,C.y),e.closePath(),e.stroke()}}}},{key:"setMarkUp",value:function(e,t){var n=ni(this.component,e,t),i=n.renderingData,a=n.outerRect;e=n.scale,t=n.rotate;var r=i.page,o=i.annotInfo,s=o.borderInfo||{},c=this.convertPointToPixel(s.width,e),l=this.canvas.getContext("2d");l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),l.lineWidth=c,l.strokeStyle=this.numberToRGBAString(o.color);var u=this.convertToPathPoint(i.startPoint,e,a,r,t),d=this.convertToPathPoint(i.endPoint,e,a,r,t),h=i.leaderLinePoints,f=this.convertToPathPoint(h.start,e,a,r,t),p=this.convertToPathPoint(h.end,e,a,r,t);if(i.leaderLineOffset>0){var v=i.annotInfo.leaderLineLength>0?1:-1,g=this.convertPointToPixel(i.leaderLineOffset,e),m=u.move(g,d).rotate(v*Math.PI/2,u);d=d.move(g,u).rotate(v*-Math.PI/2,d),u=m,m=f.move(g,p).rotate(v*Math.PI/2,f),p=p.move(g,f).rotate(v*-Math.PI/2,p),f=m}var y=this.convertPointToPixel(i.leaderLineExtend,e);l.beginPath(),this.renderLine(l,u,d,f,p,y),l.closePath(),ii(l,u),ii(l,d)}}]),a}(tn),xi=pn,Ci=function(e){l(o,e);var n=m(o);function o(e){var i;t(this,o);var a=(i=n.call(this,e)).annotationInfo;switch(i.annotationInfo.endStyle&&(a.endingStyle=i.annotationInfo.endStyle),a.intent){case cn:a.endingStyle===xi.None&&(a.endingStyle=xi.OpenArrow);break;case ln:a.startStyle===xi.None&&(a.startStyle=xi.OpenArrow),a.endingStyle===xi.None&&(a.endingStyle=xi.OpenArrow)}return a.hasCaption=a.enableCaption,a.leaderLinePoints.start=a.startPoint,i}return i(o,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var i=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,i),this.eContainer.style.cssText+="\n            width: ".concat(t,"px;\n            height: ").concat(n,"px;\n        ")}},{key:"generateApRenderer",value:function(){return new Ti(this)}},{key:"getType",value:function(){return"line"}},{key:"getStartPoint",value:function(){return this.annotationInfo.startPoint}},{key:"getEndPoint",value:function(){return this.annotationInfo.endPoint}},{key:"setEndPoint",value:function(e){var t=A(this.page.reverseDevicePoint([e.x,e.y],this.scale,this.rotate),2),n=t[0],i=t[1];this.annotationInfo.endPoint={x:n,y:i},this.annotationInfo.leaderLinePoints.end=this.annotationInfo.endPoint;var a=this.annotationInfo.startPoint,r=a.x,o=a.y,s=A(this.page.getDevicePoint([r,o],this.scale,this.rotate),2),c=s[0],l=s[1];this.setRect({left:c,top:l,right:e.x,bottom:e.y}),this.annotationInfo.intent==ln&&this.calculateLeaderLinePoints()}},{key:"calculateLeaderLinePoints",value:function(){var e=this.getStartPoint(),t=this.getEndPoint(),n=t.y-e.y,i=t.x-e.x,a=-1/(n/i),r=Math.atan(a),o=1,s=(this.page.getRotationAngle()+this.rotate)%360;if(t.x<e.x&&t.y<e.y||t.x>e.x&&t.y>e.y)switch(s){case 180:case 270:o=-1;break;default:o=1}else switch(s){case 90:case 180:o=1;break;default:o=-1}var c=this.annotationInfo.leaderLineLength,l=o*Math.cos(r)*c,u=o*Math.sin(r)*c,d={x:e.x+l,y:e.y+u},h=t,f=this.pdfRect;f.left<d.x&&d.x<f.right&&f.bottom<d.y&&d.y<f.top?h={x:t.x+l,y:t.y+u}:(d={x:e.x-l,y:e.y-u},h={x:t.x-l,y:t.y-u}),this.annotationInfo.leaderLinePoints.start=d,this.annotationInfo.leaderLinePoints.end=h}},{key:"getRenderingData",value:function(){return Yn({},r(a(o.prototype),"getRenderingData",this).call(this),this.annotationInfo)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.leaderLinePoints.start,i=this.annotationInfo.startPoint,a=this.annotationInfo.leaderLineExtend,r=this.annotationInfo.borderInfo.width,o=Yt.convertTo(r,Jt)*this.scale,s=Math.max(Math.abs(n.x-i.x),Math.abs(n.y-i.y))+a,c=Yt.convertTo(s,Jt)*this.scale;return _n.on(this.getDeviceRect(e,t)).expand(c+o).extract()}},{key:"getDefaultAnnotInfo",value:function(){var e={x:0,y:0},t={x:0,y:0};return wi(Yn({},r(a(o.prototype),"getDefaultAnnotInfo",this).call(this)),{startPoint:e,endPoint:t,leaderLineLength:15,leaderLineExtend:5,captionOffset:{x:0,y:0},enableCaption:!1,leaderLinePoints:{start:e,end:t},leaderLineOffset:0,captionPos:vn,content:"",startStyle:Qe,endingStyle:Qe})}},{key:"apply",value:function(){var e=this;return r(a(o.prototype),"apply",this).call(this).then((function(t){return"LineDimension"===e.annotationInfo.intent?e.page.getMeasureScaleRatio().then((function(n){if(n&&n.scale){var i=e.pdfViewer.getStore().getCurrentValue("measurementData"),a=Qn(e.pdfViewer),r=en(i.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(i.displayUnit.name)):i.displayUnit.name;return t[0].setContent(a+parseFloat(i.distance).toFixed(2)+" "+r).then((function(e){return t}))}return t})):t}))}}]),o}(jn);!function(e){e.EndPoint="end-point",e.MidPoint="mid-point",e.IntersectionPoint="intersection-point",e.NearestPoint="nearest-point"}(Ei||(Ei={}));var Pi=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.arc(n/2,n/2,2*Math.PI,0,360),e.stroke()}}]),e}(),_i=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(n/2,0),e.lineTo(0,n),e.lineTo(n,n),e.closePath(),e.stroke()}}]),e}(),Ii=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.rect(0,0,n,n),e.stroke()}}]),e}(),Di=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(0,0),e.lineTo(n,n),e.moveTo(0,n),e.lineTo(n,0),e.stroke()}}]),e}(),Mi=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),Ke(v(i=n.call(this)),"container",void 0),Ke(v(i),"canvas",void 0),Ke(v(i),"size",void 0),Ke(v(i),"renderer",void 0),i.container=e,i.size=16,i.renderer=new Pi,i.canvas=document.createElement("canvas"),i.canvas.classList.add("fv__viewer-snapped-point"),i.addDestroyHook((function(){i.canvas.parentElement===i.container&&i.container.removeChild(i.canvas)})),i.canvas.width=i.size,i.canvas.height=i.size,i}return i(a,[{key:"setRenderer",value:function(e){this.renderer=new e,this.redraw()}},{key:"setSize",value:function(e){this.size=e,this.canvas.width=e,this.canvas.height=e,this.redraw()}},{key:"setPosition",value:function(e,t){(0,xe.cssText)(this.canvas,{left:e+"px",top:t+"px",margin:"".concat(.5*-this.size,"px ").concat(.5*-this.size,"px")})}},{key:"show",value:function(e){switch(this.container.appendChild(this.canvas),e){case Ei.MidPoint:this.setRenderer(_i);break;case Ei.IntersectionPoint:this.setRenderer(Di);break;case Ei.NearestPoint:this.setRenderer(Ii);break;default:this.setRenderer(Pi)}}},{key:"hide",value:function(){this.canvas.parentElement===this.container&&this.container.removeChild(this.canvas)}},{key:"redraw",value:function(){if(this.renderer){var e=this.canvas.getContext("2d");e&&this.renderer.render(e)}}}]),a}(xe.Disposable),Ni=w.stateHandler,Li=w.ViewerEvents,Vi=Ni.IStateHandler,Oi=w.shared,Hi=(Oi.DebouncePromiseQueue,Oi.keyboardStatus),Fi=Oi.ThrottleAsyncTaskExecutor,Ui=(w.Consts.LineEndingStyle,Ni.StateHandlerConsts.STATE_HANDLER_CREATE_LINE),ji=Ni.StateHandlerUtils.getDevicePagePoint,Bi=w.commons.isSamePoint,Xi=w.keyboard,Yi=Xi.BuiltinCommand,Gi=Xi.BuiltinShortcutContext,Wi=function(e){l(a,e);var n=m(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).startStyle=i,o.endStyle=r,o.cursorStyle="fv__cursor-crosshair",o.executor=new Fi(20),o}return i(a,[{key:"createInteractionTool",value:function(e,t){return new Ai(this.pdfViewer,e,t)}},{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=i.get(0);this.snappedPointAssistant=new Mi(a);var r,o=this.interaction=this.createInteractionTool(a,{direction:Hammer.DIRECTION_ALL});o.init();var s,c=function(){return o.on("mousemove",(function(e){n.executor.exec((function(){return n.getSnappedPoint(e).then((function(t){Bi(e,t)?(n.snappedPointAssistant.hide(),r=null):(n.snappedPointAssistant.show(t.type),n.snappedPointAssistant.setPosition(t.x,t.y),r=t)}))}))}))};this.offMouseMoveEvent=c();var l,u=!1,d=this.pdfViewer.getKeyboard(),h=function(){};d.withContext(Gi.CREATING_ANNOTATION,(function(e){n.offCancelEvent=e.keyup(Yi.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){h(),n.cancel(),n.interaction.cancel(),u=!0}),{interceptors:[function(e,t){u||t(e)}]})}));var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs;f.startSDKSpan,f.otelService;o.on("start",(function(e){var t;n.offMouseMoveEvent(),h=d.activeContext(Gi.CREATING_ANNOTATION),u=!1;var i=[0,0],o=ji(a,e);r?(t=[r.x,r.y],i=[o.x-r.x,o.y-r.y]):t=[o.x,o.y],s=n.pageRender.page.reverseDevicePoint(t,n.pageRender.scale,n.pageRender.getRotation()),l=n.pageRender.page.reverseDevicePoint(i,n.pageRender.scale,n.pageRender.getRotation()),n.start(s[0],s[1])})),o.on("move",(function(e){if(!u){var t=A(function(e,t){if(Hi.isShift){var n=Math.sqrt(e*e+t*t),i=Math.atan2(t,e),a=.25*Math.PI,r=Math.round(i/a)*a;e=n*Math.cos(r),t=n*Math.sin(r)}return[e,t]}(e.deltaX,e.deltaY),2),i=t[0],a=t[1],r=n.pageRender.page.getDevicePoint(s,n.pageRender.scale,n.pageRender.getRotation()),o=n.pageRender.page.getDevicePoint(l,n.pageRender.scale,n.pageRender.getRotation()),c=n.correctPosition({x:r[0]+i+o[0],y:r[1]+a+o[1]});n.adjust(n.fakeAnnotation,{x:c[0],y:c[1]}),n.pageRender.page.reverseDevicePoint(c,n.pageRender.scale,n.pageRender.getRotation());var d=n.fakeAnnotation.pdfRect,h=n.fakeAnnotation.annotationInfo,f=h.startPoint,p=h.endPoint;n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:n.type,page:n.pageRender.page.getIndex(),rect:d,points:[f,p]})}})),o.on("end",(function(e){if(!u)return h(),n.offMouseMoveEvent=c(),n.end()})),o.on("cancel",(function(e){u||(n.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:n.pageRender.index}),h(),n.cancel(),n.offMouseMoveEvent=c())})),this.__removeZoomToSuccessEventListener=this.pdfViewer.addEventListener(Li.zoomToSuccess,(function(){if(!u&&n.fakeAnnotation){var e=n.pageRender.scale;n.fakeAnnotation.zoomTo(e),n.fakeAnnotation.draw()}}))}},{key:"correctCoord",value:function(e,t){var n=this.pageRender.getScale(),i=e.getPxWidth()*n,a=e.getPxHeight()*n;return[Math.max(0,Math.min(i,t[0])),Math.max(0,Math.min(a,t[1]))]}},{key:"start",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Line",a=!0,r="";if(n=this.pdfViewer.customs.getMeasuringConfig){var o=n();o.hasOwnProperty("defaultLeader")&&(a=o.defaultLeader),"custom"==o.labelType&&(r=o.label)}var s=this.pdfViewer.getIoC().getInstanceByClass(Jn).getMeasurementInfo();return s.showCustomLabel&&(r=s.caption),this.fakeAnnotation=new Ci({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({flags:4,label:r,startPoint:{x:e,y:t},endPoint:{x:e+1,y:t+1},startStyle:this.startStyle,endingStyle:this.endStyle,leaderLineLength:a?15:0,leaderLineExtend:a?5:0,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects."+i)})})}},{key:"createAnnotJson",value:function(e){return Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line")),e}},{key:"getSnappedPoint",value:function(e){var t=this;return this.pageRender.getPDFPage().then((function(n){if(!n)return e;var i=t.pdfViewer.getSnapMode(t.constructor.getStateName());if(i&&i.length>0){var a=A(n.reverseDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2),r=a[0],o=a[1];return n.getSnappedPoint({x:r,y:o},i).then((function(e){var i=A(n.getDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2);return{x:i[0],y:i[1],type:e.type}}))}return e}))}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec((function(){return n.getSnappedPoint(t).then((function(i){Bi(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),e.setEndPoint(i),e.draw()}))}))}},{key:"end",value:function(){var e=this;if(this.fakeAnnotation)return this.executor.waitForLastTask().then((function(){e.snappedPointAssistant.hide();var t=e.fakeAnnotation.apply().then((function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}));return e.fakeAnnotation=null,t}))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index}),this.snappedPointAssistant.hide(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(Li.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"destroyPageHandler",value:function(){this.offMouseMoveEvent(),this.snappedPointAssistant.destroy(),this.executor.cancel(),this.interaction&&this.interaction.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.__removeZoomToSuccessEventListener&&this.__removeZoomToSuccessEventListener()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return[Math.max(0,Math.min(t,e.x)),Math.max(0,Math.min(n,e.y))]}}],[{key:"getStateName",value:function(){return Ui}}]),a}(Vi),$i=w.stateHandler,zi=(w.ViewerEvents,$i.StateHandlerConsts.STATE_HANDLER_CREATE_ARROW),qi=w.Consts.LineEndingStyle,Ki=function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e,qi.None,qi.OpenArrow)}return i(a,[{key:"createAnnotJson",value:function(e){return e.intent="LineArrow",e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Arrow"),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineArrow")),e}}],[{key:"getStateName",value:function(){return zi}}]),a}(Wi);function Zi(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}}function Ji(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}const Qi="idle",ea="construct",ta="creating";var na,ia;!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.MOVE=2]="MOVE"}(na||(na={}));var aa,ra,oa,sa,ca=(Ke(ia={},0,["MSPointerDown"]),Ke(ia,2,["MSPointerMove"]),Ke(ia,1,["MSPointerUp"]),ia),la=(Ke(aa={},0,["pointerdown"]),Ke(aa,2,["pointermove"]),Ke(aa,1,["pointerup"]),aa),ua=(Ke(ra={},0,["pointerdown","mousedown"]),Ke(ra,2,["pointermove","mousemove"]),Ke(ra,1,["pointerup","mouseup"]),ra),da=(Ke(oa={},0,["pointerdown","touchstart"]),Ke(oa,2,["pointermove","touchmove"]),Ke(oa,1,["pointerup","touchend"]),oa),ha=(Ke(sa={},0,["mousedown","touchstart"]),Ke(sa,2,["mousemove","touchmove"]),Ke(sa,1,["mouseup","touchend"]),sa),fa={};function pa(t,n,i,a){var r,o=0,s=fa[n].map((function(n){var c,l=function(n){r!==n.type&&Date.now()-o<160?c():(r=n.type,a&&a.once&&c(),i.call(t,function(t){var n={native:t,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,target:t.target,preventDefault:function(){return t.preventDefault()},stopPropagation:function(){return t.stopPropagation()}};if(window.TouchEvent&&e(t,window.TouchEvent)){var i="touchend"===t.type||"touchcancel"===t.type?t.changedTouches[0]:t.touches[0];n.clientX=i.clientX,n.clientY=i.clientY,n.pageX=i.pageX,n.pageY=i.pageY,n.screenX=i.screenX,n.screenY=i.screenY,n.x=i.clientX,n.y=i.clientY,n.bubbles=t.bubbles,n.relatedTarget=i.target}else(e(t,MouseEvent)||e(t,PointerEvent))&&(n.clientX=t.clientX,n.clientY=t.clientY,n.pageX=t.pageX,n.pageY=t.pageY,n.screenX=t.screenX,n.screenY=t.screenY,n.x=t.x||t.clientX,n.y=t.y||t.clientY,n.relatedTarget=t.relatedTarget,n.button=t.button,n.buttons=t.buttons,n.bubbles=t.bubbles);return n}(n)),o=Date.now())};return c=function(){var e=s.indexOf(c);-1!==e&&(t.removeEventListener(n,l,a),s.splice(e,1))},t.addEventListener(n,l,a),c}));return function(){s.forEach((function(e){return e()}))}}function va(e){if(xe.isIE){if(!xe.isIEAtLeast11)return ca[e]}else{if(xe.isSafari)return ua[e];if(xe.isAndroid)return xe.isTouchDevice?da[e]:ha[e]}return la[e]}xe.Lazy.property(fa,0,(function(){return va(0)})),xe.Lazy.property(fa,2,(function(){return va(2)})),xe.Lazy.property(fa,1,(function(){return va(1)}));var ga=function(e){l(a,e);var n=m(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).actionName=r,o.targetElement=i,o.pdfViewerElement=e.$ui[0],o.status=Qi,o.lastMoveData={},o}return i(a,[{key:"startCreating",value:function(){this.status=ta}},{key:"cancel",value:function(){this.status=Qi}},{key:"_addEventListener",value:function(e,t,n,i){return e.addEventListener(t,n,i),function(){e.removeEventListener(t,n,i)}}},{key:"init",value:function(){var e=this,t=new Hammer.Manager(this.targetElement);t.add(new Hammer.Tap({event:"doubletap",taps:2,posThreshold:100,time:296}),new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var n=!0,i=null,a=zn,r=pa(this.pdfViewerElement,na.DOWN,(function(t){if(e.status!==Qi){var i=e.targetElement.getBoundingClientRect(),r=i.left,o=i.right,s=i.top,c=i.bottom,l=Math.max(Math.min(o,t.clientX),r),u=Math.max(Math.min(c,t.clientY),s);if(e.status===ta){a(),n=!1;var d=setTimeout((function(){e.emit("add-point",{clientX:l,clientY:u,srcEvent:t.native}),n=!0}),300);a=function(){clearTimeout(d)}}}})),o=pa(this.pdfViewerElement,na.MOVE,(function(t){if(e.status!==Qi&&(xe.isTouchDevice&&i&&(Math.abs(t.clientX-i.x)>25||Math.abs(t.clientY-i.y)>25)&&a(),!e.isLocked&&n)){var r=e.targetElement.getBoundingClientRect(),o=r.left,s=r.right,c=r.top,l=r.bottom,u=Math.max(Math.min(s,t.clientX),o),d=Math.max(Math.min(l,t.clientY),c);e.emit("move",e.lastMoveData={clientX:u,clientY:d,srcEvent:t.native})}})),s=pa(this.targetElement,na.DOWN,(function(t){if(0===t.button){var r=t.clientX,o=t.clientY;if(i={x:t.clientX,y:t.clientY},e.status===Qi){a();var s=setTimeout((function(){e.status=ea,e.emit("start",{clientX:r,clientY:o,srcEvent:t.native})}),300);a=function(){clearTimeout(s)}}else if(e.status===ta){a(),n=!1;var c=setTimeout((function(){e.emit("add-point",{clientX:r,clientY:o,srcEvent:t.native}),n=!0}),300);a=function(){clearTimeout(c)}}t.stopPropagation()}})),c=zn;xe.isTouchDevice&&(c=this._addEventListener(this.targetElement,"touchstart",(function(e){e.touches.length>1&&a(),xe.isIOSChrome&&e.preventDefault()})));var l=pa(this.targetElement,na.MOVE,(function(t){if(xe.isTouchDevice&&i&&(Math.abs(t.clientX-i.x)>25||Math.abs(t.clientY-i.y)>25)&&a(),!e.isLocked&&n){if(e.status===Qi){var r=e.targetElement.getBoundingClientRect(),o=t.clientX-r.left,s=t.clientY-r.top;e.emit("mousemove",{x:o,y:s})}if(e.status===ta&&!xe.isTouchDevice){var c=t.clientX,l=t.clientY;e.emit("move",e.lastMoveData={clientX:c,clientY:l,srcEvent:t.native}),t.stopPropagation()}}}));t.on("doubletap",(function(t){n=!0;var i=t.srcEvent;a(),e.lastMoveData={clientX:Zi(i),clientY:Ji(i),srcEvent:t},u()}));var u=function(){e.status===ta&&(e.status=Qi,e.unlock(),e.emit("end",e.lastMoveData),e.lastMoveData=null)},d=this.pdfViewer.getStore().subscribe(this.actionName,(function(t){switch(t){case"complete":u();break;case"cancel":e.status===ta&&(e.status=Qi,e.unlock(),e.emit("cancel"));break;case"continue":e.startCreating()}}));this.addDestroyHook((function(){c(),t.destroy(),d(),s(),l(),r(),o()}))}}]),a}(Si),ma=function(){function e(){t(this,e),Ke(this,"isCreating",!1),Ke(this,"handlingPage",-1)}return i(e,[{key:"setCreating",value:function(e){this.isCreating=!0,this.handlingPage=e}},{key:"creatingEnd",value:function(){this.isCreating=!1,this.handlingPage=-1}}]),e}(),ya=w.stateHandler,Sa=w.Log,Aa=w.ViewerEvents,wa=ya.IStateHandler,Ea=Sa.LoggerFactory,ba=w.shared,ka=ba.DebouncePromiseQueue,Ra=(ba.getClientX,ba.getClientY,ba.keyboardStatus),Ta=ba.ThrottleAsyncTaskExecutor,xa=w.DeviceInfo.isTouchDevice,Ca=w.commons.isSamePoint,Pa=w.keyboard,_a=Pa.BuiltinCommand,Ia=Pa.BuiltinShortcutContext,Da=(Ea.getLogger("creation/complexshape/state"),function(e){l(a,e);var n=m(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).type=i,r.cursorStyle="fv__cursor-crosshair",r.executor=new Ta(20,!0),r}return i(a,[{key:"createInteractionTool",value:function(e){return new ga(this.pdfViewer,e,"create-complex-shape")}},{key:"syncAddingAnnot",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)e={cancle:t,page:this.pageRender.index};else{var n=this.fakeAnnotation||{},i=n.pdfRect,a=n.vertexes,r=n.lastPoint;e={type:this.type,page:this.pageRender.page.getIndex(),rect:i,points:f(a).concat([r]),closePath:"polygon"==this.type}}this.pdfViewer.eventEmitter.emit("collab-creating-op",e)}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e,this.destroyPageHooks=[];var n=e.$handler;n.addClass(this.cursorStyle);var i=n.get(0);this.snappedPointAssistant=new Mi(i),this.interaction=this.createInteractionTool(i),this.interaction.init();var a=new ka,r=this.pdfViewer.getKeyboard(),o=this.pdfViewer.getIoC().getInstanceByClass(ma),s=function(){},c=function(){s=r.activeContext(Ia.CREATING_ANNOTATION)};function l(e,t,n){if(Ra.isShift){var i=e.getDeviceVertexes();if(i.length>=1){var a=i[i.length-1],r=t-a.x,o=n-a.y,s=Math.sqrt(r*r+o*o),c=Math.atan2(o,r),l=.25*Math.PI,u=Math.round(c/l)*l;return r=s*Math.cos(u),o=s*Math.sin(u),{deviceX:a.x+r,deviceY:a.y+o}}}return{deviceX:t,deviceY:n}}r.withContext(Ia.CREATING_ANNOTATION,(function(e){e.keyup(_a.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){s(),t.interaction.unlock(),t.interaction.cancel(),t.cancel()}))})),this.pdfViewer.getStore().subscribe("forbidMeasureRatio",(function(e){t.isUsePageMeasure=e})),"polygon"==this.type||"polyline"==this.type||this.pdfViewer.eventEmitter.addListener(Aa.toolbarTabsClicked,(function(){t.out()})),this.interaction.on("start",(function(e){var n=e.clientX,a=e.clientY;if(o.isCreating)t.interaction.cancel();else{o.setCreating(t.pageRender.index),t.pageRender.annotsRender.unActiveAnnot();var r=i.getBoundingClientRect(),l=n-r.left,u=a-r.top;s(),c();var d=[ln,hn,un,dn];t.getSnappedPoint(l,u).then((function(e){t.fakeAnnotation=t.create(e.deviceX,e.deviceY),t.interaction.startCreating(),t.unsubscribeMeasurementData=t.pdfViewer.getStore().subscribe("measurementData",(function(e){if(t.fakeAnnotation){var n=t.fakeAnnotation.intent;if(n&&d.includes(n)){var i=Qn(t.pdfViewer),a=e.displayUnit,r=e.area,o=e.embeddedScale,s=a&&en(a.name)?t.pdfViewer.i18n.t("measurement.units.".concat(a.name)):a.name;r&&t.fakeAnnotation.setContent(i+r.toFixed(2)+" sq "+s),o&&(t.pageMeasureRatio=o)}t.fakeAnnotation.draw&&t.fakeAnnotation.draw()}})),t.pdfViewer.eventEmitter.emit(Aa.distanceAnnotCreationStart,t.fakeAnnotation)}))}})),this.interaction.on("add-point",(function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top,c=l(t.fakeAnnotation,o,s);t.getSnappedPoint(c.deviceX,c.deviceY).then((function(e){t.addPoint(t.fakeAnnotation,e)}))})),this.interaction.on("move",(function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top;t.executor.exec((function(){var e=l(t.fakeAnnotation,o,s);return t.getSnappedPoint(e.deviceX,e.deviceY).then((function(n){Ca({x:e.deviceX,y:e.deviceY},{x:n.deviceX,y:n.deviceY})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.show(n.type),t.snappedPointAssistant.setPosition(n.deviceX,n.deviceY)),t.adjust(t.fakeAnnotation,n),t.syncAddingAnnot()}))}))})),this.interaction.on("mousemove",(function(e){t.mousemove(e)})),this.interaction.on("end",(function(e){if(t.canBeCompleted(t.fakeAnnotation)){o.creatingEnd(),s();var n=i.getBoundingClientRect(),a=l(t.fakeAnnotation,e.clientX-n.left,e.clientY-n.top);t.executor.waitForLastTask().finally((function(){t.getSnappedPoint(a.deviceX,a.deviceY).then((function(e){-1==t.end(t.fakeAnnotation,e)&&(c(),t.interaction.startCreating())})),t.pdfViewer.eventEmitter.emit(Aa.distanceAnnotCreationEnd,t.fakeAnnotation)}))}else t.interaction.startCreating()})),this.interaction.on("cancel",(function(){o.creatingEnd(),s(),t.cancel(),t.syncAddingAnnot(!0)}));var u=function(e){t.fakeAnnotation&&(t.fakeAnnotation.zoomTo(e),t.fakeAnnotation.draw())};this.destroyPageHooks.push((function(){return a.end()}),this.pdfViewer.addEventListener(Aa.zoomToSuccess,(function(){u(t.pageRender.scale)})),this.pdfViewer.addEventListener(Aa.changeViewModeSuccess,(function(e,n){u(t.pageRender.scale)})),this.pdfViewer.addEventListener(Aa.fitWidthResizeViewport,(function(){u(t.pageRender.scale)})))}},{key:"getSnappedPoint",value:function(e,t){var n=this;return this.pageRender.getPDFPage().then((function(i){var a=n.pdfViewer.getSnapMode(n.constructor.getStateName());if(a&&a.length>0){var r=A(i.reverseDevicePoint([e,t],n.pageRender.scale,n.pageRender.rotate),2),o=r[0],s=r[1];return i.getSnappedPoint({x:o,y:s},a).then((function(e){var t=A(i.getDevicePoint([e.x,e.y],n.pageRender.scale,n.pageRender.rotate),2);return{deviceX:t[0],deviceY:t[1],type:e.type}}))}return{deviceX:e,deviceY:t}}))}},{key:"create",value:function(e,t){throw new Error("not implemented!")}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.addPoint(n,i),e.draw()}},{key:"mousemove",value:function(e){var t=this;this.executor.exec((function(){return t.getSnappedPoint(e.x,e.y).then((function(n){var i=n.deviceX,a=n.deviceY,r=n.type;Ca(e,{x:i,y:a})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.setPosition(i,a),t.snappedPointAssistant.show(r))}))}))}},{key:"adjust",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.setLastPoint(n,i),e.draw()}},{key:"end",value:function(e,t){var n=this;if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.creatingState=0,t&&!xa&&(e.addPoint(t.deviceX,t.deviceY),e.draw()),this.isUsePageMeasure&&this.pageMeasureRatio){var i=this.pageMeasureRatio.split(" = ").map((function(e){var t=e.split(" ");return{value:t[0],unit:t[1]}}));i.length<2||(e.annotationInfo.measure=Object.assign({},e.annotationInfo.measure,{ratio:{userSpaceValue:Number(i[0].value),realValue:Number(i[1].value),userSpaceUnit:i[0].unit,realUnit:i[1].unit}}))}e.apply().then((function(e){if(n.pdfViewer.config.showCommentList){var t=e[e.length-2];n.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}})),this.fakeAnnotation=null}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(ma).creatingEnd(),this.syncAddingAnnot(!0),this.executor.cancel(),this.interaction.cancel(),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"canBeCompleted",value:function(){return!0}},{key:"createAnnotJson",value:function(e,t){return e}},{key:"docHandler",value:function(e){xa?e.enableDragToScroll():e.disableDragToScroll()}},{key:"destroyPageHandler",value:function(){(this.snappedPointAssistant.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach((function(e){return e()})),this.pageRender.$handler.removeClass(this.cursorStyle),this.fakeAnnotation)&&(this.interaction.status!==Qi&&this.pdfViewer.eventEmitter.emit(Aa.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null,this.pdfViewer.getIoC().getInstanceByClass(ma).creatingEnd());this.interaction.destroy(),this.offCancelEvent&&this.offCancelEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),a}(wa));function Ma(e){return y(e)||d(e)||h(e)||S()}var Na=function(e){l(a,e);var n=m(a);function a(e){var i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t(this,a),(i=n.call(this)).closing=r,e.length>1&&e.reduce((function(e,t,n){return i.addSegment(new La(e,t,1===n)),t})),i}return i(a,[{key:"render",value:function(e){e.beginPath(),this.segments.forEach((function(t){t.render(e)})),this.closing&&e.closePath()}}]),a}(yn),La=function(e){l(a,e);var n=m(a);function a(e,i){var r,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t(this,a),(r=n.call(this,e,i)).atTheStart=o,r}return i(a,[{key:"render",value:function(e){this.atTheStart&&e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y)}}]),a}(Sn);function Va(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;e.fillStyle="#fff",t.forEach((function(t){e.beginPath(),e.arc(t.x,t.y,n,0,360),e.stroke(),e.fill()}))}var Oa,Ha,Fa=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).helper=new ki(e),i}return i(o,[{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polyline")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.canvas.getContext("2d"),s=this.convertPointToPixel(0==i.width?.5:i.width,a);if((0!=s||-1!=n.borderColor||n.fillColor)&&(o.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent())){var c=t.page,l=e.innerRect,u=t.vertexes.map((function(e){var t=A(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new mn(n-l.left,i-l.top)}));e.vertexes=u,o.save(),e.lineWidth=s,o.globalAlpha=n.opacity,o.lineWidth=s,0===s||!1===n.hasBorderColor?o.strokeStyle="transparent":o.strokeStyle=this.numberToRGBAString(n.color);try{switch(i.style){case an:case nn:this.renderSolid(o,n,e)}var d=u[u.length-1],h=u[u.length-2],f=u[0],p=u[1];this.helper.renderLineEnd(o,s,e,t.startStyle,p,f),this.helper.renderLineEnd(o,s,e,t.endingStyle,h,d),this.setContents(o,n.contents,u)}finally{o.restore()}}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0;r.style===an&&(e.setLineDash&&e.setLineDash(o.map((function(e){return i.convertPointToPixel(e,a)}))),e.lineDashOffset=this.convertPointToPixel(s,a)),new Na(n.vertexes,!1,5).render(e),e.stroke();try{if(!xe.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&Va(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=ni(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=this.canvas.getContext("2d"),s=i.page;o.strokeStyle=this.numberToRGBAString(r.color),i.vertexes.map((function(n){var i=A(s.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new mn(r-a.left,o-a.top)})).forEach((function(e){return ii(o,e)})),o.restore()}},{key:"setContents",value:function(e,t,n){var i,a;if(void 0!==t&&n&&!(n.length<3)){var r=n[n.length-1],o=e;o.beginPath(),o.font="14px Verdana",o.textAlign="left",o.textBaseline="top",o.direction="ltr";var s=o.measureText(t).width;o.fillStyle="#AF6B6B";var c=n.map((function(e){return e.x})),l=(i=Math).min.apply(i,f(c));(a=Math).max.apply(a,f(c));Math.abs(r.x-l)>=s&&r.x>l?o.fillText(t,r.x-s,r.y,s):o.fillText(t,r.x,r.y,s),o.closePath()}}}]),o}(tn),Ua=function(e){l(o,e);var n=m(o);function o(e){var i,a;(t(this,o),Ke(v(i=n.call(this,e)),"vertexes",[]),Ke(v(i),"deviceVertexes",[]),Ke(v(i),"lastPoint",{x:0,y:0}),i.annotationInfo.vertexes)&&(a=i.vertexes).push.apply(a,f(i.annotationInfo.vertexes));return i.annotationInfo.vertexes=i.vertexes,i}return i(o,[{key:"getVertexes",value:function(){return this.vertexes}},{key:"getDeviceVertexes",value:function(){return this.deviceVertexes}},{key:"addPoint",value:function(e,t){var n=A(this.page.reverseDevicePoint([e,t],this.scale,this.rotate),2),i=n[0],a=n[1];this.vertexes.push({x:i,y:a}),this.lastPoint={x:i,y:a},this.deviceVertexes.push({x:e,y:t}),this.updateRect()}},{key:"setLastPoint",value:function(e,t){var n=this.deviceVertexes[this.deviceVertexes.length-1],i="number"==typeof e?e:n.x,a="number"==typeof t?t:n.y,r=A(this.page.reverseDevicePoint([i,a],this.scale,this.rotate),2),o=r[0],s=r[1];this.lastPoint={x:o,y:s},this.updateRect()}},{key:"getLastPoint",value:function(){return this.lastPoint}},{key:"zoomTo",value:function(e){var t=this;this.scale!==e&&(r(a(o.prototype),"zoomTo",this).call(this,e),this.deviceVertexes=this.vertexes.map((function(n){var i=A(t.page.getDevicePoint([n.x,n.y],e,t.rotate),2);return{x:i[0],y:i[1]}})),this.updateRect())}},{key:"removeLastPoint",value:function(){}},{key:"getRenderingData",value:function(e,t){var n=r(a(o.prototype),"getRenderingData",this).call(this,e,t),i=Ma(this.vertexes).slice(0);return i.push(this.lastPoint),wi(Yn({},n),{vertexes:i})}},{key:"generateApRenderer",value:function(){return new Fa(this)}},{key:"getType",value:function(){return"polyline"}},{key:"getOuterDeviceRect",value:function(e,t){return r(a(o.prototype),"getDeviceRect",this).call(this,e,t)}},{key:"updateRect",value:function(){if(0!==this.deviceVertexes.length){var e=A(this.page.getDevicePoint([this.lastPoint.x,this.lastPoint.y],this.scale,this.rotate),2),t={x:e[0],y:e[1]},n=t.x,i=t.y,a=t.x,r=t.y;this.deviceVertexes.forEach((function(e){n=Math.min(n,e.x),a=Math.max(a,e.x),i=Math.min(i,e.y),r=Math.max(r,e.y)}));var o=Fn(this.annotationInfo.borderInfo.width)*this.scale*2+20;n-=o/2,i-=o/2,a+=o/2,r+=o/2,this.setRect({left:n,top:i,right:a,bottom:r})}}},{key:"apply",value:function(){var e=this;return r(a(o.prototype),"apply",this).call(this).then((function(t){var n=e.annotationInfo.intent;return"PolygonDimension"===n||"PolyLineDimension"===n?e.page.getMeasureScaleRatio().then((function(i){if(i&&i.scale){var a=e.pdfViewer.getStore().getCurrentValue("measurementData"),r=Qn(e.pdfViewer),o=en(a.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(a.displayUnit.name)):a.displayUnit.name;return t[0].setContent(r+parseFloat("PolyLineDimension"===n?a.perimeter:a.area).toFixed(2)+" "+o).then((function(e){return t}))}return t})):t}))}}]),o}(jn),ja=function(e){l(o,e);var n=m(o);function o(e){var i,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t(this,o),(i=n.call(this,e)).closing=a,i.showText=!0,i}return i(o,[{key:"setFlag",value:function(e,t){this.closing=e,this.showText=t}},{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polygon")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.convertPointToPixel(0==i.width?.5:i.width,a);if(0!=o||-1!=n.borderColor||n.fillColor){var s=this.canvas.getContext("2d");if(s.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){var c=t.page,l=e.innerRect,u=e.outerRect,d=t.vertexes.map((function(e){var t=A(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new mn(n-l.left,i-l.top)})),h=t.vertexes.map((function(e){var t=A(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new mn(n-u.left,i-u.top)}));e.vertexes=d,s.save(),e.lineWidth=o,s.globalAlpha=n.opacity,0===o||!1===n.hasBorderColor?s.strokeStyle="transparent":s.strokeStyle=this.numberToRGBAString(n.color),s.lineWidth=o;try{switch(i.style){case an:case nn:case rn:case on:this.renderSolid(s,n,e),this.setContents(s,n.contents,d);break;case sn:0==o?this.renderSolid(s,n,e):this.renderCloud(s,n,e),this.setContents(s,n.contents,h)}}finally{s.restore()}}}}},{key:"renderCloud",value:function(e,t,n){var i=t.fillColor,a=t.borderInfo.cloudIntensity,r=n.innerRect,o=n.outerRect,s=new xn(n.vertexes,r,o),c=n.renderingData.vertexes,l=c.length;(l=l*=2==a?8:16,c.length>=2)&&(l=function(e,t){var n=2,i=Math.abs(e.right-e.left),a=Math.abs(e.bottom-e.top);n=1===t?parseInt((i+a)/4):parseInt((i+a)/6);return n<2&&(n=2),n%2!=0&&(n+=1),n}(this.calculateRect(c),a));s.generate(16/a,e,l).render(e),i&&(e.fillStyle=this.numberToRGBAString(i),e.fill()),e.stroke();try{if(!xe.isTouchDevice)return;var u=r.left-o.left,d=r.top-o.top,h=n.vertexes.map((function(e){return{x:e.x+u,y:e.y+d}}));void 0===n.renderingData.annotInfo.id&&Va(e,h)}catch(e){}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0,c=t.fillColor;r.style===an&&(e.setLineDash&&e.setLineDash(o.map((function(e){return i.convertPointToPixel(e,a)}))),e.lineDashOffset=this.convertPointToPixel(s,a)),new Na(n.vertexes,this.closing).render(e),c&&(e.fillStyle=this.numberToRGBAString(c),e.fill()),e.stroke();try{if(!xe.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&Va(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=ni(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=r.borderInfo||{},s=this.convertPointToPixel(o.width,e),c=this.canvas.getContext("2d");c.clearRect(0,0,this.canvas.width,this.canvas.height);var l=i.page,u=i.vertexes.map((function(n){var i=A(l.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new mn(r-a.left,o-a.top)}));c.save(),c.strokeStyle=this.numberToRGBAString(r.color),c.lineWidth=s;var d=this.closing;this.closing=!0,this.renderSolid(c,r,{vertexes:u}),c.beginPath(),u.forEach((function(e){return ii(c,e)})),this.closing=d}},{key:"setContents",value:function(e,t,n){var i;if(void 0!==t&&n&&!(n.length<3)&&this.showText){var a=n[n.length-1],r=e;r.beginPath(),r.font="14px Verdana",r.textAlign="left",r.textBaseline="top",r.direction="ltr";var o=r.measureText(t).width;r.fillStyle="#AF6B6B";var s=n.map((function(e){return e.x})),c=(i=Math).min.apply(i,f(s));Math.abs(a.x-c)>=o&&a.x>c?r.fillText(t,a.x-o,a.y,o):r.fillText(t,a.x,a.y,o),r.closePath()}}},{key:"calculateRect",value:function(e){var t={},n={x:0,y:0};t.left=t.right=e[0].x,t.bottom=t.top=e[0].y;for(var i=e.length,a=1;a<=i;a++)n=e[a%i],t.left>n.x&&(t.left=n.x),t.bottom>n.y&&(t.bottom=n.y),t.right<n.x&&(t.right=n.x),t.top<n.y&&(t.top=n.y);return t}}]),o}(tn),Ba=function(e){l(o,e);var n=m(o);function o(e){var i;t(this,o),Ke(v(i=n.call(this,e)),"isCloudy",!1);var a=i.annotationInfo;if(a.borderStyle)switch(a.borderInfo.style=a.borderStyle,a.borderStyle){case sn:i.annotationInfo.borderInfo.cloudIntensity=a.borderStyleParam,i.isCloudy=!0;break;case an:i.annotationInfo.borderInfo.dashes=a.borderStyleParam}return a.borderInfo.style===sn?i.isCloudy=!0:i.isCloudy=!1,i}return i(o,[{key:"setFlag",value:function(e,t){this.renderer.setFlag(e,t)}},{key:"generateApRenderer",value:function(){var e=this.isCloudy;return new ja(this,e)}},{key:"getOuterDeviceRect",value:function(e,t){return this.isCloudy?_n.on(this.getDeviceRect(e,t)).expand(100*e).extract():r(a(o.prototype),"getDeviceRect",this).call(this,e,t)}},{key:"getType",value:function(){return"polygon"}}]),o}(Ua),Xa=function(e){l(i,e);var n=m(i);function i(e,a){var r;return t(this,i),Ke(v(r=n.call(this,e,a,"create-drawing-status")),"target",void 0),r.target=a,r}return i}(ga),Ya=w.stateHandler,Ga=w.Log,Wa=w.DeviceInfo,$a=w.ViewerEvents,za=w.Consts.CREATING_DRAWING_CONTEXTMENU,qa=Ga.LoggerFactory,Ka=Ya.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON,Za=qa.getLogger("CreatePolygonStateHandler"),Ja=function(e){l(o,e);var n=m(o);function o(e){return t(this,o),n.call(this,e,"polygon")}return i(o,[{key:"createInteractionTool",value:function(e){return new Xa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"create",value:function(e,t){var n=new Ba({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polygon",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polygon")})});return n.addPoint(e,t),Wa&&Wa.isTouchDevice&&n.draw(),this.pdfViewer.eventEmitter.emit($a.perimeterAnnotCreationStart,n),n}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&Za.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(e){var t,n=this;if(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler()){var i,s;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(za,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",i)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan;c.otelService;this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit($a.drawingAnnotCreationStart,n.fakeAnnotation),l&&l(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;s=t,n}))})),this.interaction.on("end",(function(){null==s||s()})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){i=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()}))}}},{key:"end",value:function(e,t){if(!this.isCurrentStateHandler())return r(a(o.prototype),"end",this).call(this,e,t);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit($a.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return r(a(o.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit($a.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Ka}}]),o}(Da),Qa=w.stateHandler,er=w.Log,tr=w.DeviceInfo,nr=w.ViewerEvents,ir=w.Consts.CREATING_DRAWING_CONTEXTMENU,ar=er.LoggerFactory,rr=Qa.StateHandlerConsts.STATE_HANDLER_CREATE_POLYLINE,or=(ar.getLogger("creation/polyline/state"),function(e){l(o,e);var n=m(o);function o(e){return t(this,o),n.call(this,e,"polyline")}return i(o,[{key:"createInteractionTool",value:function(e){return new Xa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"pageHandler",value:function(e){var t,n=this;if(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler()){var i,s;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(ir,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",i)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan;c.otelService;this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit(nr.drawingAnnotCreationStart,n.fakeAnnotation),l&&l(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;s=t,n}))})),this.interaction.on("end",(function(){null==s||s()})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){i=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()}))}}},{key:"create",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("polyline"),i=new Ua(Object.assign({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polyline",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polyline")})},n));return i.addPoint(e,t),tr&&tr.isTouchDevice&&i.draw(),i}},{key:"end",value:function(e,t){if(!this.isCurrentStateHandler())return r(a(o.prototype),"end",this).call(this,e,t);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(nr.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return r(a(o.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(nr.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return rr}}]),o}(Da)),sr=w.stateHandler,cr=w.Log,lr=w.DeviceInfo,ur=w.ViewerEvents,dr=w.Consts.CREATING_DRAWING_CONTEXTMENU,hr=w.Consts.BORDER_STYLE,fr=cr.LoggerFactory,pr=sr.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON_CLOUD,vr=Object.values(hr),gr=fr.getLogger("CreatePolygonCloudStateHandler"),mr=function(e){l(o,e);var n=m(o);function o(e){return t(this,o),n.call(this,e,"polygon")}return i(o,[{key:"createInteractionTool",value:function(e){return new Xa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"create",value:function(e,t){var n,i=this.pdfViewer.getDefaultAnnotConfig()("polygon","PolygonCloud"),a=Object.assign({type:"polygon",flags:4,date:new Date,borderStyle:hr.CLOUDY,borderStyleParam:2,intent:"PolygonCloud",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Cloud")},i);if(n=i.borderInfo){vr.indexOf(n.style)>-1&&(a.borderStyle=n.style);var r=n.dashes;Array.isArray(r)&&r.length>0?a.borderStyleParam=r:"number"==typeof n.cloudIntensity&&(a.borderStyleParam=n.cloudIntensity)}var o=new Ba({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:a});return o.addPoint(e,t),lr&&lr.isTouchDevice&&o.draw(),o}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&gr.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(e){var t,n=this;if(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler()){var i,s;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(dr,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",i)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan;c.otelService;this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit(ur.drawingAnnotCreationStart,n.fakeAnnotation),l&&l(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;s=t,n}))})),this.interaction.on("end",(function(){null==s||s()})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){i=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()}))}}},{key:"end",value:function(e,t){this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(ur.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(ur.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return pr}}]),o}(Da),yr=function(e){l(a,e);var n=m(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"convertToCanvasBasedPoint",value:function(e,t,n,i,a,r){var o=A(a.getDevicePoint([e,t],i,r),2),s=o[0],c=o[1];return{x:s-n.left,y:c-n.top}}},{key:"doRender",value:function(e){var t=this,n=e.scale,i=e.renderingData,a=e.rotate,r=i.page,o=i.annotInfo,s=o.startCharInfo,c=o.endCharInfo,l=i.quadPoints,u=i.outerDeviceRect;if(!s){var d=l[0];s={left:d[0].x,top:d[0].y,right:d[1].x,bottom:d[2].y}}if(!c){var h=l[l.length-1];c={left:h[0].x,top:h[0].y,right:h[1].x,bottom:h[2].y}}var p=l.map((function(e,i){var o,s,c,l,d=e.map((function(e){return t.convertToCanvasBasedPoint(e.x,e.y,u,n,r,a)})),h=d.map((function(e){return e.x})),p=d.map((function(e){return e.y})),v=(o=Math).min.apply(o,f(h)),g=(s=Math).max.apply(s,f(h)),m=(c=Math).max.apply(c,f(p)),y=(l=Math).min.apply(l,f(p));return{left:v,right:g,bottom:m,top:y,width:g-v,height:m-y,textBlockHeight:m-y}}));e.quadRects=p}}]),a}(tn),Sr=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).lastX=0,i.lastY=0,i}return i(o,[{key:"prepare",value:function(){r(a(o.prototype),"prepare",this).call(this),xe.isChrome||xe.isFirefox||xe.isSafari||xe.isChromiumEdge||(this.canvas.style.cssText+='\n            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";\n            -ms-filter: alpha(opacity=50);\n            filter: alpha(opacity=50);\n            -moz-opacity: 0.5;\n            -khtml-opacity: 0.5;\n            opacity: 0.5;\n        ')}},{key:"doRender",value:function(e){e.smartScale,e.scale,this.component;var t=e.renderingData,n=t.annotInfo;if(this.component.needToggleView&&this.component.needToggleView()&&!this.component.shouldRenderByMouseEvent()){var i=this.canvas.getContext("2d");return i.clearRect(0,0,this.canvas.width,this.canvas.height),void i.save()}if(0!=n.hasBorderColor){var s=this.canvas.getContext("2d"),c=t.outerDeviceRect,l=c.right-c.left,u=c.bottom-c.top;if(this.container.style.cssText+="\n                left: ".concat(c.left,"px;\n                top: ").concat(c.top,"px;\n            "),this.canvas.style.cssText+="width: ".concat(l,"px;height: ").concat(u,"px;"),s.save(),s.fillStyle=this.numberToRGBAString(n.color),s.globalAlpha=t.opacity,t.isArea)s.fillRect(0,0,this.canvas.width,this.canvas.height);else r(a(o.prototype),"doRender",this).call(this,e),e.quadRects.forEach((function(e){s.fillRect(e.left,e.top,e.width,e.textBlockHeight)}));s.restore()}}}]),o}(yr),Ar=function(e){l(o,e);var n=m(o);function o(e){var i;t(this,o);return(i=n.call(this,e)).annotationInfo.dicts=Object.assign({AreaHi:"AreaHi"},i.annotationInfo.dicts||{}),i.eContainer.classList.add("fv__viewer-fake-highlight-area-annot"),i}return i(o,[{key:"setRect",value:function(e){r(a(o.prototype),"setRect",this).call(this,e),this.annotationInfo.coords=[this.pdfRect],this.annotationInfo.quadPoints=[{x:this.pdfRect.left,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.bottom},{x:this.pdfRect.left,y:this.pdfRect.bottom}]}},{key:"getDefaultAnnotInfo",value:function(){var e=r(a(o.prototype),"getDefaultAnnotInfo",this).call(this);return e.color=16776960,e}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),"Area"):{}}},{key:"generateApRenderer",value:function(){return new Sr(this)}},{key:"getType",value:function(){return"highlight"}},{key:"getCreationJSON",value:function(){return wi(Yn({},r(a(o.prototype),"getCreationJSON",this).call(this)),{color:this.annotationInfo.color})}},{key:"getRenderingData",value:function(e,t){var n=r(a(o.prototype),"getRenderingData",this).call(this,e,t);return wi(Yn({},n),{coords:[n.outerDeviceRect],isArea:!0})}}]),o}(jn),wr=w.stateHandler,Er=wr.IStateHandler,br=wr.StateHandlerUtils.getDevicePagePoint,kr=wr.StateHandlerConsts.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT,Rr=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-crosshair",i}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e,this.pageDestroyHooks=[];var i=e.$handler.get(0);e.$handler.addClass(this.cursorStyle);var a,r,o,s=this.hammer=new Hammer.Manager(i);s.add(new Hammer.Pan);var c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan,u=c.otelService;s.on("panstart",(function(e){if(n.startPoint=br(i,e),n.start(n.startPoint),l&&l(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;a=t,n})),u){var t=u.startChildSpan(n.constructor.getStateName()+"Start"),o=t.end,s=t.span;r=o,s}})),s.on("panmove",(function(e){return n.currentPoint={x:n.startPoint.x+e.deltaX,y:n.startPoint.y+e.deltaY},n.adjust(n.fakeAnnotation,n.startPoint,n.currentPoint)})),s.on("panend",(function(e){if(n.end(n.fakeAnnotation),u){var t=u.startChildSpan(n.constructor.getStateName()+"End"),i=t.end,s=t.span;o=i,s}null==o||o(),null==r||r(),null==a||a()})),s.on("pancancel",(function(e){return n.end(n.fakeAnnotation)})),this.pageDestroyHooks.push((function(){return s.destroy()}))}},{key:"start",value:function(e){var t=e.x,n=e.y;return this.fakeAnnotation=new Ar({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight")}}),this.fakeAnnotation.setRect({left:t,right:t+1,top:n,bottom:n+1}),this.fakeAnnotation}},{key:"adjust",value:function(e,t,n){var i=t.x,a=t.y,r=n.x,o=n.y,s=Math.min(i,r),c=Math.min(a,o),l=Math.max(i,r),u=Math.max(a,o);e.setRect({left:s,top:c,right:l,bottom:u}),e.draw()}},{key:"end",value:function(e){var t=this;e.apply().then((function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}})).then((function(){0}))}},{key:"destroyPageHandler",value:function(){this.fakeAnnotation&&this.fakeAnnotation.destroy(),this.pageDestroyHooks&&this.pageDestroyHooks.forEach((function(e){return e()})),this.pageRender.$handler.removeClass(this.cursorStyle)}}],[{key:"getStateName",value:function(){return kr}}]),a}(Er),Tr=function(){function e(){t(this,e),Ke(this,"store",new xe.ValueStore(!0))}return i(e,[{key:"start",value:function(){this.store.dispatch(!1)}},{key:"complete",value:function(){this.store.dispatch(!0)}},{key:"waitForCreationComplete",value:function(){return this.store.takeUntil(Boolean)}}]),e}(),xr=w.stateHandler,Cr=w.ViewerEvents,Pr=w.shared,_r=w.DeviceInfo,Ir=w.vendors,Dr=Ir.jQuery,Mr=Ir.EventEmitter,Nr=xr.IStateHandler,Lr=xr.StateHandlerConsts.STATE_HANDLER_CREATE_PENCIL,Vr=w.shared,Or=Vr.getClientX,Hr=Vr.getClientY,Fr=Vr.colorConvertor,Ur=Pr.browser.dpr,jr=function(){function e(){t(this,e),this.isZoom=!1,this.eventEmitter=new Mr}return i(e,[{key:"allInjected",value:function(){var e=this,t=new Hammer.Manager(this.pdfViewer.element,{recognizers:[[Hammer.Pinch]]});t.on("pinchstart",(function(t){e.isZoom=!0,e.eventEmitter.emit("pinchstart",t)})),t.on("pinchend",(function(t){Promise.resolve().then((function(){e.isZoom=!1})),e.eventEmitter.emit("pinchend",t)})),t.on("pinchmove",(function(t){e.eventEmitter.emit("pinchmove",t)}))}},{key:"onPinchstart",value:function(e){var t=this;return this.eventEmitter.on("pinchstart",e),function(){t.eventEmitter.off("pinchstart",e)}}},{key:"onPinchmove",value:function(e){var t=this;return this.eventEmitter.on("pinchmove",e),function(){t.eventEmitter.off("pinchmove",e)}}},{key:"onPinchend",value:function(e){var t=this;return this.eventEmitter.on("pinchend",e),function(){t.eventEmitter.off("pinchend",e)}}}],[{key:"inject",value:function(){return{pdfViewer:w.PDFViewer}}}]),e}(),Br=function(e){l(a,e);var n=m(a);function a(){var e;return t(this,a),(e=n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))).cursorStyle="fv__cursor-pencil",e.isMovingPencil=!1,e.destroyHooks=[],e.createInkService=e.pdfViewer.getIoC().getInstanceByClass(Tr),e}return i(a,[{key:"initTimeout",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.timeout;clearTimeout(i),n&&(this.timeout=setTimeout((function(){if(t.isMovingPencil)return t.isMovingPencil=!1,t.initTimeout(e,n);t.addAnnot().then((function(e){t.isMovingPencil=!1}))}),e))}},{key:"pageHandler",value:function(e){var t,n=this,i=this,a=this;this.pageRender=e;var r=this.pdfViewer,o=r.getIoC().getInstanceByClass(jr),s=e.viewerRender,c=s.scrollWrap,l=e.$handler;l.addClass(this.cursorStyle);var u=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i.pdfPointList&&!(i.pdfPointList.length<1)){if(t&&i.$canvas)return R(),void function(t,n){if(!t||t.length<1)return;var i={left:1e4,right:0,top:0,bottom:1e4},a=e.scale;xe.isTouchDevice&&(a=e.scale*n);var r=function(e,t,n,i,a,r){return a.forEach((function(a){var o=A(e.getDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})})),i}(e.page,a,e.rotate,[],t,i),o=d[0].getBoundingClientRect(),s=v.getBoundingClientRect();r.slice(0).map((function(e){return wi(Yn({},e),{x:e.x-(o.left-s.left),y:e.y-(o.top-s.top)})})).forEach((function(e){1==e.type?p.moveTo(e.x*Ur,e.y*Ur):p.lineTo(e.x*Ur,e.y*Ur)})),p.stroke()}(i.pdfPointList,n);clearTimeout(i.timeout),i.addAnnot()}};this.destroyHooks.push((0,xe.observeResize)(e.viewerRender.scrollWrap.getScrollHost(),(function(){n.isPaintingPencil||T()})));var d=this.$canvas=Dr('<canvas style="position: fixed;pointer-events: none;z-index: 1024;">');T(),l.append(this.$canvas.get(0));var h,f,p=this.$canvas[0].getContext("2d"),v=l[0],g=this.hammer=new Hammer.Manager(v,{recognizers:[[Hammer.Tap]]});if(this.pencilLists=[],this.isMovingPencil=!1,this.pdfPointList=[],this.isPaintingPencil=!1,this.startScale=e.scale,xe.isTouchDevice){var m=r.addEventListener(Cr.zoomToSuccess,(function(){n.transferPencilListsToPDFPointsLists(),u(!0,1)}));this.destroyHooks.push(m)}var y=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,S=y.startSDKSpan,w=(y.otelService,!1);g.on("tap",(function(t){if(n.isPaintingPencil=!0,0==n.pdfPointList.length&&(n.startScale=e.scale,R()),!(t.pointers.length>1||o.isZoom)){p.closePath();var i=Xr(v,t,d[0]);p.beginPath(),p.moveTo(i.x*Ur,i.y*Ur),p.arc(i.x*Ur,i.y*Ur,n.lineWidth,0,2*Math.PI),p.fillStyle=n.lineColor,p.fill(),p.closePath(),n.pencilLists.push([{x:i.x,y:i.y,type:3}]),n.isMovingPencil=!0,n.startAddAnnot()}}));var E=!1;function b(e){var t=r.element.parentElement.getBoundingClientRect(),n=l[0].getBoundingClientRect(),i=n.x-t.x,a=n.y-t.y;d.css({position:"absolute",left:-i/e,top:-a/e})}function k(){var e=r.element.parentElement;if(!e)return 1;var t=e.style.transform,n=A(/scale\((\d+(\.\d+)?)\)/.exec(t)||[],2)[1];return void 0===n?1:parseFloat(n)}function R(){var t=Object.assign({borderInfo:{width:2},color:16711680},a.pdfViewer.getDefaultAnnotConfig()("ink"));t.color=16777215&t.color,T(),a.$canvas.css("opacity",Number(t.opacity));var n=t.borderInfo.width*e.getScale()*Ur*4/3;a.lineWidth=n,p.lineWidth=n,a.lineColor=Fr(t.color,"HTML"),p.strokeStyle=Fr(t.color,"HTML"),p.lineJoin="round",p.lineCap="round"}function T(){var t=e.viewerRender.getViewBoxRect(),n=t.right-t.left,i=t.bottom-t.top;d[0].width=n*Ur,d[0].height=i*Ur,d.css({width:n,height:i,position:"fixed",left:t.left,top:t.top})}if(g.on("hammer.input",(function(t){t.pointers.length>1?w=!0:w?"pointerup"==t.srcEvent.type&&(w=!1):"pointermove"==t.srcEvent.type?(E||(!function(t){if(s.setAllowScrollOnMouseWheel(!1),0==n.pdfPointList.length&&(n.startScale=e.scale,R()),!o.isZoom){n.isPaintingPencil=!0;var i=n.pencilLists;h=[],i.push(h);var a=Xr(v,t,d[0]);p.closePath(),p.beginPath(),p.moveTo(a.x*Ur,a.y*Ur),h.push({x:a.x,y:a.y,type:1}),S&&S(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;f=t,n}))}}(t),E=!0),function(e){if(!o.isZoom){n.isMovingPencil=!0;var t=Xr(v,e,d[0]);h.push({x:t.x,y:t.y,type:2}),p.lineTo(t.x*Ur,t.y*Ur),p.strokeStyle=n.lineColor,p.stroke(),p.closePath(),p.beginPath(),p.moveTo(t.x*Ur,t.y*Ur),n.pageRender.page}}(t)):"pointerup"==t.srcEvent.type&&(!function(e){s.setAllowScrollOnMouseWheel(!0);var t=n.pencilLists;if(n.isPaintingPencil&&t&&!(t.length<1)&&n.isMovingPencil&&!o.isZoom){n.isMovingPencil=!1;var i=Xr(v,e,d[0]);p.lineTo(i.x*Ur,i.y*Ur),p.stroke(),n.startAddAnnot(),null==f||f()}}(t),E=!1)})),o.onPinchstart((function(e){b(k())})),o.onPinchmove((function(e){b(k())})),o.onPinchend((function(t){var n;n=e.viewerRender.getViewBoxRect(),d.css({position:"fixed",left:n.left,top:n.top}),Promise.resolve().then((function(){u(!1,t.scale)}))})),_r.isTouchDevice){var x=function(e){e.preventDefault()};l.on("touchstart",x),this.__off_touch_event=function(){l.off("touchstart",x)}}else this.__off_touch_event=function(){};var C=c.getScrollHost(),P=function(e){if(n.isPaintingPencil&&!n.isMovingPencil){var t=!1;(e.ctrlKey||xe.isMac&&e.metaKey)&&(t=!0),u(t)}};C.addEventListener("wheel",P);var _=function(e){n.isPaintingPencil&&!n.isMovingPencil&&u()};e.$element.on("blur",_),this.destroyHooks.push((function(){e.$element.off("blur",_),C.removeEventListener("wheel",P)}))}},{key:"changeToPageDevicePoints",value:function(e,t){var n,i=[];(n=i).push.apply(n,f(e.reduce((function(e,t){return e.concat(t)}),[])));var a=this.$canvas[0].getBoundingClientRect(),r=t.getBoundingClientRect();return i.slice(0).map((function(e){return wi(Yn({},e),{x:e.x+a.left-r.left,y:e.y+a.top-r.top})}))}},{key:"transferPencilListsToPDFPointsLists",value:function(){var e,t=this.pencilLists;if(t&&!(t.length<1)){var n=this.pageRender,i=n.$handler[0],a=n.page,r=this.changeToPageDevicePoints(t,i),o=function(e,t,n,i,a,r){return a.forEach((function(a){var o=A(e.reverseDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})})),i}(a,n.scale,n.rotate,[],r,{left:1e4,right:0,top:0,bottom:1e4});(e=this.pdfPointList).push.apply(e,f(o)),this.pencilLists=[]}}},{key:"startAddAnnot",value:function(){var e=this.pencilLists;if(!e||e.length<1)return Promise.resolve();var t=this.pageRender;if(this.transferPencilListsToPDFPointsLists(),!t.pdfViewer.continuousAddPencil){var n=t.pdfViewer.getStateHandlerManager().getStateHandlerConfig(this.constructor.getStateHandlerName()),i=n?n.pencilTimeout:null;return i=null!=i?i:3e3,this.createInkService.start(),this.initTimeout(i)}this.addAnnot()}},{key:"addAnnot",value:function(){var e=this;if(!this.pdfPointList||this.pdfPointList.length<1)return Promise.resolve();var t=this.pdfPointList.slice(0);this.pdfPointList=[];var n=this.pageRender;return this.createInkService.start(),n.getPDFPage().then((function(i){var a=n.index,r=function(t){t.index===a&&(e.$canvas[0]&&(e.$canvas[0].width=0),t.pdfViewer.eventEmitter.off("renderAnnotSuccess",r),e.isPaintingPencil=!1)};return i.addAnnot({type:"ink",flags:4,rect:{left:1e4,right:0,top:0,bottom:1e4},inkList:t,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Pencil")}).then((function(t){return n.pdfViewer.eventEmitter.emit(Cr.addAnnotSuccess,t[0]),n.pdfViewer.eventEmitter.on("renderAnnotSuccess",r),e.pencilLists=[],t})).then((function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}))})).finally((function(){e.createInkService.complete()}))}},{key:"destroyPageHandler",value:function(){var e=this;this.__off_touch_event(),this.initTimeout(0,!1),this.addAnnot().then((function(t){e.$canvas.remove(),e.hammer&&e.hammer.destroy(),e.pageRender.$handler.removeClass(e.cursorStyle),e.pencilLists=null})),this.destroyHooks.forEach((function(e){return e()}))}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return Lr}},{key:"getStateHandlerName",value:function(){return"pencilStateHandler"}}]),a}(Nr);function Xr(e,t,n){var i=e.getBoundingClientRect(),a=t.srcEvent,r=Or(a),o=Hr(a),s=n.getBoundingClientRect();return{x:Math.max(i.left,Math.min(i.right,r))-s.left,y:Math.max(i.top,Math.min(i.bottom,o))-s.top}}!function(e){e.CREATE_ANNOT="create-annots",e.REMOVE_ANNOT="remove-annots",e.UPDATE_ANNOT="update-annots",e.ADD_REPLY="add-reply",e.REMOVE_REPLY="remove-reply",e.ADD_REVIEW_STATE="add-review-state",e.ADD_MARKED_STATE="add-marked-state",e.UPDATE_ANNOT_CONTENT="update-comment-content",e.PPO_REMOVE_PAGE="ppo-remove-page",e.PPO_REMOVE_PAGES="ppo-remove-pages",e.PPO_INSERT_PAGE="ppo-insert-page",e.PPO_ROTATE_PAGE="ppo-rotate-page",e.PPO_MOVE_PAGE="ppo-move-page",e.MOVE_ANNOTS_BETWEEN_PAGES="move-annotations-between-pages",e.IMPORT_ANNOTATIONS_FILE="import-annotations-file"}(Oa||(Oa={})),function(e){e.fully="fully",e.playable="playable",e.adjustable="adjustable",e.deletable="deletable",e.modifiable="modifiable",e.attachmentDownloadable="attachmentDownloadable",e.replyable="replyable",e.editable="editable"}(Ha||(Ha={}));var Yr=o(47),Gr=o.n(Yr),Wr=(o(263),w.DeviceInfo.isDesktop?8:20),$r=function(){function e(n,i){t(this,e),this.pageRender=n,this.circle=document.createElement("div"),this.circle.classList.add("eraserCircle"),this.circle.style="position:absolute; border:1px solid #000000;display:block;border-radius:50%;",this.wrapCircle=i,this.$eraserCircle=null,this.clientY,this.clientX,this.$pdfViewerElement=Gr()(this.pageRender.pdfViewer.element)}return i(e,[{key:"init",value:function(){var e=this;this.$pdfViewerElement.on("scroll",(function(t){e.$eraserCircle&&e.eraserMove(t)})),this.wrapCircle.on("mouseenter",(function(){e.wrapCircle.append(e.circle),e.$eraserCircle=Gr()(e.circle),e.$eraserCircle.css("display","block")})),this.wrapCircle.on("mousemove",(function(t){e.eraserMove(t)})),this.wrapCircle.on("mouseleave",(function(t){e.$eraserCircle&&e.$eraserCircle.remove()}))}},{key:"eraserMove",value:function(e){var t=e||window.event,n=this.getEraseWidth()*this.pageRender.getScale(),i=this.$eraserCircle?this.$eraserCircle:Gr()(this.circle);t.clientY&&(this.clientY=t.clientY),t.clientX&&(this.clientX=t.clientX);var a=i[0].getBoundingClientRect();i.width(n),i.height(n);var r=Gr()(this.wrapCircle).offset().top,o=Gr()(this.wrapCircle).offset().left,s=Gr()("html").scrollLeft(),c=this.clientY-a.height/2-r,l=this.clientX-a.width/2-o+s;i.css({top:c,left:l})}},{key:"destroy",value:function(){this.$eraserCircle&&this.$eraserCircle.remove(),this.wrapCircle.off(),this.$pdfViewerElement.off("scroll")}},{key:"getEraseWidth",value:function(){var e=this.pageRender.pdfViewer.getStateHandlerManager().getStateHandlerConfig("eraserStateHandler");return e?e.width:Wr}}]),e}(),zr=w.stateHandler,qr=w.Log,Kr=w.ViewerEvents,Zr=w.shared.eraser,Jr=Zr.Eraser,Qr=Zr.Point,eo=zr.IStateHandler,to=w.Consts.POINT_TYPE,no=zr.StateHandlerUtils.getDevicePagePoint,io=qr.LoggerFactory.getLogger("EraserStateHandler"),ao=function(e){l(a,e);var n=m(a);function a(){var e;return t(this,a),(e=n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))).cursorStyle="fv__cursor-eraser fv__cursor-none",e.eraserCircle=null,e.createInkService=e.pdfViewer.getIoC().getInstanceByClass(Tr),e}return i(a,[{key:"pageHandler",value:function(e){var t=this;return Ae((function(){var n,i,a,r,o,s,c,l,u,d,h,f,p,v;return we(this,(function(g){return t.pageRender=e,i=e.$handler,(a=new $r(e,i)).init(),t.eraserCircle=a,t.allInkList={},t.eraseInkList={},i.addClass(t.cursorStyle),r=i[0],o=t.hammer=new Hammer.Manager(r,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),s=t.createInkService.waitForCreationComplete().then((function(){return e.page.getAnnots().then((function(e){return e.filter((function(e){return"ink"===e.getType()}))}))})),d=(null===(n=t.pdfViewer.viewerUI.rootComponent)||void 0===n?void 0:n.pdfUI)||{customs:{}},h=d.customs,f=h.startSDKSpan,p=h.otelService,e.getPDFPage().then((function(n){o.on("panstart",(function(e){if(t.startPoint=no(r,e),v=s.then((function(e){e.forEach((function(e){t.allInkList[e.getId()]={annot:e,inkList:e.getInkList()}}))})),f&&f(t.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;c=t,n})),p){var n=p.startChildSpan(t.constructor.getStateName()+"Start"),i=n.end,a=n.span;l=i,a}})),o.on("panmove",(function(e){t.lastPoint=t.currentPoint||t.startPoint,t.currentPoint={x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY},v=v.then((function(e){return s.then((function(e){if(0!==e.length||t.currentPoint){var i=t.eraserCircle.getEraseWidth();return t.erase(n,e,t.currentPoint,i)}}))}))})),o.on("panend",(function(n){var i=document.getElementById("eraser");if(i&&i.remove(),v.then((function(n){var i=[],a=[];for(var r in t.eraseInkList){var o=t.allInkList[r],s=t.eraseInkList[r];o.isRemove=s.isRemove,i.push(o),a.push(s)}e.pdfViewer.eventEmitter.emit(Kr.eraserSuccess,i,a);var c=Object.keys(t.eraseInkList).map((function(e){return t.eraseInkList[e]})).filter((function(e){return!e.isRemove})).map((function(e){return e.annot.exportToJSON()}));t.pdfViewer.collaborate(Oa.UPDATE_ANNOT,{annots:c})})),p){var a=p.startChildSpan(t.constructor.getStateName()+"End"),r=a.end,o=a.span;u=r,o}null==u||u(),null==l||l(),null==c||c()}))})),[2]}))}))()}},{key:"erase",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Wr,a=this;return Ae((function(){var r,o,s,c,l,u,d,h,f,p,v;return we(this,(function(g){switch(g.label){case 0:return r=a.pdfViewer,o=a.pageRender,s=o.getScale(),c=o.getRotation(),l=A(e.reverseDevicePoint([n.x,n.y],s,c),2),u=l[0],d=l[1],h={x:u,y:d},m=Ae((function(e,t){var n;return we(this,(function(i){switch(i.label){case 0:return[4,Promise.all(e.map(t))];case 1:return n=i.sent(),[2,e.filter((function(e,t){return n[t]}))]}}))})),f=function(e,t){return m.apply(this,arguments)},[4,f(t,function(){var e=Ae((function(e){var t;return we(this,(function(n){switch(n.label){case 0:return t=e.getRect(),[4,a.pdfViewer.getAnnotAuthorityManager()];case 1:return[4,n.sent().getPermission(e)];case 2:return n.sent().isModifiable()?[2,(i=t,r=h,o=r.x>=i.left&&r.x<=i.right,s=r.y>=i.bottom&&r.y<=i.top,o&&s)]:[2,null]}var i,r,o,s}))}));return function(t){return e.apply(this,arguments)}}())];case 1:return p=g.sent(),v=p.map((function(e){var t=function(){var t,n=e.getInkList(),a=new Jr(i/2).erase(n.map((function(e){return new Qr(e.x,e.y,e.type)})),new Qr(u,d)).reduceRight((function(e,t){var n=e[0];return n&&n.type===to.MOVE_TO&&n.type===t.type||e.unshift(t),e}),[]),s=(t=a,t.reduce((function(e,t){return t.type===to.MOVE_TO&&e.push([]),e[e.length-1].push(t),e}),[])).filter((function(e){if(e.length<1)return!1;var t=e[0],n=0;return e.forEach((function(e){n+=e.distanceTo(t),t=e})),n>.01}));if(0!==s.length){var c=s.reduce((function(e,t){return e.concat(t)}),[]);return e.setInkList(c)}var l=o.getAnnotRender(e.getId());if(l){var h=l.component.annot;return h.getPDFPage().removeAnnot(h).then((function(){r.collaborate(Oa.REMOVE_ANNOT,[{annotId:h.getUniqueID(),pageIndex:o.index}])}))}io.debug("annotRender === undefined",l,s,a)};return e.$$lastErasePromise=(e.$$lastErasePromise||Promise.resolve()).then(t,t).then((function(t){var n=o.getAnnotRender(e.getId());return a.eraseInkList[e.getId()]={annot:e,inkList:e.getInkList(),isRemove:!n},t}))})),[2,Promise.all(v)]}var m}))}))()}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.eraserCircle.destroy()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return"eraser"}},{key:"getStateHandlerName",value:function(){return"eraserStateHandler"}}]),a}(eo);const ro=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";e.endsWith("/")||(e+="/"),t=t.replace(/(\w*?)-(\w*)/,(function(e,t,n){return t+"-"+n.toUpperCase()}));return function(n,i,a){var r;return Ke(r={},a,{Approved:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Approved.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Received.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Confidential.pdf"),fileType:"pdf"}}),Ke(r,i,{Accepted:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Accepted.pdf"),fileType:"pdf"},Witness:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Witness.pdf"),fileType:"pdf"},SignHere:{url:"".concat(e,"stamps/").concat(t,"/SignHere/SignHere.pdf"),fileType:"pdf"},Rejected:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Rejected.pdf"),fileType:"pdf"},Initial:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Initial.pdf"),fileType:"pdf"}}),Ke(r,n,{Approved:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Approved.pdf"),fileType:"pdf"},Void:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Void.pdf"),fileType:"pdf"},Verified:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Verified.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Received.pdf"),fileType:"pdf"},Final:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Final.pdf"),fileType:"pdf"},Expired:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Expired.pdf"),fileType:"pdf"},Emergency:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Emergency.pdf"),fileType:"pdf"},Draft:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Draft.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Confidential.pdf"),fileType:"pdf"},Completed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Completed.pdf"),fileType:"pdf"}}),r}.apply(undefined,f(["Static","SignHere","Dynamic"]))};var oo,so=w.DeviceInfo,co=w.PDFViewer,lo=w.shared.Store;!function(e){e.CUSTOM_STAMP_LIST_ADDED="custom-stamps-added",e.CUSTOM_STAMP_LIST_REMOVED="custom-stamps-removed",e.CUSTOM_STAMP_LIST_UPDATED="custom-stamps-updated",e.DEFAULT_STAMP_LIST_UPDATED="default-stamps-updated",e.DEFAULT_STAMP_LIST_REMOVED="default-stamps-removed",e.SWITCH_STAMP_ICON="switch-stamp-icon"}(oo||(oo={}));var uo,ho=function(){function e(){t(this,e),Ke(this,"pdfViewer",void 0),Ke(this,"currentStamp",void 0),Ke(this,"currentPreviewerImg",void 0),Ke(this,"customStamps",{}),Ke(this,"defaultStamps",{}),Ke(this,"initAnnotationIcons",{}),Ke(this,"store",new lo),Ke(this,"lastKey",void 0),Ke(this,"defaultStampRewrited",!1);var n=document.createElement("img");n.draggable=!1,n.style.cssText="position: absolute;opacity:0.5;pointer-events:none;",this.currentPreviewerImg=n}return i(e,[{key:"setCurrentStamp",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,s=this.currentStamp,c=this.currentStamp=this.getStampIcon(e,t,i,a,r,o);if(!c)throw new Error("Stamp not found: category: ".concat(e,", name: ").concat(t));this.currentPreviewerImg.src=c.showUrl||"",Promise.resolve().then((function(){n.store.dispatch("switch-stamp-icon",{current:n.currentStamp,last:s})}))}},{key:"onSwitchStamp",value:function(e){return this.store.subscribe("switch-stamp-icon",(function(t){e(t.current,t.last)}))}},{key:"getCurrentStampConfig",value:function(){return this.currentStamp}},{key:"getPreviewerImage",value:function(){return this.currentPreviewerImg}},{key:"setInitAnnotationIcons",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initAnnotationIcons=e}},{key:"setDefaultStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.defaultStamps=e,this.defaultStampRewrited=!0,this.store.dispatch("default-stamps-updated",e)}},{key:"setCustomStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.customStamps=e,this.store.dispatch("custom-stamps-updated",e)}},{key:"updateDefaultStamps",value:function(e,t){if(!this.defaultStampRewrited){var n=this.pdfViewer.libPath,i=this.pdfViewer.getCurrentLanguage(),a=n+i;if(this.lastKey!==a){this.lastKey=a;var r=ro(n,i);if(e){var o=e.category,s=e.name;r[o]=r[o]||{},r[o][s]=e}if(t){var c=t.category,l=t.name;r[c]&&(delete r[c][l],0===Object.keys(r[c]).length&&delete r[c])}this.defaultStamps=r,this.store.dispatch("default-stamps-updated",r)}}}},{key:"getDefaultStamps",value:function(){return this.defaultStamps}},{key:"getCustomStamps",value:function(){return this.customStamps}},{key:"getFavoriteStamps",value:function(){var e=function(e){var n,r,s=t[e].split("."),c=s[0],l=s[1],u=s[2],d=s[s.length-1],h=!1;if(d.includes("__sPage__")){h=!0;var f=d.split("__");c=f[0],l=f[1],u=d}var p={},v=void 0;if(null==i||null===(r=i[c])||void 0===r||null===(n=r[l])||void 0===n?void 0:n.url)v=i[c][l].url,o[c+"-"+l]=Yn({fileType:"pdf",url:v},p);else{var g,m=null==a||null===(g=a[c])||void 0===g?void 0:g[l];if(m||a[c]&&"length"in a[c]&&(m=a[c].find((function(e){var t=e.index.split("__"),n=t[t.length-1],i=u.split("__");return n===i[i.length-1]&&t[0]===i[0]}))),!m)return"continue";if(Array.isArray(m)){var y=m.find((function(e){return e.index==u}));v=y.url,p.width=y.width,p.height=y.height,p.fileType=y.fileType,h&&(p.isImportPDFStamp=y.isImportPDFStamp,p.blob=y.blob,p.pageIndex=y.index)}else v=m.url,p.width=m.width,p.height=m.height,p.fileType=m.fileType,h&&(p.isImportPDFStamp=m.isImportPDFStamp,p.blob=m.blob,p.pageIndex=m.pageIndex);if(!v)return"continue";o[c+"-"+l+"-"+u]=Yn({fileType:"pdf",url:v},p)}};this.updateDefaultStamps();var t=this.pdfViewer.getDeprecatedStorage().getItem("FAVORITE-STAMPS-LIST"),n=this.pdfViewer.customs.stampManager;n&&(t=n.getFavoriteStamps());var i=this.getDefaultStamps(),a=this.getCustomStamps(),r=Object.assign({},i);if(!t)return r;if(0===t.length)return r;for(var o={},s=0;s<t.length;s++)e(s);return r.Favorite=o,r}},{key:"getStampIcon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,o=this.defaultStamps[e]&&this.defaultStamps[e][t];Array.isArray(o)&&(o=o.find((function(e){return e.index===n})));var s=this.customStamps[e];if(!o&&s){var c=s[t];o=Array.isArray(c)?c.find((function(e){return e.index==n})):c}if(!o){var l=this.getFavoriteStamps()[e];if(l){var u=l[t];o=Array.isArray(u)?u.find((function(e){return e.index==n})):u}}if(o=o||i){var d=o.width||a,h=o.height||r,f=o.showUrl||o.url;if(!so.isTouchDevice&&["pdf","tif","tiff"].includes(o.fileType)){f=f.replace(/\.(pdf|tif|tiff)$/,".svg");var p=new XMLHttpRequest;p.open("get",f),p.send()}return!("index"in o)&&"pageIndex"in o&&(o.index=o.pageIndex),Object.assign({},o,{width:d,height:h,showUrl:f,category:e,name:t})}}},{key:"clearCustomStamps",value:function(){this.customStamps={}}},{key:"addAnnotationIcon",value:function(e){var t=this;return Ae((function(){var n,i;return we(this,(function(a){return n=e.category,i=e.name,n in t.customStamps||(t.customStamps[n]={leaf:1}),t.customStamps[n][i]=[e],t.store.dispatch("custom-stamps-added",t.customStamps,e),t.store.dispatch("custom-stamps-updated",t.customStamps),[2]}))}))()}},{key:"removeAnnotationIcon",value:function(e){this.removeIcon(this.initAnnotationIcons,e),this.removeIcon(this.defaultStamps,e)?this.store.dispatch("default-stamps-removed",this.defaultStamps,e):this.removeIcon(this.customStamps,e)&&(this.store.dispatch("custom-stamps-updated",this.customStamps),this.store.dispatch("custom-stamps-removed",this.customStamps,e))}},{key:"onCustomStampRemoved",value:function(e){return this.store.subscribe("custom-stamps-removed",e)}},{key:"onCustomStampUpdated",value:function(e){return this.store.subscribe("custom-stamps-updated",e)}},{key:"onCustomStampAdded",value:function(e){return this.store.subscribe("custom-stamps-added",e)}},{key:"onDefaultStampRemoved",value:function(e){return this.store.subscribe("default-stamps-removed",e)}},{key:"onDefaultStampUpdated",value:function(e){return this.store.subscribe("default-stamps-updated",e)}},{key:"removeIcon",value:function(e,t){var n,i=function(){var t=e[s];for(var i in t){var c=t[i];if(r){if(a==s&&i==r){if(Array.isArray(c)){if(void 0===o){delete t[i],n=!0;continue}t[i]=c.reduce((function(e,t,n){return o.length>1&&o==t.index||n+""==o||e.push(t),e}),[]);var l=t[i];Array.isArray(l)&&(l.length||delete t[i])}else delete t[i];n=!0}}else a?s==a&&(delete t[i],n=!0):delete t[i]}Object.values(t).some((function(e){return Array.isArray(e)||"[object Object]"===Object.prototype.toString.call(e)}))||delete e[s]},a=t.category,r=t.name,o=t.index;for(var s in e)i();return n}}],[{key:"inject",value:function(){return{pdfViewer:co}}}]),e}(),fo=w.stateHandler,po=w.ViewerEvents,vo=w.vendors,go=(vo.jQuery,vo.Hammer),mo=fo.IStateHandler,yo=fo.StateHandlerConsts.STATE_HANDLER_CREATE_STAMP,So=w.shared,Ao=So.getClientX,wo=So.getClientY,Eo=w.DeviceInfo.isTouchDevice,bo=function(e){l(a,e);var n=m(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler,a=e.pdfViewer;i.addClass("fv__create-stamp-state-handler");var r,o,s=!1,c=i[0],l=this.hammer=new go.Manager(c,{recognizers:[[go.Tap]]}),u=a.getIoC().getInstanceByClass(ho),d=u.getPreviewerImage();function h(t){var n=u.getCurrentStampConfig(),a=c.getBoundingClientRect(),r=t.clientX-a.left,o=t.clientY-a.top;Eo||(d.style.cssText+="\n                    transform: scale(".concat(e.getScale(),");\n                    top: ").concat(o-2*n.height/3,"px;\n                    left: ").concat(r-2*n.width/3,"px;\n                "),d.style.display="",i.append(d))}this.previewStampImg=d,a.getStore().subscribe("switchStampEvent",(function(e){h(e)})),this.addEvent(i,"mousemove",(function(e){s||h(e)}));var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;l.on("tap",(function(t){if(!s){var i=c.getBoundingClientRect(),l=t.srcEvent,h="",f=Ao(l),g=wo(l),m=[f-i.left,g-i.top],y=m[0],S=m[1];s=!0;var A=u.getCurrentStampConfig(),w=A.width,E=A.height,b=A.category,k=A.name,R=A.fileType,T=A.url,x=A.field,C=A.blob,P=A.index,_=A.isImportPDFStamp;return p&&p(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;r=t,o=n})),e.getPDFPage().then((function(t){var n=2*w/3*e.scale,i=2*E/3*e.scale,a={left:y-n,right:y+n,top:S-i,bottom:S+i};a=t.reverseDeviceRect(a,e.scale,e.getRotation());var r={rotation:(360-(90*t.getRotation()+e.getRotation()))%360,type:"stamp",flags:4,rect:a,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Stamp"),iconInfo:{category:b,name:k,fileType:R,url:T,field:x,stampPdfBlob:C,isImportPDFStamp:_,pageIndex:P}};return Object.assign(r,e.pdfViewer.getDefaultAnnotConfig()("stamp")||{}),t.addAnnot(r)})).then((function(t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;return h=n,e.pdfViewer.eventEmitter.emit(po.addAnnotSuccess,n.annot),n})).then((function(t){return e.pdfViewer.getStateHandlerManager().switchTo(),t.getRenderPromise().finally((function(){setTimeout((function(){d.style.cssText+="\n                                    display: none;\n                                    opacity: 0.5;\n                                "}),500),d.style.opacity=1})),s=!1,a.activeElement(t),a.config.showCommentList?(h.showReplyDialog(),t):t})).catch((function(e){null==v||v.setSpanException(o,e),s=!1,d.style.cssText+="\n                        display: none;\n                        opacity: 0.5;\n                    "})).finally((function(){null==r||r()}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler");var e=this.previewStampImg;e.parentElement&&e.parentElement.removeChild(e),this.destroyList.map((function(e){var t=A(e,3),n=t[0],i=t[1],a=t[2];n.off(i,a)}))}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addEvent",value:function(e,t,n){this.destroyList=this.destroyList||[],e.on(t,n),this.destroyList.push([e,t,n])}}],[{key:"getStateName",value:function(){return yo}},{key:"setParams",value:function(e,t){var n=e.category,i=e.name,a=e.index,r=t.getIoC().getInstanceByClass(ho);try{e.url&&e.fileType?r.setCurrentStamp(n,i,a,e):r.setCurrentStamp(n,i,a,void 0)}catch(e){return console.error(e),void Promise.resolve().then((function(){t.getStateHandlerManager().switchTo()}))}var o=r.getPreviewerImage(),s=r.getCurrentStampConfig(),c=s.width,l=s.height,u=s.showUrl;Eo||(o.style.cssText+="\n                width: ".concat(4*c/3,"px;\n                height: ").concat(4*l/3,"px;\n            "),o.src=u,"pdf"==s.fileType&&setTimeout((function(){t.previewIconDoc(s).then((function(e){o.parentElement&&(o.src=URL.createObjectURL(e))}))}),100))}}]),a}(mo),ko=w.stateHandler,Ro=w.ViewerEvents,To=ko.IStateHandler,xo=ko.HandStateHandler,Co=w.vendors,Po=Co.Hammer,_o=Co.jQuery,Io=w.shared,Do=(Io.DebouncePromiseQueue,Io.getClientX),Mo=Io.getClientY,No=ko.StateHandlerUtils,Lo=(No.getDevicePagePoint,No.deltaDeviceRect,No.appendSelectMark,No.removeSelectMark,ko.StateHandlerConsts.STATE_HANDLER_CREATE_FILE_ATTACHMENT),Vo=function(e){l(a,e);var n=m(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-file",i}return i(a,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=_o('<input id="fileAttachment" type="file" style="display: none;"/>');this.$fileAttachment=a,i.append(a);var r,o,s=i[0],c=this.hammer=new Po.Manager(s,{recognizers:[[Po.Tap]]}),l=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,d=l.otelService;c.on("tap",(function(t){var i=s.getBoundingClientRect(),c=t.srcEvent,l=Do(c),h=Mo(c),f=[l-i.left,h-i.top],p=f[0],v=f[1],g=e.pdfViewer;u&&u(n.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;r=t,o=n})),a.off("change").on("change",(function(t){var n=t.target.files[0];if(n&&!(g.customs&&g.customs.isAttachFileOverSize&&g.customs.isAttachFileOverSize(n)))if(n.size>268435456)g.viewerUI.confirm({message:"sidebar.attachment.addAttachmentSizeLimit",level:"warning"});else{if(!(["exe"].indexOf(n.name.split(".")[1])>=0))return e.getPDFPage().then((function(t){var i=new FileReader,a=A(t.reverseDevicePoint([p,v],e.scale,e.getRotation()),2),s=a[0],c=a[1];i.readAsArrayBuffer(n),i.onload=function(){var a=new Uint8Array(i.result);t.addAnnot({flags:28,type:"fileattachment",rect:{left:s,right:s+20,top:c,bottom:c-24},buffer:a,fileName:n.name,file:n,subject:g.i18n.t("viewer_:annotSubjects.File")}).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;g.eventEmitter.emit(Ro.addAnnotSuccess,i.annot),g.getStateHandlerManager().switchTo(xo.getStateName()),e.annotsRender.activeAnnot(n.getId())})).catch((function(e){throw null==d||d.setSpanException(o,e),e})).finally((function(){null==r||r()}))}}));g.viewerUI.confirm({message:"sidebar.attachment.addAttachmentFileFormat",level:"warning"})}})),a.click()}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.$fileAttachment.remove()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return Lo}}]),a}(To);!function(e){e.STATE_HANDLER_HAND="hand",e.STATE_HANDLER_CHECK_THE_SEARCH="checkTheSearch",e.STATE_HANDLER_CREATE_CARET="createCaret",e.STATE_HANDLER_CREATE_ARROW="createArrow",e.STATE_HANDLER_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CIRCLE="createCircle",e.STATE_HANDLER_CREATE_FILE_ATTACHMENT="createFileAttachment",e.STATE_HANDLER_CREATE_HIGHLIGHT="createHighlight",e.STATE_HANDLER_CREATE_IMAGE="createImage",e.STATE_HANDLER_CREATE_LINK="createLink",e.STATE_HANDLER_CREATE_LINE="createLine",e.STATE_HANDLER_CREATE_DISTANCE="createDistance",e.STATE_HANDLER_CREATE_PERIMETER="createPerimeter",e.STATE_HANDLER_CREATE_AREA="createArea",e.STATE_HANDLER_CREATE_CIRCLE_AREA="createCircleArea",e.STATE_HANDLER_CREATE_PENCIL="createPencil",e.STATE_HANDLER_CREATE_POLYGON_CLOUD="createPolygonCloud",e.STATE_HANDLER_CREATE_POLYGON="createPolygon",e.STATE_HANDLER_CREATE_POLYLINE="createPolyline",e.STATE_HANDLER_CREATE_REPLACE="createReplace",e.STATE_HANDLER_CREATE_SQUARE="createSquare",e.STATE_HANDLER_CREATE_SQUIGGLY="createSquiggly",e.STATE_HANDLER_CREATE_STAMP="createStamp",e.STATE_HANDLER_CREATE_STRIKE_OUT="createStrikeOut",e.STATE_HANDLER_CREATE_TEXT="createText",e.STATE_HANDLER_CREATE_UNDERLINE="createUnderline",e.STATE_HANDLER_MARQUEE="marquee",e.STATE_HANDLER_ERASER="eraser",e.STATE_HANDLER_LOUPE="loupe",e.STATE_HANDLER_SELECT_TEXT_ANNOTATION="select-text-annotation",e.STATE_HANDLER_SELECT_TEXT_IMAGE="select-text-image",e.STATE_HANDLER_SELECT_ANNOTATION="select-annotation",e.STATE_HANDLER_CREATE_FREETEXT_BOX="createFreeTextBox",e.STATE_HANDLER_CREATE_FREETEXT_CALLOUT="createFreeTextCallout",e.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER="createFreeTextTypewriter",e.STATE_HANDLER_CREATE_FIELD_TEXT="CreateTextStateHandler",e.STATE_HANDLER_CREATE_FIELD_SIGNATURE="CreateSignStateHandler",e.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON="CreatePushButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_CHECK_BOX="CreateCheckBoxStateHandler",e.STATE_HANDLER_CREATE_RADIO_BUTTON="CreateRadioButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_COMBO_BOX="CreateComboBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_LIST_BOX="CreateListBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_DATE="CreateDateStateHandler",e.STATE_HANDLER_CREATE_FIELD_IMAGE="CreateImageStateHandler",e.STATE_HANDLER_SNAPSHOT_TOOL="snapshot-tool",e.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT="createDocumentAttachment"}(uo||(uo={}));var Oo,Ho="userSpaceUnit",Fo="userSpaceScaleValue",Uo="realUnit",jo="realScaleValue",Bo=(Ke(Oo={},uo.STATE_HANDLER_CREATE_PERIMETER,"perimeter"),Ke(Oo,uo.STATE_HANDLER_CREATE_DISTANCE,"distance"),Ke(Oo,uo.STATE_HANDLER_CREATE_AREA,"area"),Ke(Oo,uo.STATE_HANDLER_CREATE_CIRCLE_AREA,"area"),function(e){l(a,e);var n=m(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).target=i,r}return i(a,[{key:"init",value:function(){var e,t,n,i,a=this,r=function(n){if(0===n.button)if(a.isStarted){if(a.isStarted){i=null,a.isStarted=!1;var r=n.clientX-e,o=n.clientY-t;a.emit("end",{deltaX:r,deltaY:o,srcEvent:n})}}else i=a.target.getBoundingClientRect(),a.isStarted=!0,e=n.clientX,t=n.clientY,a.emit("start",{deltaX:0,deltaY:0,srcEvent:n})},o=function(i){if(!a.isLocked)if(a.isStarted){var r=i.clientX-e,o=i.clientY-t;a.emit("move",n={deltaX:r,deltaY:o,srcEvent:i})}else{var s=a.target.getBoundingClientRect(),c=i.clientX-s.left,l=i.clientY-s.top;a.emit("mousemove",{x:c,y:l})}},s=function(n){if(a.isStarted&&!a.isDestroyed&&!a.isLocked&&i){var r=a.target.getBoundingClientRect(),o=e-i.left,s=t-i.top,c=r.width/i.width;e=r.left+o*c,t=r.top+s*c,i=r}};window.addEventListener("scroll",s,!0),this.target.addEventListener("mousedown",r),document.addEventListener("mousemove",o,!0);var c=this.pdfViewer.getStore().subscribe("create-measurement-status",(function(e){switch(e){case"complete":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("end",n));break;case"cancel":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("cancel"))}}));this.addDestroyHook((function(){a.target.removeEventListener("mousedown",r),document.removeEventListener("mousemove",o),c(),window.removeEventListener("scroll",s,!0)}))}}]),a}(Si)),Xo=w.stateHandler.CreateMeasurementService,Yo=[],Go=w.ViewerEvents,Wo=w.DeviceInfo.isTouchDevice,$o=w.Consts,zo=$o.LineEndingStyle,qo=$o.Intents,Ko=$o.CREATING_MEASUREMENT_CONTEXTMENU,Zo=w.shared.ThrottleAsyncTaskExecutor,Jo=w.commons.isSamePoint,Qo=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e,zo.OpenArrow,zo.OpenArrow)).isEnd=!0,i.executor=new Zo(20,!0),i}return i(o,[{key:"createInteractionTool",value:function(e,t){return Wo?r(a(o.prototype),"createInteractionTool",this).call(this,e,t):new Bo(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(Xo).getMeasurementInfo();return{unit:e[Uo].name,ratio:{userSpaceValue:e[Fo],userSpaceUnit:e[Ho].name,realValue:e[jo],realUnit:e[Uo].name}}}},{key:"createAnnotJson",value:function(e){return e.intent=qo.LINE_DIMENSION,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineDimension")),e}},{key:"pageHandler",value:function(e){var t,n=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[];var i=this.pdfViewer.viewerUI.createContextMenu(Ko,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),s=this.pdfViewer.getIoC().getInstanceByClass(ma),c=i.getItem("complete");i.disable(),this.creatingContextmenu=i,this.interaction.on("start",(function(){s.isCreating?n.interaction.cancel():(s.setCreating(n.pageRender.index),n.isEnd=!1,i.enable())})),this.interaction.on("end",(function(){s.creatingEnd(),n.isEnd=!0,i.disable()})),this.interaction.on("cancel",(function(){s.creatingEnd(),i.disable()})),this.interaction.on("move",(function(e){t=e})),i.onHidden((function(){n.interaction.unlock()})),i.onShown((function(){n.interaction.lock(),c.enable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(Go.zoomToSuccess,(function(e){ti(Yo)})),this.pdfViewer.addEventListener(Go.changeViewModeSuccess,(function(e,t){ti(Yo)})),this.pdfViewer.addEventListener(Go.fitWidthResizeViewport,(function(){ti(Yo)})))}},{key:"start",value:function(e,t){var n=this;ti(Yo);var i=r(a(o.prototype),"start",this).call(this,e,t,"Distance");return this.pdfViewer.eventEmitter.emit(Go.distanceAnnotCreationStart,i),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Qn(n.pdfViewer),a=en(e.displayUnit.name)?n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;i.setContent(t+Math.round(100*e.distance)/100+" "+a),i.draw()})),i}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec((function(){return n.getSnappedPoint(t).then((function(i){Jo(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),n.pdfViewer.eventEmitter.emit(Go.updateDistanceAnnot,e),e.setEndPoint(i),e.draw()}))}))}},{key:"end",value:function(){var e=this;this.fakeAnnotation&&this.fakeAnnotation.annotationInfo.content&&(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.executor.waitForLastTask().then((function(){ei(e.pdfViewer).markup?(e.fakeAnnotation.annotationInfo.measure=e.getMeasurementInfo(),e.pdfViewer.eventEmitter.emit(Go.distanceAnnotCreationEnd,e.fakeAnnotation),r(a(o.prototype),"end",e).call(e)):(e.fakeAnnotation.renderer.setMarkUp(e.pageRender.scale,e.pageRender.rotate),Yo.push(e.fakeAnnotation));return Promise.resolve()})))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(ma).creatingEnd(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(Go.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),this.creatingContextmenu&&this.creatingContextmenu.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach((function(e){return e()})),ti(Yo),r(a(o.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createDistance"}}]),o}(Wi),es=function(e){l(i,e);var n=m(i);function i(e,a){var r;return t(this,i),(r=n.call(this,e,a,"create-measurement-status")).target=a,r}return i}(ga),ts=w.stateHandler.CreateMeasurementService,ns=[],is=w.ViewerEvents,as=(w.DeviceInfo.isTouchDevice,w.Consts),rs=as.LineEndingStyle,os=as.Intents,ss=as.CREATING_MEASUREMENT_CONTEXTMENU,cs=(w.shared.ThrottleAsyncTaskExecutor,function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"createInteractionTool",value:function(e){return new es(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(ts).getMeasurementInfo();return{unit:e[Uo].name,ratio:{userSpaceValue:e[Fo],userSpaceUnit:e[Ho].name,realValue:e[jo],realUnit:e[Uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polyline",os.POLYLINE_DIMENSION);return e.intent=os.POLYLINE_DIMENSION,e.startStyle=rs.OpenArrow,e.endStyle=rs.OpenArrow,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Perimeter"),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(e){var t,n,i,s,c,l=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(ss,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){l.interaction.unlock(),l.interaction.emit("end",n)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){l.interaction.unlock(),l.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var u=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,d=u.startSDKSpan,h=u.otelService;this.interaction.on("start",(function(){if(l.isEnd=!1,l.contextmenu.enable(),l.completeMenuItem.disable(),ti(ns),l.pdfViewer.eventEmitter.emit(is.perimeterAnnotCreationStart,l.fakeAnnotation),d&&d(l.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;i=t,n})),h){var e=h.startChildSpan(l.constructor.getStateName()+"Start"),t=e.end,n=e.span;s=t,n}})),this.interaction.on("end",(function(){if(h){var e=h.startChildSpan(l.constructor.getStateName()+"End"),t=e.end,n=e.span;c=t,n}null==c||c(),null==s||s(),null==i||i()})),this.interaction.on("cancel",(function(){l.contextmenu.disable()})),this.interaction.on("move",(function(e){n=e})),this.contextmenu.onHidden((function(){l.interaction.unlock()})),this.contextmenu.onShown((function(){l.interaction.lock(),l.fakeAnnotation.getVertexes().length>=3?l.completeMenuItem.enable():l.completeMenuItem.disable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(is.zoomToSuccess,(function(e){ti(ns)})),this.pdfViewer.addEventListener(is.changeViewModeSuccess,(function(e,t){ti(ns)})),this.pdfViewer.addEventListener(is.fitWidthResizeViewport,(function(){ti(ns)})))}},{key:"create",value:function(e,t){var n=this,i=r(a(o.prototype),"create",this).call(this,e,t);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Qn(n.pdfViewer),a=en(e.displayUnit.name)?n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;i.setContent(t+Math.round(100*e.perimeter)/100+" "+a),i.draw()})),i}},{key:"adjust",value:function(e,t){t=this.autoAdsorbToStartPoint(e,t)[1],e.setLastPoint(t.deviceX,t.deviceY),this.pdfViewer.eventEmitter.emit(is.updateDistanceAnnot,e),e.draw()}},{key:"canBeCompleted",value:function(e){if(!e)return!1;var t=e.getVertexes();if(0==t.length)return!1;var n=e.getLastPoint();return!(1==t.length&&n&&Math.abs(t[0].x-n.x)<Number.EPSILON&&Math.abs(t[0].y-n.y)<Number.EPSILON)}},{key:"end",value:function(e,t){if(this.fakeAnnotation){if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.fakeAnnotation.getVertexes().length<2)return-1;if(t=this.autoAdsorbToStartPoint(e,t)[1],this.isEnd=!0,this.contextmenu.disable(),ei(this.pdfViewer).markup)this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(is.distanceAnnotCreationEnd,this.fakeAnnotation),e.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,r(a(o.prototype),"end",this).call(this,e,t);else this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),ns.push(this.fakeAnnotation)}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(is.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),ti(ns),r(a(o.prototype),"destroyPageHandler",this).call(this)}},{key:"autoAdsorbToStartPoint",value:function(e,t){var n=!1,i=e.deviceVertexes;if(i.length>2){var a=i[0],r=Math.abs(t.deviceX-a.x),o=Math.abs(t.deviceY-a.y),s=Math.max(r,o);s*s<200&&(n=!0,t={deviceX:a.x,deviceY:a.y})}return[n,t]}},{key:"addPoint",value:function(e,t){var n=this.autoAdsorbToStartPoint(e,t);if(n[0])return this.interaction.cancel(),this.interaction.unlock(),this.interaction.lastMoveData=null,void this.end(e,n[1]);r(a(o.prototype),"addPoint",this).call(this,e,t)}}],[{key:"getStateName",value:function(){return"createPerimeter"}}]),o}(or)),ls=function(e){l(i,e);var n=m(i);function i(e,a){var r;return t(this,i),(r=n.call(this,e,a,"create-measurement-status")).target=a,r}return i}(ga),us=w.stateHandler.CreateMeasurementService,ds=[],hs=w.ViewerEvents,fs=w.Consts,ps=fs.Intents,vs=fs.CREATING_MEASUREMENT_CONTEXTMENU,gs=fs.DISTANCE_TOLERANCE,ms=fs.POINT_TOLERANCE;function ys(e,t){return e.x===t.x&&e.y===t.y}function Ss(e,t){return e.x*t.y-e.y*t.x}function As(e,t,n,i){var a=Ss({x:i.x-n.x,y:i.y-n.y},{x:e.x-n.x,y:e.y-n.y}),r=Ss({x:i.x-n.x,y:i.y-n.y},{x:t.x-n.x,y:t.y-n.y}),o=Ss({x:t.x-e.x,y:t.y-e.y},{x:n.x-e.x,y:n.y-e.y}),s=Ss({x:t.x-e.x,y:t.y-e.y},{x:i.x-e.x,y:i.y-e.y});return(a>0&&r<0||a<0&&r>0)&&(o>0&&s<0||o<0&&s>0)||!!(0===a&&ys(e,n)||0===r&&ys(e,i)||0===o&&ys(t,n)||0===s&&ys(t,i))}var ws=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"createInteractionTool",value:function(e){return new ls(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(us).getMeasurementInfo();return{unit:e[Uo].name,ratio:{userSpaceValue:e[Fo],userSpaceUnit:e[Ho].name,realValue:e[jo],realUnit:e[Uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polygon",ps.POLYGON_DIMENSION);return e.enableCaption=!0,e.intent=ps.POLYGON_DIMENSION,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Area"),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(e){var t,n,i,s,c,l=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[],this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(vs,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){l.interaction.unlock(),l.interaction.emit("end",n)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){l.interaction.unlock(),l.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var u=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,d=u.startSDKSpan,h=u.otelService;this.interaction.on("start",(function(){if(l.isEnd=!1,l.contextmenu.enable(),l.completeMenuItem.disable(),ti(ds),d&&d(l.constructor.getStateName()).then((function(e){var t=e.end,n=e.span;i=t,n})),h){var e=h.startChildSpan(l.constructor.getStateName()+"Start"),t=e.end,n=e.span;s=t,n}})),this.interaction.on("end",(function(){if(h){var e=h.startChildSpan(l.constructor.getStateName()+"End"),t=e.end,n=e.span;c=t,n}null==c||c(),null==s||s(),null==i||i()})),this.interaction.on("cancel",(function(){l.contextmenu.disable()})),this.interaction.on("move",(function(e){n=e,l.fakeAnnotation&&l.fakeAnnotation.renderer&&(l.fakeAnnotation.renderer.closing=!0)})),this.contextmenu.onHidden((function(){l.interaction.unlock()})),this.contextmenu.onShown((function(){l.interaction.lock(),l.fakeAnnotation.getVertexes().length>=2?l.completeMenuItem.enable():l.completeMenuItem.disable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(hs.zoomToSuccess,(function(e){ti(ds)})),this.pdfViewer.addEventListener(hs.changeViewModeSuccess,(function(e,t){ti(ds)})),this.pdfViewer.addEventListener(hs.fitWidthResizeViewport,(function(){ti(ds)})))}},{key:"create",value:function(e,t){var n=this,i=r(a(o.prototype),"create",this).call(this,e,t);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Qn(n.pdfViewer),a=n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name));i.setContent(t+Math.round(100*e.area)/100+" sq "+a),i.draw()})),i}},{key:"isPointClosely",value:function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}},{key:"pointDistance",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,a=Math.abs(n),r=Math.abs(i);return Math.sqrt(a*a+r*r)}},{key:"isPointOnLine",value:function(e,t,n){if(this.isPointClosely(e,t,Number.EPSILON)||this.isPointClosely(e,n,Number.EPSILON))return!0;var i=this.pointDistance(e,t),a=this.pointDistance(e,n),r=this.pointDistance(t,n);return Math.abs(i+a-r)<ms}},{key:"checkLineCrossed",value:function(e,t,n,i){var a,r;if(a=Math.abs(t.x-e.x)<1e-4?Number.POSITIVE_INFINITY:(t.y-e.y)/(t.x-e.x),r=Math.abs(i.x-n.x)<1e-4?Number.POSITIVE_INFINITY:(i.y-n.y)/(i.x-n.x),Number.isFinite(a)&&Number.isFinite(r)&&Math.abs(a-r)<.01||!Number.isFinite(a)&&!Number.isFinite(r))return!(!this.isPointOnLine(e,n,i)&&!this.isPointOnLine(t,n,i));var o,s,c=e.x>t.x?t.x:e.x,l=e.x>t.x?e.x:t.x,u=n.x>i.x?i.x:n.x,d=n.x>i.x?n.x:i.x;if(Number.isFinite(a)){if(Number.isFinite(r))return!((o=(a*e.x-e.y-r*n.x+n.y)/(a-r))<c-ms||o>l+ms)&&(!(o<u-ms||o>d+ms)&&(s=a*(o-e.x)+e.y,!0));s=a*((o=u)-e.x)+e.y;var h=n.y<i.y?n.y:i.y,f=n.y<i.y?i.y:n.y;return h-ms<=s&&s<=f+ms&&c-ms<=o&&o<=l+ms}s=r*((o=c)-n.x)+n.y;var p=e.y<t.y?e.y:t.y,v=e.y<t.y?t.y:e.y;return p-ms<=s&&s<=v+ms&&u-ms<=o&&o<=d+ms}},{key:"checkIfPointAllowAdded",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<1&&!n)return!0;if(2==e.length&&!n)return!this.isPointOnLine(t,e[0],e[1]);var i=function(e,t){for(var n=0;n<e.length-2;n++)if(As(e[n],e[(n+1)%e.length],t,e[e.length-1]))return"disableAdd";for(var i=1;i<e.length-1;i++)if(As(e[i],e[(i+1)%e.length],t,e[0]))return"noClosing";return"success"}(e,t);return"success"==i?(this.fakeAnnotation.setFlag(!0,!0),!0):"noClosing"==i&&!n&&(this.fakeAnnotation.setFlag(!1,!1),!0)}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY,a=A(e.page.reverseDevicePoint([n,i],e.scale,e.rotate),2),r=a[0],o=a[1],s=this.pageRender.$handler;if(this.checkIfPointAllowAdded(e.getVertexes(),{x:r,y:o})){s.removeClass("fv__cursor-disable");var c=e.getVertexes();if(c.length>2&&this.isPointClosely(c[0],{x:r,y:o},gs)){var l=c[c.length-1],u=A(e.page.getDevicePoint([l.x,l.y],e.scale,e.rotate),2),d=u[0],h=u[1],f=e.pageRender.$handler[0].getBoundingClientRect();return this.interaction.lastMoveData={clientX:d+f.left,clientY:h+f.top},void this.pdfViewer.getStore().dispatch("create-measurement-status","complete")}e.addPoint(n,i),e.draw()}else s.addClass("fv__cursor-disable")}},{key:"adjust",value:function(e,t){var n=A(e.page.reverseDevicePoint([t.deviceX,t.deviceY],e.scale,e.rotate),2),i=n[0],a=n[1],r=this.pageRender.$handler;this.checkIfPointAllowAdded(e.getVertexes(),{x:i,y:a})?(r.removeClass("fv__cursor-disable"),e.setLastPoint(t.deviceX,t.deviceY),e.draw(),this.pdfViewer.eventEmitter.emit(hs.updateDistanceAnnot,e)):r.addClass("fv__cursor-disable")}},{key:"end",value:function(e,t){if(this.fakeAnnotation){this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData();var n=Ma(e.getVertexes()).slice(0);if(0!=n.length){if(null!=t){var i=A(e.page.reverseDevicePoint([t.deviceX,t.deviceY],e.scale,e.rotate),2),s=i[0],c=i[1];if(this.isPointClosely(n[n.length-1],{x:s,y:c},gs))t=null;else{var l=this.pageRender.$handler;if(!this.checkIfPointAllowAdded(n,{x:s,y:c},!0))return l.addClass("fv__cursor-disable"),-1;l.removeClass("fv__cursor-disable"),n.push({x:s,y:c})}}if(this.isEnd=!0,this.contextmenu.disable(),ei(this.pdfViewer).markup){this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(hs.distanceAnnotCreationEnd,this.fakeAnnotation);var u=this.pdfViewer.getStore().getCurrentValue("measurementData");if(u){var d=Qn(this.pdfViewer),h=this.pdfViewer.i18n.t("measurement.units.".concat(u.displayUnit.name));e.setContent(d+Math.round(100*u.area)/100+" sq "+h)}e.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,r(a(o.prototype),"end",this).call(this,e,t)}else{this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),ds.push(this.fakeAnnotation)}}}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(hs.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),ti(ds),r(a(o.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createArea"}}]),o}(Ja),Es=w.stateHandler.CreateMeasurementService,bs=[],ks=w.ViewerEvents,Rs=w.Consts.Intents,Ts=function(e){l(o,e);var n=m(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"start",value:function(e){var t=this,n={flags:4,subject:this.getSubject()};this.currentFakeAnnot=new ai({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson(n)});var i=e.left,a=e.top;this.currentFakeAnnot.setRect({left:i,top:a,right:i+10,bottom:a-10}),this.pdfViewer.eventEmitter.emit(ks.distanceAnnotCreationStart,this.currentFakeAnnot),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var n=Qn(t.pdfViewer),i=e.displayUnit,a=e.area,r=e.embeddedScale,o=i&&en(i.name)?t.pdfViewer.i18n.t("measurement.units.".concat(i.name)):i.name;a&&t.currentFakeAnnot.setContent(n+a.toFixed(2)+" sq "+o),r?t.pageMeasureRatio=r:delete t.pageMeasureRatio,t.currentFakeAnnot.draw()})),ti(bs)}},{key:"adjust",value:function(e,t,n){r(a(o.prototype),"adjust",this).call(this,e,t,n),this.pdfViewer.eventEmitter.emit(ks.updateDistanceAnnot,e)}},{key:"end",value:function(e,t,n){if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),ei(this.pdfViewer).markup){if(e.annotationInfo.measure=this.getMeasurementInfo(),this.pageMeasureRatio){var i=this.pageMeasureRatio.split(" = ").map((function(e){var t=e.split(" ");return{value:t[0],unit:t[1]}}));i.length<2||(e.annotationInfo.measure=Object.assign({},e.annotationInfo.measure,{ratio:{userSpaceValue:Number(i[0].value),realValue:Number(i[1].value),userSpaceUnit:i[0].unit,realUnit:i[1].unit}}))}this.pdfViewer.eventEmitter.emit(ks.distanceAnnotCreationEnd,e),r(a(o.prototype),"end",this).call(this,e,t,n)}else bs.push(e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(Es).getMeasurementInfo();return{unit:e[Uo].name,ratio:{userSpaceValue:e[Fo],userSpaceUnit:e[Ho].name,realValue:e[jo],realUnit:e[Uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("circle",Rs.CIRCLE_DIMENSION);return e.enableCaption=!0,e.intent=Rs.CIRCLE_DIMENSION,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(e){r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[],this.destroyPageHooks.push(this.pdfViewer.addEventListener(ks.zoomToSuccess,(function(e){ti(bs)})),this.pdfViewer.addEventListener(ks.changeViewModeSuccess,(function(e,t){ti(bs)})),this.pdfViewer.addEventListener(ks.fitWidthResizeViewport,(function(){ti(bs)})))}},{key:"destroyPageHandler",value:function(){r(a(o.prototype),"destroyPageHandler",this).call(this),ti(bs)}}],[{key:"getStateName",value:function(){return"createCircleArea"}}]),o}(mi),xs=function(){function e(){t(this,e),Ke(this,"pdfViewer",void 0)}return i(e,[{key:"getInternalStampService",value:function(){var e;return null===(e=this.pdfViewer)||void 0===e?void 0:e.getIoC().getInstanceByClass(ho)}},{key:"getCurrentStampInfo",value:function(){if(this.pdfViewer.getStateHandlerManager().getCurrentStates()===bo){var e=this.getInternalStampService().getCurrentStampConfig();return e?{category:e.category,iconName:e.name,width:e.width,height:e.height,url:e.url,fileType:e.fileType}:void 0}}},{key:"onSelectStampInfo",value:function(e){var t=this;return this.getInternalStampService().onSwitchStamp((function(){e(t.getCurrentStampInfo())}))}},{key:"onCustomStampUpdated",value:function(e){return this.getInternalStampService().onCustomStampUpdated((function(t){var n=Object.keys(t).map((function(e){return Object.keys(t[e]).map((function(n){var i=t[e][n];return Array.isArray(i)?i.map((function(t){return Yn({category:e,iconName:n},t)})):(0,xe.isPlainObject)(i)?[Yn({category:e,iconName:n},i)]:[]}))})).flat().flat();e(n)}))}}],[{key:"inject",value:function(){return{pdfViewer:w.PDFViewer}}}]),e}(),Cs=function(){function e(n){t(this,e),this.pdfViewer=n}return i(e,[{key:"getStampService",value:function(){return this.pdfViewer.getIoC().getInstanceByClass(xs)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showReplyDialog,n=e.hideReplyDialog,i=e.showPopup,a=e.hidePopup,r=e.showPropertiesDialog,o=e.hidePropertiesDialog,s=e.contextMenuIsEnable,c=this.pdfViewer.getStateHandlerManager();c.register(I),c.register(W),c.register(z),c.register(K),c.register(J),c.register(ne),c.register(ye),c.register(vt),c.register(Tt),c.register(Mt),c.register(vi),c.register(mi),c.register(Wi),c.register(Ki),c.register(Ja),c.register(or),c.register(mr),c.register(Rr),c.register(Br),c.register(ao),c.register(bo),c.register(Vo),c.register(Qo),c.register(cs),c.register(ws),c.register(Ts),(t||n||i||a||r||o||s)&&this._overwriteAnnot(t,n,i,a,r,o,s)}},{key:"_overwriteAnnot",value:function(e,n,o,s,c,u,d){this.pdfViewer.getAnnotManager().registerMatchRule((function(h,p){return h.isMarkup()?function(h){l(v,h);var p=m(v);function v(){return t(this,v),p.apply(this,arguments)}return i(v,[{key:"showReplyDialog",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o;return e?e.bind(this).apply(this,f(n)):(o=r(a(v.prototype),"showReplyDialog",this)).call.apply(o,[this].concat(f(n)))}},{key:"hideReplyDialog",value:function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];if(!n){var s;if(e)return;return(s=r(a(v.prototype),"hideReplyDialog",this)).call.apply(s,[this].concat(f(i)))}return n.bind(this).apply(this,f(i))}},{key:"showPopup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return o?o.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"showPopup",this)).call.apply(i,[this].concat(f(t)))}},{key:"hidePopup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!s){var i;if(o)return;return(i=r(a(v.prototype),"hidePopup",this)).call.apply(i,[this].concat(f(t)))}return s.bind(this).apply(this,f(t))}},{key:"showPropertiesDialog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return c?c.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"showPropertiesDialog",this)).call.apply(i,[this].concat(f(t)))}},{key:"hidePropertiesDialog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!u){var i;if(c)return;return(i=r(a(v.prototype),"hidePropertiesDialog",this)).call.apply(i,[this].concat(f(t)))}return u.bind(this).apply(this,f(t))}},{key:"contextMenuIsEnable",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return d?d.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"contextMenuIsEnable",this)).call.apply(i,[this].concat(f(t)))}}]),v}(p):p}))}}]),e}()})(),s})()));