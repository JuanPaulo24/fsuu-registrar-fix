!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.FormToSheetUIXAddon=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons):e.FormToSheetUIXAddon=t(e.UIExtension,e.UIExtension.PDFViewCtrl.commons)}(self,((e,t)=>(()=>{var n={737:e=>{e.exports=null},616:t=>{"use strict";t.exports=e},732:e=>{"use strict";e.exports=t}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var i=o[e]={exports:{}};return n[e](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function l(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function f(e){var t=u();return function(){var n,o=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return l(this,n)}}r.d(i,{default:()=>O});var d=r(616),p=r(737),h=r.n(p);function m(e,t,n){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n||e):r.value}},m(e,t,n||e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i=[],c=!0,s=!1;try{for(n=n.call(e);!(c=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=d.PDFViewCtrl.Events,P=d.PDFViewCtrl.Consts.PDFDocPermission,D=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e.getUserPermission().getValue()}));Promise.all([e.hasForm(),n]).then((function(e){var n=g(e,2);n[0];n[1]&t.constructor.permission?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"mounted",value:function(){var e=this;m(a(r.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(y.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(y.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(y.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(y.flattenAnnotation,(function(t,n){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})))}}],[{key:"getName",value:function(){return"FormToSheetController"}},{key:"permission",get:function(){return P.Extract}}]),r}(d.Controller);function b(e,t,n,o,r,i,c){try{var s=e[i](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(o,r)}function F(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,o=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){c=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){c.label=s[1];break}if(6===s[0]&&c.label<r[1]){c.label=r[1],r=s;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(s);break}r[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var w=r(732),k=PDFViewCtrl.KeyboardUtils,U=k.isMatch,I=k.matchers,x=d.PDFViewCtrl.shared.download,E=d.PDFViewCtrl.Events,C=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e&&e.getUserPermission()}));Promise.all([e&&!e.isDestroyed&&e.hasForm(),n]).then((function(e){var n=g(e,2),o=n[0],r=n[1],i=r&&r.checkModify(),c=r&&r.checkAnnotForm();o&&i&&c?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"handle",value:function(e){var t,n=this;return(t=function(){var t,o,r,i;return F(this,(function(c){switch(c.label){case 0:return[4,n.getPDFUI().getCurrentPDFDoc()];case 1:return[4,c.sent().form.exportToFile(w.FileFormat.csv)];case 2:return t=c.sent(),o=new FileReader,[4,new Promise((function(t){o.onloadend=function(){return t(o.result)},o.readAsText(e.slice(0))}))];case 3:return r=c.sent(),i=new Blob(["\ufeff"===r?"":"\ufeff",e,t],{type:"text/csv,charset=UTF-8-sig"}),x(i,e.name,i.type),[2]}}))},function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function c(e){b(i,o,r,c,s,"next",e)}function s(e){b(i,o,r,c,s,"throw",e)}c(void 0)}))})()}},{key:"mounted",value:function(){var e=this;m(a(r.prototype),"mounted",this).call(this);var t=this.component.element;t.classList.remove("fv__ui-button"),t.querySelector(".fv__ui-button-text").classList.remove("fv__ui-button-text"),this.addDestroyHook(this.getPDFUI().addViewerEventListener(E.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(E.formReloaded,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(E.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(E.flattenAnnotation,(function(t,n){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(E.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.component.element.addEventListener("keydown",(function(t){var n=I.or,o=I.Enter,r=I.Space;U(t,n(o,r))&&e.component.parent.deactive()}))}}],[{key:"getName",value:function(){return"AppendSheetController"}}]),r}(d.Controller),S=d.PDFViewCtrl.Events,_=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e&&e.getUserPermission()}));Promise.all([e&&!e.isDestroyed&&e.hasForm(),n]).then((function(e){var n=g(e,2),o=n[0],r=n[1],i=r&&r.checkModify(),c=r&&r.checkAnnotForm();o&&i&&c?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"mounted",value:function(){var e=this;m(a(r.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(S.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(S.formReloaded,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(S.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(S.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(S.flattenAnnotation,(function(t,n){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})))}}],[{key:"getName",value:function(){return"FormToSheetDropdownController"}}]),r}(d.Controller),V=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,null,[{key:"getName",value:function(){return"form-to-sheet-ribbon-dropdown"}}]),r}(d.SeniorComponentFactory.createSuperClass({template:'\n    <ribbon-button @tooltip tooltip-title="form-to-sheet:button-tooltip.title" @controller="form-to-sheet-module:FormToSheetDropdownController" name="form-to-sheet" @var.self="$component"  not-immediately="true">\n        <dropdown icon-class="fv__icon-toolbar-form-to-sheet" separate="false" selected="0" @on.selected="self.select($args[0])" @cannotBeDisabled>\n            <file-selector ribbon-text="form-to-sheet:ribbon.text" ribbon-icon="fx-icon-ribbon_form_append_to_an_existing_sheet-32" @controller="form-to-sheet-module:AppendSheetController" name="append-to-sheet" icon-class="fx-icon-sm fv__icon-toolbar-append-to-sheet"  accept=".csv" >\n                form-to-sheet:export.existing\n            </file-selector>\n        </dropdown>\n    </ribbon-button>\n    '})),R=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,null,[{key:"getName",value:function(){return"form-to-sheet-dropdown"}}]),r}(d.SeniorComponentFactory.createSuperClass({template:'\n        <dropdown @tooltip @controller="form-to-sheet-module:FormToSheetController" name="form-to-sheet"  icon-class="fv__icon-toolbar-form-to-sheet" tooltip-title="form-to-sheet:button-tooltip.title" separate="false" selectable="false">\n            <file-selector @controller="form-to-sheet-module:AppendSheetController" name="append-to-sheet" icon-class="fv__icon-toolbar-append-to-sheet"  accept=".csv" @cannotBeDisabled>\n                form-to-sheet:export.existing\n            </file-selector>\n        </dropdown>\n    '})),O=function(e){s(r,e);var n=f(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"formToSheet"}},{key:"getLoader",value:function(){return h()}},{key:"initOnLoad",value:function(){var e=d.modular.module("form-to-sheet-module",[]);e.registerComponent(R),e.registerComponent(V),e.registerController(D),e.registerController(C),e.registerController(_)}}]),r}(d.UIXAddon)})(),i=i.default})()));