!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension"),require("UIExtension").PDFViewCtrl.PDF.actions,require("UIExtension").PDFViewCtrl.commons):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","PDF","actions"],["UIExtension","PDFViewCtrl","commons"]],e):"object"==typeof exports?exports.UndoRedoAddon=e(require("UIExtension"),require("UIExtension").PDFViewCtrl.PDF.actions,require("UIExtension").PDFViewCtrl.commons):t.UndoRedoAddon=e(t.UIExtension,t.UIExtension.PDFViewCtrl.PDF.actions,t.UIExtension.PDFViewCtrl.commons)}(self,((t,e,n)=>(()=>{var r={1843:t=>{t.exports=null},8552:(t,e,n)=>{var r=n(852)(n(5639),"DataView");t.exports=r},1989:(t,e,n)=>{var r=n(1789),o=n(401),i=n(7667),a=n(1327),u=n(1866);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},8407:(t,e,n)=>{var r=n(7040),o=n(4125),i=n(2117),a=n(7518),u=n(4705);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},7071:(t,e,n)=>{var r=n(852)(n(5639),"Map");t.exports=r},3369:(t,e,n)=>{var r=n(4785),o=n(1285),i=n(6e3),a=n(9916),u=n(5265);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},3818:(t,e,n)=>{var r=n(852)(n(5639),"Promise");t.exports=r},8525:(t,e,n)=>{var r=n(852)(n(5639),"Set");t.exports=r},6384:(t,e,n)=>{var r=n(8407),o=n(7465),i=n(3779),a=n(7599),u=n(4758),c=n(4309);function s(t){var e=this.__data__=new r(t);this.size=e.size}s.prototype.clear=o,s.prototype.delete=i,s.prototype.get=a,s.prototype.has=u,s.prototype.set=c,t.exports=s},2705:(t,e,n)=>{var r=n(5639).Symbol;t.exports=r},1149:(t,e,n)=>{var r=n(5639).Uint8Array;t.exports=r},577:(t,e,n)=>{var r=n(852)(n(5639),"WeakMap");t.exports=r},7412:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},4963:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}},4636:(t,e,n)=>{var r=n(2545),o=n(5694),i=n(1469),a=n(4144),u=n(5776),c=n(6719),s=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),l=!n&&o(t),f=!n&&!l&&a(t),d=!n&&!l&&!f&&c(t),h=n||l||f||d,p=h?r(t.length,String):[],v=p.length;for(var y in t)!e&&!s.call(t,y)||h&&("length"==y||f&&("offset"==y||"parent"==y)||d&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||p.push(y);return p}},2488:t=>{t.exports=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}},4865:(t,e,n)=>{var r=n(9465),o=n(7813),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];i.call(t,e)&&o(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},8470:(t,e,n)=>{var r=n(7813);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},4037:(t,e,n)=>{var r=n(8363),o=n(3674);t.exports=function(t,e){return t&&r(e,o(e),t)}},3886:(t,e,n)=>{var r=n(8363),o=n(1704);t.exports=function(t,e){return t&&r(e,o(e),t)}},9465:(t,e,n)=>{var r=n(8777);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},5990:(t,e,n)=>{var r=n(6384),o=n(7412),i=n(4865),a=n(4037),u=n(3886),c=n(4626),s=n(278),l=n(8805),f=n(1911),d=n(8234),h=n(6904),p=n(4160),v=n(3824),y=n(9148),E=n(8517),g=n(1469),A=n(4144),T=n(6688),m=n(3218),S=n(2928),k=n(3674),b=n(1704),O="[object Arguments]",w="[object Function]",N="[object Object]",R={};R[O]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object DataView]"]=R["[object Boolean]"]=R["[object Date]"]=R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Map]"]=R["[object Number]"]=R[N]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object Symbol]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Error]"]=R[w]=R["[object WeakMap]"]=!1,t.exports=function t(e,n,I,_,C,P){var D,L=1&n,j=2&n,x=4&n;if(I&&(D=C?I(e,_,C,P):I(e)),void 0!==D)return D;if(!m(e))return e;var V=g(e);if(V){if(D=v(e),!L)return s(e,D)}else{var U=p(e),F=U==w||"[object GeneratorFunction]"==U;if(A(e))return c(e,L);if(U==N||U==O||F&&!C){if(D=j||F?{}:E(e),!L)return j?f(e,u(D,e)):l(e,a(D,e))}else{if(!R[U])return C?e:{};D=y(e,U,L)}}P||(P=new r);var M=P.get(e);if(M)return M;P.set(e,D),S(e)?e.forEach((function(r){D.add(t(r,n,I,r,e,P))})):T(e)&&e.forEach((function(r,o){D.set(o,t(r,n,I,o,e,P))}));var B=V?void 0:(x?j?h:d:j?b:k)(e);return o(B||e,(function(r,o){B&&(r=e[o=r]),i(D,o,t(r,n,I,o,e,P))})),D}},3118:(t,e,n)=>{var r=n(3218),o=Object.create,i=function(){function t(){}return function(e){if(!r(e))return{};if(o)return o(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=i},8866:(t,e,n)=>{var r=n(2488),o=n(1469);t.exports=function(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}},4239:(t,e,n)=>{var r=n(2705),o=n(9607),i=n(2333),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?o(t):i(t)}},9454:(t,e,n)=>{var r=n(4239),o=n(7005);t.exports=function(t){return o(t)&&"[object Arguments]"==r(t)}},5588:(t,e,n)=>{var r=n(4160),o=n(7005);t.exports=function(t){return o(t)&&"[object Map]"==r(t)}},8458:(t,e,n)=>{var r=n(3560),o=n(5346),i=n(3218),a=n(346),u=/^\[object .+?Constructor\]$/,c=Function.prototype,s=Object.prototype,l=c.toString,f=s.hasOwnProperty,d=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(r(t)?d:u).test(a(t))}},9221:(t,e,n)=>{var r=n(4160),o=n(7005);t.exports=function(t){return o(t)&&"[object Set]"==r(t)}},8749:(t,e,n)=>{var r=n(4239),o=n(1780),i=n(7005),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[r(t)]}},280:(t,e,n)=>{var r=n(5726),o=n(6916),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},313:(t,e,n)=>{var r=n(3218),o=n(5726),i=n(3498),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=o(t),n=[];for(var u in t)("constructor"!=u||!e&&a.call(t,u))&&n.push(u);return n}},2545:t=>{t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},1717:t=>{t.exports=function(t){return function(e){return t(e)}}},4318:(t,e,n)=>{var r=n(1149);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},4626:(t,e,n)=>{t=n.nmd(t);var r=n(5639),o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}},7157:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},3147:t=>{var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},419:(t,e,n)=>{var r=n(2705),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},7133:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},278:t=>{t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},8363:(t,e,n)=>{var r=n(4865),o=n(9465);t.exports=function(t,e,n,i){var a=!n;n||(n={});for(var u=-1,c=e.length;++u<c;){var s=e[u],l=i?i(n[s],t[s],s,n,t):void 0;void 0===l&&(l=t[s]),a?o(n,s,l):r(n,s,l)}return n}},8805:(t,e,n)=>{var r=n(8363),o=n(9551);t.exports=function(t,e){return r(t,o(t),e)}},1911:(t,e,n)=>{var r=n(8363),o=n(1442);t.exports=function(t,e){return r(t,o(t),e)}},4429:(t,e,n)=>{var r=n(5639)["__core-js_shared__"];t.exports=r},8777:(t,e,n)=>{var r=n(852),o=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},1957:(t,e,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},8234:(t,e,n)=>{var r=n(8866),o=n(9551),i=n(3674);t.exports=function(t){return r(t,i,o)}},6904:(t,e,n)=>{var r=n(8866),o=n(1442),i=n(1704);t.exports=function(t){return r(t,i,o)}},5050:(t,e,n)=>{var r=n(7019);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},852:(t,e,n)=>{var r=n(8458),o=n(7801);t.exports=function(t,e){var n=o(t,e);return r(n)?n:void 0}},5924:(t,e,n)=>{var r=n(5569)(Object.getPrototypeOf,Object);t.exports=r},9607:(t,e,n)=>{var r=n(2705),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}},9551:(t,e,n)=>{var r=n(4963),o=n(479),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(t){return null==t?[]:(t=Object(t),r(a(t),(function(e){return i.call(t,e)})))}:o;t.exports=u},1442:(t,e,n)=>{var r=n(2488),o=n(5924),i=n(9551),a=n(479),u=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,i(t)),t=o(t);return e}:a;t.exports=u},4160:(t,e,n)=>{var r=n(8552),o=n(7071),i=n(3818),a=n(8525),u=n(577),c=n(4239),s=n(346),l="[object Map]",f="[object Promise]",d="[object Set]",h="[object WeakMap]",p="[object DataView]",v=s(r),y=s(o),E=s(i),g=s(a),A=s(u),T=c;(r&&T(new r(new ArrayBuffer(1)))!=p||o&&T(new o)!=l||i&&T(i.resolve())!=f||a&&T(new a)!=d||u&&T(new u)!=h)&&(T=function(t){var e=c(t),n="[object Object]"==e?t.constructor:void 0,r=n?s(n):"";if(r)switch(r){case v:return p;case y:return l;case E:return f;case g:return d;case A:return h}return e}),t.exports=T},7801:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},1789:(t,e,n)=>{var r=n(4536);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},401:t=>{t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},7667:(t,e,n)=>{var r=n(4536),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(e,t)?e[t]:void 0}},1327:(t,e,n)=>{var r=n(4536),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}},1866:(t,e,n)=>{var r=n(4536);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},3824:t=>{var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},9148:(t,e,n)=>{var r=n(4318),o=n(7157),i=n(3147),a=n(419),u=n(7133);t.exports=function(t,e,n){var c=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return o(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return u(t,n);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return i(t);case"[object Symbol]":return a(t)}}},8517:(t,e,n)=>{var r=n(3118),o=n(5924),i=n(5726);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:r(o(t))}},5776:t=>{var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},7019:t=>{t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},5346:(t,e,n)=>{var r,o=n(4429),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!i&&i in t}},5726:t=>{var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},7040:t=>{t.exports=function(){this.__data__=[],this.size=0}},4125:(t,e,n)=>{var r=n(8470),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)}},2117:(t,e,n)=>{var r=n(8470);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},7518:(t,e,n)=>{var r=n(8470);t.exports=function(t){return r(this.__data__,t)>-1}},4705:(t,e,n)=>{var r=n(8470);t.exports=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}},4785:(t,e,n)=>{var r=n(1989),o=n(8407),i=n(7071);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},1285:(t,e,n)=>{var r=n(5050);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},6e3:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).get(t)}},9916:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).has(t)}},5265:(t,e,n)=>{var r=n(5050);t.exports=function(t,e){var n=r(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}},4536:(t,e,n)=>{var r=n(852)(Object,"create");t.exports=r},6916:(t,e,n)=>{var r=n(5569)(Object.keys,Object);t.exports=r},3498:t=>{t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},1167:(t,e,n)=>{t=n.nmd(t);var r=n(1957),o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},5569:t=>{t.exports=function(t,e){return function(n){return t(e(n))}}},5639:(t,e,n)=>{var r=n(1957),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},7465:(t,e,n)=>{var r=n(8407);t.exports=function(){this.__data__=new r,this.size=0}},3779:t=>{t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},7599:t=>{t.exports=function(t){return this.__data__.get(t)}},4758:t=>{t.exports=function(t){return this.__data__.has(t)}},4309:(t,e,n)=>{var r=n(8407),o=n(7071),i=n(3369);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!o||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new i(a)}return n.set(t,e),this.size=n.size,this}},346:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},361:(t,e,n)=>{var r=n(5990);t.exports=function(t){return r(t,5)}},7813:t=>{t.exports=function(t,e){return t===e||t!=t&&e!=e}},5694:(t,e,n)=>{var r=n(9454),o=n(7005),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(t){return o(t)&&a.call(t,"callee")&&!u.call(t,"callee")};t.exports=c},1469:t=>{var e=Array.isArray;t.exports=e},8612:(t,e,n)=>{var r=n(3560),o=n(1780);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},4144:(t,e,n)=>{t=n.nmd(t);var r=n(5639),o=n(5062),i=e&&!e.nodeType&&e,a=i&&t&&!t.nodeType&&t,u=a&&a.exports===i?r.Buffer:void 0,c=(u?u.isBuffer:void 0)||o;t.exports=c},3560:(t,e,n)=>{var r=n(4239),o=n(3218);t.exports=function(t){if(!o(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},1780:t=>{t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},6688:(t,e,n)=>{var r=n(5588),o=n(1717),i=n(1167),a=i&&i.isMap,u=a?o(a):r;t.exports=u},3218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},7005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},2928:(t,e,n)=>{var r=n(9221),o=n(1717),i=n(1167),a=i&&i.isSet,u=a?o(a):r;t.exports=u},6719:(t,e,n)=>{var r=n(8749),o=n(1717),i=n(1167),a=i&&i.isTypedArray,u=a?o(a):r;t.exports=u},3674:(t,e,n)=>{var r=n(4636),o=n(280),i=n(8612);t.exports=function(t){return i(t)?r(t):o(t)}},1704:(t,e,n)=>{var r=n(4636),o=n(313),i=n(8612);t.exports=function(t){return i(t)?r(t,!0):o(t)}},479:t=>{t.exports=function(){return[]}},5062:t=>{t.exports=function(){return!1}},4616:e=>{"use strict";e.exports=t},2459:t=>{"use strict";t.exports=e},732:t=>{"use strict";t.exports=n}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={id:t,loaded:!1,exports:{}};return r[t](n,n.exports,i),n.loaded=!0,n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var a={};return(()=>{"use strict";function t(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):t(e,n)}function e(e,n){if(!t(e,n))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function o(t){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},o(t)}function u(t,e,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n||t):i.value}},u(t,e,n||t)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function d(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(h=function(){return!!t})()}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function y(t){var e=h();return function(){var n,r=o(t);if(e){var i=o(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?p(t):e}(this,n)}}i.d(a,{default:()=>Te});var E=i(4616);function g(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function A(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){g(i,r,o,a,u,"next",t)}function u(t){g(i,r,o,a,u,"throw",t)}a(void 0)}))}}function T(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var m={SETTITLE:"ANNOTATIONSETTITLE",SETSUBJECT:"ANNOTATIONSETSUBJECT",SETCOLOR:"ANNOTATIONSETCOLOR",SETOPACITY:"ANNOTATIONSETOPACITY",SETFILLCOLOR:"ANNOTATIONSETFILLCOLOR",SETBORDERWIDTH:"ANNOTATIONSETBORDERWIDTH",SETBORDERSTYLE:"ANNOTATIONSETBORDERSTYLE",SETBORDERINFO:"ANNOTATIONSETBORDERINFO",SETENDINGSTYLE:"ANNOTATIONSETENDINGSTYLE",ENABLECAPTION:"ANNOTATIONENABLECAPTION",SETROTATION:"ANNOTATIONSETROTATION",SETHIGHLIGHTINGMODE:"ANNOTATIONSETHIGHLIGHTINGMODE",REMOVEANNOT:"REMOVEANNOT",ADDANNOT:"ADDANNOT",SETRECT:"ANNOTATIONSETRECT",MOVETO:"ANNOTATION_MOVE_TO",ANNOT_SET_RECT:"ANNOTATION_SET_RECT",UPDATEQUADPOINTSBYCHARINDEX:"UPDATEQUADPOINTSBYCHARINDEX",UPDATECALLOUTPOINTS:"ANNOTATIONUPDATECALLOUTPOINTS",UPDATELINEPOINTS:"ANNOTATIONUPDATELINEPOINTS",SETLEADERLINELENGTH:"ANNOTATIONSETLEADERLINELENGTH",UPDATEVERTEXES:"ANNOTATIONUPDATEVERTEXES",SETCONTENT:"ANNOTATIONSETCONTENT",PLACEREDACT:"ANNOTATIONPLACEREDACT",ADDREPLY:"ANNOTATIONADDREPLY",DELETEREPLY:"ANNOTATIONDELETEREPLY",ADDACTION:"ANNOTATIONADDACTION",REMOVEACTION:"ANNOTATIONREMOVEACTION",MOVEACTION:"ANNOTATIONMOVEACTION",UPDATEACTION:"ANNOTATIONUPDATEACTION",ERASER:"ANNOTATIONERASER",MARKREDACTANNOT:"ANNOTATIONMARKREDACTANNOT",MAKEREDACTBYPAGES:"ANNOTATIONMAKEREDACTBYPAGES",MARKCHECKEDRESULTREDACTION:"MARKCHECKEDRESULTREDACTION",ADDREVIEWSTATE:"ADDREVIEWSTATE",ADD_MARKED_STATE:"ADD_MARKED_STATE",DEFAULTAP:"DEFAULTAP",moveAnnotsCrossPage:"moveAnnotsCrossPage",UPDATECAPTIONOFFSET:"ANNOTATIONUPDATECAPTIONOFFSET",Group:"Group",FlipPoint:"FlipPoint",SETICONNAME:"SETICONNAME",FLAG:"FLAG",SET_MEASUREMENT_RATIO:"ANNOTATION_SET_MEASUREMENT_RATIO",SET_MEASUREMENT_UNIT:"ANNOTATION_SET_MEASUREMENT_UNIT",SET_MEASURE_CONVERSION_FACTOR:"ANNOTATION_SET_MEASURE_CONVERSION_FACTOR",SET_CAPTION_COLOR:"ANNOTATION_SET_CAPTION_COLOR",SET_END_POINT:"ANNOTATION_SET_END_POINT",SET_START_POINT:"ANNOTATION_SET_START_POINT",SET_STYLE_FILL_COLOR:"ANNOTATION_SET_STYLE_FILL_COLOR",SET_LEADER_LINE_EXTEND:"ANNOTATION_SET_LEADER_LINE_EXTEND",SET_LEADER_LINE_OFFSET:"ANNOTATION_SET_LEADER_LINE_OFFSET",SET_LEADER_LINE_LENGTH:"ANNOTATION_SET_LEADER_LINE_LENGTH",SET_CAPTION_OFFSET:"ANNOTATION_SET_CAPTION_OFFSET",SET_VERTEXES:"ANNOTATION_SET_VERTEXES",SET_ALIGNMENT:"ANNOTATION_SET_ALIGNMENT",SET_INNER_RECT:"ANNOTATION_SET_INNER_RECT",SET_CALLOUT_LINE_ENDING_STYLE:"ANNOTATION_SET_CALLOUT_LINE_ENDING_STYLE",SET_DEFAULT_APPEARANCE:"FREETEXT_SET_DEFAULT_APPEARANCE",SET_INK_LIST:"ANNOTATION_SET_INK_LIST",SET_OVERLAY_TEXT:"REDACT_SET_OVERLAY_TEXT",REMOVE_OVERLAY_TEXT:"REDACT_REMOVE_OVERLAY_TEXT",SET_OVERLAY_TEXT_ALIGNMENT:"REDACT_REMOVE_OVERLAY_TEXT_ALIGNMENT",SET_REPEAT:"REDACT_SET_REPEAT",SET_AUTO_FONT_SIZE:"REDACT_SET_AUTO_FONT_SIZE",SET_REDACT_APPLY_FILL_COLOR:"REDACT_SET_REDACT_APPLY_FILL_COLOR",SET_IMAGE:"SCREEN_OR_STAMP_SET_IMAGE",CHANGE_ANNOT_ORDER:"CHANGE_ANNOT_ORDER"},S="ADD",k="REMOVE",b=function(){function t(n){e(this,t),this.action=n,this.json={};var r=n.type;this[r]&&this[r]()}return r(t,[{key:"TypeGoto",value:function(){var t=this.action.destination;this.json=Object.assign(t,{type:t.zoomMode})}},{key:"TypeURI",value:function(){var t=this.action.uri;this.json=Object.assign({},{uri:t})}},{key:"TypeJavaScript",value:function(){var t=this.action.javascript;this.json=Object.assign({},{script:t})}},{key:"TypeNamed",value:function(){var t=this.action.name;this.json=Object.assign({},{name:t})}},{key:"TypeHide",value:function(){var t=this.action,e=t.fieldNames,n=t.hideState;this.json=Object.assign({},{fieldNames:e,hideState:n})}},{key:"TypeSubmitForm",value:function(){var t=this.action,e=t.flags,n=t.url,r=t.fieldNames;this.json=Object.assign({},{flags:e,url:n,fieldNames:r})}},{key:"TypeResetForm",value:function(){var t=this.action,e=t.flags,n=t.fieldNames;this.json=Object.assign({},{flags:e,fieldNames:n})}},{key:"TypeGoToR",value:function(){var t=this.action,e=t.destinationName,n=t.destination;this.json=Object.assign({},{destinationName:e,destination:n})}},{key:"TypeLaunch",value:function(){var t=this.action.fileSpec;this.json=Object.assign({},{fileSpec:t})}},{key:"toJson",value:function(){return this.json}}]),t}(),O=E.PDFViewCtrl.Deps.jQuery,w=E.UIEvents,N=E.PDFViewCtrl.Consts.BORDER_STYLE,R=(PDFViewCtrl.PDF.constant.PosType,function(){function t(n,r){e(this,t),this.pdfViewer=n,this.controller=r}return r(t,[{key:"init",value:function(){var t,n=this.controller,i=this.pdfViewer,a=void 0,c=0,l=this.resetMergeStatus=function(){a=void 0,c=0,t=void 0};i.registerMatchRule((function(f,h){var p=function(e,r){if(!i.customs.pushUndoStack||i.customs.pushUndoStack(e,r))return n.create("annot",e,r,function(){if(c++,!a){if(a=f,!t){t=i.getAllActivatedElements().map((function(t){return t.annot})).filter(Boolean).filter((function(t){return"widget"!==t.getType()}));var e=t.findIndex((function(t){return"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()}));e>-1&&t.splice(e+1,1)}return 0===t.length||-1===t.indexOf(f)?(c--,a=void 0,t=void 0):t.length===c&&l(),!1}-1===t.indexOf(f)&&c--;var n=t.length;return c===n?(l(),!0):n>1}())};return function(a){s(l,a);var c=y(l);function l(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];var i;return e(this,l),(i=c.call.apply(c,[this].concat(d(r)))).undoRedoDataRecord={},i.handler=n.getAnnotHandler(i.annot),i}return r(l,[{key:"setTitle",value:function(t){var e=this;return this.handler.handleSetTitle((function(){return e.annot.setTitle(t)}))}},{key:"setSubject",value:function(t){var e=this;return this.handler.handleSetSubject((function(){return e.annot.setSubject(t)}))}},{key:"setColor",value:function(t){var e=this;return this.handler.handleSetColor((function(){return u(o(l.prototype),"setColor",e).call(e,t)}))}},{key:"setOpacity",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.handler.handleSetOpacity((function(){return u(o(l.prototype),"setOpacity",e).call(e,t)}),n,r)}},{key:"setFillColor",value:function(t){var e=this;if(u(o(l.prototype),"setFillColor",this))return this.handler.handleSetFillColor((function(){return u(o(l.prototype),"setFillColor",e).call(e,t)}))}},{key:"setBorderWidth",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.handler.handleSetBorderWidth((function(){return u(o(l.prototype),"setBorderWidth",e).call(e,t)}),n,r)}},{key:"setBorderStyle",value:function(t,e){var n=this;return this.handler.handleSetBorderStyle((function(){return u(o(l.prototype),"setBorderStyle",n).call(n,t,e)}))}},{key:"flip",value:function(t){var e=this;return this.handler.handleFlip((function(){return e.annot.flip()}),t)}},{key:"setEndingStyle",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.handler.handleSetEndingStyle((function(){return u(o(l.prototype),"setEndingStyle",n).call(n,t,e)}),t,r)}},{key:"enableCaption",value:function(t){var e=this;return this.handler.handleEnableCaption((function(){return u(o(l.prototype),"enableCaption",e).call(e,t)}))}},{key:"setRotation",value:function(t){var e=this;return this.handler.handleSetRotation((function(){return u(o(l.prototype),"setRotation",e).call(e,t)}))}},{key:"setHighlightingMode",value:function(t){var e=this;return this.handler.handleSetHighlightingMode((function(){return u(o(l.prototype),"setHighlightingMode",e).call(e,t)}))}},{key:"removeAnnot",value:function(){var e=this.annot,n=e.info.type,r=function(t){switch(t){case"sound":case"widget":case"watermark":return!1}return!0},a=r(n);return a&&!t&&(t=i.getAllActivatedElements().map((function(t){return t.annot})).filter(Boolean).filter((function(t){return r(t.info.type)}))).slice(0).forEach((function(e){var n=e.getGroupHeader&&e.getGroupHeader();if(n!==e){var r=t.indexOf(n);r>-1&&t.splice(r,1)}})),u(o(l.prototype),"removeAnnot",this).call(this).then((function(t){a&&t&&t.length>0&&p(m.REMOVEANNOT,[t,e]);return t}))}},{key:"textBoundaryStart",value:function(){this.undoRedoDataRecord[m.UPDATEQUADPOINTSBYCHARINDEX]={annot:this.annot,oldStart:this.annot.getStartCharIndex(),oldEnd:this.annot.getEndCharIndex()}}},{key:"textBoundaryEnd",value:function(){var t=this.undoRedoDataRecord[m.UPDATEQUADPOINTSBYCHARINDEX],e=Object.assign({},t,{annot:this.annot,newStart:this.annot.getStartCharIndex(),newEnd:this.annot.getEndCharIndex()});p(m.UPDATEQUADPOINTSBYCHARINDEX,e)}},{key:"onStartUpdateShape",value:function(t){if(this.isCallingOnShapeUpdate=!0,t in{resize:1,text:1,area:1}&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent())this.undoRedoDataRecord[m.UPDATECALLOUTPOINTS]={annot:this.annot,oldRect:this.annot.getRect(),oldCalloutLinePoints:this.annot.getCalloutLinePoints(),oldInnerRect:this.annot.getInnerRect()};else{var e=this.annot.getType();"square"===e||"circle"===e||"freetext"===e&&this.annot.getIntent&&"FreeTextTextbox"===this.annot.getIntent()?this.undoRedoDataRecord[m.SETRECT]={annot:this.annot,oldRect:this.annot.getRect(),oldInnerRect:this.annot.getInnerRect()}:this.undoRedoDataRecord[m.SETRECT]={annot:this.annot,oldRect:this.annot.getRect()}}return u(o(l.prototype),"onStartUpdateShape",this).apply(this,arguments)}},{key:"onShapeUpdateEnd",value:function(t,e,n){var r=this,i=u(o(l.prototype),"onShapeUpdateEnd",this).apply(this,arguments);return i.finally((function(){r.isCallingOnShapeUpdate=!1})),n in{resize:1,text:1,area:1}&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent()?i.then((function(){var t=r.undoRedoDataRecord[m.UPDATECALLOUTPOINTS],e=Object.assign({},t,{annot:r.annot,newRect:r.annot.getRect(),newCalloutLinePoints:r.annot.getCalloutLinePoints(),newInnerRect:r.annot.getInnerRect()});p(m.UPDATECALLOUTPOINTS,e)})):i.then((function(){var t,e=r.undoRedoDataRecord[m.SETRECT],n=r.annot.getType();t="square"===n||"circle"===n||"freetext"===n&&r.annot.getIntent&&"FreeTextTextbox"===r.annot.getIntent()?Object.assign({},e,{annot:r.annot,newRect:r.annot.getRect(),newInnerRect:r.annot.getInnerRect()}):Object.assign({},e,{annot:r.annot,newRect:r.annot.getRect()}),p(m.SETRECT,t)}))}},{key:"moveTo",value:function(t,e,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=this.annot.getRect(),s=this.getPDFPage(),f=t,d=e;if(!a){var h=s.reverseDevicePoint([t,e],this.scale,this.rotate);f=h[0],d=h[1]}return u(o(l.prototype),"moveTo",this).apply(this,arguments).then((function(t){return i.isCallingOnShapeUpdate||p(m.MOVETO,{annot:i.annot,originLeft:c.left,originTop:c.top,left:f,top:d,action:n,apply:r}),t}))}},{key:"setRect",value:function(t){var e=this,n=this.annot.getRect();this.annot.getBorderStyle()===N.CLOUDY&&(n=this.annot.getInnerRect());var r=this.getPDFPage().reverseDeviceRect({left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+t.height},this.scale,this.rotate);return u(o(l.prototype),"setRect",this).apply(this,arguments).then((function(t){return e.isCallingOnShapeUpdate||p(m.ANNOT_SET_RECT,{annot:e.annot,originRect:n,newRect:r}),t}))}},{key:"boundaryChangeStart",value:function(t){if("line"===this.annot.getType())switch(O(t.target).data("index")||O(t.target).parent().data("index")){case 0:case 1:this.undoRedoDataRecord[m.UPDATELINEPOINTS]={annot:this.annot,oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case 2:case 3:this.undoRedoDataRecord[m.SETLEADERLINELENGTH]={annot:this.annot,oldLeaderLinePoints:this.annot.getLeaderLinePoints(),oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case"caption":this.undoRedoDataRecord[m.UPDATECAPTIONOFFSET]={annot:this.annot,oldCaptionOffset:this.annot.getCaptionOffset()}}else this.undoRedoDataRecord[m.UPDATEVERTEXES]={annot:this.annot,oldVertexes:this.annot.getVertexes(),oldIndex:O(t.target).data("index")}}},{key:"boundaryChangeEnd",value:function(t){var e=O(t.target).data("index")||O(t.target).parent().data("index");if("line"===this.annot.getType())switch(e){case 0:case 1:var n=this.undoRedoDataRecord[m.UPDATELINEPOINTS],r=Object.assign({},n,{annot:this.annot,newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});p(m.UPDATELINEPOINTS,r);break;case 2:case 3:var o=this.undoRedoDataRecord[m.SETLEADERLINELENGTH],i=Object.assign({},o,{annot:this.annot,newLeaderLinePoints:this.annot.getLeaderLinePoints(),newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});p(m.SETLEADERLINELENGTH,i);break;case"caption":var a=this.undoRedoDataRecord[m.UPDATECAPTIONOFFSET],u=Object.assign({},a,{annot:this.annot,newCaptionOffset:this.annot.getCaptionOffset()});p(m.UPDATECAPTIONOFFSET,u)}else{var c=this.undoRedoDataRecord[m.UPDATEVERTEXES],s=Object.assign({},c,{annot:this.annot,newVertexes:this.annot.getVertexes(),newIndex:e});p(m.UPDATEVERTEXES,s)}}},{key:"setContent",value:function(t){var e=this;return this.handler.handleSetContent((function(){return u(o(l.prototype),"setContent",e).call(e,t)}))}},{key:"placeRedact",value:function(t){return u(o(l.prototype),"placeRedact",this).call(this,t).then((function(t){var e=t.flat().flat().flat().filter((function(t){return"redact"===t.getType()}));return p(m.PLACEREDACT,{redacts:e}),t}))}},{key:"setDefaultAppearance",value:function(t,e){var n=this;return this.handler.handleSetDefaultAppearance((function(){return u(o(l.prototype),"setDefaultAppearance",n).call(n,t,e)}))}},{key:"setFlags",value:function(t){var e=this;return this.handler.handleSetFlags((function(){return e.annot.setFlags(t)}))}},{key:"setAction",value:function(t,e,n){var r=this;return this.handler.handleSetAction((function(){return r.annot.setAction(t,e,n)}),t,e,n)}},{key:"removeAction",value:function(t,e){var n=this;return this.handler.handleRemoveAction((function(){return n.annot.removeAction(t,e)}),t,e)}},{key:"moveAction",value:function(t){return this.handler.handleMoveAction(t)}},{key:"setActionData",value:function(t,e){return this.handler.handleSetActionData(t,e)}},{key:"changeOrder",value:function(t){var e=this,n=this.annot.getIndex();return this.getPDFPage().changeAnnotOrder(t,this.annot).then((function(r){var o=e.annot.getIndex();return p(m.CHANGE_ANNOT_ORDER,{annot:f,newIndex:o,oldIndex:n,orderType:t}),r}))}}]),l}(h)})),this.bindEvent()}},{key:"bindEvent",value:function(){var t=this.controller,e=this.pdfViewer;function n(e,n){t.create("annot",e,n)}e.eventEmitter.on(w.addReplySuccess,(function(t,e){"sound"!==t.info.type&&n(m.ADDREPLY,{annot:t,replyAnnot:e})})),e.eventEmitter.on(w.deleteReplySuccess,(function(t,e){n(m.DELETEREPLY,{annot:t,replyAnnot:e})})),e.eventEmitter.on("annot-group-event",(function(t,e,r){n(m.Group,{page:t,annotIds:e,isGroup:r})})),e.eventEmitter.on(w.eraserSuccess,(function(t,e){n(m.ERASER,{beforeInks:t,afterInks:e})})),e.eventEmitter.on(w.addAnnotSuccess,(function(t){n(m.ADDANNOT,{annot:t})})),e.eventEmitter.on(w.applyRedaction,(function(e){t.clear()})),e.eventEmitter.on(w.addContentSuccess,(function(t,e,r){n(m.SETCONTENT,{annot:t,oldContent:e,newContent:r})})),e.eventEmitter.on("markRedactAnnotSuccess",(function(t){n(m.MARKREDACTANNOT,{annot:t})})),e.eventEmitter.on("makeRedactByPagesSuccess",(function(t){n(m.MAKEREDACTBYPAGES,{redacts:t})})),e.eventEmitter.on(w.markRedactionSuccess,(function(t){n(m.MARKCHECKEDRESULTREDACTION,{redacts:t})})),e.eventEmitter.on(w.addReviewStateSuccess,(function(t,e){"sound"!==t.info.type&&n(m.ADDREVIEWSTATE,{annot:t,stateName:e.getState()})})),e.eventEmitter.on(w.annotationMarkedStateAnnotAdd,(function(t,e,r){r||n(m.ADD_MARKED_STATE,{annot:e,stateName:t.getState()})})),e.eventEmitter.on(w.moveAnnotsToPages,(function(t,e,r,o){o&&n(m.moveAnnotsCrossPage,{srcPage:t,destPage:e,annots:r})})),e.eventEmitter.on("setNoteIconName",(function(t,e,r){e!==r&&n(m.SETICONNAME,{annot:t,oldIconName:e,newIconName:r})}));var r=function(){return t.clear()};e.eventEmitter.on(w.importPages,r),e.eventEmitter.on(w.pageAdded,r),e.eventEmitter.on(w.pageRemoved,r),e.eventEmitter.on(w.pagesRemoved,r),e.eventEmitter.on(w.pagesRotated,r),e.eventEmitter.on(w.pageMoved,r),e.eventEmitter.on(w.pagesMoved,r)}}]),t}()),I=function(){function t(){e(this,t),this.stackArray=[]}return r(t,[{key:"push",value:function(t){this.stackArray.push(t)}},{key:"pop",value:function(){return this.stackArray.pop()}},{key:"size",value:function(){return this.stackArray.length}},{key:"clear",value:function(){var t=this,e=this.stackArray,n=[];return this.stackArray=n,function(){t.stackArray===n&&(t.stackArray=e)}}},{key:"filter",value:function(t){this.stackArray=this.stackArray.filter(t)}}]),t}(),_=function(){function t(n,r){e(this,t),this.pdfViewer=n,this.controller=r,this.undoStack=new I,this.redoStack=new I}return r(t,[{key:"storage",value:function(t){var e=this;return this.undoStack.push(t),function(){var n=e.undoStack.indexOf(t);n>-1&&e.undoStack.splice(n,1)}}},{key:"mergeLast",value:function(t){var e=this,n=this.undoStack.pop();if(n){var r=this.doMerge(n,t);return this.undoStack.push(r),function(){var t=e.undoStack.indexOf(r);t>-1&&(e.undoStack[t]=n)}}return this.storage(t)}},{key:"doMerge",value:function(t,e){return{undo:function(){return Promise.resolve(t.undo()).finally((function(){return e.undo()}))},redo:function(){return Promise.resolve(t.redo()).finally((function(){return e.redo()}))}}}},{key:"undo",value:function(){var t=this.undoStack.pop();if(t)return this.redoStack.push(t),t}},{key:"redo",value:function(){var t=this.redoStack.pop();if(t)return this.undoStack.push(t),t}},{key:"removeById",value:function(t){this.undoStack.filter((function(e){return t!==e.uniqueId})),this.redoStack.filter((function(e){return t!==e.uniqueId}))}},{key:"removeByName",value:function(t){this.undoStack.filter((function(e){if(e.annot)return t!==e.annot.info.name})),this.redoStack.filter((function(e){if(e.annot)return t!==e.annot.info.name}))}},{key:"clear",value:function(){this.undoStack.clear(),this.redoStack.clear()}},{key:"getUndoStack",value:function(){return this.undoStack}},{key:"getRedoStack",value:function(){return this.redoStack}}]),t}();function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(t,e)||f(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var P=E.PDFViewCtrl.Consts.BORDER_STYLE,D=function(){function t(n){e(this,t);var r=function(t){var e,n,r,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HTML",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u="";"number"==typeof t&&(t=["int",t]);switch(t[0]){case"int":e=(16711680&t[1])>>16,n=(65280&t[1])>>8,r=255&t[1];break;case"T":e=0,n=0,r=0,a=0;break;case"G":e=n=r=255*t[1];break;case"RGB":e=255*t[1],n=255*t[2],r=255*t[3];break;case"CMYK":e=(1-t[4])*(1-t[1])*255,n=(1-t[4])*(1-t[2])*255,r=(1-t[4])*(1-t[3])*255;break;case"r":e=+(o=t.match(/rgba?\((\d*),\s*(\d*),\s*(\d*),?\s*([\.0-9]*)?\)/))[1],n=+o[2],r=+o[3];break;case"#":var c=4==t.length?/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/:/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/;o=t.match(c),e=parseInt(o[1],16),n=parseInt(o[2],16),r=parseInt(o[3],16);break;default:throw new Error("Unsupported color format")}switch(i){case"HTML":u=e===n&&n===r&&-1===r?"transparent":"rgba("+parseInt(e)+","+parseInt(n)+","+parseInt(r)+","+a+")";break;case"RGB":u=["RGB",e/255,n/255,r/255];break;case"#":u+=e<16?"#0"+e.toString(16):"#"+e.toString(16),u+=n<16?"0"+n.toString(16):n.toString(16),u+=r<16?"0"+r.toString(16):r.toString(16);break;case"int":u=0,u|=(a*=255)<<24,u|=e<<16,u|=n<<8,u|=r,u>>>=0}return u}(n.info.borderColor,"int");this.json={objectNumber:n.info.objectNumber,name:n.getName(),flags:n.info.flag,rect:n.info.rect,color:r,style:n.info.borderInfo.style,contents:n.info.content,date:new Date(n.info.modifiedTimestamp).getTime(),type:n.info.type,borderWidth:n.info.borderInfo.width},n.info.isMarkup&&this.markup(n);var o=n.info.type;switch("strikeout"!==o&&"highlight"!==o&&"squiggly"!==o&&"underline"!==o||this.textMarkup(n),o){case"ink":this.ink(n);break;case"fileattachment":this.fileattachment(n);break;case"polygon":this.polygon(n);break;case"polyline":this.polyline(n);break;case"stamp":this.stamp(n);break;case"freetext":this.freetext(n);break;case"screen":this.screen(n);break;case"line":this.line(n);break;case"redact":this.redact(n);break;case"highlight":this.highlight(n);break;case"link":this.link(n);break;case"square":this.square(n);break;case"circle":this.circle(n)}}return r(t,[{key:"markup",value:function(t){var e="",n=!1;if(t.getPopup){var r=t.getPopup();r?(e=r.getName(),n=!1):n=!0}else n=!0;this.json=Object.assign({intent:t.info.intent,opacity:t.info.opacity,subject:t.info.subject,title:t.info.title,creationTimestamp:new Date(t.info.creationTimestamp).getTime(),popId:e,noPopup:n},this.json)}},{key:"textMarkup",value:function(t){var e=[];t.info.quadPoints.map((function(t){e.push({top:t[0].y,left:t[0].x,bottom:t[3].y,right:t[3].x})})),this.json=Object.assign(this.json,{coords:e})}},{key:"ink",value:function(t){this.json=Object.assign({inkList:t.info.inkList},this.json)}},{key:"fileattachment",value:function(t){this.json=Object.assign({fObjNum:t.info.fObjNum},this.json)}},{key:"polygon",value:function(t){var e=L(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,borderStyle:e.style,borderStyleParam:e.param,fillColor:t.info.fillColor,style:void 0,measure:o})}},{key:"polyline",value:function(t){var e=L(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,fillColor:t.info.fillColor,borderStyle:e.style,borderStyleParam:e.param,style:void 0,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,measure:o})}},{key:"stamp",value:function(t){this.json=Object.assign({icon:t.info.icon,rotate:(t.info.rotation+360)%360,apObjeNum:t.info.apObjeNum},this.json)}},{key:"freetext",value:function(t){var e=L(t.info.borderInfo),n="FreeTextTypewriter"==t.info.intent?0:t.info.fillColor;this.json=Object.assign(this.json,{calloutLinePoints:t.info.calloutLinePoints,innerRect:t.info.innerRect,borderStyle:e.style,borderStyleParam:e.param,style:void 0,"interior-color":n,calloutLineEndingStyle:t.info.calloutLineEndingStyle,defaultAppearance:t.info.defaultAppearance,rotate:t.info.rotation})}},{key:"line",value:function(t){var e=L(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n});var i=t.info.startPoint,a=t.info.endPoint;this.json=Object.assign(this.json,{styleFillColor:t.info.styleFillColor,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,enableCaption:t.info.hasCaption,startPoint:{x:i.x,y:i.y},endPoint:{x:a.x,y:a.y},measure:o,borderStyle:e.style,borderStyleParam:e.param,style:void 0})}},{key:"screen",value:function(t){var e=L(t.info.borderInfo);this.json=Object.assign({apObjNum:t.info.apObjNum,opacity:t.info.opacity,rotate:{0:0,90:1,180:2,270:3}[t.info.rotation],iObjNum:t.info.iObjNum,aObjNum:t.info.aObjNum,intensity:e.param},this.json)}},{key:"redact",value:function(t){var e=t.info.quadPoints,n=[];e.length>0?e.map((function(t){n.push({left:t[0].x,right:t[3].x,top:t[0].y,bottom:t[3].y})})):n.push(t.info.rect),this.json=Object.assign(this.json,{rects:n,applyFillColor:t.info.applyFillColor})}},{key:"highlight",value:function(t){t.info.isArea&&(this.json=Object.assign(this.json,{coords:[t.info.rect],dicts:{AreaHi:"AreaHi"}}),delete this.json.startCharIndex,delete this.json.endCharIndex)}},{key:"link",value:function(t){var e=L(t.info.borderInfo);this.json=Object.assign(this.json,{aObjNum:t.info.aObjNum,borderStyle:e.style,borderStyleParam:e.param,style:void 0,highlightingMode:t.info.highlightingMode})}},{key:"circle",value:function(t){var e=L(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,borderStyle:e.style,borderStyleParam:e.param,style:void 0,measure:o})}},{key:"square",value:function(t){var e=L(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,measure:o,borderStyle:e.style,borderStyleParam:e.param,style:void 0})}},{key:"getJson",value:function(){return this.json}}]),t}();function L(t){var e,n=t.style,r=t.cloudIntensity,o=t.dashes;switch(n){case P.SOLID:e=[];break;case P.CLOUDY:e=r;break;case P.DASHED:e=o}return{style:n,param:e}}var j=i(361),x=i.n(j);function V(t){if(!t)return[];var e=[];return function t(n){if(e.push(n),1===n.subAction.length)t(n.subAction[0]);else for(var r=0;r<n.subAction.length;r++)e.push(n.subAction[r])}(t),e}E.PDFViewCtrl.Consts.Intents;var U=E.PDFViewCtrl.shared.QueuedAsyncTaskExecutor,F=E.PDFViewCtrl.Consts.BORDER_STYLE,M=PDFViewCtrl.PDF.constant.PosType,B=function(){function t(n){e(this,t),this.pdfViewer=n,this.pdfViewer.recordsMap={}}return r(t,[{key:m.SETTITLE,value:function(t){var e=t.annot,n=t.oldTitle,r=t.newTitle,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setTitle(t)}}return{undo:i(n),redo:i(r)}}},{key:m.SETSUBJECT,value:function(t){var e=t.annot,n=t.oldSubject,r=t.newSubject,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setSubject(t)}}return{undo:i(n),redo:i(r)}}},{key:m.SETCOLOR,value:function(t){var e=t.annot,n=t.oldColor,r=t.newColor,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return-1===t&&(t=0),n&&n.annot.setBorderColor(t).then((function(){n.updateRender()}))}}return{undo:i(n),redo:i(r)}}},{key:m.SETOPACITY,value:function(t){var e=t.annot,n=t.oldOpacity,r=t.newOpacity,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setOpacity(t).then((function(){n.updateRender()}))}}return{undo:i(n),redo:i(r)}}},{key:m.SETFILLCOLOR,value:function(t){var e=t.annot,n=t.oldFillColor,r=t.newFillColor,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n?(n.annot.setStyleFillColor||n.annot.setFillColor).call(n.annot,t):Promise.resolve()}}return{undo:i(n),redo:i(r)}}},{key:m.SETBORDERWIDTH,value:function(t){var e=t.annot,n=t.oldBorderWidth,r=t.newBorderWidth;return this._common_interpreter(e,"setBorderWidth",[r],[n])}},{key:m.FlipPoint,value:function(t){var e=t.annot,n=this.pdfViewer;function r(t){return function(){var e=G(n,t);return e&&e.annot.flip()}}return{undo:r(e),redo:r(e)}}},{key:m.SETBORDERSTYLE,value:function(t){var e=t.annot,n=t.oldBorderStyle,r=t.newBorderStyle,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setBorderStyle(t.style,t.param)}}return{undo:i(n),redo:i(r)}}},{key:m.SETBORDERINFO,value:function(t){var e=t.annot,n=t.oldBorderInfo,r=t.newBorderInfo;return this._common_interpreter(e,"setBorderInfo",[r],[n])}},{key:m.SET_MEASUREMENT_RATIO,value:function(t){var e=t.annot,n=t.oldMeasureRatio,r=t.newMeasureRatio;return this._common_interpreter(e,"setMeasureRatio",[r],[n])}},{key:m.SET_MEASUREMENT_UNIT,value:function(t){var e=t.annot,n=t.oldUnit,r=t.newUnit;return this._common_interpreter(e,"setMeasureUnit",[r],[n])}},{key:m.SET_MEASURE_CONVERSION_FACTOR,value:function(t){var e=t.annot,n=t.oldFactor,r=t.newFactor;return this._common_interpreter(e,"setMeasureConversionFactor",[r],[n])}},{key:m.SET_CAPTION_COLOR,value:function(t){var e=t.annot,n=t.oldCaptionColor,r=t.newCaptionColor;return this._common_interpreter(e,"setCaptionColor",[r],[n])}},{key:m.SETENDINGSTYLE,value:function(t){var e=t.annot,n=t.isStart,r=t.oldStyle,o=t.newStyle,i=this.pdfViewer;function a(t){return function(){var r=G(i,e);return r&&r.annot.setCalloutLineEndingStyle?r.annot.setCalloutLineEndingStyle(+t).then((function(){r.redraw(),r.activeRect()})):r&&r.annot.setEndingStyle(n,+t).then((function(){r.redraw(),r.activeRect()}))}}return{undo:a(r),redo:a(o)}}},{key:m.SET_END_POINT,value:function(t){var e=t.annot,n=t.oldEndPoint,r=t.newEndPoint;return this._common_interpreter(e,"setEndPoint",[r],[n])}},{key:m.SET_START_POINT,value:function(t){var e=t.annot,n=t.oldStartPoint,r=t.newStartPoint;return this._common_interpreter(e,"setStartPoint",[r],[n])}},{key:m.SET_STYLE_FILL_COLOR,value:function(t){var e=t.annot,n=t.oldStyleFillColor,r=t.newStyleFillColor;return this._common_interpreter(e,"setStyleFillColor",[r],[n])}},{key:m.SET_LEADER_LINE_EXTEND,value:function(t){var e=t.annot,n=t.newLength,r=t.oldLength;return this._common_interpreter(e,"setLeaderLineExtend",[n],[r])}},{key:m.SET_LEADER_LINE_OFFSET,value:function(t){var e=t.annot,n=t.newOffset,r=t.oldOffset;return this._common_interpreter(e,"setLeaderLineOffset",[n],[r])}},{key:m.SET_LEADER_LINE_LENGTH,value:function(t){var e=t.annot,n=t.newLength,r=t.oldLength;return this._common_interpreter(e,"setLeaderLineLength",[n],[r])}},{key:m.SET_CAPTION_OFFSET,value:function(t){var e=t.annot,n=t.newOffset,r=t.oldOffset;return this._common_interpreter(e,"setCaptionOffset",[n.x,n.y],[r.x,r.y])}},{key:m.ENABLECAPTION,value:function(t){var e=t.annot,n=t.oldEnableCaption,r=t.newEnableCaption;return this._common_interpreter(e,"enableCaption",[r],[n])}},{key:m.SETROTATION,value:function(t){var e=t.annot,n=t.oldRotation,r=t.newRotation,o=t.oldRect,i=t.newRect,a=this.pdfViewer;function u(t,n){return A((function(){var r,o;return T(this,(function(i){switch(i.label){case 0:return[4,H(a,e)];case 1:return r=i.sent(),o=G(a,e),"screen"===r.getType()?[2,r.setRect(n).then((function(e){if(e)return r.setRotation((t+360)%360).then((function(){o&&o.activeRect()}))}))]:[2,r.setRotation((t+360)%360).then((function(){o&&o.activeRect()}))]}}))}))}return{undo:u(n,o),redo:u(r,i)}}},{key:m.SETHIGHLIGHTINGMODE,value:function(t){var e=t.annot,n=t.oldHlMode,r=t.newHlMode,o=this.pdfViewer;function i(t){return A((function(){return T(this,(function(n){switch(n.label){case 0:return[4,H(o,e)];case 1:return[2,n.sent().setHighlightingMode(t)]}}))}))}return{undo:i(n),redo:i(r)}}},{key:m.REMOVEANNOT,value:function(t){var e=C(t,2),n=e[0],r=e[1],o=this.pdfViewer;return{undo:Y(o,n,r),redo:X(r,o)}}},{key:m.ADDANNOT,value:function(t){var e=t.annot,n=this.pdfViewer,r=[e],o=e.getPopup&&e.getPopup();return o&&!o.isEmpty()&&r.push(o),e.isReplace&&e.isReplace()&&(r=e.getGroupElements().map((function(t){return t}))).push(e.getGroupHeader().getPopup()),{undo:X(e,n),redo:Y(n,r,e),annot:e}}},{key:m.UPDATEQUADPOINTSBYCHARINDEX,value:function(t){var e=t.annot,n=t.oldStart,r=t.oldEnd,o=t.newStart,i=t.newEnd,a=this.pdfViewer;function u(t,n){return function(){var r=G(a,e);return r&&r.annot.updateQuadPointsByCharIndex(t,n).then((function(){if(r.redraw(),r.isReplace)return r.caretAnnot.moveRectByCharIndex(n).then((function(){r.getGroupRenders().map((function(t){t.active()}))}));r.active()}))}}return{undo:u(n,r),redo:u(o,i)}}},{key:m.SETRECT,value:function(t){var e=t.annot,n=t.oldRect,r=t.newRect,o=t.oldInnerRect,i=t.newInnerRect,a=this.pdfViewer;function u(t,n){return function(){var r=G(a,e);return n?r&&r.annot.setRectAndInnerRect(t,n).then((function(){r.redraw(),r.active()})):r&&r.annot.setRect(t).then((function(){r.redraw(),r.active()}))}}return{undo:u(n,o),redo:u(r,i)}}},{key:m.ANNOT_SET_RECT,value:function(t){var e=t.annot,n=t.originRect,r=t.newRect,o=this.pdfViewer;function i(t){return A((function(){var n,r,i,a;return T(this,(function(u){switch(u.label){case 0:return(n=G(o,e))?[4,e.getBorderStyle()]:[2,Promise.resolve()];case 1:return r=u.sent(),[4,e.getCloudIntensity()];case 2:return i=u.sent(),[4,e.getBorderWidth()];case 3:return a=u.sent(),r!==F.CLOUDY?[3,6]:[4,e.setBorderStyle(0)];case 4:return u.sent(),[4,e.setBorderWidth(0)];case 5:u.sent(),u.label=6;case 6:return[4,e.setRect(t)];case 7:return u.sent(),r!==F.CLOUDY?[3,10]:[4,e.setBorderStyle(r,i)];case 8:return u.sent(),[4,e.setBorderWidth(a)];case 9:u.sent(),u.label=10;case 10:return n.redraw(),n.active(),[2]}}))}))}return{undo:i(n),redo:i(r)}}},{key:m.MOVETO,value:function(t){var e=t.annot,n=t.originLeft,r=t.originTop,o=t.left,i=t.top,a=this.pdfViewer;function u(t,n){return function(){var r=G(a,e);return r&&r.annot?r.annot.moveTo({left:t,top:n}).then((function(){r.redraw(),r.active()})):Promise.resolve()}}return{undo:u(n,r),redo:u(o,i)}}},{key:m.UPDATECALLOUTPOINTS,value:function(t){var e=t.annot,n=t.oldRect,r=t.oldCalloutLinePoints,o=t.oldInnerRect,i=t.newRect,a=t.newCalloutLinePoints,u=t.newInnerRect,c=this.pdfViewer;function s(t,n,r){return function(){var o=G(c,e);return o&&o.annot._setRect(t,!1).then((function(){return o.annot.setInnerRectNoAction(r).then((function(){return o.annot.setCalloutLinePoints(n).then((function(){return o.annot.update().then((function(){o.redraw(),o.active()}))}))}))}))}}return{undo:s(n,r,o),redo:s(i,a,u)}}},{key:m.UPDATELINEPOINTS,value:function(t){var e=t.annot,n=t.oldStartPoint,r=t.oldEndPoint,o=t.newStartPoint,i=t.newEndPoint,a=this.pdfViewer;function u(t,n){return function(){var r=G(a,e);if(!r)return Promise.resolve();var o=[];return o.push(r.annot.setStartPoint(t)),o.push(r.annot.setEndPoint(n)),Promise.all(o).then((function(){r.active()}))}}return{undo:u(n,r),redo:u(o,i)}}},{key:m.SETLEADERLINELENGTH,value:function(t){var e=t.annot,n=t.oldLeaderLinePoints,r=t.oldStartPoint,o=t.oldEndPoint,i=t.newLeaderLinePoints,a=t.newStartPoint,u=t.newEndPoint,c=this.pdfViewer;function s(t,n,r){var o=t.start,i=(t.end,Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2))),a=!0;return(r.x-n.x)*(o.y-r.y)-(o.x-r.x)*(r.y-n.y)>0&&(a=!1),a&&(i=-i),function(){var t=G(c,e);return t&&t.annot.setLeaderLineLength(i).then((function(){t.active()}))}}return{undo:s(n,r,o),redo:s(i,a,u)}}},{key:m.UPDATEVERTEXES,value:function(t){var e=t.annot,n=t.oldVertexes,r=t.oldIndex,o=t.newVertexes,i=t.newIndex,a=this.pdfViewer;function u(t,n){return function(){var r=G(a,e);return r&&r.annot.updateVertexes(t,n[t]).then((function(){r.active()}))}}return{undo:u(r,n),redo:u(i,o)}}},{key:m.SET_VERTEXES,value:function(t){var e=t.annot,n=t.newVertexes,r=t.oldVertexes;return this._common_interpreter(e,"setVertexes",[n],[r])}},{key:m.SETCONTENT,value:function(t){var e=t.annot,n=t.oldContent,r=t.newContent,o=t.oldInnerRect,i=t.newInnerRect,a=t.oldRect,u=t.newRect,c=t.oldCalloutLinePoints,s=t.newCalloutLinePoints,l=this.pdfViewer,f=e.getId(),d=[];l.recordsMap[f]?d=l.recordsMap[f]:(l.recordsMap[f]=d,d.push({modifyDate:e.getCreateDateTime(),content:n}));var h=d.findIndex((function(t){return t.content===n}));function p(t,n,r,o){return function(){return H(l,e).then((function(e){return e.setContent(t).then((function(){var i=(l.recordsMap[e.getId()]||[]).map((function(i){if(i.content===t)return r?e.setRect(r).then((function(){return n&&e.setInnerRect(n).then((function(){return o&&e.setCalloutLinePoints(o).then((function(){var t=G(l,e);if(t)return t.redraw(),t.active(),e._setModifiedDateTime(i.modifyDate)}))}))})):e._setModifiedDateTime(i.modifyDate)}));return Promise.all(i)}))}))}}return-1!==h&&(d.length=h+1),d.push({modifyDate:e.getModifiedDateTime(),content:r}),{undo:p(n,o,a,c),redo:p(r,i,u,s)}}},{key:m.PLACEREDACT,value:function(t){var e=t.redacts,n=this.pdfViewer,r=e.map((function(t){var e=t.getPopup&&t.getPopup();return e&&!e.isEmpty()?[t,e]:[t]}));return{undo:function(){return Promise.all(e.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:function(){return Promise.all(r.map((function(t){if(!(t.length<1))return t[0].page.addAnnotObjects(t.map((function(t){return t.objectNumber}))).then((function(e){n.killFocus();var r=G(n,t[0]);r&&r.active()}))})))}}}},{key:m.ADDREPLY,value:function(t){var e=t.annot,n=t.replyAnnot,r=this.pdfViewer;return{undo:z(e,K(n),r),redo:W(e,K(n),r)}}},{key:m.DELETEREPLY,value:function(t){var e=t.annot,n=t.replyAnnot,r=this.pdfViewer;return{undo:W(e,K(n),r),redo:z(e,K(n),r)}}},{key:m.ADDACTION,value:function(t){var e=t.annot,n=t.param,r=this.pdfViewer;function o(t,e,n,r){return function(){G(r,n);var o=e.trigger,i=e.action,a=e.append;switch(t){case S:return n.setAction(i,o,a);case k:var u=V(n.getAction(o));return i=u[u.length-1],n.removeAction(o,i)}}}return{undo:o(k,n,e,r),redo:o(S,n,e,r)}}},{key:m.REMOVEACTION,value:function(t){var e=t.annot,n=t.param,r=this.pdfViewer;function o(t,e,n,r){return function(){G(r,n);var o=e.trigger,i=e.index,a=e.oldActions,u="screen"==n.getType()?n.getAdditionalAction(o):n.getAction(o);switch(t){case S:if(i>-1)return 0==i?n.removeAction(o).then((function(t){var e=[];return a.forEach((function(t){e.push(n.setAction(t,o,!0))})),Promise.all(e)})):u.insertSubAction(i-1,a[i].info);var c=[];return a.forEach((function(t){c.push(n.setAction(t,o,!0))})),Promise.all(c);case k:var s=V(u);return n.removeAction(o,s[i])}}}return{undo:o(S,n,e,r),redo:o(k,n,e,r)}}},{key:m.MOVEACTION,value:function(t){var e=t.annot,n=t.moveInfo,r=this.pdfViewer;function o(t){return function(){var n=G(r,e);return n&&n.annot.moveAction(t)}}return{undo:o(Object.assign({},n,{direction:!n.direction})),redo:o(n)}}},{key:m.UPDATEACTION,value:function(t){var e=t.annot,n=t.action,r=t.oldData,o=t.newData,i=this.pdfViewer;function a(t,n){return function(){var r=G(i,e);return r&&r.annot.setActionData(t,n)}}return{undo:a(n,r),redo:a(n,o)}}},{key:m.ERASER,value:function(t){var e=t.beforeInks,n=t.afterInks,r=this.pdfViewer;return{undo:function(){var t=e.map((function(t,e){var o=t.annot,i=t.inkList;if(t.isRemove)return Y(r,[n[e].annot],o,!1)().then((function(t){var e=G(r,o);return e&&e.annot.setInkList(i)}));var a=G(r,o);return a&&a.annot.setInkList(i)}));return Promise.all(t)},redo:function(){var t=n.map((function(t){var e=t.annot;t.inkList;if(t.isRemove)return X(e,r)();var n=G(r,t.annot);return n&&n.annot.setInkList(t.inkList)}));return Promise.all(t)}}}},{key:m.MARKREDACTANNOT,value:function(t){var e=t.annot,n=this.pdfViewer,r=[e],o=e.getPopup();return o&&!o.isEmpty()&&r.push(o),{undo:X(e,n),redo:Y(n,r,e)}}},{key:m.MAKEREDACTBYPAGES,value:function(t){var e=t.redacts,n=this.pdfViewer,r=[];return e.map((function(t){r.push(new D(t).getJson())})),{undo:function(){return Promise.all(e.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:Y(n,e,e[0])}}},{key:m.MARKCHECKEDRESULTREDACTION,value:function(t){var e=t.redacts,n=this.pdfViewer,r=[];return e.map((function(t){r.push(new D(t).getJson())})),{undo:function(){return Promise.all(e.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:Y(n,e,e[0])}}},{key:m.ADDREVIEWSTATE,value:function(t){var e=t.annot,n=t.stateName,r=this.pdfViewer,o=e.getPDFPage(),i=e.getObjectNumber(),a=e.getReviewStates().find((function(t){return t.info.state===n}));return{undo:function(){return o.getAnnotsByObjectNumArray([i]).then((function(t){return t[0]&&t[0].removeReviewState()}))},redo:function(){return o.getAnnotsByObjectNumArray([i]).then((function(t){return function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=n[0].page;return i.addReviewStateAnnotObject(e,n.map((function(t){return t.objectNumber}))).then((function(e){t.killFocus();var n=G(t,r);o&&n&&n.active()}))}(r,t[0],[a],a)}))}}}},{key:m.ADD_MARKED_STATE,value:function(t){var e=t.annot,n=t.stateName,r=this.pdfViewer,o=e.getMarkedStates().find((function(t){return t.info.state===n}));function i(t){return e.page.getAnnotsByObjectNumArray([t]).then((function(t){return C(t,1)[0]}))}return{undo:function(){return i(e.objectNumber).then((function(t){return t.removeMarkedState()}))},redo:function(){return i(e.objectNumber).then((function(t){return function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return n[0].page.addMarkedStateAnnotObject(e,n.map((function(t){return t.objectNumber})),!0,!0).then((function(e){t.killFocus();var n=G(t,r);o&&n&&n.active()}))}(r,t,[o],o)}))}}}},{key:m.DEFAULTAP,value:function(t){var e=t.annot,n=t.oldDA,r=t.newDA,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setDefaultAppearance(t).then((function(){n.active()}))}}return{undo:i(n),redo:i(r)}}},{key:m.moveAnnotsCrossPage,value:function(t){var e=t.srcPage,n=t.destPage,r=t.annots,o=this.pdfViewer.getCurrentPDFDoc(),i=Object.keys(r).reduce((function(t,e){var n=r[e];return t[e]={rect:n.oldRect,oldRect:n.rect},t}),{});return{undo:function(){return o.moveAnnotsToPage(n,e,i,!0)},redo:function(){return o.moveAnnotsToPage(e,n,r,!0)}}}},{key:m.UPDATECAPTIONOFFSET,value:function(t){var e=t.annot,n=t.oldCaptionOffset,r=t.newCaptionOffset,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setCaptionOffset(t.x,t.y).then((function(){n.active()}))}}return{undo:i(n),redo:i(r)}}},{key:m.Group,value:function(t){var e=this,n=t.page,r=t.annotIds,o=t.isGroup;return{undo:function(){e.pdfViewer.killFocus(),n.handleGroupMarkup(r,!o)},redo:function(){e.pdfViewer.killFocus(),n.handleGroupMarkup(r,o)}}}},{key:m.SETICONNAME,value:function(t){var e=t.annot,n=t.oldIconName,r=t.newIconName;return this._common_interpreter(e,"setIconName",[r],[n])}},{key:m.SET_ALIGNMENT,value:function(t){var e=t.annot,n=t.oldAlignment,r=t.newAlignment;return this._common_interpreter(e,"setAlignment",[r],[n])}},{key:m.SET_INNER_RECT,value:function(t){var e=t.annot,n=t.oldInnerRect,r=t.newInnerRect;return this._common_interpreter(e,"setInnerRect",[r],[n])}},{key:m.FLAG,value:function(t){var e=t.annot,n=t.oldFlag,r=t.newFlag,o=this.pdfViewer;function i(t){return function(){var n=G(o,e);return n&&n.annot.setFlags(t)}}return{undo:i(n),redo:i(r)}}},{key:m.SET_CALLOUT_LINE_ENDING_STYLE,value:function(t){var e=t.annot,n=t.newStyle,r=t.oldStyle;return this._common_interpreter(e,"setCalloutLineEndingStyle",[n],[r])}},{key:m.SET_DEFAULT_APPEARANCE,value:function(t){var e=t.annot,n=t.newAp,r=t.oldAp;return this._common_interpreter(e,"setDefaultAppearance",[n],[r])}},{key:m.SET_INK_LIST,value:function(t){var e=t.annot,n=t.oldInkList,r=t.newInkList;return this._common_interpreter(e,"setInkList",[r],[n])}},{key:m.SET_OVERLAY_TEXT,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,(function(t,e){return"string"==typeof e?t.setOverlayText(e):t.removeOverlayText()}),[n],[r])}},{key:m.REMOVE_OVERLAY_TEXT,value:function(t){var e=t.annot,n=t.oldValue;return this._common_interpreter(e,(function(t,e){return"string"==typeof e?t.setOverlayText(e):t.removeOverlayText()}),[],[n])}},{key:m.SET_OVERLAY_TEXT_ALIGNMENT,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setOverlayTextAlignment",[n],[r])}},{key:m.SET_REPEAT,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setRepeat",[n],[r])}},{key:m.SET_AUTO_FONT_SIZE,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setAutoFontSize",[n],[r])}},{key:m.SET_REDACT_APPLY_FILL_COLOR,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setRedactApplyFillColor",[n],[r])}},{key:m.SET_IMAGE,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setImage",[n],[r])}},{key:m.CHANGE_ANNOT_ORDER,value:function(t){var e=t.annot,n=t.newIndex,r=t.oldIndex,o=t.orderType,i=o;return[M.prev,M.next].includes(o)&&(i=o===M.prev?M.next:M.prev),this._common_interpreter(e,(function(t,e,n){return[M.prev,M.next].includes(n)?t.page.changeAnnotOrder(n,t):(e>t.getIndex()&&"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()&&(e+=2),t.page.moveAnnotOrder(t,e))}),[n,o],[r,i])}},{key:"_common_interpreter",value:function(t,e,n,r){var o=this.pdfViewer;function i(n){return A((function(){var r,i,a,u;return T(this,(function(c){switch(c.label){case 0:return(i=G(o,t))?(u=i.annot,[3,3]):[3,1];case 1:return[4,H(o,t)];case 2:u=c.sent(),c.label=3;case 3:return a=u,"function"==typeof e?[2,e.apply(void 0,[a].concat(d(n)))]:[2,(r=a)[e].apply(r,d(n))]}}))}))}return{undo:i(r),redo:i(n)}}}]),t}();function G(t,e){var n=t.getAnnotRender(e.page.getIndex(),e.objectNumber);return n?n.component:null}function H(t,e){return t.getCurrentPDFDoc().getPageByIndex(e.page.getIndex()).then((function(t){return t.getAnnotsByObjectNumArray([e.objectNumber]).then((function(t){return t[0]}))}))}function Y(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(e.length<1)){var o=e[0].page;return function(){return o.addAnnotObjects(e.map((function(t){return t.objectNumber}))).then((function(e){t.killFocus();var o=G(t,n);r&&o&&o.active()}))}}}function X(t,e){return function(){e.activeElement();var n=G(e,t),r=n&&n.annot&&n.annot.getPDFPage().removeAnnot(n.annot);return r||(r=t&&t.getPDFPage().removeAnnot(t)),r&&r.then((function(t){var r=e.getCurrentActivatable();return r&&r.remove&&r.remove(n),t}))}}function W(t,e,n){return function(){var n=t.page;return n.addAnnotObjects([e.objectNumber],!1).then((function(r){t=n.annotIdMap[t.objectNumber];var o=e.reviewStates;if(o.length>0){var i=[];o.map((function(t){i.push(t.info.state)})),function(t,e){var n=new U;e.forEach((function(e){n.exec((function(){return t.addReviewState(e)}))})),n.waitForCurrentRunningTasks()}(r[0],i)}t.info.repliesSummary.some((function(t){return t.objectNumber==e.objectNumber}))||(t.info.repliesSummary.push({objectNumber:r[0].info.objectNumber,id:r[0].info.objectNumber,index:r[0].info.index}),t.replies.push(r[0])),n.doc.engine.eventEmitter.emit("annotation-reply-add",r[0],t),n.doc.engine.eventEmitter.emit("annotation-updated",[t],n,"add-replies")}))}}function z(t,e,n){return function(){return t.getPDFPage().removeAnnot(e)}}function K(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(e.has(t))return e.get(t);var n=Object.create(t,{info:{value:x()(t.info)}});e.set(t,n);var r=function(r){Object.defineProperty(n,r,{value:t[r].map((function(t){return K(t,e)}))})};return r("reviewStates"),r("markedStates"),r("replies"),r("groupElements"),n}var q=function(){function t(n){e(this,t),this.pdfViewer=n}return r(t,[{key:"add",value:function(t,e){this[t]=e}}]),t}();function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function J(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){$(t,e,n[e])}))}return t}function Q(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}var Z=function(){function t(n){e(this,t),this.pdfViewer=n}return r(t,[{key:"add",value:function(t){return{undo:rt(this.pdfViewer,t),redo:nt(this.pdfViewer,t)}}},{key:"remove",value:function(t){return et.push(t.bookmark.id),{undo:nt(this.pdfViewer,t),redo:rt(this.pdfViewer,t)}}},{key:"rename",value:function(t){var e=t.bookmark,n=t.newName,r=t.oldName;return{undo:ot(this.pdfViewer,{bookmark:e,name:r}),redo:ot(this.pdfViewer,{bookmark:e,name:n})}}},{key:"addV2",value:function(t){var e=t.bookmarkId,n=t.data;return{undo:at(this.pdfViewer,{bookmarkId:e}),redo:it(this.pdfViewer,{bookmarkId:e,data:n})}}},{key:"removeV2",value:function(t){var e=t.bookmarkId,n=t.data;return{undo:it(this.pdfViewer,{bookmarkId:e,data:n}),redo:at(this.pdfViewer,{bookmarkId:e})}}},{key:"renameV2",value:function(t){var e=t.bookmarkId,n=t.newTitle,r=t.oldTitle;return{undo:ut(this.pdfViewer,{bookmarkId:e,title:r}),redo:ut(this.pdfViewer,{bookmarkId:e,title:n})}}},{key:"setColorV2",value:function(t){var e=t.bookmarkId,n=t.newColor,r=t.oldColor;return{undo:st(this.pdfViewer,{bookmarkId:e,color:r}),redo:st(this.pdfViewer,{bookmarkId:e,color:n})}}},{key:"setDestinationV2",value:function(t){var e=t.bookmarkId,n=t.newDestination,r=t.oldDestination;return{undo:lt(this.pdfViewer,{bookmarkId:e,destination:r}),redo:lt(this.pdfViewer,{bookmarkId:e,destination:n})}}},{key:"setStyleV2",value:function(t){var e=t.bookmarkId,n=t.newStyle,r=t.oldStyle;return{undo:ct(this.pdfViewer,{bookmarkId:e,style:r}),redo:ct(this.pdfViewer,{bookmarkId:e,style:n})}}},{key:"setColor",value:function(t){var e=t.bookmark,n=t.newColor,r=t.oldColor;return{undo:dt(this.pdfViewer,{bookmark:e,style:r}),redo:dt(this.pdfViewer,{bookmark:e,style:n})}}},{key:"setStyle",value:function(t){var e=t.bookmark,n=t.newStyle,r=t.oldStyle;return{undo:ft(this.pdfViewer,{bookmark:e,style:r}),redo:ft(this.pdfViewer,{bookmark:e,style:n})}}},{key:"clear",value:function(){tt={},et=[]}}]),t}(),tt={},et=[];function nt(t,e){var n=e.bookmark,r=n.id,o=n.page,i=n.left||0,a=n.top||0,u=n.title,c=Object.assign([],n.children),s=e.siblingBookmark,l=s.id,f=e.position;return function(){n=tt[r]||n,s=tt[l]||s,u=n.title,c=c.filter((function(t){return-1===et.indexOf(t.id)})),s.insertBookmark(u,o,a,i,f).then((function(e){ht(r,e),ht(e.id,e),r=e.id,c.forEach((function(n){nt(t,{bookmark:n,siblingBookmark:e})()}))}))}}function rt(t,e){var n=e.bookmark,r=n.id,o=n.parent.children;return function(){if(n=tt[r]||n,r=n.id,n){et.push(r),n.remove();for(var t=0;t<o.length;t++){if(o[t].id===n.id){o.splice(t,1);break}}}}}function ot(t,e){var n=e.bookmark,r=n.id,o=e.name;return function(){(n=tt[r]||n)&&n.setProperty({title:o},!1).then((function(e){ht(n.id,e),ht(r,e),t.eventEmitter.emit("bookmark-update-attr",n.id,{name:o})}))}}function it(t,e){var n=e.bookmarkId,r=e.data;return A((function(){var e,o;return T(this,(function(i){return e=t.getBookmarkDataService(),o=Q(J({},r),{newBookmarkId:n,children:(r.children||[]).map((function t(e){return{newBookmarkId:e.id,title:e.title,destination:J({},e.destination),color:e.color,style:e.style,children:(e.children||[]).map(t)}}))}),[2,e.addBookmark(o)]}))}))}function at(t,e){var n=e.bookmarkId;return A((function(){return T(this,(function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().deleteBookmark(n)];case 1:return e.sent(),[2]}}))}))}function ut(t,e){var n=e.bookmarkId,r=e.title;return A((function(){return T(this,(function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().renameBookmark(n,r)];case 1:return e.sent(),[2]}}))}))}function ct(t,e){var n=e.bookmarkId,r=e.style;return A((function(){return T(this,(function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setFontStyle(n,r)];case 1:return e.sent(),[2]}}))}))}function st(t,e){var n=e.bookmarkId,r=e.color;return A((function(){return T(this,(function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setColor(n,r)];case 1:return e.sent(),[2]}}))}))}function lt(t,e){var n=e.bookmarkId,r=e.destination;return A((function(){return T(this,(function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setDestination(n,r)];case 1:return e.sent(),[2]}}))}))}function ft(t,e){var n=(null==t?void 0:t.getCurrentPDFDoc()).bookmarkAPI,r=e.bookmark,o=r.id,i=C(e.style,2),a=i[0],u=i[1];return function(){r=tt[o]||r,n.setProperties(o,{style:{italic:a,bold:u}},!1).then((function(){r.style.italic=a,r.style.bold=u,ht(o,r),t.eventEmitter.emit("bookmark-update-attr",r.id,{isBold:u,isItalic:a})}))}}function dt(t,e){var n=(null==t?void 0:t.getCurrentPDFDoc()).bookmarkAPI,r=e.bookmark,o=r.id,i=e.style;return function(){r=tt[o]||r,n.setProperties(o,{color:i}).then((function(){r.color=i,ht(o,r),t.eventEmitter.emit("bookmark-update-attr",r.id,{color:i})}))}}function ht(t,e){var n=tt[t];if(tt[t]=e,n)for(var r in tt){tt[r].id===n.id&&(tt[r]=e)}}var pt=function(){function t(n){e(this,t),this.pdfViewer=n,this.fileNameObjNumMapping={}}return r(t,[{key:"add",value:function(t){return{undo:Et(this.pdfViewer,t),redo:yt(this.pdfViewer,t)}}},{key:"remove",value:function(t){return{undo:yt(this.pdfViewer,t),redo:Et(this.pdfViewer,t)}}},{key:"setDesc",value:function(t){var e=t.fileName,n=t.description,r=t.objNum,o=t.annot;return vt[e=(o?"annot_":"")+e]||(vt[e]={objNum:r,description:n}),{undo:gt(this.pdfViewer,{fileName:t.fileName,objNum:t.objNum,description:t.descriptionOld,annot:o}),redo:gt(this.pdfViewer,{fileName:t.fileName,objNum:t.objNum,description:t.description,annot:o})}}},{key:"replace",value:function(t){var e=this,n=this.pdfViewer.currentPDFDoc,r=t.oldFile,o=r.fileName,i=r.objNum,a=r.description,u=t.objNum;return{undo:function(){n.setEmbeddedFileByAttachments(o,i).then((function(){a&&gt(e.pdfViewer,{fileName:o,objNum:i,description:a})}))},redo:function(){n.setEmbeddedFileByAttachments(o,u)}}}},{key:"clear",value:function(){vt={}}}]),t}(),vt={};function yt(t,e){var n=e.fileName;return vt[n]||(vt[n]={}),e.hasOwnProperty("objNum")&&(vt[n].objNum=e.objNum),e.hasOwnProperty("fileBuffer")&&(vt[n].fileBuffer=e.fileBuffer),function(){var e=t.currentPDFDoc,r=vt[n],o=r.fileBuffer,i=r.description;return e.addFileSpec(n,o,new Date).then((function(t){return vt[n].objNum=t,e.addEmbeddedFileByAttachments(n,t).then((function(){return i&&e.setFileSpecDesc(i,t)}))}))}}function Et(t,e){var n=e.fileName;return function(){t.currentPDFDoc.removeEmbeddedFileByAttachments(n)}}function gt(t,e){var n,r,o=e.fileName,i=e.description,a=e.annot,u=e.objNum;return a&&(n=a.getPage().getIndex(),r=a.getObjectNumber(),o="annot_"+o),function(){var e=vt[o];t.currentPDFDoc.setFileSpecDesc(i,e.objNum||u).then((function(){if(vt[o].description=i,r){var e=t.getAnnotRender(n,r),a=e&&e.annot;a&&a.setContent(i).then((function(){return a.update()}))}}))}}var At=function(){function t(n){e(this,t),this.pdfViewer=n}return r(t,[{key:"rotate",value:function(t){var e={},n={};for(var r in t){var o=t[r],i=o.from,a=o.to;e[r]=i,n[r]=a}return{undo:Tt(this.pdfViewer,e),redo:Tt(this.pdfViewer,n)}}},{key:"clear",value:function(){}}]),t}();function Tt(t,e){return function(){for(var n in e){var r=e[n];t.getPDFDocRender().getPDFPageRender(n).page.setRotation(r),t.collaborate("ppo-rotate-page",{pageIndex:n,angle:90*r})}}}var mt,St="onUndoRedo",kt=function(){function t(n,r){e(this,t),$(this,"controller",void 0),$(this,"annot",void 0),$(this,"manager",void 0),this.controller=n,this.annot=r,this.manager=n.annotUndoRedoManager}return r(t,[{key:"handleSetTitle",value:function(t){var e=this,n=this.annot.getTitle();return t().then((function(t){var r=e.annot.getTitle();return n!==r&&e.manager.pushUndoStack(e.annot,m.SETTITLE,{annot:e.annot,oldTitle:n,newTitle:r}),t}))}},{key:"handleSetSubject",value:function(t){var e=this,n=this.annot.getSubject();return t().then((function(t){var r=e.annot.getSubject();return n!==r&&e.manager.pushUndoStack(e.annot,m.SETSUBJECT,{annot:e.annot,oldSubject:n,newSubject:r}),t}))}},{key:"handleSetColor",value:function(t){var e=this,n=this.annot.getBorderColor();return t().then((function(t){var r=e.annot.getBorderColor();return n!==r&&e.manager.pushUndoStack(e.annot,m.SETCOLOR,{annot:e.annot,oldColor:n,newColor:r}),t}))}},{key:"handleSetOpacity",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;n&&r&&r.oldValue!==r.commitValue&&this.manager.pushUndoStack(this.annot,m.SETOPACITY,{annot:this.annot,oldOpacity:r.oldValue,newOpacity:r.commitValue});var o=this.annot.getOpacity();return t().then((function(t){var i=e.annot.getOpacity();return n&&!r&&o!==i&&e.manager.pushUndoStack(e.annot,m.SETOPACITY,{annot:e.annot,oldOpacity:o,newOpacity:i}),t}))}},{key:"handleSetFillColor",value:function(t){var e=this,n=this.annot.getStyleFillColor||this.annot.getFillColor,r=n.call(this.annot);return t().then((function(t){var o=n.call(e.annot);return r!==o&&e.manager.pushUndoStack(e.annot,m.SETFILLCOLOR,{annot:e.annot,oldFillColor:r,newFillColor:o}),t}))}},{key:"handleSetBorderWidth",value:function(t,e,n){var r=this;e&&n&&n.oldValue!==n.commitValue&&this.manager.pushUndoStack(this.annot,m.SETBORDERWIDTH,{annot:this.annot,oldBorderWidth:n.oldValue,newBorderWidth:n.commitValue});var o=this.annot.getBorderWidth();return t().then((function(t){var i=r.annot.getBorderWidth();return e&&!n&&o!==i&&r.manager.pushUndoStack(r.annot,m.SETBORDERWIDTH,{annot:r.annot,oldBorderWidth:o,newBorderWidth:i}),t}))}},{key:"handleSetBorderStyle",value:function(t){var e=this,n=this.annot.getBorderStyleWithParam();return t().then((function(t){var r=e.annot.getBorderStyleWithParam();return n!==r&&e.manager.pushUndoStack(e.annot,m.SETBORDERSTYLE,{annot:e.annot,oldBorderStyle:n,newBorderStyle:r}),t}))}},{key:"handleSetBorderInfo",value:function(t){var e=this,n=this.annot.getBorderInfo();return this.annot.setBorderInfo(t).then((function(t){var r=e.annot.getBorderInfo();return e.manager.pushUndoStack(e.annot,m.SETBORDERINFO,{annot:e.annot,oldBorderInfo:n,newBorderInfo:r}),t}))}},{key:"handleFlip",value:function(t,e){var n=this;return t().then((function(t){return n.controller.create("annot",m.FlipPoint,{annot:n.annot},e),t}))}},{key:"handleSetEndingStyle",value:function(t,e,n){var r,o=this,i=(r=e?this.annot.getStartStyle||this.annot.getCalloutLineEndingStyle:this.annot.getEndingStyle).call(this.annot);return t().then((function(t){var a=r.call(o.annot);return o.controller.create("annot",m.SETENDINGSTYLE,{annot:o.annot,isStart:e,oldStyle:i,newStyle:a},n),t}))}},{key:"handleEnableCaption",value:function(t){var e=this,n=this.annot.hasCaption();return t().then((function(t){var r=e.annot.hasCaption();return n!==r&&e.manager.pushUndoStack(e.annot,m.ENABLECAPTION,{annot:e.annot,oldEnableCaption:n,newEnableCaption:r}),t}))}},{key:"handleSetRotation",value:function(t){var e=this,n=this.annot.getRotation(),r=this.annot.getRect();return t().then((function(t){var o=e.annot.getRotation(),i=e.annot.getRect();return e.manager.pushUndoStack(e.annot,m.SETROTATION,{annot:e.annot,oldRotation:n,newRotation:o,oldRect:r,newRect:i}),t}))}},{key:"handleSetHighlightingMode",value:function(t){var e=this,n=this.annot.getHighlightingMode();return t().then((function(t){var r=e.annot.getHighlightingMode();return e.manager.pushUndoStack(e.annot,m.SETHIGHLIGHTINGMODE,{annot:e.annot,oldHlMode:n,newHlMode:r}),t}))}},{key:"handleSetContent",value:function(t){var e=this,n=this.annot.getContent(),r=this.annot.getInnerRect&&this.annot.getInnerRect(),o=this.annot.getRect(),i=this.annot.getCalloutLinePoints&&this.annot.getCalloutLinePoints();return t().then((function(t){var a=e.annot.getContent();if(a!==n)if("freetext"===e.annot.getType()){var u=e.annot.getInnerRect(),c=e.annot.getRect(),s=e.annot.getCalloutLinePoints();e.manager.pushUndoStack(e.annot,m.SETCONTENT,{annot:e.annot,oldContent:n,newContent:a,oldInnerRect:r,newInnerRect:u,oldRect:o,newRect:c,oldCalloutLinePoints:i,newCalloutLinePoints:s})}else e.manager.pushUndoStack(e.annot,m.SETCONTENT,{annot:e.annot,oldContent:n,newContent:a});return t}))}},{key:"handlePlaceRedact",value:function(t){var e=this;return t().then((function(t){var n=t.flat().flat().flat().filter((function(t){return"redact"===t.getType()}));return e.manager.pushUndoStack(e.annot,m.PLACEREDACT,{redacts:n}),t}))}},{key:"handleSetDefaultAppearance",value:function(t){var e=this,n=this.annot.getDefaultAppearance();return t().then((function(t){var r=e.annot.getDefaultAppearance();e.manager.pushUndoStack(e.annot,m.DEFAULTAP,{annot:e.annot,oldDA:n,newDA:r})}))}},{key:"handleSetFlags",value:function(t){var e=this,n=this.annot.getFlags();return t().then((function(t){var r=e.annot.getFlags();e.manager.pushUndoStack(e.annot,m.FLAG,{annot:e.annot,oldFlag:n,newFlag:r})}))}},{key:"handleSetAction",value:function(t,e,n,r){var o=this;return t().then((function(t){o.manager.pushUndoStack(o.annot,m.ADDACTION,{annot:o.annot,param:{action:e,trigger:n,append:r}})}))}},{key:"handleRemoveAction",value:function(t,e,n){var r=this,o=V("screen"==this.annot.getType()?this.annot.getAdditionalAction(e):this.annot.getAction()),i=-1;return n&&(i=o.findIndex((function(t){return t.info.objNumber===n.info.objNumber}))),t().then((function(t){r.manager.pushUndoStack(r.annot,m.REMOVEACTION,{annot:r.annot,param:{trigger:e,index:i,oldActions:o}})}))}},{key:"handleMoveAction",value:function(t){var e=this;return this.annot.moveAction(t).then((function(n){e.manager.pushUndoStack(e.annot,m.MOVEACTION,{annot:e.annot,moveInfo:t})}))}},{key:"handleSetActionData",value:function(t,e){var n=this,r=new b(t.info).toJson();return this.annot.setActionData(t,e).then((function(o){n.manager.pushUndoStack(n.annot,m.UPDATEACTION,{annot:n.annot,action:t,oldData:r,newData:e})}))}},{key:"handleSetRect",value:function(t){var e=this,n=this.annot.getRect(),r=this.annot.getInnerRect();return this.annot.setRect(t).then((function(){e.manager.pushUndoStack(e.annot,m.SETRECT,{annot:e.annot,oldRect:n,oldInnerRect:r,newRect:e.annot.getRect(),newInnerRect:e.annot.getInnerRect()})}))}}]),t}(),bt=function(){function t(n,r){e(this,t),$(this,"pdfViewer",void 0),$(this,"controller",void 0),$(this,"firstUndoAnnot",void 0),$(this,"handledAnnotCount",void 0),$(this,"activateAnnots",void 0),this.pdfViewer=n,this.controller=r,this.handledAnnotCount=0}return r(t,[{key:"requireMergeLast",value:function(t){if(this.handledAnnotCount++,!this.firstUndoAnnot){if(this.firstUndoAnnot=t,!this.activateAnnots){this.activateAnnots=this.pdfViewer.getAllActivatedElements().map((function(t){return t.annot})).filter(Boolean).filter((function(t){return"widget"!==t.getType()}));var e=this.activateAnnots.findIndex((function(t){return"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()}));e>-1&&this.activateAnnots.splice(e+1,1)}return 0===this.activateAnnots.length||-1===this.activateAnnots.indexOf(t)?(this.handledAnnotCount--,this.firstUndoAnnot=void 0,this.activateAnnots=void 0):this.activateAnnots.length===this.handledAnnotCount&&this.reset(),!1}-1===this.activateAnnots.indexOf(t)&&this.handledAnnotCount--;var n=this.activateAnnots.length;return this.handledAnnotCount===n?(this.reset(),!0):n>1}},{key:"reset",value:function(){this.firstUndoAnnot=void 0,this.handledAnnotCount=0,this.activateAnnots=void 0}},{key:"pushUndoStack",value:function(t,e,n){if(!this.pdfViewer.customs.pushUndoStack||this.pdfViewer.customs.pushUndoStack(e,n))return this.controller.create("annot",e,n,this.requireMergeLast(t))}}]),t}(),Ot=function(){function t(n){e(this,t),$(this,"pdfViewer",void 0),this.pdfViewer=n}return r(t,[{key:"exitEdit",value:function(){var t=this;return{undo:function(){var e=t.pdfViewer.getPDFDocRender();e&&e.doc&&(e.doc.getTouchup().handleEvent("Undo",!0,!1),t.pdfViewer.eventEmitter.emit("undoRedo",{type:"touch",operation:"undo"}))},redo:function(){var e=t.pdfViewer.getPDFDocRender();e&&e.doc&&(e.doc.getTouchup().handleEvent("Undo",!1,!1),t.pdfViewer.eventEmitter.emit("undoRedo",{type:"touch",operation:"redo"}))}}}}]),t}(),wt=function(){function t(n){e(this,t),$(this,"pdfViewer",void 0),this.pdfViewer=n}return r(t,[{key:"exitEdit",value:function(t){var e=this;return{undo:function(){var t=e.pdfViewer.getPDFDocRender();t&&t.doc&&(t.doc.getPageEditor().undoRedo(!1,!0),e.pdfViewer.eventEmitter.emit("undoRedo",{type:"pageEditor",operation:"undo"}))},redo:function(){var t=e.pdfViewer.getPDFDocRender();t&&t.doc&&(t.doc.getPageEditor().undoRedo(!1,!1),e.pdfViewer.eventEmitter.emit("undoRedo",{type:"pageEditor",operation:"redo"}))}}}}]),t}(),Nt=i(2459);!function(t){t.up="up",t.down="down"}(mt||(mt={}));var Rt=function(){function t(n){e(this,t),$(this,"pdfViewer",void 0),this.pdfViewer=n}return r(t,[{key:"appendAction",value:function(t){var e=t.widget,n=t.appendActionData,r=n.trigger,o=n.actionData;return{undo:A((function(){return T(this,(function(t){return[2,It(e,{trigger:r})]}))})),redo:function(){return e.appendAdditionalAction(r,o)}}}},{key:"removeAdditionalActionByTrigger",value:function(t){var e=t.widget,n=t.trigger,r=t.hierarchy;return{undo:A((function(){var t,o,i,a,u,c,s,l;return T(this,(function(f){switch(f.label){case 0:t=(0,Nt.iterateActionHierarchy)(r),o=!0,i=!1,a=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),u=t[Symbol.iterator](),f.label=2;case 2:return(o=(c=u.next()).done)?[3,5]:(s=c.value,[4,e.appendAdditionalAction(n,{type:s.hierarchy.type,data:s.hierarchy.data})]);case 3:f.sent(),f.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return l=f.sent(),i=!0,a=l,[3,8];case 7:try{o||null==u.return||u.return()}finally{if(i)throw a}return[7];case 8:return[2]}}))})),redo:function(){return e.removeAdditionalAction(n)}}}},{key:"removeSpecAdditionalAction",value:function(t){var e=t.widget,n=t.trigger,r=t.actionObjNumber,o=t.actionSpec;return{undo:function(){return e.appendAdditionalAction(n,o)},redo:function(){return e.removeAdditionalAction(n,r)}}}},{key:"moveActionAcross",value:function(t){var e=t.doc;return{undo:function(){return e.undoAnnotActionOperation()},redo:function(){return e.redoAnnotActionOperation()}}}},{key:"moveAction",value:function(t){var e=t.widget,n=t.actionData;return{undo:function(){return n.direction="up"===n.direction?"down":"up",e.moveAdditionalAction(n)},redo:function(){return e.moveAdditionalAction(n)}}}},{key:"updateAction",value:function(t){var e=t.widget,n=t.trigger,r=t.actionObjNumber,o=t.oldActionData,i=t.newActionData;return{undo:function(){return Ct(e,{trigger:n,actionObjNumber:r,actionData:o})},redo:function(){return Ct(e,{trigger:n,actionObjNumber:r,actionData:i})}}}},{key:"updateNormalAction",value:function(t){var e=t.widget,n=t.actionObjNumber,r=t.oldActionData,o=t.newActionData,i=function(t,e,n){return t.updateAction(e,n)};return{undo:function(){return i(e,n,r)},redo:function(){return i(e,n,o)}}}},{key:"removeNormalAction",value:function(t){t.widget,t.actionObjNumber,t.actionSpec;return{undo:function(){},redo:function(){}}}}]),t}();function It(t,e){return _t.apply(this,arguments)}function _t(){return(_t=A((function(t,e){var n,r,o,i,a;return T(this,(function(u){switch(u.label){case 0:return n=e.trigger,[4,t.getAdditionalActions([n])];case 1:return r=u.sent(),o=r[0].data,i=o.subAction,a=i.length?i[i.length-1].objNumber:o.objNumber,[2,t.removeAdditionalAction(n,a)]}}))}))).apply(this,arguments)}function Ct(t,e){return Pt.apply(this,arguments)}function Pt(){return(Pt=A((function(t,e){var n,r,o;return T(this,(function(i){switch(i.label){case 0:return n=e.trigger,r=e.actionObjNumber,o=e.actionData,[4,t.updateAdditionalAction(n,r,o)];case 1:return[2,i.sent()]}}))}))).apply(this,arguments)}var Dt=UIExtension.UIEvents,Lt=function(){function t(n,r){e(this,t),this.pdfViewer=n,this.undoRedoManager=r,this.annoutInitStatesManager={};var o=Promise.resolve();this.interpreter={annot:new B(n),user:new q(n),bookmark:new Z(n),attachment:new pt(n),rotatePage:new At(n),touchup:new Ot(n),pageEditor:new wt(n),formDesigner:new Rt(n),undo:function(t){return o=o.finally((function(){return t.undo()}))},redo:function(t){return o=o.finally((function(){return t.redo()}))}},this.annotUndoRedoManager=new bt(n,this)}return r(t,[{key:"getAnnotHandler",value:function(t){return new kt(this,t)}},{key:"before",value:function(t,e,n){this.beforeData={type:t,fnName:e,data:n}}},{key:"after",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.beforeData;o.type===t||o.fnName===e?this.create(t,e,Object.assign(o.data,n),r):this.beforeData=null}},{key:"create",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&1===Object.keys(n).length&&n.annot&&(this.annoutInitStatesManager[n.annot.objectNumber]=n.annot);var o,i=this.interpreter[t][e](n);o=r?this.undoRedoManager.mergeLast(i):this.undoRedoManager.storage(i);var a=this.undoRedoManager.getRedoStack().clear();return this.pdfViewer.eventEmitter.emit(Dt.undoRedoStoreChange,this),function(){o(),a()}}},{key:"removeByName",value:function(t){this.undoRedoManager.removeByName(t),this.pdfViewer.eventEmitter.emit(Dt.undoRedoStoreChange,this)}},{key:"clear",value:function(){this.undoRedoManager.clear(),this.annoutInitStatesManager={};var t=this.interpreter;[t.bookmark,t.attachment,t.rotatePage,t.formDesigner].forEach((function(t){t.clear&&t.clear()})),this.pdfViewer.eventEmitter.emit(Dt.undoRedoStoreChange,null,"clearAll")}},{key:"undo",value:function(){var t=this.undoRedoManager.undo();if(t){var e=this.interpreter.undo(t);return this.pdfViewer.eventEmitter.emit(Dt.undoRedoStoreChange,this),this.pdfViewer.eventEmitter.emit(St,!0),e}}},{key:"redo",value:function(){var t=this.undoRedoManager.redo();if(t){var e=this.interpreter.redo(t);return this.pdfViewer.eventEmitter.emit(Dt.undoRedoStoreChange,this),this.pdfViewer.eventEmitter.emit(St,!1),e}}},{key:"popUndoStack",value:function(){this.undoRedoManager.getUndoStack().pop()}},{key:"undoAll",value:function(){for(var t in this.annoutInitStatesManager){var e=this.annoutInitStatesManager[t],n=this.pdfViewer.getAnnotRender(e.page.info.index,e.objectNumber);n&&n.component&&n.component.hideUI()}for(var r=this,o="",i=[];o=this.undoRedoManager.undo();)!function(t){i.push((function(){return r.interpreter.undo(t)}))}(o);return i.reduce((function(t,e){return t.then((function(){return e()}))}),Promise.resolve())}}]),t}(),jt=(E.UIEvents,function(){function t(n,r){e(this,t),this.pdfViewer=n,this.controller=r}return r(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("bookmark",t,e)}}]),t}()),xt=(E.UIEvents,function(){function t(n,r){e(this,t),this.pdfViewer=n,this.controller=r}return r(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("attachment",t,e)}}]),t}()),Vt=(E.UIEvents,function(){function t(n,r){e(this,t),this.pdfViewer=n,this.controller=r}return r(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("rotatePage",t,e)}}]),t}()),Ut=i(732),Ft="vertical",Mt="horizontal",Bt=function(){function t(n,r){e(this,t),this.fromInchRate=n,this.name=r,Object.defineProperties(this,{fromInchRate:{value:n,enumerable:!0,writable:!1,configurable:!0},name:{value:r,enumerable:!0,writable:!1,configurable:!0}})}return r(t,[{key:"isPixel",get:function(){return!1}},{key:"convertTo",value:function(t,e){return t/this.fromInchRate*e.fromInchRate}},{key:"convertAreaTo",value:function(t,e){return t/Math.pow(this.fromInchRate,2)*Math.pow(e.fromInchRate,2)}}]),t}(),Gt=function(t){s(o,t);var n=y(o);function o(t){var r;return e(this,o),(r=n.call(this,0,"px")).orientation=t,Object.defineProperty(p(r),"fromInchRate",{get:function(){var e=(0,Ut.getDPI)();switch(t){case Mt:return e.x;case Ft:return e.y;default:return e.x}}}),r}return r(o,[{key:"isPixel",get:function(){return!0}}]),o}(Bt);const Ht={inch:"inch",custom:"custom",mi:"mi",pt:"pt",ft:"ft",yd:"yd",km:"km",m:"m",cm:"cm",mm:"mm",pica:"pica"};var Yt,Xt=new Bt(1,Ht.inch),Wt=new Bt(1,Ht.custom),zt=new Bt(1/63360,Ht.mi),Kt=new Bt(72,Ht.pt),qt=new Bt(1/12,Ht.ft),$t=new Bt(1/36,Ht.yd),Jt=new Bt(.0254/1e3,Ht.km),Qt=new Bt(.0254,Ht.m),Zt=new Bt(2.54,Ht.cm),te=new Bt(25.4,Ht.mm),ee=new Bt(6,Ht.pica),ne=new Gt(Mt),re=(new Gt(Ft),$(Yt={},Xt.name,Xt),$(Yt,Wt.name,Wt),$(Yt,zt.name,zt),$(Yt,Kt.name,Kt),$(Yt,qt.name,qt),$(Yt,$t.name,$t),$(Yt,Jt.name,Jt),$(Yt,Qt.name,Qt),$(Yt,Zt.name,Zt),$(Yt,te.name,te),$(Yt,ee.name,ee),$(Yt,ne.name,ne),Yt);function oe(t){switch(t=(t=t.toLowerCase()).replace(/[^a-z]/g,"")){case"in":t="inch";break;case"p":t="pica"}return re[t]}function ie(t,n){if(t){if("popup"===t.getType()||t.isStateAnnot&&t.isStateAnnot())return t;var i=Ut.Proxy.getProxyClass(t.constructor,(function(e,n,r){var o;return(o=n).call.apply(o,[t].concat(d(r)))}),(function(){})),a=n.getAnnotHandler(t),c=n.annotUndoRedoManager,l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setContent",value:function(t){var e=this;return a.handleSetContent((function(){return u(o(i.prototype),"setContent",e).call(e,t)}))}},{key:"setRect",value:function(t){return a.handleSetRect(t)}},{key:"setBorderColor",value:function(t){var e=this;return a.handleSetColor((function(){return u(o(i.prototype),"setBorderColor",e).call(e,t)}))}},{key:"setBorderInfo",value:function(t){return a.handleSetBorderInfo(t)}},{key:"setFlags",value:function(t,e){var n=this;return a.handleSetFlags((function(){return u(o(i.prototype),"setFlags",n).call(n,t,e)}))}}]),i}(i);return t.isMarkup()&&(l=function(n){s(l,n);var i=y(l);function l(){return e(this,l),i.apply(this,arguments)}return r(l,[{key:"setOpacity",value:function(t){var e=this;return a.handleSetOpacity((function(){return u(o(l.prototype),"setOpacity",e).call(e,t)}),!0,null)}},{key:"setSubject",value:function(t){var e=this;return a.handleSetSubject((function(){return u(o(l.prototype),"setSubject",e).call(e,t)}))}},{key:"setTitle",value:function(t){var e=this;return a.handleSetTitle((function(){return u(o(l.prototype),"setTitle",e).call(e,t)}))}},{key:"addReply",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(a){switch(a.label){case 0:return[4,u(o(l.prototype),"addReply",n).call(r,e)];case 1:return(i=a.sent())&&c.pushUndoStack(t,m.ADDREPLY,{annot:t,replyAnnot:i}),[2,i]}}))}))()}},{key:"addReviewState",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(a){switch(a.label){case 0:return[4,u(o(l.prototype),"addReviewState",n).call(r,e)];case 1:return(i=a.sent())&&c.pushUndoStack(t,m.ADDREVIEWSTATE,{annot:t,stateName:e}),[2,i]}}))}))()}},{key:"addMarkedState",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(a){switch(a.label){case 0:return[4,u(o(l.prototype),"addMarkedState",n).call(r,e)];case 1:return(i=a.sent())&&c.pushUndoStack(t,m.ADD_MARKED_STATE,{annot:t,stateName:e}),[2,i]}}))}))()}}]),l}(l)),t.setFillColor&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setFillColor",value:function(t){var e=this;return a.handleSetFillColor((function(){return u(o(i.prototype),"setFillColor",e).call(e,t)}))}}]),i}(l)),t.setMeasureRatio&&t.getMeasureRatio&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setMeasureRatio",value:function(e){var n=function(t){var e=t.match(/(\d+(\.\d+)?)\s+(\w+)\s+=\s+(\d+(\.\d+)?)\s+(\w+)/);if(e){var n=C(e,7),r=n[1],o=n[3],i=n[4],a=n[6];return"in"===o&&(o="inch"),"in"===a&&(a="inch"),{fScale:parseFloat(r),fUnit:oe(o),tScale:parseFloat(i),tUnit:oe(a)}}}(u(o(a.prototype),"getMeasureRatio",this).call(this))||{fScale:1,fUnit:Ht.inch,tScale:1,tUnit:Ht.inch};"object"==typeof n.fUnit&&(n.fUnit=n.fUnit.name),"object"==typeof n.tUnit&&(n.tUnit=n.tUnit.name);var r={userSpaceValue:n.fScale,userSpaceUnit:n.fUnit,realValue:n.tScale,realUnit:n.tUnit},i=Object.assign({},e);return u(o(a.prototype),"setMeasureRatio",this).call(this,e).then((function(){c.pushUndoStack(t,m.SET_MEASUREMENT_RATIO,{annot:t,oldMeasureRatio:r,newMeasureRatio:i})}))}}]),a}(l)),t.getMeasureUnit&&t.setMeasureUnit&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setMeasureUnit",value:function(e){var n=u(o(a.prototype),"getMeasureUnit",this).call(this);return u(o(a.prototype),"setMeasureUnit",this).call(this,e).then((function(){c.pushUndoStack(t,m.SET_MEASUREMENT_UNIT,{annot:t,oldUnit:n,newUnit:e})}))}}]),a}(l)),t.setMeasureConversionFactor&&t.getMeasureConversionFactor&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setMeasureConversionFactor",value:function(e){var n=u(o(a.prototype),"getMeasureConversionFactor",this).call(this);return u(o(a.prototype),"setMeasureConversionFactor",this).call(this,e).then((function(){c.pushUndoStack(t,m.SET_MEASURE_CONVERSION_FACTOR,{annot:t,oldFactor:n,newFactor:e})}))}}]),a}(l)),t.enableCaption&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"enableCaption",value:function(t){var e=this;return a.handleEnableCaption((function(){return u(o(i.prototype),"enableCaption",e).call(e,t)}))}}]),i}(l)),t.setCaptionColor&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setCaptionColor",value:function(e){var n=u(o(a.prototype),"getCaptionColor",this).call(this);return u(o(a.prototype),"setCaptionColor",this).call(this,e).then((function(){c.pushUndoStack(t,m.SET_CAPTION_COLOR,{annot:t,oldCaptionColor:n,newCaptionColor:e})}))}}]),a}(l)),t.setEndPoint&&t.getEndPoint&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setEndPoint",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getEndPoint",n)};return A((function(){var s,l;return T(this,(function(f){switch(f.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setEndPoint",n).call(r,e)];case 1:return f.sent(),l=i().call(r),c.pushUndoStack(t,m.SET_END_POINT,{annot:t,oldEndPoint:s,newEndPoint:l}),[2]}}))}))()}}]),a}(l)),t.setStartPoint&&t.getStartPoint&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setStartPoint",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getStartPoint",n)};return A((function(){var s,l;return T(this,(function(f){switch(f.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setStartPoint",n).call(r,e)];case 1:return f.sent(),l=i().call(r),c.pushUndoStack(t,m.SET_START_POINT,{annot:t,oldStartPoint:s,newStartPoint:l}),[2]}}))}))()}}]),a}(l)),t.setEndingStyle&&t.getEndingStyle&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setEndingStyle",value:function(t,e){var n=this,r=this;return A((function(){return T(this,(function(c){return[2,a.handleSetEndingStyle((function(){return u(o(i.prototype),"setEndingStyle",n).call(r,t,e)}),t,e)]}))}))()}}]),i}(l)),t.setStyleFillColor&&t.setStyleFillColor&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setStyleFillColor",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(s){switch(s.label){case 0:return i=u(o(a.prototype),"getStyleFillColor",n).call(r),[4,u(o(a.prototype),"setStyleFillColor",n).call(r,e)];case 1:return s.sent(),c.pushUndoStack(t,m.SET_STYLE_FILL_COLOR,{annot:t,oldStyleFillColor:i,newStyleFillColor:e}),[2]}}))}))()}}]),a}(l)),t.setLeaderLineExtend&&t.getLeaderLineExtend&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setLeaderLineExtend",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(s){switch(s.label){case 0:return i=r.getLeaderLineExtend(),[4,u(o(a.prototype),"setLeaderLineExtend",n).call(r,e)];case 1:return s.sent(),c.pushUndoStack(t,m.SET_LEADER_LINE_EXTEND,{annot:t,oldLength:i,newLength:e}),[2]}}))}))()}}]),a}(l)),t.setLeaderLineOffset&&t.getLeaderLineOffset&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setLeaderLineOffset",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(s){switch(s.label){case 0:return i=r.getLeaderLineOffset(),[4,u(o(a.prototype),"setLeaderLineOffset",n).call(r,e)];case 1:return s.sent(),c.pushUndoStack(t,m.SET_LEADER_LINE_OFFSET,{annot:t,oldOffset:i,newOffset:e}),[2]}}))}))()}}]),a}(l)),t.setLeaderLineLength&&t.getLeaderLineLength&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setLeaderLineLength",value:function(e){var n=this,r=this;return A((function(){var i;return T(this,(function(s){switch(s.label){case 0:return i=r.getLeaderLineLength(),[4,u(o(a.prototype),"setLeaderLineLength",n).call(r,e)];case 1:return s.sent(),c.pushUndoStack(t,m.SET_LEADER_LINE_LENGTH,{annot:t,oldLength:i,newLength:e}),[2]}}))}))()}}]),a}(l)),t.setCaptionOffset&&t.getCaptionOffset&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setCaptionOffset",value:function(e,n){var r=this,i=this;return A((function(){var s,l;return T(this,(function(f){switch(f.label){case 0:return s=i.getCaptionOffset(),[4,u(o(a.prototype),"setCaptionOffset",r).call(i,e,n)];case 1:return f.sent(),l=i.getCaptionOffset(),c.pushUndoStack(t,m.SET_CAPTION_OFFSET,{annot:t,oldOffset:s,newOffset:l}),[2]}}))}))()}}]),a}(l)),t.getVertexes&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"updateVertexes",value:function(e,n){var r=this,i=this,s=function(){return u(o(a.prototype),"getVertexes",r)};return A((function(){var l,f;return T(this,(function(d){switch(d.label){case 0:return l=s().call(i),[4,u(o(a.prototype),"updateVertexes",r).call(i,e,n)];case 1:return d.sent(),f=s().call(i),c.pushUndoStack(t,m.UPDATEVERTEXES,{annot:t,oldIndex:e,newIndex:e,newVertexes:f,oldVertexes:l}),[2]}}))}))()}},{key:"setVertexes",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getVertexes",n)};return A((function(){var s,l;return T(this,(function(f){switch(f.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setVertexes",n).call(r,e)];case 1:return f.sent(),l=i().call(r),c.pushUndoStack(t,m.SET_VERTEXES,{annot:t,newVertexes:l,oldVertexes:s}),[2]}}))}))()}}]),a}(l)),t.setIconName&&t.getIconName&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setIconName",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getIconName",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setIconName",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),s===f?[2,l]:(c.pushUndoStack(t,m.SETICONNAME,{annot:t,oldIconName:s,newIconName:f}),[2,l])}}))}))()}}]),a}(l)),t.getAlignment&&t.setAlignment&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setAlignment",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getAlignment",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setAlignment",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),s===f?[2,l]:(c.pushUndoStack(t,m.SET_ALIGNMENT,{annot:t,oldAlignment:s,newAlignment:f}),[2,l])}}))}))()}}]),a}(l)),"freetext"===t.getType()&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setInnerRect",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getInnerRect",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setInnerRect",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),c.pushUndoStack(t,m.SET_INNER_RECT,{annot:t,oldInnerRect:s,newInnerRect:f}),[2,l]}}))}))()}},{key:"setCalloutLinePoints",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getRect",n)},s=function(){return u(o(a.prototype),"getCalloutLinePoints",n)},l=function(){return u(o(a.prototype),"getInnerRect",n)};return A((function(){var f,d,h,p,v,y,E;return T(this,(function(g){switch(g.label){case 0:return f=i().call(r),d=s().call(r),h=l().call(r),[4,u(o(a.prototype),"setCalloutLinePoints",n).call(r,e)];case 1:return p=g.sent(),v=i().call(r),y=s().call(r),E=l().call(r),c.pushUndoStack(t,m.UPDATECALLOUTPOINTS,{annot:t,oldRect:f,oldCalloutLinePoints:d,oldInnerRect:h,newRect:v,newCalloutLinePoints:y,newInnerRect:E}),[2,p]}}))}))()}},{key:"setCalloutLineEndingStyle",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getCalloutLineEndingStyle",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setCalloutLineEndingStyle",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),s!==f&&c.pushUndoStack(t,m.SET_CALLOUT_LINE_ENDING_STYLE,{annot:t,oldStyle:s,newStyle:f}),[2,l]}}))}))()}}]),a}(l)),t.setDefaultAppearance&&t.getDefaultAppearance&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setDefaultAppearance",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getDefaultAppearance",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setDefaultAppearance",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),c.pushUndoStack(t,m.SET_DEFAULT_APPEARANCE,{annot:t,oldAp:s,newAp:f}),[2,l]}}))}))()}}]),a}(l)),t.setRotation&&t.getRotation&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setRotation",value:function(t){var e=this,n=this;return A((function(){return T(this,(function(r){return[2,a.handleSetRotation((function(){return u(o(i.prototype),"setRotation",e).call(n,t)}))]}))}))()}}]),i}(l)),t.setInkList&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setInkList",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getInkList",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setInkList",n).call(r,e)];case 1:return l=d.sent(),f=i().call(r),c.pushUndoStack(t,m.SET_INK_LIST,{annot:t,oldInkList:s,newInkList:f}),[2,l]}}))}))()}}]),a}(l)),t.setHighlightingMode&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setHighlightingMode",value:function(t){var e=this,n=this;return A((function(){return T(this,(function(r){return[2,a.handleSetHighlightingMode((function(){return u(o(i.prototype),"setHighlightingMode",e).call(n,t)}))]}))}))()}}]),i}(l)),t.setAction&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"setAction",value:function(t,e,n){var r=this,c=this;return A((function(){return T(this,(function(s){return[2,a.handleSetAction((function(){return u(o(i.prototype),"setAction",r).call(c,t,e,n)}),t,e,n)]}))}))()}}]),i}(l)),t.moveAction&&(l=function(t){s(o,t);var n=y(o);function o(){return e(this,o),n.apply(this,arguments)}return r(o,[{key:"moveAction",value:function(t){return A((function(){return T(this,(function(e){return[2,a.handleMoveAction(t)]}))}))()}}]),o}(l)),t.removeAction&&(l=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"removeAction",value:function(t,e){var n=this,r=this;return A((function(){return T(this,(function(c){return[2,a.handleRemoveAction((function(){return u(o(i.prototype),"removeAction",n).call(r,t,e)}),t,e)]}))}))()}}]),i}(l)),t.setActionData&&(l=function(t){s(o,t);var n=y(o);function o(){return e(this,o),n.apply(this,arguments)}return r(o,[{key:"setActionData",value:function(t,e){return A((function(){return T(this,(function(n){return[2,a.handleSetActionData(t,e)]}))}))()}}]),o}(l)),"redact"===t.getType()&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setOverlayText",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getOverlayText",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setOverlayText",n).call(r,e)];case 1:return l=d.sent(),(f=i().call(r))!==s&&c.pushUndoStack(t,m.SET_OVERLAY_TEXT,{annot:t,newValue:f,oldValue:s}),[2,l]}}))}))()}},{key:"removeOverlayText",value:function(){var e=this,n=this;return A((function(){var r,i;return T(this,(function(s){switch(s.label){case 0:return r=u(o(a.prototype),"getOverlayText",e).call(n),[4,u(o(a.prototype),"removeOverlayText",e).call(n)];case 1:return i=s.sent(),void 0!==r&&c.pushUndoStack(t,m.REMOVE_OVERLAY_TEXT,{annot:t,oldValue:r}),[2,i]}}))}))()}},{key:"setOverlayTextAlignment",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getOverlayTextAlignment",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setOverlayTextAlignment",n).call(r,e)];case 1:return l=d.sent(),(f=i().call(r))!==s&&c.pushUndoStack(t,m.SET_OVERLAY_TEXT_ALIGNMENT,{annot:t,newValue:f,oldValue:s}),[2,l]}}))}))()}},{key:"setRepeat",value:function(e){var n=this,r=this,i=function(){return u(o(a.prototype),"getRepeat",n)};return A((function(){var s,l,f;return T(this,(function(d){switch(d.label){case 0:return s=i().call(r),[4,u(o(a.prototype),"setRepeat",n).call(r,e)];case 1:return l=d.sent(),(f=i().call(r))!==s&&c.pushUndoStack(t,m.SET_REPEAT,{annot:t,newValue:f,oldValue:s}),[2,l]}}))}))()}},{key:"setRedactApplyFillColor",value:function(e){var n=this,r=this;return A((function(){var i,s,l;return T(this,(function(f){switch(f.label){case 0:return i=t.info.applyFillColor,[4,u(o(a.prototype),"setRedactApplyFillColor",n).call(r,e)];case 1:return s=f.sent(),(l=t.info.applyFillColor)!==i&&c.pushUndoStack(t,m.SET_REDACT_APPLY_FILL_COLOR,{annot:t,newValue:l,oldValue:i}),[2,s]}}))}))()}}]),a}(l)),t.setImage&&t.getImage&&(l=function(n){s(a,n);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"setImage",value:function(e){var n=this,r=this;return A((function(){var i,s,l;return T(this,(function(f){switch(f.label){case 0:return[4,u(o(a.prototype),"getImage",n).call(r,"buffer")];case 1:return i=f.sent(),[4,u(o(a.prototype),"setImage",n).call(r,e)];case 2:return s=f.sent(),l=e,c.pushUndoStack(t,m.SET_IMAGE,{annot:t,oldValue:i,newValue:l}),[2,s]}}))}))()}}]),a}(l)),new l}}function ae(t,n){var i=function(t){s(a,t);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"getPageByIndex",value:function(t){return u(o(a.prototype),"getPageByIndex",this).call(this,t).then((function(t){return ue(t,n)}))}},{key:"getPageById",value:function(t){var e=u(o(a.prototype),"getPageById",this).call(this,t);return e?ue(e,n):e}},{key:"addAnnot",value:function(t,e){var r=this,i=this;return A((function(){var c;return T(this,(function(s){switch(s.label){case 0:return[4,u(o(a.prototype),"addAnnot",r).call(i,t,e)];case 1:return c=s.sent(),n.create("annot",m.ADDANNOT,{annot:c[0]}),[2,ce(c,n)]}}))}))()}},{key:"getAnnots",value:function(){var t=this,e=this;return A((function(){return T(this,(function(r){switch(r.label){case 0:return[4,u(o(a.prototype),"getAnnots",t).call(e)];case 1:return[2,r.sent().map((function(t){return ce(t,n)}))]}}))}))()}}]),a}(Ut.Proxy.getProxyClass(t.constructor,(function(e,n,r){var o;return(o=n).call.apply(o,[t].concat(d(r)))}),(function(){})));return new i}function ue(t,n){var i=function(t){s(a,t);var i=y(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"addAnnot",value:function(t){for(var e=this,r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];var s=this;return A((function(){var r,c;return T(this,(function(l){switch(l.label){case 0:return[4,(r=u(o(a.prototype),"addAnnot",e)).call.apply(r,[s,t].concat(d(i)))];case 1:return c=l.sent(),n.create("annot",m.ADDANNOT,{annot:c[0]}),[2,ce(c,n)]}}))}))()}},{key:"removeAnnotById",value:function(t){var e=this,r=this;return A((function(){var i,c,s;return T(this,(function(l){switch(l.label){case 0:return[4,u(o(a.prototype),"getAnnots",e).call(r)];case 1:return i=l.sent(),(c=i.find((function(e){return t&&t===e.getUniqueID()})))?[4,u(o(a.prototype),"removeAnnotById",e).call(r,t)]:[2,[]];case 2:return 0===(s=l.sent()).length?[2,[]]:(n.create("annot",m.REMOVEANNOT,[s,c]),[2,s])}}))}))()}},{key:"removeAnnotByObjectNumber",value:function(t){var e=this,r=this;return A((function(){var i,c,s;return T(this,(function(l){switch(l.label){case 0:return[4,u(o(a.prototype),"getAnnots",e).call(r)];case 1:return i=l.sent(),(c=i.find((function(e){return t===e.getId()})))?[4,u(o(a.prototype),"removeAnnotByObjectNumber",e).call(r,t)]:[2,[]];case 2:return 0===(s=l.sent()).length?[2,[]]:(n.create("annot",m.REMOVEANNOT,[s,c]),[2,s])}}))}))()}},{key:"getAnnots",value:function(){for(var t=this,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var c=this;return A((function(){var e;return T(this,(function(i){switch(i.label){case 0:return[4,(e=u(o(a.prototype),"getAnnots",t)).call.apply(e,[c].concat(d(r)))];case 1:return[2,ce(i.sent(),n)]}}))}))()}},{key:"getAnnotsByObjectNumArray",value:function(){for(var t=this,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var c=this;return A((function(){var e;return T(this,(function(i){switch(i.label){case 0:return[4,(e=u(o(a.prototype),"getAnnotsByObjectNumArray",t)).call.apply(e,[c].concat(d(r)))];case 1:return[2,ce(i.sent(),n)]}}))}))()}},{key:"getAnnotsByIdArray",value:function(){for(var t=this,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var c=this;return A((function(){var e;return T(this,(function(i){switch(i.label){case 0:return[4,(e=u(o(a.prototype),"getAnnotsByIdArray",t)).call.apply(e,[c].concat(d(r)))];case 1:return[2,ce(i.sent(),n)]}}))}))()}},{key:"getMarkupAnnots",value:function(){var t=this,e=this;return A((function(){return T(this,(function(r){switch(r.label){case 0:return[4,u(o(a.prototype),"getMarkupAnnots",t).call(e)];case 1:return[2,ce(r.sent(),n)]}}))}))()}},{key:"getAnnotTree",value:function(){var t=this,e=this;return A((function(){return T(this,(function(r){switch(r.label){case 0:return[4,u(o(a.prototype),"getAnnotTree",t).call(e)];case 1:return[2,ce(r.sent(),n)]}}))}))()}}]),a}(Ut.Proxy.getProxyClass(t.constructor,(function(e,n,r){var o;return(o=n).call.apply(o,[t].concat(d(r)))}),(function(){})));return new i}function ce(t,e){if(0===t.length)return t;var n=[];return new window.Proxy(t,{get:function(t,r){return"symbol"===(void 0===r?"undefined":v(r))?t[r]:r>-1&&r<t.length?n[r]?n[r]:n[r]=ie(t[r],e):"__isProxy"===r||t[r]}})}var se=function(){function t(n,r){e(this,t),$(this,"pdfViewer",void 0),$(this,"controller",void 0),this.pdfViewer=n,this.controller=r}return r(t,[{key:"pushUndoStack",value:function(t,e){this.controller.create("touchup",t,e)}}]),t}(),le=function(){function t(n,r){e(this,t),$(this,"pdfViewer",void 0),$(this,"controller",void 0),$(this,"lastItem",void 0),this.pdfViewer=n,this.controller=r}return r(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){var t=this;this.pdfViewer.eventEmitter.on("pageeditor-notify",(function(e,n){"onAddUndo"===e&&n&&t.lastItem!==n.item&&(t.lastItem=n.item,t.pushUndoStack("exitEdit",{isEditing:!1}))}))}},{key:"pushUndoStack",value:function(t,e){this.controller.create("pageEditor",t,e)}}]),t}(),fe=function(){function t(n,r){e(this,t),$(this,"pdfViewer",void 0),$(this,"controller",void 0),this.pdfViewer=n,this.controller=r}return r(t,[{key:"pushUndoStack",value:function(t,e){this.controller.create("formDesigner",t,e)}}]),t}(),de=E.UIEvents,he=E.PDFViewCtrl.keyboard,pe=he.BuiltinCommand,ve=he.BuiltinShortcutContext,ye=he.interceptors,Ee=function(){function t(n){e(this,t),this.pdfViewer=n}return r(t,[{key:"isDisabled",value:function(){return-1!==["touch-up-editor","page-editor"].indexOf(this.pdfViewer.stateHandlerManager.getCurrentStates().getStateName())}},{key:"init",value:function(){var t=this,e=this.undoRedoManager=new _(this.pdfViewer),n=this.controller=new Lt(this.pdfViewer,e);(this.annotModule=new R(this.pdfViewer,n)).init(),(this.bookmarkModule=new jt(this.pdfViewer,n)).init(),(this.attachmentModule=new xt(this.pdfViewer,n)).init(),(this.rotatePageModule=new Vt(this.pdfViewer,n)).init();this.touchUpModule=new se(this.pdfViewer,n);(this.pageEditorModule=new le(this.pdfViewer,n)).init();this.formDesignerModule=new fe(this.pdfViewer,n);var r=!1,o=!1;this.pdfViewer.getKeyboard().withContext(ve.VIEWER,(function(e){var n={interceptors:[ye.excludeEditableElementInterceptor(),ye.preventDefaultInterceptor()]};e.keydown(pe.UNDO_OPERATION,(function(){t.isDisabled()||r||(t.undo(),r=!0,setTimeout((function(){return r=!1}),300))}),n),e.keydown(pe.REDO_OPERATION,(function(){t.isDisabled()||o||(t.redo(),o=!0,setTimeout((function(){return o=!1}),300))}),n)})),this.pdfViewer.eventEmitter.on(de.willCloseDocument,(function(){n.clear()}))}},{key:"undo",value:function(){return this.controller.undo()}},{key:"redo",value:function(){return this.controller.redo()}},{key:"undoAll",value:function(){return this.controller.undoAll()}},{key:"pushUndoStack",value:function(t,e,n){switch(t){case"bookmark":this.bookmarkModule.pushUndoStack(e,n);break;case"touchup":this.touchUpModule.pushUndoStack(e,n);break;case"formDesigner":this.formDesignerModule.pushUndoStack(e,n)}}},{key:"restMergeStatus",value:function(){this.annotModule.resetMergeStatus()}},{key:"invoke",value:function(t){var e=this;return A((function(){var n;return T(this,(function(r){if("function"!=typeof t)throw new Error("Incorrect parameter: The callback is not a function");return(n=e.pdfViewer.getCurrentPDFDoc())?[2,t(ae(n,e.controller))]:[2,t(null)]}))}))()}}]),t}(),ge=i(1843),Ae=i.n(ge);const Te=function(t){s(i,t);var n=y(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"init",value:function(t){var e=this;u(o(i.prototype),"init",this).call(this,t),this.addonPromise=t.getPDFViewer().then((function(t){if(!t.collaborationOptions||!t.collaborationOptions.enable)return e.addon=new Ee(t),e.addon.init(),e.addon}))}},{key:"undo",value:function(){return this.receiveAction("undo",[])}},{key:"undoAll",value:function(){return this.receiveAction("undoAll",[])}},{key:"redo",value:function(){return this.receiveAction("redo",[])}},{key:"invoke",value:function(t){return this.receiveAction("invoke",[t])}},{key:"pushUndoStack",value:function(t,e,n){return this.receiveAction("pushUndoStack",[t,e,n])}},{key:"receiveAction",value:function(t,e){return this.addonPromise.then((function(n){var r;if(!n)throw new Error("undo/redo is not supported when collaboration is enabled!");return(r=n)[t].apply(r,d(e||[]))}))}}],[{key:"getName",value:function(){return"undo-redo"}},{key:"getLoader",value:function(){return Ae()}}]),i}(E.UIXAddon)})(),a=a.default})()));