!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],e):"object"==typeof exports?exports.ImportFormUIXAddon=e(require("UIExtension")):t.ImportFormUIXAddon=e(t.UIExtension)}(self,(t=>(()=>{var e={359:t=>{t.exports=null},616:e=>{"use strict";e.exports=t}},n={};function o(t){var r=n[t];if(void 0!==r)return r.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";function t(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):t(e,n)}function e(e,n){if(!t(e,n))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function u(t,e,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n||t):r.value}},u(t,e,n||t)}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i=[],c=!0,u=!1;try{for(n=n.call(t);!(c=(o=n.next()).done)&&(i.push(o.value),!e||i.length!==e);c=!0);}catch(t){u=!0,r=t}finally{try{c||null==n.return||n.return()}finally{if(u)throw r}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(p=function(){return!!t})()}function m(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}function d(t){var e=p();return function(){var n,o=c(t);if(e){var r=c(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m(this,n)}}o.d(r,{default:()=>g});var b=o(616),y=o(359),v=o.n(y),h=b.PDFViewCtrl.Events,g=function(t){l(o,t);var n=d(o);function o(){return e(this,o),n.apply(this,arguments)}return i(o,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"importForm"}},{key:"getLoader",value:function(){return v()}},{key:"initOnLoad",value:function(){var t=b.modular.module("import-form-module",[]),n={template:'<ribbon-button @tooltip name="import-form-tool"  @var.self="$component" class="fx-ribbon-hidden-dropdown" text="import:ribbon.text" not-dropdown="true">\n        <dropdown @on.selected="self.select($args[0])" selected="0">\n                <file-selector ribbon-icon="fx-icon-ribbon_form_import-32" text="import:ribbon.text" @tooltip name="import-form-tool" accept=".xml,.fdf,.xfdf,.csv,.txt" icon-class="fx-icon-md fv__icon-toolbar-import-form" ></file-selector>\n        </dropdown>\n        </ribbon-button>\n                ',config:{target:"import-form-tool",tooltip:{title:"import:button-tooltip.title"},callback:function(t){l(o,t);var n=d(o);function o(){return e(this,o),n.apply(this,arguments)}return i(o,[{key:"changePermission",value:function(t){var e=this,n=this.getPDFUI().getPDFDocRender().then((function(t){return t&&t.getUserPermission().getValue()}));Promise.all([t&&!t.isDestroyed&&t.hasForm(),n,t&&t.isXFA()]).then((function(n){var o=f(n,3),r=o[0],i=o[1],c=o[2];i&e.constructor.permission&&r&&!t.isStaticXFA()||c?e.component.lock&&e.component.unlock():e.component.lock&&e.component.lock();var u=e.component.querySelector("@file-selector");u&&(c?u.setAccept(".xdp,.xml"):u.setAccept(".xml,.fdf,.xfdf,.csv,.txt"))}))}},{key:"mounted",value:function(){var t=this;u(c(o.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(h.recognitionForm,(function(e){t.changePermission(e)})),this.getPDFUI().addViewerEventListener(h.formReloaded,(function(e){t.changePermission(e)})),this.getPDFUI().addViewerEventListener(h.annotationAdd,(function(e){t.getPDFUI().getPDFDocRender().then((function(e){t.changePermission(e.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(h.annotationRemoved,(function(e){t.getPDFUI().getPDFDocRender().then((function(e){t.changePermission(e.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(h.flattenAnnotation,(function(e,n){t.getPDFUI().getPDFDocRender().then((function(e){t.changePermission(e.getPDFDoc())}))})))}},{key:"handle",value:function(t){var e=this.getPDFUI(),n=e.progress("");e.getPDFDocRender().then((function(e){var n=e.getPDFDoc(),o=t.name,r=o.substr(o.lastIndexOf(".")+1,o.length),i=0,c=Promise.resolve();switch(r){case"fdf":i=0;break;case"xfdf":i=1;break;case"xml":i=2;break;case"csv":i=3,c=P(t);break;case"txt":i=4,c=P(t);break;case"xdp":i="xdp"}var u=n.isStaticXFA()||n.isDynamicXFA();return c.then((function(e){return e||3!==i||(e="GBK"),u?(i=2===i?"xml":i,n.importXFAFromFile(t,i)):n.importFormFromFile(t,i,e)}))})).finally((function(){n.then((function(t){return t.close()}))}))}}],[{key:"permission",get:function(){return b.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm+b.PDFViewCtrl.Consts.PDFDocPermission.FillForm}}]),o}(b.Controller)}};t.registerPreConfiguredComponent("import-form-ribbon-button",n),t.registerPreConfiguredComponent("import-form-button",Object.assign({},n,{template:'<file-selector @tooltip tooltip-title="import:button-tooltip.title" text="import:button-tooltip.title" name="import-form-tool" accept=".xml,.fdf,.xfdf,.csv,.txt" icon-class="fv__icon-toolbar-import-form" ></file-selector>'}))}}]),o}(b.UIXAddon),P=function(t){return new Promise((function(e,n){var o=new FileReader;o.onloadend=function(){var t=new Uint8Array(o.result);return 254==t[0]&&255==t[1]||255==t[0]&&254==t[1]?e("UTF-16"):239==t[0]&&187==t[1]&&191==t[2]?e("UTF-8"):0==t[0]&&0==t[1]&&254==t[2]&&255==t[3]?e("UTF-32"):void e()},o.readAsArrayBuffer(t)}))}})(),r=r.default})()));