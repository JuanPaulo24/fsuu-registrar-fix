!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.PasswordProtectAddon=t(require("UIExtension")):e.PasswordProtectAddon=t(e.UIExtension)}(self,(e=>(()=>{var t={759:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button @tooltip tooltip-title="password-protect:toolbar.protect.secureDocument" text="password-protect:toolbar.protect.secureDocument" icon-class="fx-icon-ribbon_protect_security_document-32" not-immediately="true" name="password-protect-controllers">\n<dropdown separate="false">\n<password-protect:password-protect-button></password-protect:password-protect-button>\n<password-protect:remove-protect-button></password-protect:remove-protect-button>\n</dropdown>\n</ribbon-button>','<ribbon-button @tooltip tooltip-title="password-protect:toolbar.protect.secureDocument" text="password-protect:toolbar.protect.secureDocument" icon-class="fx-icon-ribbon_protect_security_document-32" not-immediately="true" name="password-protect-controllers">\n<dropdown separate="false">\n<password-protect:password-protect-button></password-protect:password-protect-button>\n<password-protect:remove-protect-button></password-protect:remove-protect-button>\n</dropdown>\n</ribbon-button>'}},637:(e,t,n)=>{n(779);e.exports=function(e){"use strict";var t="";return t+='<div class="fv__ui-password-protect-permissionPopup-body">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__owner-permission-setting-checkbox checkbox-input" ',(e=e||{}).isAllowed&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.add-document-setting" class="fv__owner-lable"></span>\n</label>\n<div class="fv__password-caption" data-i18n="password-protect:dialog.permission-caption"></div>\n<div class="fv__password-permissions fv__password-container online-password-permissions">\n<div class="print-change-wrapper">\n\x3c!-- 打印 --\x3e\n<div class="print-wrapper">\n<span class="fv__permission-label online-label" data-i18n="password-protect:dialog.printing-label"></span>\n<select class="fv__permission-print online-print-select" ',e.isAllowed||(t+="disabled"),t+='>\n<option value="0" ',0==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-none"></option>\n<option value="1" ',1==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-low"></option>\n<option value="2" ',2==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-high"></option>\n</select>\n</div>\n\x3c!-- 打印 --\x3e\n\n\x3c!-- 更改 --\x3e\n<div class="change-wrapper">\n<span class="fv__permission-label online-label" data-i18n="password-protect:dialog.perm-change-label"></span>\n<select class="fv__permission-change online-change-select" ',e.isAllowed||(t+="disabled"),t+='>\n<option value="0" ',0==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-none"></option>\n<option value="1" ',1==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-1"></option>\n<option value="2" ',2==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-2"></option>\n<option value="3" ',3==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-3"></option>\n<option value="4" ',4==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-4"></option>\n</select>\n</div>\n\x3c!-- 更改 --\x3e\n</div>\n\x3c!-- 复制权限 --\x3e\n<label class="check-box-wrapper bottom-label">\n<div>\n<input type="checkbox" class="fv__permission-copy checkbox-input" ',e.isAllowed||(t+="disabled"),t+=" ",e.copy&&(t+=" checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span class="fv__permission-label" data-i18n="password-protect:dialog.perm-copy-label"></span>\n</div>\n</label>\n\x3c!-- 复制权限 --\x3e\n\x3c!-- 访问权限 --\x3e\n<label class="check-box-wrapper bottom-label">\n<div class="read-checkbox-wrapper">\n<input type="checkbox" class="fv__permission-accessibility checkbox-input" ',e.isAllowed&&!e.copy||(t+="disabled"),t+=" ",e.accessibility&&(t+=" checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span class="fv__permission-label" data-i18n="password-protect:dialog.perm-access-label"></span>\n</div>\n</label>\n\x3c!-- 访问权限 --\x3e\n</div>\n</div>\n<div class="fv__button-container footer">\n<button type="button" class="fv__password-btn fv__ui-dialog-ok-button fv__ui-button" data-i18n="password-protect:dialog.ok"></button>\n<button type="button" class="fv__password-cancel fv__ui-dialog-cancel-button fv__ui-button" data-i18n="password-protect:dialog.cancel"></button>\n</div>'}},943:(e,t,n)=>{var r=n(779);e.exports=function(e){"use strict";e=e||{};var t="",n=r.$escape;e.hideSaveToPolicy;return t+='<div class="fv__ui-password-protect-popup-body">\n<div class="fv__password-protect-error fv__hide">\n<div class="fv__password-protect-error-header"></div>\n<div class="fv__password-protect-error-msg"></div>\n</div>\n<form onsubmit="return false">\n<fieldset class="fv__ui-password-protect-fieldset">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.doc-open-caption"></legend>\n<div class="fv__user-password-container fv__password-container">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__user-password-checkbox checkbox-input" ',(e.userPassword||e.ownerPassword)&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.password-check-hint"  class="fv__user-lable"></span>\n</label>\n<div class="fv__user-password-input">\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-label" class="fv__user-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__user-password1" value="',t+=n(e.userPassword),t+='" ',e.userPassword||e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-user1"></div>\n</div>\n</label>\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-confirm-label" class="fv__user-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__user-password2" value="',t+=n(e.userPassword),t+='" ',e.userPassword||e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-user2"></div>\n</div>\n</label>\n<div style="clear:both"></div>\n</div>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.document-restriction-caption"> </legend>\n<div class="fv__owner-password-container fv__password-container document-permission-wrapper">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__owner-password-checkbox checkbox-input" ',e.ownerPassword&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.add-document-restriction" class="fv__owner-lable"></span>\n</label>\n<div class="fv__owner-password-input">\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-label" class="fv__owner-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__owner-password1" value="',t+=n(e.ownerPassword),t+='" ',e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-owner1"></div>\n</div>\n</label>\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-confirm-label" class="fv__owner-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__owner-password2" value="',t+=n(e.ownerPassword),t+='" ',e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-owner2"></div>\n</div>\n</label>\n<div style="clear:both"></div>\n</div>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset">\n<div class="fv__password-caption" data-i18n="password-protect:dialog.permission-specific-caption"></div>\n<div class="fv__owner-password-container document-permission-wrapper-inner">\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Printing"></div>\n',0===e.print?t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-none"></div>\n':1===e.print?t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-low"></div>\n':2===e.print&&(t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-high"></div>\n'),t+='\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Accessiability"></div>\n<div class="permission-detail-value accessiability-value" ',e.accessibility&&(t+=' data-i18n="password-protect:dialog.Allowed"'),t+=" ",e.accessibility||(t+=' data-i18n="password-protect:dialog.NotAllowed"'),t+='></div>\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Copying"></div>\n<div class="permission-detail-value copying-value" ',e.copy&&(t+=' data-i18n="password-protect:dialog.Allowed"'),t+=" ",e.copy||(t+=' data-i18n="password-protect:dialog.NotAllowed"'),t+='></div>\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Changes"></div>\n',0===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-none"></div>\n':1===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-1"></div>\n':2===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-2"></div>\n':3===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-3"></div>\n':4===e.change&&(t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-4"></div>\n'),t+='\n</div>\n<button type="button" class="permission-edit-btn fv__ui-button" ',e.ownerPassword||(t+="disabled"),t+=' data-i18n="password-protect:dialog.permission"></button>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset encrypt-config-wrapper">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.encrypt-caption"></legend>\n<div class="fv__encrypt-setting-container fv__password-container">\n<div>\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__encrypt-not-metadata checkbox-input" ',e.isEncryptMetadata||(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.enc-no-metadata" class="fv__encrypt-lable"></span>\n</label>\n</div>\n<div class="fv__encrypt-settings-radiobox-container">\n<span data-i18n="password-protect:dialog.enc-alg-label" class="fv__encrypt-lable" style="margin-left:5px;"></span>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="aes128" ',"aes128"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>128-bit AES\n</label>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="aes256" ',"aes256"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>256-bit AES\n</label>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="rc4" ',"rc4"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>128-bit ARC-FOUR\n</label>\n</div>\n</div>\n</fieldset>\n</form>\n</div>\n<div class="fv__button-container footer password-protect-footer">\n',t+='\n<button type="button" class="fv__password-btn fv__ui-dialog-ok-button fv__ui-button" ',e.ownerPassword||e.userPassword||(t+="disabled"),t+=' data-i18n="password-protect:dialog.ok"></button>\n<button type="button" class="fv__password-cancel fv__ui-dialog-cancel-button fv__ui-button" data-i18n="password-protect:dialog.cancel"></button>\n</div>\n'}},480:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-toolbar-show-text-button" name="remove-protect-btn" @tooltip tooltip-title="password-protect:buttons.removeTitle" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_remove_protect-16" text="password-protect:buttons.removeTitle">password-protect:buttons.removeTitle</xbutton>','<xbutton class="fv__ui-toolbar-show-text-button" name="remove-protect-btn" @tooltip tooltip-title="password-protect:buttons.removeTitle" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_remove_protect-16" text="password-protect:buttons.removeTitle">password-protect:buttons.removeTitle</xbutton>'}},841:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-toolbar-show-text-button" name="password-protect-btn" @tooltip tooltip-title="password-protect:buttons.title" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_password_protect-16" text="password-protect:buttons.title">password-protect:buttons.title</xbutton>','<xbutton class="fv__ui-toolbar-show-text-button" name="password-protect-btn" @tooltip tooltip-title="password-protect:buttons.title" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_password_protect-16" text="password-protect:buttons.title">password-protect:buttons.title</xbutton>'}},64:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},s=Object.create(r),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}s.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var r="",s=void 0,a=void 0,i=void 0;for(s=n.index,a=0;s<t.length;s++){switch(t.charCodeAt(s)){case 34:i="&#34;";break;case 38:i="&#38;";break;case 39:i="&#39;";break;case 60:i="&#60;";break;case 62:i="&#62;";break;default:continue}a!==s&&(r+=t.substring(a,s)),a=s+1,r+=i}return a!==s?r+t.substring(a,s):r}(a(e))},s.$each=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(e[n],n);else for(var s in e)t(e[s],s)},e.exports=s},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function i(e,t,n){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var s=Object.getOwnPropertyDescriptor(r,t);return s.get?s.get.call(n||e):s.value}},i(e,t,n||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function f(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return o}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(b=function(){return!!e})()}function m(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function y(e){var t=b();return function(){var n,r=a(e);if(t){var s=a(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return m(this,n)}}r.d(s,{default:()=>fe});var g=r(616);function _(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var P,k=r(943),x=r.n(k),D=g.vendors.jQuery,S="password-input-tip",C=function(){D("."+S).remove()},E=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(C(),e){var r=D('<span class="'.concat(S,'"><span>')),s=D('<i class="password-input-tip-text" role="alert" aria-live="assertive" ><i>');if(s.text(e),r.empty().append(s),n)D(t).before(r),r.css({left:0,top:"calc(100% + 8px)"}).addClass("relative");else{var o=t.getBoundingClientRect();r.css({left:o.left-13+"px"}).appendTo("body"),r.css({top:o.top+35+"px"})}}},A=g.PDFViewCtrl.shared,O=A.cipherType,T=A.securityUtils,q=function(e){l(r,e);var n=y(r);function r(e,s,o){var a;return t(this,r),(a=n.call(this,e,s,o)).userPasswordChanged=!1,a.permissionData={},a.destroyDataHooks=[],P=o.i18next,a.addDestroyHook((function(){a.destroyDataHooks.forEach((function(e){return e()}))})),a}return o(r,[{key:"bindEvent",value:function(e,t,n){var r=this,s=this.element.querySelectorAll(e);0!=s.length&&s.forEach((function(e){e.addEventListener(t,n),r.destroyDataHooks.push((function(){e.removeEventListener(t,n)}))}))}},{key:"render",value:function(){i(a(r.prototype),"render",this).call(this),this.element.classList.add("fv__password-protect-popup")}},{key:"setSubmitCallback",value:function(e){this.permissionData={},this.submitCallback=e}},{key:"getFormDataAndCheckDataValid",value:function(){var e,t,n,r={userPassword:!1,ownerPassword:!1,algorithm:!1,encryptMetadata:!1};if(this.element.querySelectorAll('input[name="algorithm"]').forEach((function(t){t.checked&&(e=t.value)})),this.element.querySelector(".fv__user-password-checkbox").checked){t=this.element.querySelector(".fv__user-password1").value;var s=this.element.querySelector(".fv__user-password2").value;if(t.length>32){var o=P.t("password-protect:error.pwdLength");return E(o,this.element.querySelector(".fv__user-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}if(C(),t!==s){if(this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),""!==t&&""!==s){var a=P.t("password-protect:error.open-pwd-not-match");E(a,this.element.querySelector(".fv__user-password2"),!0)}return!1}}else t=this.userPasswordChanged?"":e==O.AES256?-1:this.originData.userPassword;if(this.element.querySelector(".fv__owner-password-checkbox").checked){this.element.querySelector(".permission-edit-btn").removeAttribute("disabled"),n=this.element.querySelector(".fv__owner-password1").value;var i=this.element.querySelector(".fv__owner-password2").value;if(n.length>32){var c=P.t("password-protect:error.pwdLength");return E(c,this.element.querySelector(".fv__owner-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}if(C(),n!==i){if(this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),""!==n&&""!==i){var l=P.t("password-protect:error.permission-pwd-not-match");E(l,this.element.querySelector(".fv__owner-password2"),!0)}return!1}}else n=this.element.querySelector(".fv__owner-password1").value=this.element.querySelector(".fv__owner-password2").value="",this.element.querySelector(".permission-edit-btn").setAttribute("disabled","");if(!(t&&-1!==t||n))return this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),C(),!1;if(t===n){var p=P.t("password-protect:error.open-owner-pwd-cannot-same");return E(p,this.element.querySelector(".fv__owner-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}var d=!this.element.querySelector(".fv__encrypt-not-metadata").checked;C(),this.element.querySelector(".fv__password-btn").removeAttribute("disabled"),this.userPasswordChanged&&(r.userPassword=!0),n!==this.originData.ownerPassword&&(r.ownerPassword=!0),"{}"===JSON.stringify(this.permissionData)&&(this.permissionData=this.originData);var u=this.permissionData,f=u.print,v=u.accessibility,w=u.copy,h=u.change,b=u.isAllowed;return[t,n,{value:T.convertUIDataToPermission({print:Number(f),accessibility:Boolean(v),copy:Boolean(w),change:Number(h)}),isAllowed:b},e,d,r]}},{key:"updateData",value:function(e){var t=this,n=this;this.userPasswordChanged=!1,this.originData=e,this.destroyDataHooks.forEach((function(e){return e()})),this.element.querySelector(".fv__ui-layer-panel").innerHTML=x()(e),this.localize(),this.bindEvent(".fv__show-password","click",(function(e){var t=e.srcElement;t.classList.contains("fv__hide-password")?(t.classList.remove("fv__hide-password"),t.previousElementSibling.type="password"):(t.classList.add("fv__hide-password"),t.previousElementSibling.type="text")})),this.bindEvent(".fv__password","keyup",(function(e){e.srcElement.value=e.srcElement.value.replace(/[^\x00-\x80]/g,""),t.getFormDataAndCheckDataValid()})),this.bindEvent(".fv__password-btn","click",(function(e){t.submit()})),this.bindEvent(".fv__password-cancel","click",(function(e){var r=n._showParams||{};r.cancelAfter&&r.cancelAfter(),n._showParams={},t.hide(),C()})),this.bindEvent(".permission-edit-btn","click",(function(n){t.pdfUI.openDialog("password-protect-permissionPopup").then((function(n){n.show(),n.updateData(d({},e,t.permissionData)),n.setSubmitCallback((function(e){n.hide(),t.permissionData=e;var r=e.copy,s=e.accessibility,o=e.change,a=e.print,i=t.element.querySelector(".copying-value"),c=t.element.querySelector(".accessiability-value"),l=t.element.querySelector(".changes-value"),p=t.element.querySelector(".printing-value"),d="password-protect:dialog.Allowed",u="password-protect:dialog.NotAllowed";switch(i.innerHTML=r?P.t(d):P.t(u),c.innerHTML=s?P.t(d):P.t(u),a){case 0:default:p.innerHTML=P.t("password-protect:dialog.printing-none");break;case 1:p.innerHTML=P.t("password-protect:dialog.printing-low");break;case 2:p.innerHTML=P.t("password-protect:dialog.printing-high")}switch(o){case 0:default:l.innerHTML=P.t("password-protect:dialog.perm-changes-none");break;case 1:l.innerHTML=P.t("password-protect:dialog.perm-changes-1");break;case 2:l.innerHTML=P.t("password-protect:dialog.perm-changes-2");break;case 3:l.innerHTML=P.t("password-protect:dialog.perm-changes-3");break;case 4:l.innerHTML=P.t("password-protect:dialog.perm-changes-4")}}))}))})),this.bindEvent(".fv__icon-layer-close","click",(function(e){var t=n._showParams||{};t.cancelAfter&&t.cancelAfter(),n._showParams={},C()}));var r=this.element.querySelector(".fv__user-password-checkbox"),s=this.element.querySelectorAll(".fv__user-password-input input"),o=e.userPassword&&e.userPassword.length>0;r.checked=o,s.forEach((function(e){return e.disabled=!o})),this.bindEvent(".fv__user-password-checkbox","change",(function(e){t.element.querySelectorAll(".fv__user-password-container input").forEach((function(n){n!==e.target&&(n.disabled=!e.target.checked,n.disabled&&(n.value=""),t.userPasswordChanged=!0)})),t.getFormDataAndCheckDataValid()})),this.bindEvent(".fv__owner-password-checkbox","change",(function(e){t.element.querySelectorAll(".fv__owner-password-container input").forEach((function(t){t!==e.target&&(t.disabled=!e.target.checked,t.disabled&&(t.value=""))})),t.getFormDataAndCheckDataValid(),e.target.checked&&t.pdfUI.alert({message:"password-protect:warning.restriction-warn",level:"warning",again:!0,id:"password-restriction-warn"})}))}},{key:"submit",value:function(){var e=this._showParams||{};e.successAfter&&e.successAfter();var t=this.getFormDataAndCheckDataValid();if("boolean"!=typeof t||t)return this.submitCallback.apply(this,_(t))}},{key:"showError",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-header").innerHTML=P.t("password-protect:dialog.warn"),this.element.querySelector(".fv__password-protect-error").classList.add("fv__warn")):(this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-header").innerHTML=P.t("password-protect:dialog.error"),this.element.querySelector(".fv__password-protect-error").classList.remove("fv__warn")),this.element.querySelector(".fv__password-protect-error").classList.remove("fv__hide");var t=e;"string"!=typeof t&&e.message&&(t=e.message),this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-msg").innerHTML=t}},{key:"hideError",value:function(){this.element.querySelector(".fv__password-protect-error").classList.add("fv__hide")}},{key:"isSaveToPolicy",value:function(){var e=this.element.querySelector("#password-protect-save-to-policy");return!!e&&e.checked}}],[{key:"getName",value:function(){return"password-protect-popup"}}]),r}(g.widgets.LayerComponent),I=r(637),U=r.n(I),L=[{value:0,text:"password-protect:dialog.printing-none"},{value:1,text:"password-protect:dialog.printing-low"},{value:2,text:"password-protect:dialog.printing-high"}],j=[{value:0,text:"password-protect:dialog.perm-changes-none"},{value:1,text:"password-protect:dialog.perm-changes-1"},{value:2,text:"password-protect:dialog.perm-changes-2"},{value:3,text:"password-protect:dialog.perm-changes-3"},{value:4,text:"password-protect:dialog.perm-changes-4"}],F=g.shared.refactorSelect,V=function(e){l(r,e);var n=y(r);function r(e,s,o){var a;return t(this,r),(a=n.call(this,e,s,o)).destroyDataHooks=[],a.showaccessibilityTip=!0,a.addDestroyHook((function(){a.destroyDataHooks.forEach((function(e){return e()}))})),a}return o(r,[{key:"bindEvent",value:function(e,t,n){var r=this,s=this.element.querySelectorAll(e);0!=s.length&&s.forEach((function(e){e.addEventListener(t,n),r.destroyDataHooks.push((function(){e.removeEventListener(t,n)}))}))}},{key:"render",value:function(){i(a(r.prototype),"render",this).call(this),this.element.classList.add("fv__password-protect-permissionPopup")}},{key:"setSubmitCallback",value:function(e){this.submitCallback=e}},{key:"getFormData",value:function(){var e,t,n,r,s=this.element.querySelector(".fv__owner-permission-setting-checkbox").checked;return s?(e=this.printQualityComp.getValue(),t=this.element.querySelector(".fv__permission-accessibility").checked,n=this.element.querySelector(".fv__permission-copy").checked,r=this.permissionComp.getValue()):(e=2,t=!0,n=!0,r=4),{isAllowed:s,print:Number(e),accessibility:Boolean(t),copy:Boolean(n),change:Number(r)}}},{key:"updateData",value:function(e){var t=this;this.showaccessibilityTip=!0,this.destroyDataHooks.forEach((function(e){return e()})),this.element.querySelector(".fv__ui-layer-panel").innerHTML=U()(e),this.refactorSelector(e),this.localize(),this.bindEvent(".fv__owner-permission-setting-checkbox","change",(function(e){t.element.querySelectorAll(".fv__password-permissions input").forEach((function(t){if(t!==e.target){t.disabled=!e.target.checked;(function(e){var t=function(e){return!!e&&e.classList.contains("check-box-wrapper")},n=e.parentElement;if(t(n))return n;t(n&&n.parentElement)&&n.parentElement})(t)}})),t.printQualityComp[e.target.checked?"enable":"disable"](),t.permissionComp[e.target.checked?"enable":"disable"]();var n=t.element.querySelector(".fv__permission-copy"),r=t.element.querySelector(".fv__permission-accessibility");n.checked&&(r.disabled=!0),t.getFormData()})),this.bindEvent(".fv__permission-copy","change",(function(e){var n=t.element.querySelector(".fv__permission-accessibility");n.disabled=e.target.checked,e.target.checked&&(n.checked=!0)})),this.bindEvent(".fv__permission-accessibility","change",(function(e){!e.target.checked&&t.showaccessibilityTip&&(t.pdfUI.alert({message:"password-protect:warning.reader-warn",level:"warning",again:!0}),t.showaccessibilityTip=!1)})),this.bindEvent(".fv__password-cancel","click",(function(e){t.hide()})),this.bindEvent(".fv__password-btn","click",(function(e){t.submitCallback(t.getFormData())}))}},{key:"submit",value:function(){var e=this.getFormData();if("boolean"!=typeof e||e)return this.submitCallback.apply(this,_(e))}},{key:"refactorSelector",value:function(e){var t=e.isAllowed,n=e.print,r=e.change,s=h(F(this.pdfUI,[{template:'<dropdown separate="false" name="stamp-input-type" @var.self="$component" class="fv__permission-print online-print-select">\n                            <xbutton @foreach="item in self.printQualities" tabindex=\'0\' @on.click="self.selectType($index)" @class="{\'active\':self.printQuality === item.value}" @setter.text="item.text"></xbutton>\n                        </dropdown>',parent:this,init:function(){this[t?"enable":"disable"](),this.selectType(n)},printQualities:L,printQuality:L[0].value,selectType:function(e){this.printQuality=this.printQualities[e].value,this.select(this.childAt(e)),this.digest()},getValue:function(){return this.printQuality}},{template:'<dropdown separate="false" name="stamp-input-type" @var.self="$component" class="fv__permission-change online-change-select">\n                            <xbutton @foreach="item in self.permissionTypes" tabindex=\'0\' @on.click="self.selectType($index)" @class="{\'active\':\n                            self.permissionType === item.value}" @setter.text="item.text"></xbutton>\n                        </dropdown>',parent:this,init:function(){this[t?"enable":"disable"](),this.selectType(r)},permissionTypes:j,permissionType:j[0].value,selectType:function(e){this.permissionType=this.permissionTypes[e].value,this.select(this.childAt(e)),this.digest()},getValue:function(){return this.permissionType}}]),2),o=s[0],a=s[1];this.printQualityComp=o,this.element.querySelector(".print-wrapper").replaceChild(this.printQualityComp.element,this.element.querySelector(".fv__permission-print")),this.permissionComp=a,this.element.querySelector(".change-wrapper").replaceChild(this.permissionComp.element,this.element.querySelector(".fv__permission-change"))}}],[{key:"getName",value:function(){return"password-protect-permissionPopup"}}]),r}(g.widgets.LayerComponent),H=r(64),M=r.n(H);function N(e,t,n,r,s,o,a){try{var i=e[o](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,s)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var o=e.apply(t,n);function a(e){N(o,r,s,a,i,"next",e)}function i(e){N(o,r,s,a,i,"throw",e)}a(void 0)}))}}function Q(e,t){var n,r,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var R=g.PDFViewCtrl.shared.SecurityUtils.convertPermissionToUIData,$=g.PDFViewCtrl.Events,z=g.PDFViewCtrl.shared.securityEncryptType,J=g.PDFViewCtrl.shared.securityUtils,K=g.PDFViewCtrl.Consts.PDFDocPermission,G=function(e){l(r,e);var n=y(r);function r(e){var s;return t(this,r),(s=n.call(this,e)).isAllowed=!1,s}return o(r,[{key:"changePermission",value:function(e){var t=this;e&&!e.isDestroyed?Promise.all([e.getUserPermissions(),e.isPdfaDoc(),e.pdfaEditable,e.getSecurityType()]).then((function(n){var r,s=h(n,4),o=(s[0],s[1]),a=s[2],i=s[3];!e||e.isDestroyed?r=!1:(i===z.Password?r=!0:(r=i===z.Certificate?e.isOwner():!o||o&&a,e.checkPermission(K.ModifyDocument)||(r=!1)),e.hasSignature()&&(r=!1)),r?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})):this.component.lock&&this.component.lock()}},{key:"mounted",value:function(){var e,t=this;i(a(r.prototype),"mounted",this).call(this),this.pdfUI.i18n.on("languageChanged",e=function(){var e=t.getComponentByName("password-protect-popup");e&&e.localize()}),this.addDestroyHook((function(){t.pdfUI.i18n.off("languageChanged",e)}),this.pdfUI.addViewerEventListener($.willCloseDocument,(function(){J.setPwdPopupLatestUIData(null),J.setInputOwnerPwd()})),this.pdfUI.addViewerEventListener($.openFileSuccess,(function(e){t.changePermission(e)})),this.pdfUI.addViewerEventListener($.docPasswordChanged,(function(e,n){J.changedPasswordAndPermission(t.pdfUI,Object.assign({},n,{permissionData:{value:n.permission,isAllowed:t.isAllowed}})),t.isAllowed=!1})))}},{key:"handle",value:function(){var e=this;return B((function(){var t,n;return Q(this,(function(r){return(t=e.pdfUI.pdfViewer.currentPDFDoc)?(e.component[t.hasSignature()?"disable":"enable"](),(n=J.getPwdPopupLatestUIData())?(e.showPopup(n),[2]):(Promise.all([t.getSecurityType(),t.getStdCipherOptions()]).then((function(n){var r=h(n,2),s=r[0],o=r[1],a=Object.assign(J.getPermissionDefaultUIData("password"),o,J.convertPermissionToUIData(o.permission));s===z.Password?t.hasOwnerPassword()&&!J.getInputOwnerPwd()?J.requestOwnerPassword(e.pdfUI,(function(n){a.ownerPassword=n,a.isAllowed=!0,e.isAllowed=!0,t.getUserPassword(n).then((function(t){a.userPassword=t,e.showPopup(a),J.setPwdPopupLatestUIData(a)}))})):(e.isAllowed=!1,a.ownerPassword=J.getInputOwnerPwd(),t.getUserPassword(a.ownerPassword).then((function(t){a.userPassword=t,e.showPopup(a)}))):s===z.Unknown||s===z.None?e.showPopup(a):e.pdfUI.confirm({message:"password-protect:warning.already-secured",level:"question"}).then((function(){e.showPopup(a)}),(function(){}))})),[2])):[2]}))}))()}},{key:"showPopup",value:function(e){var t=this;return B((function(){var n;return Q(this,(function(r){switch(r.label){case 0:return[4,t.pdfUI.openDialog("password-protect-popup")];case 1:return(n=r.sent()).updateData(e),n.setSubmitCallback((s=B((function(e,r,s,o,a,i){var c,l,p,u,f,v,w,h,b,m;return Q(this,(function(i){switch(i.label){case 0:return[4,t.getPDFUI()];case 1:return p=i.sent(),u=p.customs,f=u.startSDKSpan,v=u.otelService,f?[4,f("password-protect-submit")]:[3,3];case 2:w=i.sent(),h=w.end,b=w.span,c=h,l=b,i.label=3;case 3:return t.isAllowed=s.isAllowed,[4,t.pdfUI.getCurrentPDFDoc()];case 4:return(m=i.sent())?[2,m.setPasswordAndPermission(e,r,s.value,o,a).then((function(i){if(i?n.hide():n.showError(),i&&n.saveToPolicy){var c=R(s.value);t.pdfUI.pdfViewer.customs.passwordProtectSaveSecurityPolicy(d({userPassword:e,ownerPassword:r,cipherType:o,isEncryptMetadata:a,isAllowed:s.isAllowed},c))}})).catch((function(e){throw n.showError(e),null==v||v.setSpanException(l,error),e})).finally((function(){null==c||c()}))]:[2]}}))})),function(e,t,n,r,o,a){return s.apply(this,arguments)})),n.show(),[2]}var s}))}))()}}]),r}(g.Controller);const X=G;var W=g.PDFViewCtrl.Events,Y=g.PDFViewCtrl.shared.securityEncryptType,Z=g.PDFViewCtrl.shared.securityUtils,ee=(g.PDFViewCtrl.PDF.constant.User_Permissions,g.services.PortfolioLayoutService);const te=function(e){l(r,e);var n=y(r);function r(e){return t(this,r),n.call(this,e)}return o(r,[{key:"setRibbonButtonCallback",value:function(e){this.ribbonCallback=e}},{key:"handle",value:function(){var e=this;i(a(r.prototype),"handle",this).call(this);var t=this.pdfUI.pdfViewer.currentPDFDoc;t.getSecurityType().then((function(n){var r=function(){var r=e;e.pdfUI.confirm({message:"password-protect:dialog.remove.confirmation",level:"question"}).then(B((function(){var e,s,o,a,i,c,l,p,d;return Q(this,(function(u){switch(u.label){case 0:return[4,r.getPDFUI()];case 1:return o=u.sent(),a=o.customs,i=a.startSDKSpan,c=a.otelService,i?[4,i("remove-protection")]:[3,3];case 2:l=u.sent(),p=l.end,d=l.span,e=p,s=d,u.label=3;case 3:return t.removeSecurity().then((function(e){e&&(r.component.disable(),n===Y.Password&&(t.setPasswordType(1),t.setHasOwnerPassword(!1),Z.setPwdPopupLatestUIData(null)),r.pdfUI.eventEmitter.emit(W.securityTypeChanged))})).catch((function(e){throw null==c||c.setSpanException(s,e),e})).finally((function(){null==e||e()})),[2]}}))})),(function(){}))};switch(n){case Y.Password:Z.getInputOwnerPwd()?r():t.hasOwnerPassword()?Z.requestOwnerPassword(e.pdfUI,(function(){r()})):r();break;case Y.Certificate:r()}}))}},{key:"mounted",value:function(){var e=this,t=this.pdfUI;this.toggle(),this.addDestroyHook(t.getServiceInstance(ee).onLayoutChange((function(){e.toggle()})),t.addViewerEventListener(W.openFileSuccess,(function(t){e.toggle()})),this.pdfUI.addViewerEventListener(W.securityTypeChanged,(function(){e.toggle()})))}},{key:"toggle",value:function(){var e=this;return B((function(){var t,n;return Q(this,(function(r){switch(r.label){case 0:return[4,e.pdfUI.getCurrentPDFDoc()];case 1:return(t=r.sent())&&e.pdfUI.pdfViewer.currentPDFDoc?(n=function(t){var n,r;return null===(r=e.ribbonCallback)||void 0===r||null===(n=r.enableCallback)||void 0===n||n.call(r,t),t?e.component.enable():e.component.disable()},Promise.all([t.getUserPermissions(),t.isPdfaDoc(),t.pdfaEditable,t.getSecurityType()]).then((function(e){var r=h(e,4),s=(r[0],r[1]),o=r[2];switch(r[3]){case Y.Password:t.getPasswordType().then((function(e){n((!s||s&&o)&&(2===e||3===e))}));break;case Y.Certificate:n(t.isOwner());break;default:n(!1)}})),[2]):[2]}}))}))()}}]),r}(g.Controller);var ne=r(841),re=r.n(ne),se=r(480),oe=r.n(se),ae=r(759),ie=r.n(ae),ce=g.PDFViewCtrl.shared,le=ce.securityUtils,pe=ce.securityEncryptType,de=g.PDFViewCtrl.Events,ue=g.PDFViewCtrl.Consts.PDFDocPermission,fe=function(e){l(r,e);var n=y(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"fragments",value:function(){return[]}},{key:"init",value:function(e){var t=this;this.pdfUI=e;var n="password-protect-popup";e.registerDialog(n,(function(r,s){return t.passwordDialog?(t.passwordDialog.show(document.body,s),Promise.resolve(t.passwordDialog)):e.getComponentByName("template-container").then((function(e){e.append('\n                <password-protect:password-protect-popup name="password-protect-popup" append-to="body" class="center" modal backdrop>\n                    <layer-header title="password-protect:buttons.title" @draggable="{type:\'parent\'}"></layer-header>\n                    <layer-view></layer-view>\n                </password-protect:password-protect-popup>\n            ');var r=t.passwordDialog=e.getComponentByName(n);return r.open(document.body,s),r}))})),e.registerDialog("password-protect-permissionPopup",(function(n){return t.permDialog?Promise.resolve(t.permDialog):e.getComponentByName("template-container").then((function(e){return t.permDialog=e.append('\n                    <password-protect:password-protect-permissionPopup name="password-protect-permissionPopup" append-to="body" class="center" modal backdrop>\n                        <layer-header title="password-protect:buttons.PermissionTitle" @draggable="{type:\'parent\'}"></layer-header>\n                        <layer-view></layer-view>\n                    </password-protect:password-protect-permissionPopup>\n                ')}))}))}},{key:"receiveAction",value:function(e,t){var n=this.pdfUI;"showPasswordPopup"===e?n.openDialog("password-protect-popup").then((function(e){var n=t.data,r=t.callback;if(n&&r){var s=n.id,o=(n.modifyDate,n.method),a=n.name,i=n.desc,c=n.encrypted,l=f(n,["id","modifyDate","method","name","desc","encrypted"]);e.show(),e.updateData(l),e.setSubmitCallback((function(t,n,l,p,f,v){r(u(d({id:s,method:o,name:a,desc:i,encrypted:c,userPassword:t,ownerPassword:n,cipherType:p,isEncryptMetadata:f},le.convertPermissionToUIData(l.value)),{isAllowed:l.isAllowed})),e.hide()}))}})):"showPermissionPopup"===e&&this.pdfUI.openDialog("password-protect-permissionPopup").then((function(e){var n=t.data,r=t.callback;n&&r&&(e.show(),e.updateData(n),e.setSubmitCallback((function(t){r(t),e.hide()})))}))}}],[{key:"getName",value:function(){return"password-protect"}},{key:"getLoader",value:function(){return M()}},{key:"initOnLoad",value:function(){var e=g.modular.module("password-protect",[]),n=e.getRegistry();this.module=e,n.registerComponent(q),n.registerComponent(V),e.registerPreConfiguredComponent("password-protect-button",{template:re()(),config:[{target:"password-protect-btn",tooltip:{title:"password-protect:buttons.title"},callback:X}]}),e.registerPreConfiguredComponent("remove-protect-button",{template:oe()(),config:[{target:"remove-protect-btn",tooltip:{title:"password-protect:buttons.removeTitle"},callback:te}]});var r={template:ie()(),config:[{target:"password-protect-controllers",callback:function(e){l(r,e);var n=y(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"mounted",value:function(){var e=this;i(a(r.prototype),"mounted",this).call(this),this.addDestroyHook(this.pdfUI.addViewerEventListener(de.willCloseDocument,(function(){le.setPwdPopupLatestUIData(null),le.setInputOwnerPwd()})),this.pdfUI.addViewerEventListener(de.openFileSuccess,(function(t){e.changePermission(t)})))}},{key:"changePermission",value:function(e){var t=this;e&&!e.isDestroyed?Promise.all([e.getUserPermissions(),e.isPdfaDoc(),e.pdfaEditable,e.getSecurityType()]).then((function(n){var r,s=h(n,4),o=(s[0],s[1]),a=s[2],i=s[3];!e||e.isDestroyed?r=!1:(i===pe.Password?r=!0:(r=i===pe.Certificate?e.isOwner():!o||o&&a,e.checkPermission(ue.ModifyDocument)||(r=!1)),e.hasSignature()&&(r=!1)),r?t.component.enable&&t.component.enable():t.component.disable&&t.component.disable()})):this.component.disable&&this.component.disable()}}]),r}(g.Controller)}]};e.registerPreConfiguredComponent("password-protect-ribbon-dropdown",r)}}]),r}(g.UIXAddon)})(),s=s.default})()));