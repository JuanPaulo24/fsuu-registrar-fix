!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.SignDoc=t(require("UIExtension")):e.SignDoc=t(e.UIExtension)}(self,(e=>(()=>{var t={456:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button\nname="sign-certify-dropdown"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.signCertify"\ntext="phantom_online:toolbar.protect.signCertify"\nicon-class="fx-icon-ribbon_protect_sign_certify_certify_with_visible_signature-32"\nnot-immediately="true"\n>\n<dropdown separate="false">\n<dropdown-button\nname="place-signature"\n@tooltip\ntooltip-title="SignDoc:placeSig.tip"\nicon-class="fx-icon-page-sig"\ntext="SignDoc:placeSig.text"\n>SignDoc:placeSig.text\n</dropdown-button>\n<dropdown-button\nname="sign-document"\n@tooltip\ntooltip-title="SignDoc:signDoc.tip"\nicon-class="fx-icon-sign-document"\ntext="SignDoc:signDoc.text"\n>SignDoc:signDoc.text\n</dropdown-button>\n<dropdown-button\nname="certify-with-sig"\n@tooltip\ntooltip-title="SignDoc:certify.visibleDesc"\nicon-class="fx-icon-certify-sig"\ntext="SignDoc:certify.visible"\n>SignDoc:certify.visible\n</dropdown-button>\n<dropdown-button\nname="certify-without-sig"\n@tooltip\ntooltip-title="SignDoc:certify.invisibleDesc"\nicon-class="fx-icon-certify"\ntext="SignDoc:certify.invisible"\n>SignDoc:certify.invisible\n</dropdown-button>\n<li class="fv__ui-dropdown-separator"></li>\n<dropdown-button\nname="digital-ids-btn"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.digitalIDs"\nicon-class="fx-icon-ribbon_protect_signature_digital_ids-16"\ntext="phantom_online:toolbar.protect.digitalIDs"\n>phantom_online:toolbar.protect.digitalIDs\n</dropdown-button>\n<dropdown-button\nname="trust-certs"\n@tooltip\ntooltip-title="SignDoc:certify.trustCertsDesc"\nicon-class="fx-icon-trust-root"\ntext="SignDoc:certify.trustCerts"\n>SignDoc:certify.trustCerts\n</dropdown-button>\n</dropdown>\n</ribbon-button>\n','<ribbon-button\nname="sign-certify-dropdown"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.signCertify"\ntext="phantom_online:toolbar.protect.signCertify"\nicon-class="fx-icon-ribbon_protect_sign_certify_certify_with_visible_signature-32"\nnot-immediately="true"\n>\n<dropdown separate="false">\n<dropdown-button\nname="place-signature"\n@tooltip\ntooltip-title="SignDoc:placeSig.tip"\nicon-class="fx-icon-page-sig"\ntext="SignDoc:placeSig.text"\n>SignDoc:placeSig.text\n</dropdown-button>\n<dropdown-button\nname="sign-document"\n@tooltip\ntooltip-title="SignDoc:signDoc.tip"\nicon-class="fx-icon-sign-document"\ntext="SignDoc:signDoc.text"\n>SignDoc:signDoc.text\n</dropdown-button>\n<dropdown-button\nname="certify-with-sig"\n@tooltip\ntooltip-title="SignDoc:certify.visibleDesc"\nicon-class="fx-icon-certify-sig"\ntext="SignDoc:certify.visible"\n>SignDoc:certify.visible\n</dropdown-button>\n<dropdown-button\nname="certify-without-sig"\n@tooltip\ntooltip-title="SignDoc:certify.invisibleDesc"\nicon-class="fx-icon-certify"\ntext="SignDoc:certify.invisible"\n>SignDoc:certify.invisible\n</dropdown-button>\n<li class="fv__ui-dropdown-separator"></li>\n<dropdown-button\nname="digital-ids-btn"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.digitalIDs"\nicon-class="fx-icon-ribbon_protect_signature_digital_ids-16"\ntext="phantom_online:toolbar.protect.digitalIDs"\n>phantom_online:toolbar.protect.digitalIDs\n</dropdown-button>\n<dropdown-button\nname="trust-certs"\n@tooltip\ntooltip-title="SignDoc:certify.trustCertsDesc"\nicon-class="fx-icon-trust-root"\ntext="SignDoc:certify.trustCerts"\n>SignDoc:certify.trustCerts\n</dropdown-button>\n</dropdown>\n</ribbon-button>\n'}},254:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__export-cert-dialog" modal @var.self="$component">\n<layer-header class="fv__export-cert-header" @draggable="{type:\'parent\'}" title="SignDoc:exportCert.header" ></layer-header>\n<layer-view>\n<div class="upper">\n<div class="subtitle">SignDoc:exportCert.subtitle</div>\n<div class="certTitle">SignDoc:exportCert.certTitle</div>\n<div class="certInfo">SignDoc:exportCert.certInfo</div>\n</div>\n<div class="lower">\n<div class="optionTitle">SignDoc:exportCert.option.title</div>\n<div class="formatHint">SignDoc:exportCert.option.formatHint</div>\n<div class="input disabled">\n<input type="radio" disabled class="disabled"/>\n<span>SignDoc:exportCert.option.email</span>\n</div>\n<div class="input"><input type="radio" checked="1"/>\n<span>SignDoc:exportCert.option.file</span></div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>','<layer class="center fv__export-cert-dialog" modal @var.self="$component">\n<layer-header class="fv__export-cert-header" @draggable="{type:\'parent\'}" title="SignDoc:exportCert.header" ></layer-header>\n<layer-view>\n<div class="upper">\n<div class="subtitle">SignDoc:exportCert.subtitle</div>\n<div class="certTitle">SignDoc:exportCert.certTitle</div>\n<div class="certInfo">SignDoc:exportCert.certInfo</div>\n</div>\n<div class="lower">\n<div class="optionTitle">SignDoc:exportCert.option.title</div>\n<div class="formatHint">SignDoc:exportCert.option.formatHint</div>\n<div class="input disabled">\n<input type="radio" disabled class="disabled"/>\n<span>SignDoc:exportCert.option.email</span>\n</div>\n<div class="input"><input type="radio" checked="1"/>\n<span>SignDoc:exportCert.option.file</span></div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>'}},963:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__trust-certs-dialog" modal @var.self="$component">\n<layer-header class="fv__trust-certs-header" @draggable="{type:\'parent\'}" title="SignDoc:certify.header" ></layer-header>\n<layer-view>\n<div class="tools">\n<div @on.click="self.onEditCertView()">SignDoc:certify.edit</div>\n<div class="addCert">\n<div>\nSignDoc:certify.add\n</div>\n<input title="" type="file" accept=".p7b,.pbc,.cer" />\n</div>\n<div @on.click="self.onViewTrustCert()">SignDoc:certify.view</div>\n<div @on.click="self.onExportTrustCert()">SignDoc:certify.export</div>\n<div @on.click="self.onDeleteTrustCert()">SignDoc:certify.delete</div>\n</div>\n<div class="cert-list">\n<div class="header">\n<div class="w30p">SignDoc:certify.name</div>\n<div class="w30p">SignDoc:certify.issuedBy</div>\n<div class="w20p">SignDoc:certify.trust</div>\n<div>SignDoc:certify.expiredData</div>\n</div>\n<div class="body" name="cert-body"></div>\n</div>\n<div class="cert-info">\n<div class="subjectName">\n<label>SignDoc:certify.certName</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="validPeriodFrom">\n<label>SignDoc:certify.validFrom</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:certify.validTo</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:certify.intent</label>\n<div></div>\n</div>\n</div>\n<div class="footer">\n<div class="closeButton" @on.click="self.hide()">SignDoc:certify.close</div>\n</div>\n</layer-view>\n</layer>','<layer class="center fv__trust-certs-dialog" modal @var.self="$component">\n<layer-header class="fv__trust-certs-header" @draggable="{type:\'parent\'}" title="SignDoc:certify.header" ></layer-header>\n<layer-view>\n<div class="tools">\n<div @on.click="self.onEditCertView()">SignDoc:certify.edit</div>\n<div class="addCert">\n<div>\nSignDoc:certify.add\n</div>\n<input title="" type="file" accept=".p7b,.pbc,.cer" />\n</div>\n<div @on.click="self.onViewTrustCert()">SignDoc:certify.view</div>\n<div @on.click="self.onExportTrustCert()">SignDoc:certify.export</div>\n<div @on.click="self.onDeleteTrustCert()">SignDoc:certify.delete</div>\n</div>\n<div class="cert-list">\n<div class="header">\n<div class="w30p">SignDoc:certify.name</div>\n<div class="w30p">SignDoc:certify.issuedBy</div>\n<div class="w20p">SignDoc:certify.trust</div>\n<div>SignDoc:certify.expiredData</div>\n</div>\n<div class="body" name="cert-body"></div>\n</div>\n<div class="cert-info">\n<div class="subjectName">\n<label>SignDoc:certify.certName</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="validPeriodFrom">\n<label>SignDoc:certify.validFrom</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:certify.validTo</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:certify.intent</label>\n<div></div>\n</div>\n</div>\n<div class="footer">\n<div class="closeButton" @on.click="self.hide()">SignDoc:certify.close</div>\n</div>\n</layer-view>\n</layer>'}},182:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__view-certs-dialog" modal @var.self="$component">\n<layer-header\nclass="fv__view-certs-header"\n@draggable="{type:\'parent\'}"\ntitle="SignDoc:viewCert.header"\n></layer-header>\n<layer-view>\n<div class="details">\n<div class="title">SignDoc:viewCert.detailTitle</div>\n<div class="subjectName">\n<label>SignDoc:viewCert.subject</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:viewCert.usage</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:viewCert.expiration</label>\n<div></div>\n</div>\n</div>\n<div class="trust">\n<div class="title">SignDoc:viewCert.trust</div>\n<div class="info">SignDoc:viewCert.trustInfo</div>\n<div class="input">\n<input type="checkbox" id="trustRoot"></input>\n<label type="trustRoot">SignDoc:viewCert.trustRoot</label>\n</div>\n<div class="afterSign">SignDoc:viewCert.afterSign</div>\n<div class="input">\n<input type="checkbox" class="disabled" id="valid"></input>\n<label type="trustRoot">SignDoc:viewCert.valid</label>\n</div>\n<div class="input">\n<input type="checkbox" id="validCert"></input>\n<label type="trustRoot">SignDoc:viewCert.validCert</label>\n</div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>\n','<layer class="center fv__view-certs-dialog" modal @var.self="$component">\n<layer-header\nclass="fv__view-certs-header"\n@draggable="{type:\'parent\'}"\ntitle="SignDoc:viewCert.header"\n></layer-header>\n<layer-view>\n<div class="details">\n<div class="title">SignDoc:viewCert.detailTitle</div>\n<div class="subjectName">\n<label>SignDoc:viewCert.subject</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:viewCert.usage</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:viewCert.expiration</label>\n<div></div>\n</div>\n</div>\n<div class="trust">\n<div class="title">SignDoc:viewCert.trust</div>\n<div class="info">SignDoc:viewCert.trustInfo</div>\n<div class="input">\n<input type="checkbox" id="trustRoot"></input>\n<label type="trustRoot">SignDoc:viewCert.trustRoot</label>\n</div>\n<div class="afterSign">SignDoc:viewCert.afterSign</div>\n<div class="input">\n<input type="checkbox" class="disabled" id="valid"></input>\n<label type="trustRoot">SignDoc:viewCert.valid</label>\n</div>\n<div class="input">\n<input type="checkbox" id="validCert"></input>\n<label type="trustRoot">SignDoc:viewCert.validCert</label>\n</div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>\n'}},180:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},r=Object.create(i),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var i="",r=void 0,a=void 0,c=void 0;for(r=n.index,a=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:c="&#34;";break;case 38:c="&#38;";break;case 39:c="&#39;";break;case 60:c="&#60;";break;case 62:c="&#62;";break;default:continue}a!==r&&(i+=t.substring(a,r)),a=r+1,i+=c}return a!==r?i+t.substring(a,r):i}(a(e))},r.$each=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(e,t,n,i,r,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(i,r)}function t(t){return function(){var n=this,i=arguments;return new Promise((function(r,o){var a=t.apply(n,i);function c(t){e(a,r,o,c,s,"next",t)}function s(t){e(a,r,o,c,s,"throw",t)}c(void 0)}))}}function n(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):n(e,t)}function o(e,t){if(!n(e,t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function f(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(e){c=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw r}}return o}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(y=function(){return!!e})()}function h(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function m(e){var t=y();return function(){var n,i=g(e);if(t){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h(this,n)}}i.d(r,{default:()=>q});function b(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],i=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var S,D,w=i(616),C=i(180),k=i.n(C),x=i(456),_=i.n(x);function T(e,t,n){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}},T(e,t,n||e)}function N(e){return function(e){d(n,e);var t=m(n);function n(e){return o(this,n),t.call(this,e,"square")}return c(n,[{key:"start",value:function(e){T(g(n.prototype),"start",this).call(this,e),Object.assign(this.currentFakeAnnot.annotationInfo,{borderInfo:{width:0,style:1},color:9224925,fillColor:13426668,opacity:.5})}},{key:"end",value:function(){var e=this.currentFakeAnnot;S(e.page.getIndex(),e.pdfRect,e),this.currentFakeAnnot=null}},{key:"destroyPageHandler",value:function(){T(g(n.prototype),"destroyPageHandler",this).call(this),this.currentFakeAnnot&&this.currentFakeAnnot.destroy()}}],[{key:"getStateName",value:function(){return"createRect"}},{key:"getSubtype",value:function(){return D}},{key:"setParams",value:function(e){var t=e.callback,n=e.type;S=t,D=n}}]),n}(e.simpleShapeHandler)}var I=i(963),P=i.n(I),R=i(182),j=i.n(R),F=w.vendors.jQuery,O=function(e){d(n,e);var t=m(n);function n(){return o(this,n),t.apply(this,arguments)}return c(n,[{key:"show",value:function(e,t,i){T(g(n.prototype),"show",this).call(this,e),this.updateCert=i,this.cert=t;var r=t.usage,o=t.isCertTrustedRoot;this.certDate={usage:r,isCertTrustedRoot:o};var a=F(this.element);a.find("#trustRoot")[0].checked=o,["subjectName","issuerName","keyUsageStr","validPeriodTo"].map((function(e){a.find("."+e+" div").html(t[e])})),a.find("#valid").addClass("disabled")[0].checked=1,a.find("#validCert")[0].checked=2&r}},{key:"onOk",value:function(){this.updateCert(Object.assign({},this.cert,this.certDate)),this.hide()}},{key:"mounted",value:function(){var e=this;T(g(n.prototype),"mounted",this).call(this),F(this.element).find("input").on("change",(function(t){switch(t.target.id){case"trustRoot":e.certDate.isCertTrustedRoot=t.target.checked;break;case"valid":t.target.checked?e.certDate.usage|=1:e.certDate.usage&=2;break;case"validCert":t.target.checked?e.certDate.usage|=2:e.certDate.usage&=1}}))}}],[{key:"getName",value:function(){return"ViewTrustCertsDialog"}}]),n}(w.SeniorComponentFactory.createSuperClass({template:j()()})),U=i(254),A=i.n(U),B=w.vendors.jQuery,E=(w.toolkit.CertUtil,function(e){d(n,e);var t=m(n);function n(){return o(this,n),t.apply(this,arguments)}return c(n,[{key:"show",value:function(e,t){T(g(n.prototype),"show",this).call(this,e),this.cert=t;var i=B(this.element).prev();i.length&&i.hasClass("fv__ui-layer-modal")&&i.css("zIndex",B(this.element).css("zIndex"))}},{key:"onOk",value:function(){(0,w.vendors.saveAs)(this.cert.cerFile,this.cert.subjectName+".cer"),this.hide()}}],[{key:"getName",value:function(){return"ExportCertDialog"}}]),n}(w.SeniorComponentFactory.createSuperClass({template:A()()}))),V=w.vendors.jQuery,H=w.toolkit.CertUtil,M=function(e){d(n,e);var t=m(n);function n(){return o(this,n),t.apply(this,arguments)}return c(n,[{key:"mounted",value:function(){var e=this;T(g(n.prototype),"mounted",this).call(this),V(this.element).find(".addCert input").on("change",(function(t){var n=t.target.files[0],i=e.pdfUI;i.getCurrentPDFDoc().then((function(e){return e.engine.getCertificateInfo(n,"")})).then((function(t){t.serial?H.addTrustedCertToCertificateList(t,!1).then((function(n){n.serialNumber=t.serial;var r=V('<div class="cert selected" id="'.concat(n.uniqueSerialNumber,'">\n                    <div class="w30p" title="').concat(n.subjectName,'">').concat(n.subjectName,'</div>\n                <div class="w30p" title="').concat(n.issuerName,'">').concat(n.issuerName,'</div>\n                    <div class="w20p trustRoot">').concat(n.isCertTrustedRoot?i.i18n.t("SignDoc:trustedRoot"):i.i18n.t("SignDoc:nonTrustedRoot"),"</div>\n                    <div>").concat(n.validPeriodTo,"</div></div>"));V(e.element).find(".cert-list .body .selected").removeClass("selected"),V(e.element).find(".cert-list .body").prepend(r),r[0].scrollIntoView(),e.onSelectCert(n.uniqueSerialNumber)})):i.alert({message:"SignDoc:certify.notCert",level:"warning"})})),t.target.value=""})),V(this.element).find(".cert-list .body").on("click",(function(t){V(e.element).find(".cert-list .body .selected").removeClass("selected");var n=t.target,i=n.id;i.length||(i=(n=n.parentElement).id),V(n).addClass("selected"),e.onSelectCert(i)}))}},{key:"show",value:function(e){var t=this;T(g(n.prototype),"show",this).call(this,e);var i=this.pdfUI;H.getTrustedCertificateList(this.pdfUI).then((function(e){var n="",r=0;e.map((function(e,t){e.subjectName&&(n+='<div class="cert '.concat(r?"":"selected",'" id="').concat(e.uniqueSerialNumber,'">\n                    <div class="w30p" title="').concat(e.subjectName,'">').concat(e.subjectName,'</div>\n                <div class="w30p" title="').concat(e.issuerName,'">').concat(e.issuerName,'</div>\n                <div class="w20p trustRoot">').concat(e.isCertTrustedRoot?i.i18n.t("SignDoc:trustedRoot"):i.i18n.t("SignDoc:nonTrustedRoot"),"</div>\n                <div>").concat(e.validPeriodTo,"</div></div>"),r=t+1)})),V(t.element).find(".cert-list .body").empty().append(n),["subjectName","issuerName","validPeriodFrom","validPeriodTo","keyUsageStr"].map((function(n){V(t.element).find(".cert-info ."+n+" div").html(e[r-1][n])}));var o=V(t.element).prev();o.length&&o.hasClass("fv__ui-layer-modal")&&o.css("zIndex",V(t.element).css("zIndex"))}))}},{key:"onEditCertView",value:function(){var e=this,t=this.pdfUI,n=function(n){H.addTrustedCert(n),V(e.element).find(".body .selected .trustRoot").html(n.isCertTrustedRoot?t.i18n.t("SignDoc:trustedRoot"):t.i18n.t("SignDoc:nonTrustedRoot"))};this.getSelectedCert().then((function(i){if(e.viewTrustCertsDialog)e.viewTrustCertsDialog.show(document.body,i,n);else{var r="viewTrustCertsDialog";w.modular.module("certify").registerComponent(O),t.registerDialog(r,(function(){return t.getComponentByName("template-container").then((function(t){t.append('<certify:ViewTrustCertsDialog name="'.concat(r,'"></certify:ViewTrustCertsDialog>'));var o=e.viewTrustCertsDialog=t.getComponentByName(r);return o.show(document.body,i,n),o}))})),t.openDialog(r)}}))}},{key:"onAddTrustCert",value:function(){}},{key:"onViewTrustCert",value:function(){var e=this;this.getSelectedCert().then((function(t){if(e.certViewerDialog)return e.certViewerDialog.show({certificateInfo:t,fromTrustMgr:1},!0),Promise.resolve(e.certViewerDialog);e.certViewerDialog=new w.CertificateViewerComponent(e.pdfUI),e.certViewerDialog.show({certificateInfo:t,fromTrustMgr:1},!0)}))}},{key:"onExportTrustCert",value:function(){this.pdfUI;this.getSelectedCert().then((function(e){saveAs(e.cerFile,e.subjectName+".cer")}))}},{key:"onDeleteTrustCert",value:function(){var e=this;this.getSelectedCert().then((function(t){var n=function(){H.removeTrustedCert(t.uniqueSerialNumber),V(e.element).find(".body .selected").remove();var n=V(e.element).find(".body>div:first-child").addClass("selected");e.onSelectCert(n[0].id)};e.pdfUI.confirm({again:!0,message:"SignDoc:certify.deleteConfirm",level:"prompt",id:"SignDocCertifyDeleteConfirm"}).then(n,n)}))}},{key:"onSelectCert",value:function(e){var t=this;H.getTrustedCertificateList(this.pdfUI).then((function(n){var i=n.find((function(t){return t.uniqueSerialNumber==e}));["subjectName","issuerName","validPeriodFrom","validPeriodTo","keyUsageStr"].map((function(e){V(t.element).find(".cert-info ."+e+" div").html(i[e])}))}))}},{key:"getSelectedCert",value:function(){var e=V(this.element).find(".body .selected")[0].id;return H.getTrustedCertificateList(this.pdfUI).then((function(t){return t.find((function(t){return t.uniqueSerialNumber==e}))}))}}],[{key:"getName",value:function(){return"TrustCertsDialog"}}]),n}(w.SeniorComponentFactory.createSuperClass({template:P()()})),L=UIExtension.PDFViewCtrl.shared.download;function W(e,t,n,i){return $.apply(this,arguments)}function $(){return $=t((function(e,n,i,r){var o,a,c,s,l,d,u;function f(e){return v.apply(this,arguments)}function v(){return v=t((function(t){var n,i,r=arguments;return b(this,(function(o){return n=r.length>1&&void 0!==r[1]?r[1]:null,t?(i="",e.getCurrentPDFDoc().then((function(e){(i=e.getFileName()||"").length<1&&(i="untitled.pdf");var r=JSON.parse(JSON.stringify(t));return e.sign(r,t.sign,n)})).then((function(t){var n=e.customs,r=n.autoDownloadAfterSign,o=n.getSignedDocument;return(void 0===r||r)&&L(new Blob([t],{type:"application/octet-stream"}),i.replace(".pdf","_signed.pdf")),"function"==typeof o&&o(t),e.openPDFByFile(t,{fileName:i})})),[2]):[2]}))})),v.apply(this,arguments)}return b(this,(function(t){switch(t.label){case 0:return[4,e.pdfViewer.viewerUI.getSignatureUI()];case 1:return o=t.sent(),[4,n.getPDFForm().getField(i)];case 2:if(a=t.sent(),c=e.getSignatureWorkflowService(),s=c.getSigningSettingsList(),l=e.signatureFlowHandler&&e.signatureFlowHandler.sign,s.length<1&&!l)throw new Error("No signature sign Handler");return 4===a.signatureType?[2,e.alert({message:"signDocument.notSupportPagingSeal",level:"warning"})]:l?[2,l(a).then((function(e){return e.fieldName=i,e.hashAlgorithm=0,f(e)}))]:(d=e.pdfViewer.getDeprecatedStorage().getItem("SignSetting")||{},(u=d[n.id]&&d[n.id][i])?[2,f(u[0],u[1])]:[4,o.getSignDocumentDialog()]);case 3:return[4,t.sent().openWith(a,(function(e,t){return e&&f(e,t)}))];case 4:return t.sent(),[2]}}))})),$.apply(this,arguments)}var q=function(e){d(i,e);var n=m(i);function i(){return o(this,i),n.apply(this,arguments)}return c(i,[{key:"signDocWithoutAnnot",value:function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"placeSig",o=this;return t((function(){var t;return b(this,(function(a){switch(a.label){case 0:return t=o.pdfUI,o.lastMark&&o.lastMark.destroy(),o.lastMark=i,[4,t.getViewerUI()];case 1:return[4,a.sent().getSignatureUI()];case 2:return[4,a.sent().getSignDocumentDialog()];case 3:return a.sent().openWith(null,(function(o,a){if(o){var c,l="";if("true"==window.localStorage.getItem("SignLater")&&"certifyInvisibleSig"!=r)return t.$confirm({message:"SignDoc:signLater",level:"prompt",title:"sidebar.signature.dialog.title",id:"signLater",again:!0,customBtns:[{id:"yes",text:"dialog.ok"}]}),t.getStateHandlerManager().then((function(e){return c=e,t.getPDFViewer()})).then((function(t){var i=t.currentPDFDoc,r=t.getPDFPageRender(e),c={mkRotate:((r.rotate/90||0)+r.page.getRotation())%4},l=function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;n=e.i18n.t("form-designer:prefix."+i);var r="",o=t.countField(i,!1,!1),a="";do{a=n+o,r=t.fieldsNameMap[a],o+=1}while(r);return a}(t,i.form);o.fieldName=l,delete o.pageIndex;var d=t.getStorage().getItem("SignSetting")||{};return d[i.id]=s({},l,[o,a]),t.getStorage().setItem("SignSetting",d),i.form.addSignature(e,n,l,c)})).then((function(e){return c.switchTo("select-annotation")}));var d=null;t.getCurrentPDFDoc().then((function(e){d=e,(l=e.getFileName()||"").length<1&&(l="untitled.pdf");var t=JSON.parse(JSON.stringify(o));return t.noCheckRect="certifyInvisibleSig"==r,e.sign(t,o.sign,a)})).then((function(e){var n=t.customs,r=n.autoDownloadAfterSign,o=n.getSignedDocument;return(void 0===r||r)&&saveAs(e,l.replace(".pdf","_signed.pdf")),"function"==typeof o&&o(e),d.docModified=!1,d.otherOptions.disableSavePrompt=!0,i.destroy(),t.openPDFByFile(e,{fileName:l,isOpenNewFileAfterClose:1})}))}else i.destroy()}),e,n,r),[2]}}))}))()}},{key:"updateButton",value:function(e){return t((function(){return b(this,(function(e){return[2]}))}))()}},{key:"initOnload",value:function(e){var t=this,n="exportCertDialog";w.modular.module("certify",[]).registerComponent(E),e.registerDialog(n,(function(i,r){return e.getComponentByName("template-container").then((function(e){t.exportCertDialog&&t.exportCertDialog.show(document.body,r),e.append('<certify:ExportCertDialog name="'.concat(n,'"></certify:ExportCertDialog>'));var i=t.exportCertDialog=e.getComponentByName(n);return i.show(document.body,r),i}))}))}},{key:"registerPlaceSigStateHandler",value:function(e){e.getStateHandlerManager().register(N(e))}},{key:"init",value:function(e){this.pdfUI=e;var n,i=this,r=(n=t((function(n){return b(this,(function(o){return"fv--protect-tab-paddle"==n.name&&(e.waitComponent("sign-group").then(function(){var o=t((function(o){return b(this,(function(a){return o.insertTemplate?(o.insertTemplate(_()(),1,[{target:"sign-document",config:{callback:t((function(){var t,n;return b(this,(function(i){switch(i.label){case 0:return e.customs.sendGAEvent({eventKey:"sign_document",label:"protect_tab"}),[4,e.getCurrentPDFDoc()];case 1:return[4,(t=i.sent()).getSignaturesInfo()];case 2:return(n=i.sent()).unsignCount?pdfui.confirm({message:"SignDoc:moreSigns",level:"prompt"}).then((function(i){W(e,t,n.firstUnsignedName)})):W(e,t,n.firstUnsignedName),[2]}}))}))}},{target:"place-signature",config:{callback:function(){e.customs.sendGAEvent({eventKey:"place_signature",label:"protect_tab"}),e.getStateHandlerManager().then((function(e){"hand"===e.get("createRect").getStateName()&&e.register(N(e.pdfViewer)),e.switchTo("createRect",{callback:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.signDocWithoutAnnot.apply(i,p(t))},type:"place-signature"})}))}}},{target:"certify-with-sig",config:{callback:function(){return i.onCertifyWithSig()}}},{target:"certify-without-sig",config:{callback:function(){return i.onCertifyWithoutSig()}}},{target:"trust-certs",config:{callback:function(){return i.onShowTrusts()}}}]),e.getCurrentPDFDoc().then((function(t){t&&(i.signDocBtn=o.getComponentByName("sign-document"),i.placeSigBtn=o.getComponentByName("place-signature"),i.certifyVisibleSig=o.getComponentByName("certify-with-sig"),i.certifyInvisibleSig=o.getComponentByName("certify-without-sig"),e.customs.proxyComponent(o.getComponentByName("digital-ids-btn")),i.updateButton(t))})),[2]):[2,setTimeout((function(){return r(n)}),300)]}))}));return function(e){return o.apply(this,arguments)}}()),e.addViewerEventListener(s({},w.UIEvents.willCloseDocument,(function(){e.pdfViewer.getDeprecatedStorage().setItem("SignSetting",{})})))),[2]}))})),function(e){return n.apply(this,arguments)});e.getRootComponent().then((function(e){e.getComponentByName("sign-group")?r(e.getComponentByName("fv--protect-tab-paddle")):e.on("lazy-content",r)}))}},{key:"receiveAction",value:function(e,t){switch(e){case"signMultipleFiles":var n=v(t,5),i=n[0],r=n[1],o=n[2],a=n[3],c=n[4];return Promise.all(o.map((function(e){var t=e.pdfDoc;return t.loadPDFForm().then((function(){var n=i.fieldName;return n&&!t.form.getField(n)?{msg:"NoSignature",error:1,name:e.file.name}:i.pageIndex<0||i.pageIndex>=t.getPageCount()?{msg:"NoPage",error:1,name:e.file.name}:("certifyInvisibleSig"==c&&(i.rect={left:0,right:0,top:0,bottom:0},i.noCheckRect=1),t.sign(i,i.sign,r).then((function(e){var n=t.getFileName()||"";return n.length<1&&(n="untitled.pdf"),n=n.toLowerCase(),"string"==typeof e?{msg:e,error:1,name:n}:(2==a.namingType&&(n=a.insertBefore+n.replace(".pdf",a.insertAfter+".pdf")),{file:e,name:n,error:0})})))}))}))).then((function(e){return o.map((function(e){return e.pdfDoc.destroy()})),e}));case"signDoc":return W.apply(void 0,p(t))}}},{key:"fragments",value:function(){return[]}},{key:"onCertifyWithSig",value:function(){var e=this;this.pdfUI.getStateHandlerManager().then((function(t){var n=e;"hand"===t.get("createRect").getStateName()&&t.register(N(t.pdfViewer)),t.switchTo("createRect",{callback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.signDocWithoutAnnot.apply(n,p(t).concat(["certifyVisibleSig"]))},type:"certify-with-signature"})}))}},{key:"onCertifyWithoutSig",value:function(){var e=this;this.pdfUI.getPDFDocRender().then((function(t){e.signDocWithoutAnnot(t.getCurrentPageIndex(),{left:0,right:0,top:0,bottom:0},{destroy:function(){}},"certifyInvisibleSig")}))}},{key:"onShowTrusts",value:function(e){var t,n=this,i=this.pdfUI,r=w.toolkit.CertUtil;if(this.trustCertsDialog)return this.trustCertsDialog.show(document.body),e&&e(),Promise.resolve(this.trustCertsDialog);i.loading().then((function(e){return t=e,r.getTrustedCertificateList(n.pdfUI)})).then((function(){t.hide();var r="trustCertsDialog";w.modular.module("certify").registerComponent(M),i.registerDialog(r,(function(){return i.getComponentByName("template-container").then((function(e){e.append('<certify:TrustCertsDialog name="'.concat(r,'"></certify:TrustCertsDialog>'));var t=n.trustCertsDialog=e.getComponentByName(r);return t.open(document.body),t}))})),i.openDialog(r),e&&e()}))}}],[{key:"getName",value:function(){return"SignDoc"}},{key:"getLoader",value:function(){return k()}}]),i}(w.UIXAddon)})(),r=r.default})()));